/*! AgoraRTC|BUILD v3.6.11-0-gbdacc5f-dirty */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("AgoraRTC",[],t):"object"==typeof exports?exports.AgoraRTC=t():e.AgoraRTC=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=96)}([function(e,t,n){"use strict";n.r(t);var r,i=n(11),o=n.n(i),a=function(){var e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()},s=n(14),c=n(2),u=n(1),l=n(48),d=n.n(l),h=n(49),f=n.n(h),p=new Array(32).fill(void 0);function m(e){return p[e]}p.push(void 0,null,!0,!1);var g=p.length;function v(e){var t=m(e);return function(e){e<36||(p[e]=g,g=e)}(e),t}var y=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});y.decode();var b=null;function _(){return null!==b&&b.buffer===r.memory.buffer||(b=new Uint8Array(r.memory.buffer)),b}function E(e,t){return y.decode(_().subarray(e,e+t))}function S(e){g===p.length&&p.push(p.length+1);var t=g;return g=p[t],p[t]=e,t}var w=0,T=new TextEncoder("utf-8"),A="function"==typeof T.encodeInto?function(e,t){return T.encodeInto(e,t)}:function(e,t){var n=T.encode(e);return t.set(n),{read:e.length,written:n.length}},R=null;function x(){return null!==R&&R.buffer===r.memory.buffer||(R=new Int32Array(r.memory.buffer)),R}var I,O=function(){function e(){d()(this,e)}return f()(e,[{key:"free",value:function(){var e=this.ptr;this.ptr=0,r.__wbg_signmanager_free(e)}},{key:"get_digest",value:function(e){return v(r.signmanager_get_digest(this.ptr,S(e)))}}],[{key:"__wrap",value:function(t){var n=Object.create(e.prototype);return n.ptr=t,n}},{key:"new",value:function(){var t=r.signmanager_new();return e.__wrap(t)}}]),e}(),C=!1,M=null,N=0,L="free",k=[],P=[],D=0;(M?Promise.resolve(M):new Promise((function(e){C||r||function e(){var t={wbg:{}};t.wbg.__wbindgen_object_drop_ref=function(e){v(e)},t.wbg.__wbindgen_string_new=function(e,t){return S(E(e,t))},t.wbg.__wbindgen_string_get=function(e,t){var n=m(t),i="string"==typeof n?n:void 0,o=null==i?0:function(e,t,n){if(void 0===n){var r=T.encode(e),i=t(r.length);return _().subarray(i,i+r.length).set(r),w=r.length,i}for(var o=e.length,a=(i=t(o),_()),s=0;s<o;s++){var c=e.charCodeAt(s);if(c>127)break;a[i+s]=c}if(s!==o){0!==s&&(e=e.slice(s)),i=n(i,o,o=s+3*e.length);var u=_().subarray(i+s,i+o);s+=A(e,u).written}return w=s,i}(i,r.__wbindgen_malloc,r.__wbindgen_realloc),a=w;x()[e/4+1]=a,x()[e/4+0]=o},t.wbg.__wbindgen_throw=function(e,t){throw new Error(E(e,t))};for(var n=Uint8Array.from(atob("55ZBgM/2Bzm2JGhNn//ljJsSorhWUYE66a1Hf8O7pfQGR2zfol8qRP6CDhsi3iG7nFZu9stSyPq/qu2Rr2w8QkTGP6Gm2cg3J5qsQgq5bcHA9mDpGv/b24uEwsixZVl1eGkdV4SB/6ayw2v48hLmNA+w5UlnTCiWwerzESQPidpSUMbamXL3pU815EQm12GhhZ9aWzo568gdZvXevBc/WHfFKQSuTgWva4e4eSmW7UxpH8sY4HlDsCTMu0WwEB8B95XsZwOp3GLgfOQmJBw036DgIKU+XGn4KpIEq77WE/h6R7sZKsFUp+u+2cDnW7IPNe7xfd9areFo0EUh0/9K9CqxUkLqMB5hlgS1fwQHRzKPhQ7gALyc6HwMCPooS0M1NrzjdfH3vUn0PeQ1GBlnrnXgiu8TunfHg5TcbBfPEbxbyiiow1Np+VEBlHNh00PiAWyu024NHaPbDGfMtzu4WF02fgkh8Pxb7bCSpCZndjTytQgAzfZxk2bbe6NoHHFnsviqYzHVpxoPEk7icHRWcZC28d2muthq673KCMQay1fJcPqSTuYhWUZS5eylIguT33lP+TBbOWQI8KtCzBN5FzqILfKzRkzrJ3L192BUF8SILdwmriv10HU9ZlQAyQA1VdegnzOl/dYk2GGsB3724y7w/7aJLHJzEfwrfIzFd5CoAft7ct+zQW2G4Wm2kpoz6uJfgrNyykQgwCO6pkPy1ADrBUuJon9ySjhgcFru6AKa99wTlIhzBw3FKFt9Aa1/1KWWy7W1wAIGzRTs/7rLXRkKFjNqGVXBdoVNTpHFtfEFsuX0X98ISr0Bennlx0h2Yl/CGNb5Kc7i3bio1XJHX24avcMsEAwfdfskCki4/dkStn7QC97YJC3z+7gD84IiEEeGcnn7gHJyeALr0ssbqDUcKqxEyheyFs9FToJziLB+eYw6nMQLmYTrQyrg3b+3YBdgx7pzNEDSyz3tmaPaikwcLSyB/Igo6U/oP/fS2TZLtmN03m4iS76YrDJAgI+2W1GboabuixVcLdxm6SQ4CzUnHSPl1knhcGhW/+OcKa53tB5j5C4wEpiENv6T9PUu4K0YwtEAqFbd/eN2wVAYCKn/nlVA8uiESxCfgs0411mRFk4i1pixJLPP5AFPG9QFZnj6X19TqmhmIhl8D6Q1rOvPCqPZV/z04HjayX4qPzPzP/5NVilN/sHhQe7ulriGmU/3rj5QEuiOymsL7EdCQMc/4mXDPdVrDBfbt6dnv11oLYGmqOP1oSBj02FtsmYrMn9pRg7HJoCh86jAnzuOYn4tGnQ4gw/89sb64NAXcoIbTIjyiHBAQCCK2Yn4I/fNF10rkQlvSvkpqLG2eYpJmpWrcouNDEUtJFR607oNraLdmUKyLc1g7SNpS+ofp1FL6rua/HFSrb5kTF2Vcy2gl+6MACbFRChKoP/un7IbYJuOima/JWFZcs/MXokIx+ijuqjMtVKaYRTzNI5ncPa2y/EXTNdUUFpMhbE7sa39Uoh6Hci/viXy2KFTNbiw+BkWOPnyOr04LjIYKlJ8ud/KvjuvNUGQOHJvj6tpZJxj97tr0OrgZCAxSHGU5JQfqEd/U0QfzGM8Wh3zdsnd9LhoIIRJAtyA2PmjwJk4zTxeYlgwPqAVTU3+9bA1QD+jLZZ3Ffk3MRq+Ar2RT8YN6ASR4bItt3omBj0LJe0zeGY3OzfhljL6LA1m4+IUp+CzeWo0aEjnvRk3iCJeajgdC+NUGB5qh8PWKtBeC58woavnRjvRNphXS4b9M7Aymcfq26B2YY2lS+wLf763OnGJlVdV/srgyAUJJZjarxom4zrYy23kLFB8zFzWuwSMue5Xm1YWape91JGDuRLIctrJWU47/XfLm6Zgei4xOwq1RcjikGuaZtDwcFg9aKtO+JOGJsCjy9AiPnmt+rmdX83GsT3KtTETnLv6ZQcnGtmt4H8AjFgGYePdQc40cj8VAOV8NCLspyW5w63b3g37GXJrzjm9Fym3fh27psjo5RuTs7XCSrNENxKm9jCcXPqWxyuXJSn6dhdWnw5SAnUjixXviWS4HsnYjw4Xt4cSwkqCB9naLstVXt5D2HgG4fzHFNHvnETft0mrhU81IBDTSyNFdDvFEX8cifoc6FcNq7pzXlotl2ZS1FIzNXddZrdXpBNYZPV52gtCok6ePpUR/Y8jyJpE9P3q8dmFVivVGgmKTcBKMDDbzeOfl4MpOGBtBX/Lab/kzqG42sTyOyGUyOoFXYGMUWJ33GPI2KNa/mW8zVl+imshfbj7PiK1qRUn74KjAkH4wjKnu50AONYUaiveSdwnEc1zCjZSJ3dmBKSxhWAcO2PdHBg5m9+JCiPGCVfK9dzoM8Bm7xx9noJiqt4hNiVa5di1Fd1JRN4rnd1DbKglKpAVSoqvJPxmuyH56TFE4BQjhfKbDMZezQJqx+KXDiW1JWGeDYaPVBWPYeZX6STIzC/DjS7UFlqoKgGGAGP17x8wmMRE6O/axG5jDzloCGxCmrymT0ZGCh4g54O1iDYUtmJr7Bo1d+H9RQj2Y10BxcMkLFTIZVjm9e3vtIbeRx0OdXE1Ou37J/WeJZyPXn1fszvp/KonCqVnt862LrxfoB/0sF5gk4Y/f6LVneU5hun9/V1OVre9XrnDBhcVaQa9Ye6gs8sHW9HCNchaFbkUpxSiyxVEFZIlbejbjSPFlkYOLhtQHduwZWRHWA9akqykJNG3PKvOZAaJG5nWQq8+e4K0JF/AXTKIIr4J7zDt8ZR4xb9T2gxjl1nfqzidMRIY5B4rkw0oetta+j8rqkFpTEGA+hU/tw7bDtpkPYvCguwncnCjwULNFT9I9jXx3H4Ws3WWMCit29F7kGq2Ka+rU/MjnuP0lsXkoB1rr8LawHH5gaf8rajq/BhKrGTIfjDiZG5qz+L7SZBZsMSZZ9pM1QhKju+GTD9iC+9HlhfXMtj94gz8U4h7eGXziEO7lo7LwLL6/DVMrGbkv68JYUYhGz2yBm/8cbQEh5vhakbhmpv1K6XYM9rzdsd9bwYcYt3cfKE3m+/NrUa42+RpJBdFg7cAmxsZ7/0TMyVw6Aqu2gzldb2ag4iLrPNEyW1ywaJ2DXMgPi/sjnDzhuo+vIUrc86j4ZLhT4GAN6uqwbnXq5UDzX7TfuB48oMvvE1sK5q6owkdWfklgnC6pSBpK7wl+e3kuvaYnGRGJJMBQuVgWL1awHrVtfOTsSE1vc0ZdG+a/Jbza6pHbyfi5L7FXJAGdQTk0EP3VT54+F7RZ/MJ9fj56aMxzhJRwQJ6df3cM26qSc5bW/zP3PFXypTOBwzCvVtwGQzkGvDW7XGwgLbTNHDpQXOd2BQ5Zd9bjQqGg+S+kIqWZVZCqVLfyFPF9bEOHfPepL6nRDJUD2l5uRnXqeTvidaSIoqS1Fbc6mLPtYnbp6uuts6Qo8TbMzFuI7NuaPuKnQIyVu7vUGJ8jg1uVOjlMNKdVtLPr9/ZEKVZVj7lsFA+nm3zRjjr1DRKhr/wY1CI1iXKVTeQZ0i2PSnN99j4iVTSwNAYQLWWD+KyZ/xRLVxmZQPuSkLeKBRAkavxjWnIFQb1dn72wMSUdcB9cNCNJNdyTkrl44MRR+pUuiVrTAnTlzL33X32eEYwT+vn564yxFJLUDyIMNjJ0nx+GreKSOglI2et0kAwRHKYFclH9GVTiVlB0TWeUJGD+7JYogF7BizjTGyPOUEWQCguIEmtC4fHD5461T80Z3Mp7rhNTI+Cswuknr9hrIZmpRyFSrSrP8R4S1Cf34Tu4RNrDxpofVK9nGTklZPsYM6eiP29Lx264fsX9oLdYhq7vCwcrRMJ1a5d0QHXUYRV5IqTFBoUSpxkQ6IHHL8ckM4NCzwk8K0CA3pj5Jp2a9wZjfKq7R/eukzQFuhMxV2qgHf2E3t7/SA8N7sMvsmF0p3J96QRE3rA85ekH1q8nrBVujlIqahmL0Qto3+JxdqAfnKMCblQGSKVWZgWLMm82MG/9pjhdkMzG7C2GRLGMty2y8NhX1pZWHNbLOmvaC424LNz/Nl5tkPv7fVbCT2ItB+/dx3ZhVhmgSLd1zL+2PsNFmj7VGBruTttezlo1mDKErjY27nTswjf2fY/Uq8lPcVAgRpJM+m7jS/8dk8cdl7fkY7Tuj4TfiSe0tiNSoJgZwom4+9haoBQ65AifaB7pUiTc0MAXCvG+nDydkRIbKx5fL6gAlyMAnBbQf+Qh1naLfzzwLVTP0EEyoenW2W1zKqfMql5rwGlyCB9mSa2s25yHf4SDSBlgEVMJtplpRgegZvDakpWDKgx3UR4W7yKW+RD7bd7rEa/GQmA/q0RYAOIaXfO/2CgEUPtNhPS2uqy29lBYFPPv5SHQ0t/jRxQLBpe09ateAWKypt9TWS7Z5gynOePS5M2NC16AhF0Xz6s7DUjtI0xNho9Y6GK16J5V8HqHypV/OAz7+VBzTaiR57XGH4r62GoAiJqfWOM7okzKCeeSBnOIKPHtwgM0SQbvCvv7rmS6ZAacu4BbXZ5R9gOhdR9H3bi7lWLBNnqqLPIy0k6m4XBhtl40B6z/5AcJxjtKfwvIExl7VsQRqbW8gpPMsmJZfSp3uC35g1AkP+BJlju3RVoFZNo3JR18A5uc60NGD4zvzIdGTAOth4ZAZx0ZGQItHuNcLz/0CiavJdkjD65h4avf1vf7LFZ1uogJz6vLK3uDisXIBIGkXOlIpxTdjjjTQt6Khy50bYbXsG9JBrSUGhsBWpeRUnq2cZWOifhfueY95gFIDAu37oKR3FQ1YxGMg3UMq+L2VN2rtqodelSHof8SyYZVQWs7L0bjtgolId1tAAjHI7J1/+JIRXeUBjjaGGQAU+az9XFfiqn+VRAGG8JDdP/WmEqjhYpcy00LIBIBzCF9I9mbXCv8IX9fhPlI5NqWGO/v0ikpfn+hb5U16FcPYsx+xLb4la6nSbvrTDP5MthPyeLIIY7ZE/rNU4ajgPmI0/3RvD7WtEbo8UGPjnev55N2ELuFpEPzkNu9MzXqq8K0cWxk4lT2DQPi3rDO8x8i5jX7wWQi8e0neCMb0SUO67zRfaekZONGfaFl47LByciUuy5dhqxMPokhTE2WbzxqCyt/s2TqG66R0ocYHmzv9f7tJ+TES8NFyzL3fhNoZoW5IxWNE+stYWutd3LPwa7HKhhRAbl5uCEbEGjrUzTXwbzG0qvpmNtpnYnmKjzTaSAFNCxfw9edcjaxCiRKKIDd6GS/eDsGBgTvJexDfwGmVWm9jadZhee9jRFiZFtL6m7sY1oQa8F9ycxSuPANXCqWkApcaEfQLkt1yyfeRs5yC5O/6XGJ4TEtJmCTPJFRr95au20STIPgkoEF1mzZ+5ZRtWKUYuWJVZDwcA/lTy6oYp0/d0LGPRUXnXRm0qtIXQVdnoVhKZPeWACt9rujRL57MEDi2kHtfV/ucu+k03bN0fQlbalUJ0faY99GC6L8MO8MXTSmqDAxNSpqpIFPhgHgAg0YK/GZhlQjbQXE4tMDEDO9obNfp4W6m8fdznMesSSRINBG5FDf//DkT9pSRQsIdSg4VK7W7j2d2jsQUIyjJmbd/2zCTaqh0Yq0cH6mS/5g/cq3eGOiJbaCNo6oVwGURzXVAeVaGIfJFhd2A59sVp+rVfe1f8B6bVbCLIKgGUgpUokO0vTg6ouAxXGQKtveMhhBT83ukPIRZ02+qF1kvM+nNCVy8uzrB0+W9QIKbMio2m/7zW78xd5Tf9itocpLbRuNC5cuS/GyRGXw6fzFzjM1UITlQ5dlvoyYxuvb7ol4S1MyhkfMNZbif6/xic0wB3uSScez3oFTRbCHBd0cbJL3cLwfQjCBpGBrRVC7174qW4XWnw0eYGSSzTVSEDOlMaTUIGJO+s7/z8JxaZprcEsoB4+vt9/+uwtM/iyqLVPidu8ZTh+F1rsEWKwZhDAg/giVc6VzRq+DJCrhn81b/LYlLJOdgoAjID2VnwgU+mQhCL6KhgIqqiVraD25UIYEqxMcZ1aRcZvHa8x5gh5onPtsVcl53Xek9BOYqkyj64acX921zwqoY0lmNA81NE7BzVts3cwWDZ4Dk6uuzwtfJuJc7vVS+fdVDEg3ATwC9oG5/Vb1swTyzTsl2V4m+93bSQo5STFG5AruTDWTym6Lxtt4OrAeIVgdoyTJL+keHiHTNiL0/nO5oYwftSQK1aYBuA0e12t/FVN+LsCk0L/hfCCcke89LuP4d46qnFo3NLpHb+NFrvekXVT4GiZgMW2H0orIY0TpS15wlxVUaGCUo7YSN0yWDRU5+p41dCOs5/vXq1do7K+Byjj35/mPlQ+VEDqqF7OIBQrXfHgCXYPy8ye3Ih3io+tYA6nK0/2clIERrpA0AMHKLTGEO7q/IzIcOCwYN9W/ISH4v4uk9MhzNu7Fg2IPCq5CQF1GLuzQu+wNv2h94NIA2UJydawv5X2bHkZjv+kB/WQCYjxUNEU8ssUdxDZstpv2qNAHmI6BMD84olxMiwFdK5J80zc9x7de/cz3ZNIkkGIpMCZJqKKkaLVo1MLnR/h/hQeUvfqJmvkPeIre3EjnliNkKJKL0KNaupHzY7Eoztaj0cNOhJ5dxIRB2is3kLcSK1FZswRJR0B5OXX+Q4UlFIrhR10lIge3Fg5DnaGoZoOyFaaHztrdF251JubDsCZRDSWA0y6ysykO+h4jhXtuWF7D5Wp7B4Hx3EQvKsmPPZYcLevowjlWghHbRBEhwPI3bzjhNWXlqtym5ObYAeYxuHyvyYue2X4651f7Om3+m8KT7Y/JqLWXwgayCdzxHuJidti1ITuf/oXzeCfTRbG5ytXlDk/epX061W6BO074jI7nV518OkYtRJDnPqdDFAf0uWcATfk0h17+gP7GHjy0Rc0Ive9XmvA6gCkoMjNjMEA7GQ3xy7e12DzfNpIfND7GKKojMifTrvkDXrfa3o4wNYktY6/VlBdHtrcH9F7uMWICej/BjZXVX83WFGcVHx3nOXxSL59kE9bSmHc3Xp8iDbPuSG5GIRp3fTFHnmTzzGedl6al2gUbGFKtkC0jFNtKTk2rr8LEObiGgfCoSpTWknvAYDQBoj93s0KiRNPOqgY++Xka2cQiDwqUsLl8/i57YC/V6sy5/NvhViRRZgCzcyjNHGzZsYA5YMtUntyfC1gNFP7cL3AwVA+326NJI7MQJoxTqcHL/YhntsnYTR5R6GVVvFYIlW8Nv9qn3daoGXMz0MoAsXpCzbiHZ0XWkfw2qlJkmZjgQtMAEhHXNgokGRPfOprmtlvNZaNlGB1EjQTVX1Y4tCyJFZhdhID4CowB23uQF16NifyxH+DGnQrnxeklnG7UQV2BRVdr6ZEKZYv7Gj+PbpojzAskvbdtaFsataqPrLDoejjc6ZfPA5zA0iYcCvcNjzuy9SuT0uG8NWMTLv2OsImL++PQV1sifUENAwi4O3yBvzTy4J77B7mMBpjCYGXAyjFGFZL4eAazSmvZ8thJ0FFW+keLHL+ft1dQBKmXY6JatelGebcIC/PyLBHdfX9bRcauGg4xEO7mMl8AjlcPMczkPniNQpiQFqcDJYrFGoxMV2hskxMn0bRQT8Ajc6w6sQYkGl0CQUImPrGfie9dsk4mrCLMIFOqcm0WT8O8AiREEGmooBTO7WI0qk506NsV7ffvc0rVJERJKcyRyCmFZdTSn/SrBfjV7SXT3pQlgluoY4FBUCDDkzwBgjkrE1oFUA3ls+xVP10w5jjBIMwKBSQqRVAEDXw+Dyj+jH3ila8czULWsCKhWd4qGsMFN7++OGBAz9eXHjAO9m++mTXF6qiyG35Q+61yjYQKsBrjR4NNexrwVGqBwAZA6cr5mp8AhoyzPomJ6TLfWEJjEeRI3QsX5oQkNuyF7u650QFka+VjFeNRY6ALklleTW9I0v4ABKDCXTGkjv80vqVNk+FTL0bJK7ndSjjMJD7OBFIEywBPJFrxTdyzocmxEgG0zu1VDgsQuXITYCx1RRty89A/F+CdSAlbMlIkptCC0GrF/jFS8PAU+6TNV1eBqJrCr9BgH1mth8FtdfE7druR+xyZKn5idfUKzGW6ACGF4M61IRoSs9o6xmaj3dnAVQvFWUsMcR6MI3xTKJNyMxkhXhhvT0IxialnG7i/BBzXfMXYh5jl4BXzCSNlxU4+aboEgIDr48/+pfj8J3WcNccFfzV6eiX05qkNktmafoBcxrEsrM8WQV0VVSRybQyXPOqJ1yndwBI6BOGO9oGxGDAd+HcKaZlptCMJsR1Cp3m7F9HpBFSu/NYVj+WSDY7jWSFBlTBSCFyyPEUn8S9NmBVa+mwGVsz0Q+fxe23w1w6wVO7sVnZqRpmXJeXg72QFkl7Qda1lBzn/FW+rRwLvFxCsuad67Wmzab1RJdzPGsuq8AzW6tL+JiwW/VPUSBbBmV1+EjqQ28x1u9W5Eoy7zhsU8NT87CtNbZ0lPEpsoWMewxC80kPanfWPrQXmixWDXXz7uf1kBTr1J/iYuls7fUsyAChXjKcKOaCF4ySqkhMTGmjNqYiG5joBUi/SZpWvgxk28pyIPhf28YULINiqmbWPBKuTCLFruV7JfRgGM87XfNEFc7tgnYx503k/0UXJfpmjx6wKbKcvV5fqrctx+OrIn++TxRxSKlTScEIwd2vG5mg/p5wsQDpiD+X91XbkReKLB25Jvp/IJaJh715RXqBzwCwlY3URonyy+oZoTD8Ym8XMMv/dMllh0LCFZkZFn2gYcLG9iO+I5S/GyxwjajQLQtwH7o+n50vimC+ES8ePOpPDwlu4oG8KhS7NL/OTdIWPIHbSa6/9DfjOq9W66EpaK57R78PpEzVNLkTP2L6lllqDT6SDhIDIvQS3SQbxG96khXgvW/rME+tiXFXi+BC0udi9keyGlc3sLBN3CP3QXzswhBGTxvz2LmRMkU3rLuSkYR1Gzr7vj1VxTN1y1iciA0DswsPZ38eB6X10Uzk6HZqjzBK+EJ5osJJJ/s3b0MFRIWYlM15TPm1uzeOk1zQ96quClQLEZbpxmV/eAduIotXUYQZjWAkTulBJt7kw9uEnLo7OpZrf8k+0ZQP0agcOTLbfrekHji86Mxr7rTwve82mePKoAkkEthE45VI+f1VqpyWNW1kbBbVVfuatKt6MEKqyTUyxSFGHk81kY7CxkgMNexiikN0+IeiUNsfuktjfOAiMfDhbTe4rtxSEPvO4CCUGaktA58TGnSO8rHdCicmGkNrwWsnXgUWjhp8bllNcnQN10TbwxYPAwQKW/JJiYQadr4THXO+vWudiq3I47vqmEM/Ab3Dlq11Q7RmRWntYOEyESbTI8PZYwbtsmjcSwBtTAIHQ5h3I633h3FpOkT2c0PlMjzj0Q/OuqaTVt639fowVppqvSlNcK5KupBnrxfKHQK+SoKSuaO8PNMkYkbcEAc9F0I4uzPfRVP/q5QkvJVsVoJ8BEWW/q1+kivHEMQfb+J2NfJjSTG+WhjHjL8eqi7FgfVewxwmqG9IOnTkwDjAHUaJMIyhVkadW/+GQjLyNP4zyHcLAdWcB5zQ2kc/blAx2RKfG+ON3RfC+iQ5Th7V2i5abkoy0pjfyOwTjIvaq9slSCtoNGBZggBDOiWwau0CX4NAIThFyqu9VWCLr8TsqhQZvQP+xrywovGs6A079U7YBjhEXyQw4Q3rbQY1EQnxTPXNlHfn9vQnuhsJnzx6PZrCqry8fidPz2U1scmAMVPHxa/injIf+hDziEU02xWm9ou67OgebktON9V6wwVotoNOzVNJhiDBlHbktBwOjX1BlJHybLox5y/7NhR7uc8f85O6xdxueabhwtJjYcBzac56v6RbuI9IRvPzOnNbltj8Hh0ftwwhWyHAyiEat0oDSEVZ925jmxJKAqTo4/uHnkozgMDsnkzXPXBDJ1sDTawXy23mXuTJOYV6ZVWrervMaGGGQpgQjAnfP7KPZro+OKt/MpnoM0NeGQgIFAiH7dU7Nl1QbcMiwO6/5nIosJtrFB8w1kpqb6OjI9BgZHG1nzTMGA++HNrl4WQNcq3SajD4C9utQYAu/fETPFMMJeCDwHRCnPuRAlqJ5t0E5h3Wlh1Nw57LQ36kDjC3lS9w0a89eI8ym6BzEA25Cdz3LQAyz94Fvjqp7MyHrpm3PzmsV/tbSLF9NJBjFmzWPQ8Tfgvj3fi8dg78tXvEatqtUhLxsNp2VCU6IzSqafxWw93+Wk47skJv5qxM+tv7CrpYKvWLEylJNEXlh7GHm9UenNf2/szZOl+54P4ZWksh1r6+rphL68QYhmqW7DqKVrc2rjzPYcvFDmKtCGL/F62i3riMV9z+LoLnuVaMn4dtpNNFmQEQ4uEhDfLYU4x8G2OHCz7gnxLCa4zE4CFo9m/+ECmdzziVumHM/P00/BESH2rxUYMBL8/9NRG5fiskFJr4AO0qNUKUCgTRgEiFsTbGXtP4DTTzc8ZAmfNJuJQE5Kp7W7U7QZnBXKepfSHkYTEqgOhqo95Jw9i56kYGt4BWwX50mC27CCW92SVMl4tbUEhBDSB36zgztz5Zts0563Kjc34B+6ZUnMIk+BiQNvqSkZHnk3rHNSaYthO72IWLIxij0hcv7n228yc82FsQLK9jmptjY6estDfH3OSMaAj+poCLKwRFXvXWb6jwM9mG4nu1yug0Cc4L89w4EYek6dnV17VBfIxB2dmFFQdp0kqx3BM9gdMAr0KS7WLOSf3cn5eDItDLP2UW7MWaIR+GJ0EGcEL3ejBdu0to6vDh04JcRMNU55usmSn3jp74myzWE3azMIT96wr39F62c3G/ldGskbqTIMTk3gMg61vNBQ0cJSIxVdcgNb3xFDowwVyIqYz54F8Rqg0uQE4FIiUGZxJhND/AWhkukqIqLLZEpxj07kPBN6Zb2pWht/X5JrC8yJzPlvFhfJndQ4jcgjFyhvymr/a17uxTKHpKNWDEoL4nNa9/Prf7TYRw6Gyo6vcwYcUHk17SMb9aEdVnx24msNCDEKbj0OVzRaA3gFJeXZPObqJKvWqFlavGpxXnP+4ZYTl0Dmcri6vMdwX687ApG+ygiGHZDwNzU68F4JMPQ9JB45vLkCsE2w50QNP1kJZlI56dVGzfK1MyRqP4J6VshesfOT4hzR6MYq373IoONlLvENdYXN6pTxo5eRzQkwk2tZ1zmZqczCytqTEhpweKcBCCZ/FhizgLm8/x5ScBlO0wEXHZm90mpmL1gR/J2CUnz3wDU99YFFKqm01AZ8q2S5Fnh81CbD687c7K2OjWlZgdvEJA9M0JT3eKdIRd9GCx6g1TO5PWTE8OOphUDKdazyYnmMqFhFxfJ//cWJTsgYbol2a7Ob/Q69Fy3kb9K7aZLzH+Kl/uCzWnqTOrQonVL7LTFPr7wbTaepfAl5zSgMInjrGXY+Gspw+fCNgEU1zyC0Suum6VFyHBjdKWft7strrOXqOSQwxsYXp4F013mN9gZyu4Hc84A4dzIHN5UNXmxNn+vPjS82JM6klySWB9pLCzLBUgXiMDllaG6fT2PSBv/b+yaruyWBVcpsOKuEaQ37W3A3t9YFRcgB5rFMDjwOn3c0lfsg+5V+dBX2EmWLTSelNZkeq67CFnxaKtnlsAJRPBqYvoWVZcJKn0zSelrO2TwnailO7zgAHaMRmQYbXo9beBs16JWf7V8LjYGS/DYUKTTE1zKECC/pK1EKf6mxIgmV+mJ+Mc8h04qep+okIIEXaN351J3N0VUk7cEEaOLE1rFF3W4vqRcodPfbLqINF6QtTsfny1+O46J5ahlamZEyxglZtpjEkKd9yKDsgwnzqoAPN5o76IsI+FRaBc8u1qLBWxpKU615chTVegNFR5V4o1T2JGwVkueD6CjAhOplPnRyv8sauMnMy2wEMARR6AmCQ8S5ebL0nCEqjSztMoUyAEjQ6FDYqkGweu48DkBR5HjwlBloKVawYcDezxKBH8WWnMpJKZj1Ol+OHMmg5iq9xDswLx0iTNkujgatOkeRU0c/GmSSH+7GTTMLQJdj51l3EkojjEwWOjw8XBOm88GqC4bWPEE+U/5XYtZNJG/X4FYjgIvVd69RYVbMEMfPSKJ825e3XQ6RBesp/G+lkMk4VIxRakyUBPLO1u0UYnNG9ExAnPdOO0OfFvcPOL9rBJO8bR+q9Lp9/i+fH32KkaNR2WgoxQY3FY+rS2NUvtCOgZAaF9vny16WG/3zeUtRP9V28PcGivAHAwwCcRk0D0iohjAfgL/EKXJkr8gIFqbNq7lXUFRKqMbpBa182ol77SqJq1M5setGUJuSBKqYBYKdDZv3XdT/u6J5aKKkLvA5ez6PuWX0RT7kELSKDKfg9w9nwSmMmJHjbnr0blM2WvpiirR/nLid6SRN9+5KoLUb+pLw3QzD8JlS3X2q0m4BNRxfltr5KWqryOuuGDt6IOHSE8/zqGXMiTqgrUOfDH58NoWe0te4mFc1GxswvhZXWJZmaWaMJo2SBnuXa7+jIfFbnhNH74Z6jygwcqXsldYfI/Zh8BZbqTh2I7Hu44dilfbX8Uh18NVB3phRnTwpUonKquUs/iZXRnDFjtEmKg2YRQm2CP1FWRb/B92HqJlHT7Hs/Tpl3RrlxvkoskpNlW53/6Ujse0fkHLNeUm97TlDsaRXpfZkR1uWMTwhPv4oYM2Bv941R+c7nQ0yBdFNVQpZRkpejmIfjFrdQUA7DPwR69aq6Pzmk3IXarIMKG6R4MBdkB3j3HWxohnZLWpaNy/BMxS+84e4vPPfO/7+nLWVZsdpUY/nGDkQts0NGnRpZK/lW60tmncMoTepY5fMbow1GyKhqSXLbOZkz59l8DG9v9ZHPwA1roKz3MW/j2tN/U+lPQVYXTa6h1ePQkSWR2bp9OHmCCvT6s8v9PVG2ufK7dkbpY500gNx7fdArzH3yCjY33Fa5TbOuybLNdW8juJyJtikDn+5jMnMzIWP/+v12XkaXj195xk6eOKuvA5zeKk1i1PrSnmWA46Ca2ldgNqJ0rvLqM9X2EPn/QuMjLnLg0iVJ4H4r5S2PgpGdSdfVoiX/rBAq6yVDc30v8DOUae4oquSM0YDCIafLQ+hvEmB5b/f+QsTFtAR0zIVWeLyYbmrx3g9gHhVRfelCz9/exh19AGsyXcwuSaBiCzQIoctYvyhhkdCsC/cdZDce/1Fav35JQt+RJFAjiMRQhCdE4eS3SmfsREHe9LZa0ElOLhxxvs5uS/SnMYssyK9FxiucRjjOqfaIp2N8CmuNJqg3WvtMk+MlbAYeji9K94rx6U7nj9L1TGhVcAyz+Gb4sib21AW94HRzWbTrRKEkx5+KLE69Vc+8Cj1Vu2GkZ1AA2E4kaJ2aTjsEL2C0srAINXRAjnxwI3p5ED0NRYn9sT1iY9GPBJwhhd6WXEJ/Z44D0rufaDOA8dUj1SIqywRs2b7SjYcCYS8eefkwdWlpN0DvnecdwHVc3TqyCcUy7K2PMS2l2KZHzZfLCTCPaPq/NVc/Nlc5hVJoFvnNUpKWZcTsxVeHfH1mnELREECq9YES9v6FcvONCxXLQmf0k3S2dyNmsxbvlXM0u7lSqkx81md0rad3E33PPuPpDGM9UiBhSeJn3Sejmx+LdLCiZYcVxow59nCqrUmXGAbsR4O7wVQzyHdL6DX5s8k5BjHXlONz0PaIqS89xMhkYetMw6w7JZ5c/oJBH2jdZPbS6KbR0RpEe16BATLzU4QiHybxArrjBM8MKKP8Zz6MVbg/d8yb76U8nQzCK4Eqa5ombBm7/6xo2dR9O/ByfcU6qDu+efdLFAP4LiCr6C3aihDPjigUYuy0voLuX3Flevl7xXRtRZ4Vc48j2tgA7tK0wqv4OjLwCzZJn9lYIQuScQBEFMBjA6Vj8FTp4h3OphB6g0uA13nTnVLmKQ+zfELl+6znWX5nCWvbwak0t3q4qwWK3MAPKE2vqDEeCsFKvmJ2Ws+VOqnrA+ekCk9jaszBsZd71InADWijT4SHnyVmc55dv5ivXl1fED4vwNrxbiZHWeGinS3ImcoDAT1vGiLpP/D3NaiIPq9A2h5DT5SgaCVCh0JKu7DKsHjW9ZAACRxHgTSo5jrVWUJfGKweg2auQuittVidB+JaCdwYd0x9oJ4jyI5UygrB9Nzi2gbLVcCnpu+1ytsiWCbJb1Xxas8FhG/EX86taG6flZZauhaGnpRyfBB5ojGdsdPBVHEtb8R951oaNTvKXK7CddSeWaeOi2FIDPEhWhAk19RzuR9wSKEwvvi8nQFz649+fUlBMuDL7VmUBSsC1ExWwqY+uSdNKowEkpsBb+/KpWl6oGxymyR/e4uKjipBJrVPXg0nE2j6HL2JbCHNh01lV+/+6FUglhV8GTypzdvdfhYc7t0ZYtkyH/17wDakU7r1GAdUIXXmtxamhK2FdelBa4BPryblCC9gJG9htJue9LMrNS7mM6gbRA1xSFnWNsziDuGZeS3Dcu4bjsWaIebrgNnxpl/pLGxV5EtkFwDeh8fPyfPU8CZAM/Ljk3+Vi7jUtNZmZM8+f7d4wlUIkTHiAULRUKu0ODFIeyk20BiqLB7vvAT342SIDP+z5FPaa6Tjyqh/AsX2jFhbeIXKxDMb8fid0jHAWk6JKhswbtvtP6bDz+lYjvXIPwV1Y+nyft2uM8c1aUxmDHAUmZnJBvZXT43mxjXDHP05R1/dKfoExcgcYzv3wO5mazi7ugS01z6oUmByKtfQ6fA2+MQynPCoDHcp1eDtag/E3HQpHMWAgGkNh9wWR5Y48YG0W4CgvOrngI111j/x+MIuH5xFlVkxqptSjW+hnVbt9qxtXndEH5RtnxWfd9eP+kli/x3LU1WGsZVAkVElXD274LBGK0bMveEUbj/6EpnocEnvRSlglpE4GiAO5S4JdYb4uYd6oeK8vuZvTQaWMS3dEIJ2ssCxWz8DqYmc/b38ynz0DWCCeF1gCyipaLG2Kq9wqfHz3S6m7CS+H42nmDYAz2dYcx77M8purGOS5tQ4aykJXIDQBwHjIGSU+52M+1OV53rp4B3JbIXecQWEjfk9gkVoz8T6HJbIhFgm3quNMk+cIyRHlj/BdURXY8o7H7dBQfsdpLJhAsxS/1JtMkY8JoP4YdyOxzJY5x/+A9scOTXvPVoQAMqgmP899s6GvRtzNFGXLX7VHSnUj7VPO8K1qxaS/a/6v/YhRlUtNgnqnth3Jo/DKbdhdPn6HgB9YjU5GuN1uPyUXZJDZYfFwMfdqNPVoI8d1csoHMK5tquGoK060mIwBHMk3pFGqBosajr9g/5kBPrrtuIIEPFZnaAKSCQqLdeQq2B6Bs8WxD8+DfzGJ2nu0Xeb58spPoiHZAVV+I5lRUseUE0IA4E844UzFYADNYcLBW3zsP7aWzLnUZoQPuIDR3FX3bkM5mCunvXaPSi4PRkKnItEv8/OYiq8RSKQcaTwxX9YgdNbgPuXLwb5ARofv0Zj3WpHhNnlTq2Qu/lwvM3PUaqv8L7kpFqQR9aRaXfFanbLgbyxJ2kAx9oA1kRMyH3JXI06oQhRiZQ1LtWz+QKKxme0zAgI2q6/dmYApsA7WGeBae5+Y3eqkqDjXyS7Q+LzYgrM3EiqGHsibaKZKgFecxpGiMLXY5+kkuDKBdMkj2Bd8uTKI+aTWpu97gNp78fm891zYuT68sIEzE5JggpWjlWFSpzYayxvnOxJ3JYK/q8WbCy14KhtCFhdLOxCEAvyqXN3K+oP52ZzdxHiCAac5LX2TO5CTmkxp6zCT5JZDIBgnnmQU8GBowEvogfPni17fE1sljd55P2C4mWCNDr8l3hMH+4zpyZqp3iFbJx20nGtU+9LJozl0OxNrk/c0C9chEe+k4vUECnUaXbS8JqdnymqbZ1SCI+4+1BYMW4nzYKDLaqL3Nm08C/Ug7zNg2BuwhWepXrkqaRX58LCWLPDQyUzn369E1drtekeuNcI4SgdmyQZ/7xhXZ6sOKg9G/HEiJQsriRQThvHz4BhaFaXic4nlrz4LhUthGBLbnnB6tufJizYx4c6b2rY1E63pLDA8QdZsTOD7euNMku1a0T2nNQ9rOPBYPDyksaP+EmKTvqcgRycKMtzhHh37mAqVERuzIIMs/zXE9jGBpJBBWb8KCPZne6Sxw0+UFlY6/VeXJUHunHXY1csfc40Tw95XrkpLzxqX/LrsaYM7Y0UQ/Qe6PTjMQUXDseSMhYwHTXCohySQ+1fIjz/yjZWRFI1/a4d9eQzWLoGjz8O8ldPhzhpWFwwlaR0T1gpMP3VeHvDOx4RJocHJOSRQ+H4/nHJsiuXWDKowYZZW8Jk9vUiw2jExedn7glAsC/bgN1NrgIp1y+y3tmLd2V9x7yKVC+QK6MOFq19dlQflj350qUavBULMCTn0BvCRQY4q6VjniU6XHISUsaApCVoQeevAOuCUFcnwWfK+44XDo1qSpPF1wcnbH7N9aO+AzD212PgFlGkXlaQ3Gbfz9XIUMjulgGUREelr6IX+tR2K9H/yep959z5WLXlZ81Z8HCIV8CyU0JKYzkIeFqf6o2ywb2O73oRi7i8F6Vcn2zU1VWZpLfSXgTNkRtqM7r5s13UimLWtAVZs97rLcMRlwXzYp98ZnKvQLj/dpKn8nfNnU9V2Bp90frlQedeKt6zd4mPR53FKQ1J4r95n1G8ph0XG37DC9b185sWbnoyC4Q1iUvyy5IOxBrIqbqn/JSUWzdrlOiZGDJrU5IGuzUl5TaupUTIgFeLfT6uh0gIEJ5nZQ/8XjB0mmEZxTvocrU/BFoOaUvV/N48W3W/aQu5nR3KwsSByfSDAEq6qBqTVTkZtkaAd/1Rie2jkdRlZvxFMu0MGnLc0SHPII8eOz/bjfIhSQhAb38dSRcFmfRb+fpDrDHeazED6EHNayy0kESoRG+XFbJa6xWB6OlbwHVDwdO9Ka7bIOqLRHpZjwXmv/2DR9nu+2xwxE39cBHq/7Vv99HcvH8ZJeGmgHr8mBKQmOCTkvLkxf5k4FrqZuNpaRNhCB3puFuF5d2nnQbhgAaANLMCYAiGsJhX2bFM/r3BGhR/dkGPXeBQUJ4tTARQnVqA07mW/42Dv2k7Wa7hWU/wv7FTIWLwWyHX0Vqdg4BHrlJ7zh+b+T6fH+W3d53LS5rkXK5GIctMIttK+osfGYIvOD0BkkXBJR0EYUmteToIxpoaMVKZmCRC2BbmBLdUTIZiI1kVYKYnq9Q5xMGODu+6vCT2ofvYE0pmGbQ9Ln6wnBDYZUD/BL9rmiPn3n28Zs33OsHUQcLp2vjUEV5sOBLO2ScyescGu0N58y1q1NSNJuXCzI4fu4RWJtSIn3P3+9eAsMo/2NupFeaf70/usLGd2Z0F27EjLoIj+nmJ4/Q5edPFhVNpPURQrUzPALNNzEvx3e82rDtPpbZjugv7Abm2q2vMGwz5W+hGH0hkCzXdZhPFbLk0sR5vVhScLgAPdZIVZIjTuzwIKVuWmvpMr7Gwxgiglpy8ecfOAZcCpXRzG6lNuRB64D4G9AWD9vQi/crWV4Xq5VjJnRjQc3g4bJe+MmksjEctghn27n5i5PHZvW/gM0BsXzo8Pou6yOLnp49dGXpK/oLAbOdOel9h+kDqEtZunvsXa9EFomdl0QbDvk+H58SjszCVqVOXSgDpOdZjXWfZpFL6S/fd1Lq8FQS3LklgiNhdvE5GzgSO8uq3gtj8I2o+JzucnrUSrtoxa6IejmVQLGzF3rSCy3fdhBPhZnDdgctC89dRJ+PTfW4ga5WWAyaWspzFg5251FoByB8LUbD3AxhvV6M1ARNXRJ4NhPe2j9WOlu5I2KmCMGvGP5CbHAyZk3YhiuIdtDgOvre9Cz0yOWvHH5FpZQzqzyHE5XkTTFMU2JhG1nvne9SCi9zNvPnGj9h/bQXgpue78rpogXJl8oDSfMwz9fp4ocyOxEV1JCEslSsRvodEzPbUsMUYWDERNzR6f45Ku6EmW3qdD48dcFQtc9rr2wF3o85edZ/2SY0BSkOdQX1ahwPVBP554Q1Z4lbd0d/vrRCO5k3QBWOb3iML0vI4MRkiKwqt735Q2fkq0Xl1pI3nk4ll51cSEHOrFTctkxwLOiQl6HJh2q3iqHFmtOCSo0A4YLl+mllolm7FLpe/79gMoe7A5cbFPCbX9Z3GhI43FgBbWoq8pwaIoDlklRimVauOx355pv7v26P0MLrgiqWTOxJaIGO/UhHf7GSOm0r1O5m1sPYYn1bathmEkYfrQLiEWQ2/3IjunsIxgAmi6t4JsxalYxE4YyvD59EpzvswOjZUvSgkHwPZonVtaiMTLXnV3p0dKpCSSz38Kv8QbNFzqLbwbBBRUHw/nHSxNipNm5vtjfkuf06jWRwkctgu8wZqKwS/7IcGnFtmwnbJFPhpGcyV9GVFzCCG+TOeNgAWxOUPgmtLdD8JawVVDV+e3iR8kHuaZXIknncI/3uFnblTd2P/OdWvxl+9CXbqJb1CS8osg2fg/qaA9KvM3FQoZQ79JRZC/Upm90ABPCGzksTWJ7Xy9VHpnPZCgGzAVbJhmurq8tm24BjBvnm1GOKfotvCqXyIXFE1bYTRS1WtzgZrGWgR/oOUDnNgDPXqUfTmyFPfNCD9MX22hvuBans/Kl1DustiTunl9Kravj0NG1Ds5nkTqlQSYOfhgvRIowimmWAYWma55eqvaQL9GvHmuH/hIVB/tiN6s7yOW2iahReL8dNddIbMJ6BLVguJ4n1dnquV3ZNqi6V0H/Vn00j0cE80ERsZTgsHPJ0eUjxYik+eDtaEHnyAsYeR2AjRcGw=="),(function(e){return e.charCodeAt(0)})),i=new Uint8Array([177,156,215,89,13,111,230,1]),o=new Uint8Array(n.length),a=new Uint8Array(256),s=0;s<256;s++)a[s]=s;var c,u=0;for(s=0;s<256;s++){var l=[a[u=(u+a[s]+i[s%i.length])%256],a[s]];a[s]=l[0],a[u]=l[1]}s=0,u=0;for(var d=0;d<0+n.length;d++){var h=[a[u=(u+a[s=(s+1)%256])%256],a[s]];a[s]=h[0],a[u]=h[1],c=a[(a[s]+a[u])%256],d>=0&&(o[d-0]=n[d-0]^c)}return C=!0,new Promise((function(n){(function(e,t){return WebAssembly.instantiate(e,t)})(o.buffer,t).then((function(t){C=!1,r=t.instance.exports,e.__wbindgen_wasm_module=t.module,n()}))}))}().then((function(){M=O.new(),e(M)}))}))).then((function(e){I=e}));var U=!0;setInterval((function(){Object(c.getParameter)("UPLOAD_LOG")&&F.info("console log upload")}),9e5);var F=function(){var e,t,n,r,i,l,d=null,h=["DEBUG","INFO","WARNING","ERROR","NONE"],f=0,p=function(e,t){if(Object(c.getParameter)("UPLOAD_LOG"))try{t=Array.prototype.slice.call(t);var n="";if(t.forEach((function(e){"object"===o()(e)&&(e=JSON.stringify(e)),n=n+e+" "})),k.push({payload:n,log_level:e}),U)return;"free"===L&&function e(t){L="uploading",setTimeout((function(){!function(e,t,n){var r={};Array.isArray(e)||(e=[e]),e=e.map((function(e){return{log_item_id:N++,log_level:e.log_level,payload_str:e.payload}})),r={timestamp:Date.now(),sdk_version:c.VERSION,process_id:Object(u.getProcessId)(),payload:JSON.stringify(e)},I?r.hash=I.get_digest("".concat(r.payload).concat(r.process_id).concat(r.timestamp)):n&&n();try{var i=d,o=d||"https://".concat(Object(c.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v2");Object(s.post)(o,r,(function(e){"OK"===e?t&&t(e):n&&n(e)}),(function(e){n&&n(e)}),i?{withCredentials:!0}:{withCredentials:!0,"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})}catch(e){n&&n(e)}}(t,(function(){D=0,0!==k.length?(P=k.length<10?k.splice(0,k.length):k.splice(0,10),e(P)):L="free"}),(function(){setTimeout((function(){e(P)}),D++<2?200:1e4)}))}),3e3)}(P=k.length<10?k.splice(0,k.length):k.splice(0,10))}catch(e){}};t=function(){for(var t=[0],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},n=function(){for(var t=[1],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},r=function(){for(var t=[2],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},i=function(){for(var t=[3],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)};var m={};return l=function(e){m[e]||(r.apply(void 0,arguments),m[e]=!0)},{DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4,stopWaitJoin:function(){U=!1},enableLogUpload:function(){Object(c.setParameter)("UPLOAD_LOG",!0)},disableLogUpload:function(){Object(c.setParameter)("UPLOAD_LOG",!1)},setProxyServer:function(e){d=e?"https://".concat(e,"/ls/?h=").concat(Object(c.getParameter)("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v2"):"https://".concat(Object(c.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v2")},setLogLevel:function(e){e>4?e=4:e<0&&(e=0),f=e},log:e=function(){var e=arguments[0],t=arguments;if(t[0]=a()+" Agora-SDK ["+(h[e]||"DEFAULT")+"]:",p(e,t),!(e<f))switch(e){case 0:case 1:case 3:console.log.apply(console,t);break;case 2:console.warn.apply(console,t);break;default:return void console.log.apply(console,t)}},debug:t,info:n,warning:r,deprecate:l,error:i}}();t.default=F},function(e,t,n){"use strict";n.r(t),n.d(t,"report",(function(){return R})),n.d(t,"SESSION_INIT",(function(){return v})),n.d(t,"JOIN_CHOOSE_SERVER",(function(){return y})),n.d(t,"JOIN_GATEWAY",(function(){return b})),n.d(t,"PUBLISH",(function(){return _})),n.d(t,"SUBSCRIBE",(function(){return E})),n.d(t,"getProcessId",(function(){return A}));var r=n(46),i=n.n(r),o=n(7),a=n.n(o),s=n(2),c=n(0),u=n(14),l=n(28),d=n.n(l),h=n(47);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m,g,v="session_init",y="join_choose_server",b="join_gateway",_="publish",E="subscribe",S=new(n.n(h).a),w={eventType:null,sid:null,lts:null,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},T=null,A=function(){return T||(T="process-"+d()(),c.default.info("processId: "+T)),T},R=(g=0,(m={list:{},setProxyServer:function(e){S.setProxy(e),m.proxyServerURL=e},getUrl:function(){return m.proxyServerURL?"https://".concat(m.proxyServerURL,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),"&p=6443&d=events/message"):"https://".concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),":6443/events/message")},getBackUrl:function(){return m.proxyServerURL?"https://".concat(m.proxyServerURL,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=events/message"):"https://".concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6443/events/message")},getSessionStartTime:function(e){return m.list[e]?m.list[e].startTime:(c.default.DEBUG("[getSessionStartTime]: session ".concat(e," no exit")),0)},sessionInit:function(e,t){var n=a()({},w);n.startTime=+new Date,n.sid=e,n.cname=t.cname,m.list[e]=n;var r=a()({},{willUploadConsoleLog:Object(s.getParameter)("UPLOAD_LOG"),areaVersion:"global"},t.extend),i=a()({},n);i.eventType=v,i.appid=t.appid,i.browser=navigator.userAgent,i.build=s.BUILD,i.lts=+new Date,i.elapse=i.lts-i.startTime,i.extend=JSON.stringify(r),i.mode=t.mode,i.process=A(),i.success=t.succ,i.version=s.VERSION,delete i.startTime,m.send({type:"Session",data:i}),m._flushInvokeReport(e)},joinChooseServer2:function(e,t,n){if(m.list[e]){m.list[e].uid||(t.uid&&(m.list[e].uid=parseInt(t.uid)),t.cid&&(m.list[e].cid=parseInt(t.cid)),t.vid&&(m.list[e].vid=parseInt(t.vid)));var r=a()({},m.list[e]);r.eventType=y;var i=t.lts;r.lts=Date.now(),r.eventElapse=r.lts-i,r.chooseServerAddr=t.csAddr,r.errorCode=t.ec,r.elapse=r.lts-r.startTime,r.success=t.succ,r.chooseServerIp=t.chooseServerIp||"",r.chooseServerAddrList=JSON.stringify(t.serverList),delete r.startTime,m.send({type:"JoinChooseServer",data:r})}},joinChooseServer:function(e,t,n){if(m.list[e]){n&&(t.uid&&(m.list[e].uid=parseInt(t.uid)),t.cid&&(m.list[e].cid=parseInt(t.cid)),t.vid&&(m.list[e].vid=parseInt(t.vid)));var r=a()({},m.list[e]);r.eventType=y;var i=t.lts;r.lts=Date.now(),r.eventElapse=r.lts-i,r.chooseServerAddr=t.csAddr,r.errorCode=t.ec,r.elapse=r.lts-r.startTime,r.success=t.succ,r.chooseServerIp=t.chooseServerIp||"",r.chooseServerAddrList=JSON.stringify(t.serverList),delete r.startTime,m.send({type:"JoinChooseServer",data:r})}},reqUserAccount:function(e,t){t.vid&&(m.list[e].vid=parseInt(t.vid));var n=a()({},m.list[e]),r=t.lts;n.eventType="req_user_account",n.lts=Date.now(),n.success=t.success,n.serverAddress=t.serverAddress,n.stringUid=t.stringUid,n.uid=t.uid,n.errorCode=t.errorCode,n.elapse=n.lts-n.startTime,n.eventElapse=n.lts-r,n.extend="string"==typeof t.extend?t.extend:JSON.stringify(t.extend),delete n.startTime,m.send({type:"ReqUserAccount",data:n})},joinGateway:function(e,t){t.vid&&(m.list[e].vid=parseInt(t.vid)),t.uid&&(m.list[e].uid=parseInt(t.uid));var n=a()({},m.list[e]),r=t.lts;n.eventType=b,n.firstSuccess=t.firstSuccess,n.lts=Date.now(),n.gatewayAddr=t.addr,n.success=t.succ,n.errorCode=t.ec,n.elapse=n.lts-n.startTime,n.eventElapse=n.lts-r,delete n.startTime,m.send({type:"JoinGateway",data:n})},publish:function(e,t){var n=a()({},m.list[e]);n.eventType=_;var r=t.lts;n.lts=Date.now(),n.eventElapse=n.lts-r,n.elapse=n.lts-n.startTime,n.success=t.succ,n.errorCode=t.ec,n.audio=t.audio,n.video=t.video,n.screenshare=t.screenshare,n.publishRequestid=t.publishRequestid,n.p2pid=t.p2pid,t.videoName&&(n.videoName=t.videoName),t.audioName&&(n.audioName=t.audioName),t.screenName&&(n.screenName=t.screenName),delete n.startTime,m.send({type:"Publish",data:n}),m._flushInvokeReport(e)},subscribe:function(e,t){var n=a()({},m.list[e]);n.eventType=E;var r=t.lts;n.lts=Date.now(),n.eventElapse=n.lts-r,n.elapse=n.lts-n.startTime,n.errorCode=t.ec,n.success=t.succ,n.subscribeRequestid=t.subscribeRequestid,n.p2pid=t.p2pid,isFinite(t.peerid)?n.peer=t.peerid:n.peerSuid=""+t.peerid,"boolean"==typeof t.video&&(n.video=t.video),"boolean"==typeof t.audio&&(n.audio=t.audio),delete n.startTime,m.send({type:"Subscribe",data:n}),m._flushInvokeReport(e)},firstRemoteFrame:function(e,t){var n=a()({},m.list[e]);n.eventType="first_remote_frame";var r=t.lts;n.lts=Date.now(),n.eventElapse=n.lts-r,n.elapse=n.lts-n.startTime,n.width=t.width,n.height=t.height,n.success=t.succ,n.errorCode=t.ec,isFinite(t.peerid)?n.peer=t.peerid:n.peerSuid=""+t.peerid,delete n.startTime,m.send({type:"FirstFrame",data:n})},firstVideoReceived:function(e,t){var n=a()({},m.list[e]);n.eventType="first_video_received",n.lts=Date.now(),n.peer=t.peerid,n.uid=t.uid,n.elapse=t.elapse,n.subscribeElapse=t.subscribeElapse,n.subscribeRequestid=t.subscribeRequestid,n.p2pid=t.p2pid,m.send({type:"FirstVideoReceived",data:n})},firstAudioReceived:function(e,t){var n=a()({},m.list[e]);n.eventType="first_audio_received",n.lts=Date.now(),n.peer=t.peerid,n.uid=t.uid,n.elapse=t.elapse,n.subscribeElapse=t.subscribeElapse,n.subscribeRequestid=t.subscribeRequestid,n.p2pid=t.p2pid,m.send({type:"FirstAudioReceived",data:n})},firstVideoDecode:function(e,t){var n=a()({},m.list[e]);n.eventType="first_video_decode",n.lts=Date.now(),n.peer=t.peerid,n.uid=t.uid,n.elapse=t.elapse,n.videowidth=t.width,n.videoheight=t.height,n.subscribeElapse=t.subscribeElapse,n.subscribeRequestid=t.subscribeRequestid,n.p2pid=t.p2pid,m.send({type:"FirstVideoDecode",data:n})},firstAudioDecode:function(e,t){var n=a()({},m.list[e]);n.eventType="first_audio_decode",n.lts=Date.now(),n.uid=t.uid,n.peer=t.peerid,n.elapse=t.elapse,n.subscribeElapse=t.subscribeElapse,n.subscribeRequestid=t.subscribeRequestid,n.p2pid=t.p2pid,m.send({type:"FirstAudioDecode",data:n})},onAddAudioStream:function(e,t){var n=a()({},m.list[e]);n.eventType="on_add_audio_stream",n.lts=Date.now(),n.uid=t.uid,n.peer=t.peerid,m.send({type:"OnAddAudioStream",data:n})},onAddVideoStream:function(e,t){var n=a()({},m.list[e]);n.eventType="on_add_video_stream",n.lts=Date.now(),n.uid=t.uid,n.peer=t.peerid,m.send({type:"OnAddVideoStream",data:n})},onUpdateStream:function(e,t){var n=a()({},m.list[e]);n.eventType="on_update_stream",n.lts=Date.now(),n.uid=t.uid,n.peer=t.peerid,n.audio=t.audio,n.video=t.video,m.send({type:"OnUpdateStream",data:n})},onRemoveStream:function(e,t){var n=a()({},m.list[e]);n.eventType="on_remove_stream",n.lts=Date.now(),n.uid=t.uid,n.peer=t.peerid,m.send({type:"OnRemoveStream",data:n})},streamSwitch:function(e,t){var n=a()({},m.list[e]);n.eventType="stream_switch",n.lts=Date.now(),n.isDual=t.isdual,n.elapse=n.lts-n.startTime,n.success=n.succ,delete n.startTime,m.send({type:"StreamSwitch",data:n})},audioSendingStopped:function(e,t){var n=a()({},m.list[e]);n.eventType="audio_sending_stopped",n.lts=Date.now(),n.elapse=n.lts-n.startTime,n.reason=t.reason,n.success=t.succ,delete n.startTime,m.send({type:"AudioSendingStopped",data:n})},videoSendingStopped:function(e,t){var n=a()({},m.list[e]);n.eventType="video_sending_stopped",n.lts=Date.now(),n.elapse=n.lts-n.startTime,n.reson=t.reason,n.success=t.succ,delete n.startTime,m.send({type:"VideoSendingStopped",data:n})},requestProxyAppCenter:function(e,t){var n=a()({},m.list[e]),r=t.lts;n.eventType="request_proxy_appcenter",n.lts=Date.now(),n.eventElapse=n.lts-r,n.elapse=n.lts-n.startTime,n.extend=t.extend+"",n.APAddr=t.APAddr,n.workerManagerList=t.workerManagerList,n.response=t.response,n.errorCode=t.ec,n.success=t.succ,delete n.startTime,m.send({type:"RequestProxyAppCenter",data:n})},requestProxyWorkerManager:function(e,t){var n=a()({},m.list[e]),r=t.lts;n.eventType="request_proxy_worker_manager",n.lts=Date.now(),n.eventElapse=n.lts-r,n.elapse=n.lts-n.startTime,n.extend=t.extend,n.workerManagerAddr=t.workerManagerAddr,n.response=t.response,n.errorCode=t.ec,n.success=t.succ,delete n.startTime,m.send({type:"RequestProxyWorkerManager",data:n})},requestWorkerEvent:function(e,t){var n=a()({},m.list[e]),r=n.startTime,i=Date.now();delete(n=p({},n,{},t,{elapse:i-r,lts:i,productType:"WebRTC"})).startTime,m.send({type:"WorkerEvent",data:n})},requestApWorkerEvent:function(e,t){var n=a()({},m.list[e]),r=n.startTime,i=Date.now();n=p({},n,{},t,{elapse:i-r,lts:i}),m.send({type:"APWorkerEvent",data:n})},sendCustomReportMessage:function(e,t,n){var r={type:"UserAnalytics",data:p({sid:e},t)},i=m.getUrl(),o=!!m.proxyServerURL;Object(u.post)(i,r,(function(e){n&&n()}),(function(e){var t=m.getBackUrl();Object(u.post)(t,r,(function(e){n&&n()}),(function(e){n&&n("Failed")}),o?{timeout:Object(s.getParameter)("CUSTOMER_REPORT_TIMEOUT")}:{timeout:Object(s.getParameter)("CUSTOMER_REPORT_TIMEOUT"),"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})}),o?{timeout:Object(s.getParameter)("CUSTOMER_REPORT_TIMEOUT")}:{timeout:Object(s.getParameter)("CUSTOMER_REPORT_TIMEOUT"),"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})},joinChannelTimeOut:function(e){m.send({type:"JoinChannelTimeout",data:p({},e)})},peerPublishStatus:function(e){m.send({type:"PeerPublishStatus",data:p({},e)})},joinWebProxyAP:function(e){m.send({type:"JoinWebProxyAP",data:p({},e)})},webSocketQuit:function(e){m.send({type:"WebSocketQuit",data:p({},e)})}}).reportApiInvoke=function(e,t){var n=t.tag,r=t.name,i=t.getStates,o=t.options,a=t.timeout,u=void 0===a?6e4:a,l=t.callback,d=t.reportResult,h=void 0===d||d,f=Date.now(),m=0,v=g++,y=function(){return p({tag:n,invokeId:v,sid:e,name:r,apiInvokeTime:f,options:o},i&&{states:(t=i(),Object.keys(t).reduce((function(e,n){var r=e;return null!=t[n]&&(r[n]=t[n]),r}),{}))});var t},b=!!Object(s.getParameter)("SHOW_REPORT_INVOKER_LOG");b&&c.default.info("".concat(r," start"));var _=setTimeout((function(){R._sendApiInvoke(p({},y(),{error:"API_INVOKE_TIMEOUT",success:!1}))}),u);return function(e,t){if(clearTimeout(_),++m>1&&(e="EXECUTOR_INVOKE_".concat(m)),e)return R._sendApiInvoke(p({},y(),{success:!1,error:e},i&&{states:i()})),b&&c.default.info("".concat(r," onFailure"),e),l&&l(e);R._sendApiInvoke(p({},y(),{success:!0},h&&{result:t},{},i&&{states:i()})),b&&c.default.info("".concat(r," onSuccess")),l&&l(null,t)}},m._cachedItems=[],m._cacheInvokeReport=function(e){e.lts||(e.lts=Date.now()),m._cachedItems.push(e),m._cachedItems.length>50&&m._cachedItems.shift()},m._flushInvokeReport=function(e){if(m._cachedItems.length){var t=m._cachedItems;m._cachedItems=[],c.default.debug("Flush cached event reporting:",t.length),t.forEach((function(t,n){t.sid=e,setTimeout((function(){m._sendApiInvoke(t)}),5e3+500*n)}))}},m._sendApiInvoke=function(e){var t=e.tag,n=e.invokeId,r=e.sid,i=e.name,o=e.result,a=e.states,c=e.options,u=e.error,l=e.success,d=e.apiInvokeTime,h=e.lts,f=Object(s.getParameter)("NOT_REPORT_EVENT");if(!(t&&f instanceof Array&&-1!==f.indexOf(t)))if(m.list[r]){var g=m.list[r],v=g.startTime,y=g.cname,b=g.uid,_=g.cid,E=(h=h||Date.now())-v,S=h-d,w="";if(c)try{w=JSON.stringify(c)}catch(e){w=c.toString()}var T=p({invokeId:n,sid:r,cname:y,cid:_,lts:h,uid:b,success:l,elapse:E,apiName:i,execElapse:S},void 0!==c&&{options:w},{},void 0!==a&&{execStates:JSON.stringify(a)},{},void 0!==u&&{errorCode:JSON.stringify(u)},{},void 0!==o&&{execResult:JSON.stringify(o)});m.send({type:"ApiInvoke",data:T})}else m._cacheInvokeReport(arguments[0])},m.sendCache=[],m.sendTimer=null,m.send=function(e){if(e.data){var t=e.data;m._lastLts&&m._lastLts>=t.lts&&(t.lts=m._lastLts+1),m._lastLts=t.lts}if(m.sendCache.push(e),null===m.sendTimer)return function e(){m.sendTimer=setTimeout((function(){if(0!==m.sendCache.length){var t=m.sendCache.length<10?m.sendCache.splice(0,m.sendCache.length):m.sendCache.splice(0,10),n=m.list[t[0].data.sid].vid;return S.sendReportList(t,n),e()}m.sendTimer=null}),Object(s.getParameter)("EVENT_REPORT_SEND_INTERVAL"))}()},m)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BUILD="v3.6.11-0-gbdacc5f-dirty",t.VERSION="3.6.11";var r=0*Date.now()+11499+86604+5615+6547+846;t.SUPPORT_RESOLUTION_LIST={"90p_1":[160,90,null,null,null,null],"120p_1":[160,120,15,15,30,65],"120p_3":[120,120,15,15,30,50],"120p_4":[212,120,null,null,null,null],"180p_1":[320,180,15,15,30,140],"180p_3":[180,180,15,15,30,100],"180p_4":[240,180,15,15,30,120],"240p_1":[320,240,15,15,40,200],"240p_3":[240,240,15,15,40,140],"240p_4":[424,240,15,15,40,220],"360p_1":[640,360,15,15,80,400],"360p_3":[360,360,15,15,80,260],"360p_4":[640,360,30,30,80,600],"360p_6":[360,360,30,30,80,400],"360p_7":[480,360,15,15,80,320],"360p_8":[480,360,30,30,80,490],"360p_9":[640,360,15,15,80,800],"360p_10":[640,360,24,24,80,800],"360p_11":[640,360,24,24,80,1e3],"480p_1":[640,480,15,15,100,500,1,5],"480p_2":[640,480,30,30,100,1e3,25,30],"480p_3":[480,480,15,15,100,400],"480p_4":[640,480,30,30,100,750],"480p_6":[480,480,30,30,100,600],"480p_8":[848,480,15,15,100,610],"480p_9":[848,480,30,30,100,930],"480p_10":[640,480,10,10,100,400],"720p_1":[1280,720,15,15,120,1130,1,5],"720p_2":[1280,720,30,30,120,2e3,25,30],"720p_3":[1280,720,30,30,120,1710],"720p_5":[960,720,15,15,120,910],"720p_6":[960,720,30,30,120,1380],"1080p_1":[1920,1080,15,15,120,2080,1,5],"1080p_2":[1920,1080,30,30,120,3e3,25,30],"1080p_3":[1920,1080,30,30,120,3150],"1080p_5":[1920,1080,60,60,120,4780],"1440p_1":[2560,1440,30,30,120,4850],"1440p_2":[2560,1440,60,60,120,7350],"4k_1":[3840,2160,30,30,120,8910],"4k_3":[3840,2160,60,60,120,13500]},t.AUDIO_PROFILE_SETTINGS={speech_low_quality:[!1,!1,!0,!0],speech_standard:[!1,!1,!0,!1],music_standard:[!1,!1,!1,!1],standard_stereo:[!1,!0,!1,!1],high_quality:[!0,!1,!1,!1],high_quality_stereo:[!0,!0,!1,!1],default:[!1,!1,!1,!1]};var i={AREA_SETTING:["NORTH_AMERICA","OVERSEA"],WEBCS_DOMAIN:["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],LOG_UPLOAD_SERVER:"logservice-oversea.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1-oversea.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"statscollector-2-oversea.agora.io",ENABLE_LIVE_SERVER_LIST:!1,LIVE_SERVER_LIST:[],ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,GATEWAY_DOMAINS:["edge.agora.io"],WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,LIVESTREAMING_ALIGN:!0,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_TIMEOUT:1e7,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,REPORT_STATS:!0,REPORT_STATS_TIMEOUT:3e3,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!1,PING_PONG_TIME_OUT:10,DUALSTREAM_OPERATION_CHECK:!0,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:1e3,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:2e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,TICKET_RENEW_TIMEOUT:828e5,LIVE_STREAMING_TIMEOUT:12e4,SHOW_REPORT_INVOKER_LOG:!1,STATS_FILTER:{transportId:!0,googTrackId:!0},FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,FORCE_CHANGED_GATEWAY_FLAG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",CHROME_NEW_STATS:!1,AP_BACKOFF_MAX_TIME:8,SET_DEFAULT_TURNSERVER:!0,TURN_SERVER_PASSWORD:r.toString(),PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",NGINX:"webrtc-cloud-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CR:!0,CRL:10,CRI:6,CUSTOMER_REPORT_TIMEOUT:5e3,LIVE_STREAMING_ADDRESS:"",CHOOSE_SERVER_FRAGEMENT_LENGTH:4,PLAN:"plan-b"};i.AREA_SETTING=["CHINA","GLOBAL"],i.WEBCS_DOMAIN=["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],i.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],i.PROXY_CS=["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],i.CDS_AP=["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],i.ACCOUNT_REGISTER=["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],i.UAP_AP=["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],i.LOG_UPLOAD_SERVER="logservice.agora.io",i.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",i.EVENT_REPORT_BACKUP_DOMAIN="web-3.statscollector.sd-rtn.com",i.GATEWAY_DOMAINS=["edge.agora.io","edge.sd-rtn.com"],i.NGINX="webrtc-cloud-proxy.sd-rtn.com",i.PROXY_SERVER_TYPE3=["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],t.setParameter=function(e,t){return void 0!==i[e]&&(i[e]=t,!0)},t.getParameter=function(e){return void 0!==i[e]?i[e]:null}},function(e,t,n){"use strict";n.r(t),n.d(t,"checkValidObject",(function(){return c})),n.d(t,"checkValidString",(function(){return u})),n.d(t,"checkValidNumber",(function(){return l})),n.d(t,"checkValidArray",(function(){return d})),n.d(t,"checkValidFloatNumber",(function(){return h})),n.d(t,"checkValidBoolean",(function(){return f})),n.d(t,"checkValidEnum",(function(){return s})),n.d(t,"checkValidUID",(function(){return p})),n.d(t,"isValidString",(function(){return m})),n.d(t,"isValidNumber",(function(){return g})),n.d(t,"isValidBoolean",(function(){return y})),n.d(t,"isASCII",(function(){return E})),n.d(t,"isInteger",(function(){return S})),n.d(t,"isNumber",(function(){return w})),n.d(t,"isString",(function(){return T})),n.d(t,"isArray",(function(){return A})),n.d(t,"isEmpty",(function(){return R})),n.d(t,"isValidToken",(function(){return b})),n.d(t,"isValidChannelName",(function(){return _}));var r=n(11),i=n.n(r),o=n(10),a=n(0),s=function(e,t,n){for(var r=0;r<n.length;r++)if(e===n[r])return!0;throw new Error("".concat(t," can only be set as ").concat(JSON.stringify(n)))},c=function(e,t){if(!e)throw new Error("Invalid param: ".concat(t||"param"," cannot be empty"));if("object"!==i()(e))throw new Error("".concat(t||"This paramter"," is of the object type"));return!0},u=function(e,t,n,r,i){if(R(n)&&(n=1),r=r||255,R(i)&&(i=!0),R(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!m(e,n,r,i))throw new Error("Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))},l=function(e,t,n,r){if(R(n)&&(n=1),r=r||1e4,R(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!g(e,n,r))throw new Error("Invalid ".concat(t||"number param",": The value range is [").concat(n,",").concat(r,"]. integer only"))},d=function(e,t){if(!Array.isArray(e))throw new Error("".concat(t," should be an array"))},h=function(e,t,n,r){if(null==e)throw new Error("".concat(t||"param"," cannot be null"));if(R(n)&&(n=0),r=r||1e4,R(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!v(e,n,r))throw new Error("Invalid ".concat(t||"number param",": The value range is [").concat(n,",").concat(r,"]."))},f=function(e,t){if(R(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!y(e))throw new Error("Invalid ".concat(t||"boolean param",": The value is of the boolean type."))},p=function(e){if(!Object(o.is32Uint)(e)&&!m(e,1,255))throw a.default.error("Invalid UID ".concat(e," ").concat(i()(e))),new Error("[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]")},m=function(e,t,n,r){return t||(t=0),n||(n=Number.MAX_SAFE_INTEGER),R(r)&&(r=!0),T(e)&&(!r||E(e))&&e.length>=t&&e.length<=n},g=function(e,t,n){return S(e)&&e>=t&&e<=n},v=function(e,t,n){return w(e)&&e>=t&&e<=n},y=function(e){return"boolean"==typeof e},b=function(e){return m(e,1,2047)},_=function(e){return T(e)&&/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e)},E=function(e){if("string"==typeof e){for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}},S=function(e){return"number"==typeof e&&e%1==0},w=function(e){return"number"==typeof e},T=function(e){return"string"==typeof e},A=function(e){return e instanceof Array},R=function(e){return null==e}},function(e,t,n){"use strict";n.r(t),n.d(t,"getBrowserInfo",(function(){return y})),n.d(t,"getBrowserVersion",(function(){return h})),n.d(t,"getBrowserOS",(function(){return f})),n.d(t,"isChrome",(function(){return r})),n.d(t,"isSafari",(function(){return i})),n.d(t,"isFireFox",(function(){return a})),n.d(t,"isOpera",(function(){return s})),n.d(t,"isEdge",(function(){return o})),n.d(t,"isQQBrowser",(function(){return c})),n.d(t,"isWeChatBrowser",(function(){return u})),n.d(t,"isLegacyChrome",(function(){return m})),n.d(t,"isSupportedPC",(function(){return l})),n.d(t,"isSupportedMobile",(function(){return d})),n.d(t,"getChromeKernelVersion",(function(){return v})),n.d(t,"isChromeKernel",(function(){return p}));var r=function(){var e=y();return e.name&&"Chrome"===e.name},i=function(){var e=y();return e.name&&"Safari"===e.name},o=function(){var e=y();return e.name&&"Edge"===e.name},a=function(){var e=y();return e.name&&"Firefox"===e.name},s=function(){var e=y();return e.name&&"OPR"===e.name},c=function(){var e=y();return e.name&&"QQBrowser"===e.name},u=function(){var e=y();return e.name&&"MicroMessenger"===e.name},l=function(){var e=f();return"Linux"===e||"Mac OS X"===e||"Mac OS"===e||-1!==e.indexOf("Windows")},d=function(){var e=f();return"Android"===e||"iOS"===e},h=function(){return y().version},f=function(){return y().os},p=function(){return!!navigator.userAgent.match(/chrome\/[\d]+/i)};function m(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}var g,v=function(){var e=navigator.userAgent.match(/chrome\/[\d]+/i);return e&&e[0]&&e[0].split("/")[1]},y=(g=function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];"Chrome"===n[1]&&null!=(e=t.match(/(OPR(?=\/))\/?(\d+)/i))&&(n=e),"Safari"===n[1]&&null!=(e=t.match(/version\/(\d+)/i))&&(n[2]=e[1]),~t.toLowerCase().indexOf("qqbrowser")&&null!=(e=t.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("micromessenger")&&null!=(e=t.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("edge")&&null!=(e=t.match(/(edge(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("trident")&&null!=(e=/\brv[ :]+(\d+)/g.exec(t)||[])&&(n=[null,"IE",e[1]]);var r=void 0,i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var o in i){var a=i[o];if(a.r.test(navigator.userAgent)){r=a.s;break}}return{name:n[1],version:n[2],os:r}}(),function(){return g})},function(e,t,n){"use strict";n.r(t),n.d(t,"APErrorCode",(function(){return r})),n.d(t,"GatewayErrorCode",(function(){return i})),n.d(t,"StringUidErrorCode",(function(){return o})),n.d(t,"JOIN_GS_TRYNEXT_LIST",(function(){return a})),n.d(t,"JOIN_CS_RETRY_LIST",(function(){return s})),n.d(t,"JOIN_PROXY_RETRY_LIST",(function(){return c})),n.d(t,"INJECT_STREAM_STATUS",(function(){return u})),n.d(t,"WEBSOCKET_CLOSE_REASON",(function(){return l}));var r={1010100:"NO_FLAG_SET",1010101:"FLAG_SET_BUT_EMPTY",1010102:"INVALID_FALG_SET",2010005:"INVALID_VENDOR_KEY",2010007:"INVALID_CHANNEL_NAME",2010008:"INTERNAL_ERROR",2010009:"NO_AUTHORIZED",2010010:"DYNAMIC_KEY_TIMEOUT",2010011:"NO_ACTIVE_STATUS",2010013:"DYNAMIC_KEY_EXPIRED",2010014:"STATIC_USE_DYANMIC_KEY",2010015:"DYNAMIC_USE_STATIC_KEY",2010016:"USER_OVERLOAD",2010018:"FORBIDDEN_REGION",2010019:"CANNOT_MEET_AREA_DEMAND"},i={2e3:"ERR_NO_VOCS_AVAILABLE",2001:"ERR_NO_VOS_AVAILABLE",2002:"ERR_JOIN_CHANNEL_TIMEOUT",2003:"WARN_REPEAT_JOIN",2004:"ERR_JOIN_BY_MULTI_IP",2011:"ERR_NOT_JOINED",2012:"WARN_REPEAT_JOIN",2013:"ERR_INVALID_VENDOR_KEY",2014:"ERR_INVALID_CHANNEL_NAME",2015:"ERR_INVALID_STRINGUID",2016:"ERR_TOO_MANY_USERS",2017:"ERR_SET_CLIENT_ROLE_TIMEOUT",2018:"ERR_SET_CLIENT_ROLE_NO_PERMISSION",2019:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",2020:"ERR_PUBLISH_REQUEST_INVALID",2021:"ERR_SUBSCRIBE_REQUEST_INVALID",2022:"ERR_NOT_SUPPORTED_MESSAGE",2023:"ERR_ILLEAGAL_PLUGIN",2028:"ILLEGAL_AES_PASSWORD",101:"ERR_INVALID_VENDOR_KEY",102:"ERR_INVALID_CHANNEL_NAME",103:"WARN_NO_AVAILABLE_CHANNEL",104:"WARN_LOOKUP_CHANNEL_TIMEOUT",105:"WARN_LOOKUP_CHANNEL_REJECTED",106:"WARN_OPEN_CHANNEL_TIMEOUT",107:"WARN_OPEN_CHANNEL_REJECTED",108:"WARN_REQUEST_DEFERRED",109:"ERR_DYNAMIC_KEY_TIMEOUT",110:"ERR_NO_AUTHORIZED",111:"ERR_VOM_SERVICE_UNAVAILABLE",112:"ERR_NO_CHANNEL_AVAILABLE_CODE",113:"ERR_TOO_MANY_USERS",114:"ERR_MASTER_VOCS_UNAVAILABLE",115:"ERR_INTERNAL_ERROR",116:"ERR_NO_ACTIVE_STATUS",117:"ERR_INVALID_UID",118:"ERR_DYNAMIC_KEY_EXPIRED",119:"ERR_STATIC_USE_DYANMIC_KE",120:"ERR_DYNAMIC_USE_STATIC_KE",2:"K_TIMESTAMP_EXPIRED",3:"K_CHANNEL_PERMISSION_INVALID",4:"K_CERTIFICATE_INVALID",5:"K_CHANNEL_NAME_EMPTY",6:"K_CHANNEL_NOT_FOUND",7:"K_TICKET_INVALID",8:"K_CHANNEL_CONFLICTED",9:"K_SERVICE_NOT_READY",10:"K_SERVICE_TOO_HEAVY",14:"K_UID_BANNED",15:"K_IP_BANNED",16:"K_CHANNEL_BANNED"},o={1:"ERROR_ILLEAGAL_APPID",2:"ERROR_ILLEAGAL_UID",3:"INTERNAL_SERVER_ERROR"},a=["ERR_NO_VOCS_AVAILABLE","ERR_NO_VOS_AVAILABLE","ERR_JOIN_CHANNEL_TIMEOUT","WARN_LOOKUP_CHANNEL_TIMEOUT","WARN_OPEN_CHANNEL_TIMEOUT","ERR_VOM_SERVICE_UNAVAILABLE","ERR_TOO_MANY_USERS","ERR_MASTER_VOCS_UNAVAILABLE","ERR_INTERNAL_ERROR"],s=["NO_SERVICE_AVAILABLE"],c=["NO_SERVICE_AVAILABLE","REQUEST_PROXY_SERVER_FAILED","REQUEST_PROXY_SERVER_TIME_OUT"],u={INJECT_STREAM_STATUS_START_SUCCESS:0,INJECT_STREAM_STATUS_START_ALREADY_EXISTS:1,INJECT_STREAM_STATUS_START_UNAUTHORIZED:2,INJECT_STREAM_STATUS_START_TIMEDOUT:3,INJECT_STREAM_STATUS_START_FAILED:4,INJECT_STREAM_STATUS_STOP_SUCCESS:5,INJECT_STREAM_STATUS_STOP_NOT_FOUND:6,INJECT_STREAM_STATUS_STOP_UNAUTHORIZED:7,INJECT_STREAM_STATUS_STOP_TIMEDOUT:8,INJECT_STREAM_STATUS_STOP_FAILED:9,INJECT_STREAM_STATUS_BROKEN:10},l={WS_DISCONNECT:"WS_DISCONNECT"};t.default={FAILED:"FAILED",INVALID_KEY:"INVALID_KEY",INVALID_CLIENT_MODE:"INVALID_CLIENT_MODE",INVALID_CLIENT_CODEC:"INVALID_CLIENT_CODEC",CLIENT_MODE_CODEC_MISMATCH:"CLIENT_MODE_CODEC_MISMATCH",WEB_API_NOT_SUPPORTED:"WEB_API_NOT_SUPPORTED",INVALID_PARAMETER:"INVALID_PARAMETER",NO_TRACK_IN_STREAM:"NO_TRACK_IN_STREAM",INVALID_OPERATION:"INVALID_OPERATION",INVALID_LOCAL_STREAM:"INVALID_LOCAL_STREAM",INVALID_REMOTE_STREAM:"INVALID_REMOTE_STREAM",INVALID_DYNAMIC_KEY:"INVALID_DYNAMIC_KEY",DYNAMIC_KEY_TIMEOUT:"DYNAMIC_KEY_TIMEOUT",NO_VOCS_AVAILABLE:"NO_VOCS_AVAILABLE",NO_VOS_AVAILABLE:"ERR_NO_VOS_AVAILABLE",JOIN_CHANNEL_TIMEOUT:"ERR_JOIN_CHANNEL_TIMEOUT",NO_AVAILABLE_CHANNEL:"NO_AVAILABLE_CHANNEL",LOOKUP_CHANNEL_TIMEOUT:"LOOKUP_CHANNEL_TIMEOUT",LOOKUP_CHANNEL_REJECTED:"LOOKUP_CHANNEL_REJECTED",OPEN_CHANNEL_TIMEOUT:"OPEN_CHANNEL_TIMEOUT",OPEN_CHANNEL_REJECTED:"OPEN_CHANNEL_REJECTED",REQUEST_DEFERRED:"REQUEST_DEFERRED",STREAM_ALREADY_PUBLISHED:"STREAM_ALREADY_PUBLISHED",STREAM_NOT_YET_PUBLISHED:"STREAM_NOT_YET_PUBLISHED",JOIN_TOO_FREQUENT:"JOIN_TOO_FREQUENT",SOCKET_ERROR:"SOCKET_ERROR",SOCKET_DISCONNECTED:"SOCKET_DISCONNECTED",PEERCONNECTION_FAILED:"PEERCONNECTION_FAILED",CONNECT_GATEWAY_ERROR:"CONNECT_GATEWAY_ERROR",SERVICE_NOT_AVAILABLE:"SERVICE_NOT_AVAILABLE",JOIN_CHANNEL_FAILED:"JOIN_CHANNEL_FAILED",PUBLISH_STREAM_FAILED:"PUBLISH_STREAM_FAILED",UNPUBLISH_STREAM_FAILED:"UNPUBLISH_STREAM_FAILED",SUBSCRIBE_STREAM_FAILED:"SUBSCRIBE_STREAM_FAILED",UNSUBSCRIBE_STREAM_FAILED:"UNSUBSCRIBE_STREAM_FAILED",NO_SUCH_REMOTE_STREAM:"NO_SUCH_REMOTE_STREAM",ERR_FAILED:"1",ERR_INVALID_VENDOR_KEY:"101",ERR_INVALID_CHANNEL_NAME:"102",WARN_NO_AVAILABLE_CHANNEL:"103",WARN_LOOKUP_CHANNEL_TIMEOUT:"104",WARN_LOOKUP_CHANNEL_REJECTED:"105",WARN_OPEN_CHANNEL_TIMEOUT:"106",WARN_OPEN_CHANNEL_REJECTED:"107",WARN_REQUEST_DEFERRED:"108",ERR_DYNAMIC_KEY_TIMEOUT:"109",ERR_INVALID_DYNAMIC_KEY:"110",ERR_NO_VOCS_AVAILABLE:"2000",ERR_NO_VOS_AVAILABLE:"2001",ERR_JOIN_CHANNEL_TIMEOUT:"2002",IOS_NOT_SUPPORT:"IOS_NOT_SUPPORT",WECHAT_NOT_SUPPORT:"WECHAT_NOT_SUPPORT",SHARING_SCREEN_NOT_SUPPORT:"SHARING_SCREEN_NOT_SUPPORT",STILL_ON_PUBLISHING:"STILL_ON_PUBLISHING",LOW_STREAM_ALREADY_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",LOW_STREAM_NOT_YET_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",HIGH_STREAM_NOT_VIDEO_TRACE:"HIGH_STREAM_NOT_VIDEO_TRACE",NOT_FIND_DEVICE_BY_LABEL:"NOT_FIND_DEVICE_BY_LABEL",ENABLE_DUALSTREAM_FAILED:"ENABLE_DUALSTREAM_FAILED",DISABLE_DUALSTREAM_FAILED:"DISABLE_DUALSTREAM_FAILED",PLAYER_NOT_FOUND:"PLAYER_NOT_FOUND",ELECTRON_NOT_SUPPORT_SHARING_SCREEN:"ELECTRON_NOT_SUPPORT_SHARING_SCREEN",BAD_ENVIRONMENT:"BAD_ENVIRONMENT",LOAD_AUDIO_FAILED:"LOAD_AUDIO_FAILED"}},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n(0);var r=function(e,t,n){if(["End2EndDelay","TransportDelay","PacketLossRate","RecvLevel","RecvBitrate","CodecType","MuteState","TotalFreezeTime","TotalPlayDuration","RecordingLevel","SendLevel","SamplingRate","SendBitrate","CodecType","MuteState","End2EndDelay","TransportDelay","PacketLossRate","RecvBitrate","RecvResolutionWidth","RecvResolutionHeight","RenderResolutionHeight","RenderResolutionWidth","RenderFrameRate","TotalFreezeTime","TotalPlayDuration","TargetSendBitrate","SendFrameRate","SendFrameRate","SendBitrate","SendResolutionWidth","SendResolutionHeight","CaptureResolutionHeight","CaptureResolutionWidth","EncodeDelay","MuteState","TotalFreezeTime","TotalDuration","CaptureFrameRate","RTT","OutgoingAvailableBandwidth","Duration","UserCount","SendBytes","RecvBytes","SendBitrate","RecvBitrate","accessDelay","audioSendBytes","audioSendPackets","videoSendBytes","videoSendPackets","videoSendPacketsLost","videoSendFrameRate","audioSendPacketsLost","videoSendResolutionWidth","videoSendResolutionHeight","accessDelay","audioReceiveBytes","audioReceivePackets","audioReceivePacketsLost","videoReceiveBytes","videoReceivePackets","videoReceivePacketsLost","videoReceiveFrameRate","videoReceiveDecodeFrameRate","videoReceiveResolutionWidth","videoReceiveResolutionHeight","endToEndDelay","videoReceiveDelay","audioReceiveDelay","FirstFrameTime","VideoFreezeRate","AudioFreezeRate","RenderResolutionWidth","RenderResolutionHeight","VideoPublishDuration","AudioPublishDuration"].indexOf(t)>-1&&("string"==typeof n||isFinite(n)))return e[t]=""+n},i=function(e){var t={};return e.forEach((function(e){e.id&&e.type&&(-1===e.id.indexOf("send")&&-1===e.type.toLowerCase().indexOf("outbound")&&-1===e.id.indexOf("outbound_rtp")&&-1===e.id.indexOf("OutboundRTP")||("audio"===e.mediaType?(r(t,"audioSendBytes",e.bytesSent),r(t,"audioSendPackets",e.packetsSent),r(t,"audioSendPacketsLost",e.packetsLost)):(r(t,"videoSendBytes",e.bytesSent),r(t,"videoSendPackets",e.packetsSent),r(t,"videoSendPacketsLost",e.packetsLost),r(t,"videoSendFrameRate",e.googFrameRateSent),r(t,"videoSendResolutionWidth",e.googFrameWidthSent),r(t,"videoSendResolutionHeight",e.googFrameHeightSent))))})),t},o=function(e){var t={};return e.forEach((function(e){e.id&&e.type&&(-1===e.id.indexOf("recv")&&-1===e.type.toLowerCase().indexOf("inbound")&&-1===e.id.indexOf("inbound_rtp")&&-1===e.id.indexOf("inbound-rtp")&&-1===e.id.indexOf("InboundRTP")||("audio"===e.mediaType?(r(t,"audioReceiveBytes",e.bytesReceived),r(t,"audioReceivePackets",e.packetsReceived),r(t,"audioReceivePacketsLost",e.packetsLost)):(r(t,"videoReceiveBytes",e.bytesReceived),r(t,"videoReceivePacketsLost",e.packetsLost),r(t,"videoReceivePackets",e.packetsReceived),r(t,"videoReceiveFrameRate",e.googFrameRateReceived),r(t,"videoReceiveDecodeFrameRate",e.googFrameRateDecoded),r(t,"videoReceiveResolutionWidth",e.googFrameWidthReceived),r(t,"videoReceiveResolutionHeight",e.googFrameHeightReceived))))})),t}},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"e",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"c",(function(){return u}));var r=n(0),i=function(){var e={dispatcher:{}};return e.dispatcher.eventListeners={},e.addEventListener=function(t,n){void 0===e.dispatcher.eventListeners[t]&&(e.dispatcher.eventListeners[t]=[]),e.dispatcher.eventListeners[t].push(n)},e.hasListeners=function(t){return!(!e.dispatcher.eventListeners[t]||!e.dispatcher.eventListeners[t].length)},e.on=e.addEventListener,e.removeEventListener=function(t,n){var r;e.dispatcher.eventListeners[t]&&-1!==(r=e.dispatcher.eventListeners[t].indexOf(n))&&e.dispatcher.eventListeners[t].splice(r,1)},e.dispatchEvent=function(t){var n;for(n in e.dispatcher.eventListeners[t.type])if(e.dispatcher.eventListeners[t.type]&&e.dispatcher.eventListeners[t.type].hasOwnProperty(n)&&"function"==typeof e.dispatcher.eventListeners[t.type][n])try{e.dispatcher.eventListeners[t.type][n](t)}catch(n){r.default.debug("[".concat(e.clientId,"] Error in ").concat(t.type," event"),n)}},e.dispatchSocketEvent=function(t){var n;for(n in e.dispatcher.eventListeners[t.type])e.dispatcher.eventListeners[t.type]&&e.dispatcher.eventListeners[t.type].hasOwnProperty(n)&&"function"==typeof e.dispatcher.eventListeners[t.type][n]&&e.dispatcher.eventListeners[t.type][n](t.msg)},e},o=function(e){var t={};return t.type=e.type,t},a=function(e){var t=o(e);return t.stream=e.stream,t.reason=e.reason,t.msg=e.msg,t},s=function(e){var t=o(e);return t.uid=e.uid,t.attr=e.attr,t.stream=e.stream,t},c=function(e){var t=o(e);return t.msg=e.msg,t},u=function(e){var t=o(e);return t.url=e.url,t.uid=e.uid,t.status=e.status,t.reason=e.reason,t}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=s(n(69)),u=n(2),l=s(n(0)),d=n(3),h=n(14),f=n(10),p=function(e){function t(t,n){var r=e.call(this)||this;return r._state=b.RELAY_STATE_IDLE,r._onStatus=function(e){l.default.debug("["+r.clientId+"] ChannelMediaStatus: "+JSON.stringify(e)),e&&e.command&&("onAudioPacketReceived"===e.command&&r.emit("event",y.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&r.emit("event",y.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(r._state=b.RELAY_STATE_FAILURE,r.emit("state",b.RELAY_STATE_FAILURE,_.SRC_TOKEN_EXPIRED)),"onDestTokenPrivilegeDidExpire"===e.command&&(r._state=b.RELAY_STATE_FAILURE,r.emit("state",b.RELAY_STATE_FAILURE,_.DEST_TOKEN_EXPIRED,e.channelName?{came:e.channelName}:null)))},r._onClose=function(){return o(r,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:if(l.default.debug("["+this.clientId+"] ChannelMediaSocket onClose"),this.emit("event",y.NETWORK_DISCONNECTED),this.state=b.RELAY_STATE_IDLE,!this._prevChannelMediaConfig)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.startChannelMediaRelay(this._prevChannelMediaConfig)];case 2:return t.sent(),[3,4];case 3:return(e=t.sent())instanceof S&&(e.message===g.WS_ABORT||e.message===g.AP_REQUEST_ABORT)?[2]:(this.emit("state",b.RELAY_STATE_FAILURE,_.SERVER_CONNECTION_LOST),[3,4]);case 4:return[2]}}))}))},r.token=t.appId,r.appId=t.appId,r.cname=t.cname,r.uid=t.uid,r.sid=t.sid,r.clientId=n,r}return i(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){var t=this._state;this._state=e,t!==e&&this.emit("state",e)},enumerable:!0,configurable:!0}),t.prototype.startChannelMediaRelay=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:if(this.state!==b.RELAY_STATE_IDLE)throw new S(g.BAD_STATE);return this.state=b.RELAY_STATE_CONNECTING,[4,this._connect()];case 1:return t.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: connect success"),[4,this._sendStartRelayMessage(e)];case 2:return t.sent(),this._prevChannelMediaConfig=e,[2]}}))}))},t.prototype.updateChannelMediaRelay=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:if(this.state!==b.RELAY_STATE_RUNNING)throw new S(g.BAD_STATE);return[4,this._sendUpdateMessage(e)];case 1:return t.sent(),this._prevChannelMediaConfig=e,[2]}}))}))},t.prototype.stopChannelMediaRelay=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this._sendStopRelayMessage()];case 1:return e.sent(),l.default.debug("["+this.clientId+"] stopChannelMediaRelay: send stop message success"),this.state=b.RELAY_STATE_IDLE,this.dispose(),[2]}}))}))},t.prototype.dispose=function(){l.default.debug("["+this.clientId+"] disposeChannelMediaRelay"),this.state=b.RELAY_STATE_IDLE,this.emit("dispose"),this._signal&&this._signal.dispose(),this._prevChannelMediaConfig=null,this.removeEvent()},t.prototype._requestOneAP=function(e){var t=this;return new Promise((function(n,r){var i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:"",ts:+new Date,version:u.VERSION,cname:t.cname,uid:t.uid+"",seq:1,requestId:1},o={service_name:"tele_channel",json_body:JSON.stringify(i)},a="https://"+e;h.post(a,o,(function(e){var t=null,i=null;try{t=JSON.parse(e)}catch(e){r(new S(g.AP_JSON_PARSE_ERROR,e))}0!==t.code&&r(new S(g.AP_REQUEST_ERROR,t));try{i=JSON.parse(t.json_body)}catch(e){r(new S(g.AP_JSON_PARSE_ERROR,e))}200!==i.code&&r(new S(g.AP_REQUEST_ERROR,i)),i.servers?n(i.servers):r(new S(g.AP_JSON_PARSE_ERROR,i))}),(function(e){return r(e)}),{"X-Packet-Service-Type":0,"X-Packet-URI":61})}))},t.prototype._requestAP=function(){var e=this,t=u.getParameter("UAP_AP");return new Promise((function(n,r){setTimeout((function(){r(new S(g.AP_REQUEST_TIMEOUT))}),5e3),e.on("dispose",(function(){r(new S(g.AP_REQUEST_ABORT))})),t.forEach((function(t){t+="/api/v1",e._requestOneAP(t).then((function(r){l.default.debug("["+e.clientId+"] startChannelMediaRelay request AP "+t+" success: "+JSON.stringify(r));var i=r[0],o="wss://"+i.address.replace(/\./g,"-")+".edge.agora.io:"+i.wss;n(o)})).catch((function(n){l.default.debug("["+e.clientId+"] startChannelMediaRelay request AP "+t+" failed: "+JSON.stringify(n))}))}))}))},t.prototype._connectWebsocket=function(e){return this._signal=new E(this.appId,this.cname,this.uid,this.sid),this._signal.connect(e)},t.prototype._connect=function(){return o(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,this._requestAP()];case 1:return e=t.sent(),[4,this._connectWebsocket(e)];case 2:return t.sent(),this._signal.on("close",this._onClose.bind(this)),this._signal.on("status",this._onStatus.bind(this)),this.emit("event",y.NETWORK_CONNECTED),[2]}}))}))},t.prototype._sendStartRelayMessage=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i,o,s;return a(this,(function(a){switch(a.label){case 0:return this._checkSignal(),t=this._genMessage(v.StopPacketTransfer),[4,this._signal.request(t)];case 1:return a.sent(),[4,this._signal.waitStatus("Normal Quit")];case 2:return a.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: StopPacketTransfer success"),n=this._genMessage(v.SetSdkProfile,e),[4,this._signal.request(n)];case 3:return a.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSdkProfile success"),r=this._genMessage(v.SetSourceChannel,e),[4,this._signal.request(r)];case 4:return a.sent(),[4,this._signal.waitStatus("SetSourceChannelStatus")];case 5:return a.sent(),this.emit("event",y.PACKET_JOINED_SRC_CHANNEL),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSourceChannel success"),i=this._genMessage(v.SetSourceUserId,e),[4,this._signal.request(i)];case 6:return a.sent(),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSourceUserId success"),o=this._genMessage(v.SetDestChannel,e),[4,this._signal.request(o)];case 7:return a.sent(),[4,this._signal.waitStatus("SetDestChannelStatus")];case 8:return a.sent(),this.emit("event",y.PACKET_JOINED_DEST_CHANNEL),l.default.debug("["+this.clientId+"] startChannelMediaRelay: SetDestChannel success"),s=this._genMessage(v.StartPacketTransfer,e),[4,this._signal.request(s)];case 9:return a.sent(),this.emit("event",y.PACKET_SENT_TO_DEST_CHANNEL),this.state=b.RELAY_STATE_RUNNING,l.default.debug("["+this.clientId+"] startChannelMediaRelay: StartPacketTransfer success"),[2]}}))}))},t.prototype._sendReconnectMessage=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return this._checkSignal(),t=this._genMessage(v.Reconnect,e),[4,this._signal.request(t)];case 1:return n.sent(),[2]}}))}))},t.prototype._sendUpdateMessage=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return this._checkSignal(),t=this._genMessage(v.UpdateDestChannel,e),[4,this._signal.request(t)];case 1:return n.sent(),this.emit("event",y.PACKET_UPDATE_DEST_CHANNEL),l.default.debug("["+this.clientId+"] sendUpdateMessage: UpdateDestChannel success"),[2]}}))}))},t.prototype._sendStopRelayMessage=function(){return o(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return this._checkSignal(),e=this._genMessage(v.StopPacketTransfer),[4,this._signal.request(e)];case 1:return t.sent(),l.default.debug("["+this.clientId+"] sendStopRelayMessage: StopPacketTransfer success"),[2]}}))}))},t.prototype._genMessage=function(e,t){var n=this,r=[],i=[],o=[],a={appId:this.appId,cname:this.cname,uid:this.uid+"",sdkVersion:u.VERSION,sid:this.sid,ts:+new Date,requestId:0,seq:0,allocate:!0,clientRequest:{}},s=null;switch(e){case v.SetSdkProfile:return a.clientRequest={command:"SetSdkProfile",type:"multi_channel"},a;case v.SetSourceChannel:return s=t.getSrcChannelMediaInfo(),a.clientRequest={command:"SetSourceChannel",uid:s.uid+"",channelName:s.channelName,token:s.token||this.appId},a;case v.SetSourceUserId:return s=t.getSrcChannelMediaInfo(),a.clientRequest={command:"SetSourceUserId",uid:this.uid+""},a;case v.SetDestChannel:return t.getDestChannelMediaInfos().forEach((function(e){r.push(e.channelName),i.push(e.uid+""),o.push(e.token||n.appId)})),a.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:o},a;case v.StartPacketTransfer:return a.clientRequest={command:"StartPacketTransfer"},a;case v.Reconnect:return a.clientRequest={command:"Reconnect"},a;case v.StopPacketTransfer:return a.clientRequest={command:"StopPacketTransfer"},a;case v.UpdateDestChannel:return t.getDestChannelMediaInfos().forEach((function(e){r.push(e.channelName),i.push(e.uid+""),o.push(e.token||n.appId)})),a.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:o},a}},t.prototype._checkSignal=function(){if(!this._signal||!this._signal.isConnect())throw new S(g.WS_DISCONNECTED)},t}(c.default);t.default=p;var m=function(){function e(){this.destChannelMediaInfos=new Map}return e.prototype.setSrcChannelInfo=function(e){d.checkValidObject(e,"srcInfo");var t=e.uid,n=e.channelName,r=e.token;if(r&&!d.isValidToken(r))throw new Error("Invalid token in SrcChannelInfo");if(!d.isValidChannelName(n))throw new Error("Invalid channelName in SrcChannelInfo");if(!f.is32Uint(t))throw new Error("Invalid uid in SrcChannelInfo");this.srcChannelMediaInfo=e},e.prototype.setDestChannelInfo=function(e,t){if(!d.isValidChannelName(e))throw new Error("Invalid channelName in DestChannelInfo");d.checkValidObject(t,"destInfo");var n=t.uid,r=t.token,i=t.channelName;if(r&&!d.isValidToken(r))throw new Error("Invalid token in DestChannelInfo");if(!d.isValidChannelName(i))throw new Error("Invalid channelName in DestChannelInfo");if(!f.is32Uint(n))throw new Error("Invalid uid in DestChannelInfo");this.destChannelMediaInfos.set(e,t)},e.prototype.removeDestChannelInfo=function(e){if(!d.isValidChannelName(e))throw new Error("Invalid channelName when invoke removeDestChannelInfo");this.destChannelMediaInfos.delete(e)},e.prototype.getSrcChannelMediaInfo=function(){return this.srcChannelMediaInfo},e.prototype.getDestChannelMediaInfos=function(){return this.destChannelMediaInfos},e}();t.ChannelMediaRelayConfiguration=m;var g,v,y,b,_,E=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o._onOpen=function(){o.emit("open")},o._onClose=function(e){o.emit("close"),o.dispose()},o._onMessage=function(e){var t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(o.emit("status",t.serverStatus),void o.emit(t.serverStatus.command,t.serverStatus)):void 0;o.emit("req_"+t.requestId,t)},o._requestId=1,o.appId=t,o.cname=n,o.uid=r,o.sid=i,o}return i(t,e),t.prototype.isConnect=function(){return this._ws&&this._ws.readyState===WebSocket.OPEN},t.prototype.sendMessage=function(e){if(!this._ws||this._ws.readyState!==WebSocket.OPEN)throw new S(g.WS_DISCONNECTED);var t=this._requestId++;return e.requestId=t,e.seq=t,this._ws.send(JSON.stringify(e)),t},t.prototype.waitStatus=function(e){var t=this;return new Promise((function(n,r){var i=window.setTimeout((function(){r(new S(g.WAIT_STATUS_TIMEOUT,e))}),5e3);t.once(e,(function(t){clearTimeout(i),t.state&&0!==t.state?r(new S(g.WAIT_STATUS_ERROR,e)):n()})),t.once("dispose",(function(){clearTimeout(i),r(new S(g.WS_ABORT))}))}))},t.prototype.request=function(e){var t=this;return new Promise((function(n,r){var i=t.sendMessage(e),o=window.setTimeout((function(){t.removeAllListeners("req_"+i),r(new S(g.REQUEST_TIMEOUT))}),3e3);t.once("req_"+i,(function(e){clearTimeout(o),e&&200===e.code?n(e):r(new S(g.REQUEST_FAILED,e))})),t.once("dispose",(function(){clearTimeout(o),r(new S(g.WS_ABORT))}))}))},t.prototype.connect=function(e){var t=this;return new Promise((function(n,r){t._ws=new WebSocket(e),t._ws.onopen=function(){t._onOpen(),t._prvUrl=e,t._ws.onmessage=t._onMessage,t._ws.onclose=t._onClose,t._startHeartBeatCheck(),n()},t._ws.onclose=function(e){t._ws=null,r(new S(g.CONNECT_FAILED,"websocket error code: "+e.code))},setTimeout((function(){t._ws&&t._ws.readyState!==WebSocket.OPEN&&(t._ws.onopen=null,t._ws.onclose=null,t._ws.close(),t._ws=null,r(new S(g.CONNECT_TIMEOUT)))}),5e3),t.once("dispose",(function(){r(new S(g.WS_ABORT))}))}))},t.prototype.dispose=function(){this._clearHeartBeatCheck(),this.emit("dispose"),this.removeEvent(),this._ws&&(this._ws.onopen=null,this._ws.onclose=null,this._ws.onmessage=null,this._ws.close()),this._ws=null},t.prototype._sendPing=function(e){if(!this._ws||this._ws.readyState!==WebSocket.OPEN)throw new S(g.WS_DISCONNECTED);var t=this._requestId++;return e.requestId=t,this._ws.send(JSON.stringify(e)),t},t.prototype._startHeartBeatCheck=function(){var e=this;this._heartBeatTimer=window.setInterval((function(){e._sendPing({command:"ping",appId:e.appId,cname:e.cname,uid:e.uid+"",sid:e.sid,ts:+new Date,requestId:0})}),3e3)},t.prototype._clearHeartBeatCheck=function(){window.clearInterval(this._heartBeatTimer)},t}(c.default),S=function(e,t,n){void 0===e&&(e=""),this.code=n,this.data=t,this.message=e};t.ChannelMediaError=S,function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(g=t.CHANNEL_MEDIA_ERROR||(t.CHANNEL_MEDIA_ERROR={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(v||(v={})),function(e){e[e.NETWORK_DISCONNECTED=0]="NETWORK_DISCONNECTED",e[e.NETWORK_CONNECTED=1]="NETWORK_CONNECTED",e[e.PACKET_JOINED_SRC_CHANNEL=2]="PACKET_JOINED_SRC_CHANNEL",e[e.PACKET_JOINED_DEST_CHANNEL=3]="PACKET_JOINED_DEST_CHANNEL",e[e.PACKET_SENT_TO_DEST_CHANNEL=4]="PACKET_SENT_TO_DEST_CHANNEL",e[e.PACKET_RECEIVED_VIDEO_FROM_SRC=5]="PACKET_RECEIVED_VIDEO_FROM_SRC",e[e.PACKET_RECEIVED_AUDIO_FROM_SRC=6]="PACKET_RECEIVED_AUDIO_FROM_SRC",e[e.PACKET_UPDATE_DEST_CHANNEL=7]="PACKET_UPDATE_DEST_CHANNEL",e[e.PACKET_UPDATE_DEST_CHANNEL_REFUSED=8]="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e[e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE=9]="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(y=t.CHANNEL_MEDIA_RELAY_EVENT||(t.CHANNEL_MEDIA_RELAY_EVENT={})),function(e){e[e.RELAY_STATE_IDLE=0]="RELAY_STATE_IDLE",e[e.RELAY_STATE_CONNECTING=1]="RELAY_STATE_CONNECTING",e[e.RELAY_STATE_RUNNING=2]="RELAY_STATE_RUNNING",e[e.RELAY_STATE_FAILURE=3]="RELAY_STATE_FAILURE"}(b=t.CHANNEL_MEDIA_RELAY_STATE||(t.CHANNEL_MEDIA_RELAY_STATE={})),function(e){e[e.RELAY_OK=0]="RELAY_OK",e[e.SERVER_ERROR_RESPONSE=1]="SERVER_ERROR_RESPONSE",e[e.SERVER_NO_RESPONSE=2]="SERVER_NO_RESPONSE",e[e.NO_RESOURCE_AVAILABLE=3]="NO_RESOURCE_AVAILABLE",e[e.FAILED_JOIN_SRC=4]="FAILED_JOIN_SRC",e[e.FAILED_JOIN_DEST=5]="FAILED_JOIN_DEST",e[e.FAILED_PACKET_RECEIVED_FROM_SRC=6]="FAILED_PACKET_RECEIVED_FROM_SRC",e[e.FAILED_PACKET_SENT_TO_DEST=7]="FAILED_PACKET_SENT_TO_DEST",e[e.SERVER_CONNECTION_LOST=8]="SERVER_CONNECTION_LOST",e[e.INTERNAL_ERROR=9]="INTERNAL_ERROR",e[e.SRC_TOKEN_EXPIRED=10]="SRC_TOKEN_EXPIRED",e[e.DEST_TOKEN_EXPIRED=11]="DEST_TOKEN_EXPIRED",e[e.RELAY_ALREADY_START=12]="RELAY_ALREADY_START",e[e.RELAY_NOT_START=13]="RELAY_NOT_START",e[e.OPERATION_ABORT=14]="OPERATION_ABORT"}(_=t.CHANNEL_MEDIA_RELAY_ERROR||(t.CHANNEL_MEDIA_RELAY_ERROR={}))},function(e,t,n){"use strict";n.r(t),n.d(t,"isLiveTranscodingValid",(function(){return _})),n.d(t,"generateSessionId",(function(){return v})),n.d(t,"audioLevelHelper",(function(){return p})),n.d(t,"vsResHack",(function(){return y})),n.d(t,"is32Uint",(function(){return b})),n.d(t,"safeCall",(function(){return d})),n.d(t,"random",(function(){return S})),n.d(t,"popBanTip",(function(){return A})),n.d(t,"lengthInUtf8Bytes",(function(){return w})),n.d(t,"audioTimerLoop",(function(){return T})),n.d(t,"generateId",(function(){return g})),n.d(t,"uint8ArrayToBase64",(function(){return h})),n.d(t,"base64ToUint8Array",(function(){return f}));var r=n(11),i=n.n(r),o=n(4),a=n(0),s=n(28),c=n.n(s),u=n(25),l=n(15),d=function(){var e=arguments[0];if("function"==typeof e){var t=Array.prototype.slice.call(arguments,1);e.apply(null,t)}},h=function(e){for(var t="",n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)},f=function(e){for(var t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length)),r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n},p=function(e){return this.audioContext=Object(u.a)(),this.sourceNode=e.otWebkitAudioSource||this.audioContext.createMediaStreamSource(e),this.analyser=this.audioContext.createAnalyser(),this.timeDomainData=new Uint8Array(this.analyser.frequencyBinCount),this.sourceNode.connect(this.analyser),this.getAudioLevel=function(){if(this.analyser){this.analyser.getByteTimeDomainData(this.timeDomainData);for(var e=0,t=0;t<this.timeDomainData.length;t++)e=Math.max(e,Math.abs(this.timeDomainData[t]-128));return e/128}return a.default.warning("can't find analyser in audioLevelHelper"),0},this},m=1e4;function g(){return++m}function v(){return c()().replace(/-/g,"").toUpperCase()}var y=function(e,t,n){try{a.default.debug("start vsResHack",e);var r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: absolute; top: 0; left: 0; width:1px; high:1px;"),document.body.appendChild(r);var i=!1;r.addEventListener("playing",(function(n){o.isFireFox()?r.videoWidth&&(i=!0,a.default.debug("[vsResHack] get stream resolution: ","".concat(r.videoWidth," x ").concat(r.videoHeight),e),t(r.videoWidth,r.videoHeight),r.srcObject=null,r.remove()):(i=!0,a.default.debug("[vsResHack] get stream resolution: ","".concat(r.videoWidth," x ").concat(r.videoHeight),e),t(r.videoWidth,r.videoHeight),r.srcObject=null,r.remove())})),Object(l.setSrcObject)(r,e),r.play().catch((function(){})),setTimeout((function(){!i&&r&&(t(r.videoWidth,r.videoHeight),r.srcObject=null,r.remove())}),4e3)}catch(e){n(e)}},b=function(e){return"number"==typeof e&&0<=e&&e<=4294967295},_=function(e){var t=["lowLatency","userConfigExtraInfo","transcodingUsers"];for(var n in e)if("lowLatency"===n&&"boolean"!=typeof e[n]||"userConfigExtraInfo"===n&&"object"!==i()(e[n])||"transcodingUsers"===n&&!E(e[n])||!~t.indexOf(n)&&"number"!=typeof e[n])throw new Error("Param ["+n+"] is inValid");return!0},E=function(e){for(var t=0;t<e.length;t++)for(var n in e[t])if("number"!=typeof e[t][n])throw new Error("Param user["+t+"] - ["+n+"] is inValid");return!0},S=function(e){isNaN(e)&&(e=1e3);var t=+new Date,n=(t=(9301*t+49297)%233280)/233280;return Math.ceil(n*e)},w=function(e){var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)},T=function(e,t){var n=1/t,r=Object(u.a)(),i=r.createGain();i.gain.value=0,i.connect(r.destination);var o=!1;return function t(){var a=r.createOscillator();a.onended=t,a.connect(i),a.start(0),a.stop(r.currentTime+n),e(r.currentTime),o&&(a.onended=function(){})}(),function(){o=!0}},A=function(){if(!document.getElementById("agora-ban-tip")){var e=document.createElement("div");e.id="agora-ban-tip",e.style="position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: #fff;",document.querySelector("body").prepend(e);var t=document.createElement("div");t.style="background: #000; width: 346px; height: 116px; z-index: 100000; opacity: 0.6; border-radius: 10px; box-shadow: 0 2px 4px #000;",e.append(t);var n=document.createElement("div");n.style="height: 76px; display: flex; justify-content: center; align-items: center;";var r=document.createElement("span");r.style="height: 28px; width: 28px; color: #000; text-align: center; line-height: 30px; background: #fff; border-radius: 50%; font-weight: 600; font-size: 20px;margin-right: 5px;",r.innerText="!";var i=document.createElement("span");i.innerText="This browser does not support webRTC",n.append(r),n.append(i);var o=document.createElement("div");o.style="height: 38px; display: flex; border-top: #fff 1px solid; justify-content: center; align-items: center;",o.innerText="OK",t.append(n),t.append(o),o.onclick=function(){var e=document.getElementById("agora-ban-tip");e.parentNode.removeChild(e)}}}},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t,n){e.exports=n(64)},function(t,n,r){"use strict";var i=r(12),o=r.n(i),a=r(17),s=r.n(a),c=r(11),u=r.n(c),l=r(32),d=r.n(l),h=r(7),f=r.n(h),p=r(22),m=r(8),g=function(e){e&&e.apply(this,[].slice.call(arguments,1))},v=r(0),y=r(1),b=r(10),_=r(14),E=r(2),S=function(e){var t=Object(m.b)(e);t.needReconnect=!0,t.isTimeout=!1,t.isInit=!0,t.sendbytes=0,t.recvbytes=0,t.startTime=Date.now(),t.lastMsgTime=null,t.clientId=e.clientId,t.hostIndex=0,t.requestID=0,e.host instanceof Array?t.host=e.host:t.host=[e.host],t.getSendBytes=function(){return t.sendbytes},t.getRecvBytes=function(){return t.recvbytes},t.getDuration=function(){return Math.ceil((Date.now()-t.startTime)/1e3)},t.getURL=function(){return t.connection.url},t.reconnect=function(){t.isInit=!0,t.creatConnection()},t.connectNext=function(){t.isInit=!0,++t.hostIndex,v.default.debug("["+t.clientId+"] Gateway length:"+t.host.length+" current index:"+t.hostIndex),t.hostIndex>=t.host.length?t.dispatchEvent(Object(m.d)({type:"recover"})):t.creatConnection()},t.replaceHost=function(e){t.host=e||t.host,t.hostIndex=0,t.creatConnection()},t.creatConnection=function(){t.needReconnect=!0,t.lts=(new Date).getTime(),t.connection=new WebSocket("wss://"+t.host[t.hostIndex]),t.connection.binaryType="arraybuffer",t.turnConfig={};var n=e.proxyServerType;if(t.connection.url&&3!==n&&4!==n&&5!==n){var r=t.connection.url.match(/wss\:\/\/([^:]+):(\d+)/),i=t.host[t.hostIndex].split(":"),o=t.connection.url.match(/h=([^:]+)&p=(\d+)/);r?(t.turnConfig.url=r[1],Object(E.getParameter)("TURN_ENABLE_TCP")&&(t.turnConfig.tcpport=parseInt(r[2])+30),Object(E.getParameter)("TURN_ENABLE_UDP")&&(t.turnConfig.udpport=parseInt(r[2])+30)):o?(t.turnConfig.url=o[1],Object(E.getParameter)("TURN_ENABLE_TCP")&&(t.turnConfig.tcpport=parseInt(o[2])+30),Object(E.getParameter)("TURN_ENABLE_UDP")&&(t.turnConfig.udpport=parseInt(o[2])+30)):i&&(t.turnConfig.url=i[0],Object(E.getParameter)("TURN_ENABLE_TCP")&&(t.turnConfig.tcpport=parseInt(i[1])+30),Object(E.getParameter)("TURN_ENABLE_UDP")&&(t.turnConfig.udpport=parseInt(i[1])+30))}t.connection.onopen=function(e){t.needReconnect=!0,t.isTimeout=!1,t.isInit=!1,t.sendbytes=0,t.recvbytes=0,t.startTime=Date.now(),Object(_.resetHTTPByetsCount)(),clearTimeout(t.timeoutCheck),t.dispatchEvent(Object(m.d)({type:"onopen",event:e,socket:t}))},t.connection.onmessage=function(e){if(e.data instanceof ArrayBuffer)t.dispatchEvent({type:"onBinaryData",data:e.data});else{t.recvbytes+=Object(b.lengthInUtf8Bytes)(e.data);var n=JSON.parse(e.data);t.lastMsgTime=Date.now(),n.hasOwnProperty("_id")?t.dispatchEvent(Object(m.d)({type:n._id,msg:n})):n.hasOwnProperty("_type")&&t.dispatchSocketEvent(Object(m.d)({type:n._type,msg:n._message}))}},t.connection.onclose=function(n){t.needReconnect?t.isTimeout||t.isInit?(v.default.debug("["+t.clientId+"] websockect connect timeout"),y.report.joinGateway(e.sid,{lts:t.lts,succ:!1,ec:"timeout",addr:t.connection.url}),t.connectNext()):(t.dispatchEvent(Object(m.d)({type:"disconnect",event:n})),t.requests&&t.requests instanceof Array&&(t.requests.map((function(e){e.callback("REQUEST_ABORT")})),t.requests=[])):(v.default.debug("["+t.clientId+"] websockect closeed"),g(e.onFailure,n),clearTimeout(t.timeoutCheck),t.dispatchEvent(Object(m.d)({type:"close",event:n})),t.connection.onopen=void 0,t.connection.onclose=void 0,t.connection.onerror=void 0,t.connection.onmessage=void 0,t.connection=void 0)},t.connection.onerror=function(e){},setTimeout((function(){t.connection&&t.connection.readyState!=WebSocket.OPEN&&(t.isTimeout=!0,t.connection.close())}),5e3)},t.creatConnection(),t.sendMessage=function(e,n){if(t.connection&&t.connection.readyState==WebSocket.OPEN){var r=JSON.stringify(e);t.sendbytes+=Object(b.lengthInUtf8Bytes)(r),t.connection.send(r)}else n({error:"Gateway not connected"})},t.disconnect=function(){t.needReconnect=!0,t.connection.close()},t.close=function(){t.needReconnect=!1,t.connection.onclose=void 0,t.connection.close(),clearInterval(t.requestTimer),t.requests&&t.requests instanceof Array&&(t.requests.map((function(e){e.callback("REQUEST_ABORT")})),t.requests=[])},t.sendSignalCommand=function(e,n){e._id="_request_"+t.requestID,t.requestID+=1,"publish_stats"!==e._type&&"subscribe_stats"!==e._type&&"publish_stats_low"!==e._type&&t.on(e._id,(function(r){r.msg&&n&&n(r.msg._result,r.msg.message),delete t.dispatcher.eventListeners[e._id]})),t.sendMessage(e,(function(e){e.reason="NOT_CONNECTED",n&&n(e.reason,e)}))},t.requests=[];var n=function(e){var n=t.requests.findIndex((function(t){return t.id===e.type}));if(n>=0)var r=t.requests.splice(n,1)[0];r&&t.dispatcher.eventListeners[e.type]?(delete t.dispatcher.eventListeners[e.type],e.msg&&r.callback&&r.callback(e.msg._result,e.msg._message)):v.default.warning("Detached Response",e.type,e.msg)},r=function(e){var n=this,r=t.requests.findIndex((function(e){return e.id===n.id}));r>=0&&(n=t.requests.splice(r,1)[0]),n&&t.dispatcher.eventListeners[e.type]?(delete t.dispatcher.eventListeners[e.type],e.reason="NOT_CONNECTED",n.callback&&n.callback(e.reason,e)):v.default.warning("handleSendError",n)};return t.sendRequest=function(e,i){e=f()({_id:"_request_"+t.requestID},e),t.requestID+=1;var o={id:e._id,timeoutCounter:0,stalledAt:Date.now(),message:e,callback:i};t.requests.push(o),t.addEventListener(e._id,n),t.sendMessage(e,r.bind(o))},t.checkRequestTimeout=function(){for(var e=Math.ceil(Object(E.getParameter)("SIGNAL_REQUEST_TIMEOUT")/Object(E.getParameter)("SIGNAL_REQUEST_WATCH_INTERVAL")),n=t.requests.length-1;n>=0;n--){var r=t.requests[n];r.timeoutCounter>=e?(t.requests.splice(n,1),v.default.error("Request Timeout",r.timeoutCounter,r.message),r.callback&&r.callback("TIMEOUT")):r.timeoutCounter++}},clearInterval(t.requestTimer),t.requestTimer=setInterval(t.checkRequestTimeout,Object(E.getParameter)("SIGNAL_REQUEST_WATCH_INTERVAL")),t.sendReport=function(e){t.sendMessage(e,(function(){}))},t},w=function(e,t){var n={connect:function(){t.host=e,n.signal=S(t),n.on=n.signal.on,n.dispatchEvent=n.signal.dispatchEvent,n.signal.on("onopen",(function(e){n.signal.onEvent=function(e){n.dispatchEvent(Object(m.d)({type:e.event,msg:e}))},n.dispatchEvent(Object(m.d)({type:"connect",msg:e}))})),n.signal.on("onError",(function(e){var t=e.msg;onError(t.code,"error")}))},getLastMsgTime:function(){return n.signal&&n.signal.lastMsgTime},getSendBytes:function(){return n.signal.getSendBytes()},getRecvBytes:function(){return n.signal.getRecvBytes()},getDuration:function(){return n.signal.getDuration()},disconnect:function(){n.signal.disconnect()},close:function(){n.signal.close()},getURL:function(){return n.signal.getURL()},reconnect:function(){n.signal.reconnect()},connectNext:function(){n.signal.connectNext()},replaceHost:function(e){n.signal.replaceHost(e)},emitSimpleMessage:function(e,t){n.signal.sendSignalCommand(e,t)},emitRequest:function(e,t){n.signal.sendRequest(e,t)},emitReport:function(e){n.signal.sendReport(e)}};return n.connect(),n},T=r(23),A=r(5),R=r(20),x=r(4),I={ERR_NO_VOCS_AVAILABLE:"tryNext",ERR_NO_VOS_AVAILABLE:"tryNext",ERR_JOIN_CHANNEL_TIMEOUT:"tryNext",WARN_REPEAT_JOIN:"quit",ERR_JOIN_BY_MULTI_IP:"recover",WARN_LOOKUP_CHANNEL_TIMEOUT:"tryNext",WARN_OPEN_CHANNEL_TIMEOUT:"tryNext",ERR_VOM_SERVICE_UNAVAILABLE:"tryNext",ERR_TOO_MANY_USERS:"tryNext",ERR_MASTER_VOCS_UNAVAILABLE:"tryNext",ERR_INTERNAL_ERROR:"tryNext",K_SERVICE_NOT_READY:"tryNext",K_SERVICE_TOO_HEAVY:"tryNext",notification_test_recover:"recover",notification_test_tryNext:"tryNext",notification_test_retry:"retry"},O={googActualEncBitrate:"A_aeb",googAvailableSendBandwidth:"A_asb",googRetransmitBitrate:"A_rb",googAvailableReceiveBandwidth:"A_arb",googTargetEncBitrate:"A_teb",googBucketDelay:"A_bd",googTransmitBitrate:"A_tb",googCodecName:"A_cn",bytesSent:"bytesSent",packetsLost:"packetsLost",packetsSent:"packetsSent",googAdaptationChanges:"A_ac",googAvgEncodeMs:"A_aem",googEncodeUsagePercent:"A_eup",googFirsReceived:"A_fr",googFrameHeightInput:"A_fhi",googFrameHeightSent:"A_fhs",googFrameRateInput:"A_fri",googFrameRateSent:"A_frs",googFrameWidthInput:"A_fwi",googFrameWidthSent:"A_fws",googNacksReceived:"A_nr",googPlisReceived:"A_pr",googRtt:"A_rtt",aecDivergentFilterFraction:"A_adff",audioInputLevel:"A_ail",googEchoCancellationReturnLoss:"A_ecrl",googEchoCancellationReturnLossEnhancement:"A_ecrle",googResidualEchoLikelihood:"A_rel",googResidualEchoLikelihoodRecentMax:"A_relrm",googTargetDelayMs:"A_tdm",bytesReceived:"bytesReceived",packetsReceived:"packetsReceived",googDecodeMs:"A_dm",googMaxDecodeMs:"A_mdm",googRenderDelayMs:"A_rdm",googFrameWidthReceived:"A_fwr",googFrameHeightReceived:"A_fhr",googFrameRateReceived:"A_frr",googFrameRateDecoded:"A_frd",googFrameRateOutput:"A_fro",googJitterBufferMs:"A_jbm",googCurrentDelayMs:"A_cdm",googMinPlayoutDelayMs:"A_mpdm",googNacksSent:"A_ns",googPlisSent:"A_ps",googFirsSent:"A_fs",audioOutputLevel:"A_aol",googAccelerateRate:"A_ar",googDecodingCNG:"A_dcng",googDecodingCTN:"A_dctn",googDecodingCTSG:"A_dctsg",googDecodingNormal:"A_dn",googDecodingPLC:"A_dplc",googDecodingPLCCNG:"A_dplccng",googExpandRate:"A_er",googJitterReceived:"A_jr",googPreemptiveExpandRate:"A_per",googPreferredJitterBufferMs:"A_pjbm",googSecondaryDecodedRate:"A_sdr",googSpeechExpandRate:"A_ser",uplink_fraction_lost:"B_ufl",uplink_cumulative_lost:"B_ucl",uplink_available_bandwidth:"B_uab",period_fir:"B_fir",access_delay:"B_acd",uplink_network_quality:"B_unq",downlink_network_quality:"B_dnq",pub_audio_lost_ratio_400ms:"B_palr4",pub_video_lost_ratio_400ms:"B_pvlr4",e2e_delay:"B_ed",audio_delay:"B_ad",video_delay:"B_vd",stream_type:"B_st",e2e_audio_lost_ratio_400ms:"B_ealr4",e2e_video_lost_ratio_400ms:"B_evlr4",downlink_estimate_bandwidth:"B_deb",peer_publish_audio_duration:"B_ppad",peer_publish_video_duration:"B_ppvd"},C={};for(var M in O){var N=O[M];C[N]&&v.default.error("Key Conflict: ".concat(N,": ").concat(O[N],"| ").concat(M)),C[N]=M}var L=function(e){return O[e]||e},k=function(e){return C[e]||e},P=r(9),D=r.n(P),U=r(54),F=function t(n){var r=!1,i=function(e){return{_type:"control",_message:e}},a=function(e,t){var n={};return Object.keys(t).forEach((function(e){Object(E.getParameter)("STATS_FILTER")[e]||(n[L(e)]=t[e])})),{_type:"subscribe_related_stats",_message:{stream_type:"high",stream_id:e,stats:n}}},c=function(e){return{_type:"publish",_message:e}},l=function(e,t){var n={};return Object.keys(t).forEach((function(e){Object(E.getParameter)("STATS_FILTER")[e]||(n[L(e)]=t[e])})),{_type:"subscribe_stats",_message:{stream_id:e,stats:n}}},h=t.DISCONNECTED,_=t.CONNECTING,S=t.CONNECTED,O=t.DISCONNECTING,C=h,M=Object(m.b)(n);Object.defineProperty(M,"state",{set:function(e){var n=C;C=e,Object(R._setClientConnectionStateRecord)(M.clientId,e),e!==t.CONNECTED&&e!==t.DISCONNECTING&&(M.hasJoined=!1),n!==e&&M.dispatchEvent({type:"connection-state-change",prevState:t.connetionStateMap[n],curState:t.connetionStateMap[e]})},get:function(){return C}}),M.socket=void 0,M.state=h,M.mode=n.mode,M.role=n.role,M.codec=n.codec,M.config={},M.timers={},M.timer_counter={},M.localStreams={},M.remoteStreams={},M.remoteMuteState={},M.attemps=1,M.p2p_attemps=1,M.audioLevel={},M.activeSpeaker=void 0,M.reconnectMode="tryNext",M.rejoinAttempt=0,M.hasChangeBGPAddress=!1,M.traffic_stats={},M.clientId=n.clientId,M.pingpongCounter=0,M.hasInvokeLeave=!1,M.p2ps=new Map,M.liveStreams=new Map,M.injectLiveStreams=new Map,M.remoteStreamsInChannel=new Set,M.subscribeRequestId=new Map,M.publishRequestId=0,M.hasJoined=!1,M.isFirstSuccess=!0,M.peerPublishDurationMap=new Map,function(e){var t=g;e.makeRequest=function(n,r,i){if(void 0===e.socket)return v.default.debug("[".concat(e.clientId,"] No socket available")),void t(i,A.default.INVALID_OPERATION);try{e.socket.emitRequest(n,(function(e,t){var n;"success"===e?"function"==typeof r&&r(t):"function"==typeof i&&(n=t&&t.error_code&&A.GatewayErrorCode[t.error_code]?A.GatewayErrorCode[t.error_code]:t&&t.error_str?t.error_str:t&&t.error_code?"UNKNOW_ERROR_".concat(t.error_code):e,i(n,t))}))}catch(r){v.default.debug("[".concat(e.clientId,"] Socket emit message failed ").concat(JSON.stringify(n))),v.default.debug("[".concat(e.clientId,"] "),r),t(i,A.default.SOCKET_ERROR)}},e.makeReport=function(t){void 0===e.socket&&v.default.debug("[".concat(e.clientId,"] No socket available"));try{e.socket.emitReport(t)}catch(n){v.default.debug("[".concat(e.clientId,"] Socket emit report failed ").concat(JSON.stringify(t)))}}}(M),M.inChannelInfo={joinAt:null,duration:0},M._sendMessage=function(e,t){switch(e){case"SubscribeStats":M.makeReport(l.apply(void 0,d()(t)));break;case"SubscribeRelatedStats":M.makeReport(a.apply(void 0,d()(t)))}};var N=g;M.p2pCounter=Object(b.random)(1e5),M.generateP2PId=function(){return++M.p2pCounter},M.audioVolumeIndication={enabled:!1,sortedAudioVolumes:[],smooth:3,interval:2e3},M.remoteVideoStreamTypes={REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2},M.streamFallbackTypes={STREAM_FALLBACK_OPTION_DISABLED:0,STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:1,STREAM_FALLBACK_OPTION_AUDIO_ONLY:2},M.configPublisher=function(e){M.config=e},M.getGatewayInfo=function(e,t){M.makeRequest({_type:"gateway_info"},e,t)},M.setClientRole=function(e,t){v.default.debug("[".concat(M.clientId,"] setClientRole to ").concat(e));var n=y.report.reportApiInvoke(M.joinInfo.sid,{name:"_setClientRole",callback:t});M.makeRequest({_type:"set_client_role",_message:{role:e}},(function(){M.role=e,M.dispatchEvent({type:"client-role-changed",role:e}),n&&n(null,{role:e})}),(function(t,r){if(r&&r.code&&(t=A.GatewayErrorCode[r.code]||"UNKNOW_ERROR_"+r.code),"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE"===t)return n&&n(null);v.default.error("set Client role error to "+e+": "+t),n&&n(t)}))},M.join=function(e,t,r,i){M.hasInvokeLeave=!1,e.useProxyServer&&(M.hasChangeBGPAddress=!0);var o=(new Date).getTime(),a=e.uid;if(M.inChannelInfo.joinAt&&(M.inChannelInfo.duration+=o-M.inChannelInfo.joinAt),M.inChannelInfo.joinAt=o,M.state!==_)return v.default.error("[".concat(M.clientId,"] GatewayClient.join Failed: state "),M.state),i&&i(A.default.INVALID_OPERATION),void y.report.joinGateway(e.sid,{lts:o,succ:!1,ec:A.default.INVALID_OPERATION,addr:null});if(null!=a&&parseInt(a)!==a)return v.default.error("[".concat(M.clientId,"] Input uid is invalid")),M.state=h,i&&i(A.default.INVALID_PARAMETER),void y.report.joinGateway(e.sid,{lts:o,succ:!1,ec:A.default.INVALID_PARAMETER,addr:null});var s=j.register(M,{uid:a,cname:e&&e.cname});if(s)return M.state=h,i&&i(s),void y.report.joinGateway(e.sid,{lts:o,succ:!1,ec:s,addr:null});M.joinInfo=f()({},e),M.uid=a,M.key=t,M.pingpongCounter=0,G(e,(function(t){if(e.useLocalAccessPoint)try{var s=M.socket.signal.connection.url.match(/wss\:\/\/([^:]+):(\d+)/)[1];Object(E.setParameter)("EVENT_REPORT_DOMAIN",s),Object(E.setParameter)("EVENT_REPORT_BACKUP_DOMAIN",s),Object(E.setParameter)("LOG_UPLOAD_SERVER","".concat(s,":6444"))}catch(e){v.default.debug("[".concat(M.clientId,"] LocalAccessPoint error: ").concat(e))}if(M.state===O||M.state===h)return i&&i("LEAVE_BEFORE_JOIN_SUCCESS");M.state=S,v.default.debug("[".concat(M.clientId,"] Connected to gateway server")),clearInterval(M.pingTimer),M.pingTimer=setInterval((function(){var e=Object(E.getParameter)("PING_PONG_TIME_OUT");if(++M.pingpongCounter>=e){var t=Date.now();M.socket&&v.default.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-M.socket.getLastMsgTime(),"ms")),M.socket&&M.socket.getLastMsgTime()&&t-M.socket.getLastMsgTime()>Object(E.getParameter)("WEBSOCKET_TIMEOUT_MIN")&&(M.pingpongCounter=0,M.socket.close(),M.socket.dispatchEvent(Object(m.d)({type:"disconnect",event:{msg:"PING_PONG_TIME_OUT"}})))}var n=Date.now();M.makeRequest({_type:"ping"},(function(){M.pingpongCounter=0;var e=Date.now()-n;Object(E.getParameter)("REPORT_STATS")&&M.makeRequest({_type:"ping_back",_message:{pingpongElapse:e}})}),(function(e,t){"TIMEOUT"!==e&&(v.default.error("Ping Error ".concat(e," ").concat(JSON.stringify(t))),t&&t.error_code&&M.socket&&M.socket.signal&&M.socket.signal.connection&&M.socket.signal.connection.readyState===WebSocket.OPEN&&(v.default.info("Disconnecting websocket connection"),M.socket.signal.connection.close()))}))}),3e3),function(e,t){var r=e.role,i=f()({},M.joinInfo.apResponse),o={session_id:M.joinInfo.sid,app_id:n.appId,channel_key:M.key,channel_name:M.joinInfo.cname,sdk_version:E.VERSION,browser:navigator.userAgent,process_id:Object(y.getProcessId)(),mode:M.mode,codec:M.codec,role:r,has_changed_gateway:Object(E.getParameter)("FORCE_CHANGED_GATEWAY_FLAG")||M.hasChangeBGPAddress,ap_response:i,optionalInfo:M.joinInfo.optionalInfo,extend:Object(E.getParameter)("JOIN_EXTEND"),details:{}};if(M.joinInfo.hasOwnProperty("stringUid")&&(o.string_uid=M.joinInfo.stringUid),M.socket&&M.socket.signal&&M.socket.signal&&(i.addresses&&i.addresses[M.socket.signal.hostIndex]&&(o.ap_response.ticket=i.addresses[M.socket.signal.hostIndex].ticket,delete i.addresses),Object(E.getParameter)("SET_DEFAULT_TURNSERVER")&&M.socket.signal.turnConfig)){var a={username:M.joinInfo.uid.toString(),credential:M.joinInfo.token,forceturn:Object(E.getParameter)("FORCE_TURN")};a.url=M.socket.signal.turnConfig.url,M.socket.signal.turnConfig.tcpport&&(a.tcpport=""+M.socket.signal.turnConfig.tcpport),M.socket.signal.turnConfig.udpport&&(a.udpport=""+M.socket.signal.turnConfig.udpport),M.joinInfo.turnServers.find((function(e){if(e.url===a.url)return!0}))||M.joinInfo.turnServers.push(a)}3===M.joinInfo.proxyServerType&&(o.plugin="web_cloud_proxy",o.details.cservice_map="1"),M.joinInfo.aesmode&&M.joinInfo.aespassword?(o.aes_mode=M.joinInfo.aesmode,o.aes_encrypt=!0,M.joinInfo.aes_salt&&(o.aes_salt=M.joinInfo.aes_salt),Object(U.encryptRSA)(M.joinInfo.aespassword).then((function(e){o.aes_secret=e,M.dispatchEvent({type:"join-message-hook",joinMessage:o}),t(null,{_type:"join",_message:o})})).catch((function(e){v.default.error("[".concat(M.clientId,"] encrypt password failed "),e),t("ENCRYPT_PASSWORD_FAILED")}))):(M.dispatchEvent({type:"join-message-hook",joinMessage:o}),t(null,{_type:"join",_message:o}))}({role:M.role},(function(t,n){if(t)return i&&i(t);M.makeRequest(n,(function(t){if(y.report.joinGateway(e.sid,{lts:o,succ:!0,ec:null,vid:e.vid,uid:e.uid,addr:M.socket.getURL(),firstSuccess:M.isFirstSuccess}),M.joinSuccessLts=Date.now(),M.isFirstSuccess=!1,M.rejoinAttempt=0,M.hasJoined=!0,r&&r(t.uid),!0===t.return_vosip||!0===Object(E.getParameter)("ENABLE_LIVE_SERVER_LIST")){var n=null;try{n=M.socket.signal.connection.url}catch(e){v.default.debug("[".concat(M.clientId,"] Can not get gateway ip: ").concat(e))}n?Object(E.setParameter)("LIVE_SERVER_LIST",[n]):Object(E.setParameter)("LIVE_SERVER_LIST",[])}M.dispatchEvent({type:"join"}),clearInterval(M.timers.trafficStats),M.timers.trafficStats=setInterval((function(){M.makeRequest({_type:"traffic_stats"},(function(e){var t={};for(var n in e)t[k(n)]=e[n];if(t.peer_delay&&t.peer_delay.length){var r=[];t.peer_delay.forEach((function(e){var t={};for(var n in e)t[k(n)]=e[n];r.push(t)})),t.peer_delay=r}M.traffic_stats=t,M.traffic_stats.timestamp=Date.now();var i=M.joinInfo.stringUid,o=M.localStreams[a]||M.localStreams[i];o&&(o.traffic_stats={access_delay:t.access_delay}),t.peer_delay&&t.peer_delay.forEach((function(e){var n=M.remoteStreams[e.peer_uid];n&&(n.traffic_stats={access_delay:t.access_delay,e2e_delay:e.e2e_delay,audio_delay:e.audio_delay,video_delay:e.video_delay})})),M.dispatchEvent({type:"after-getTrafficStats",trafficStats:t})}))}),3e3)}),(function(t,n){if(v.default.error("[".concat(M.clientId,"] User join failed [").concat(t,"]")),"ERR_JOIN_BY_MULTI_IP"===t){try{y.report.joinGateway(e.sid,{lts:o,succ:!1,ec:"ERR_JOIN_BY_MULTI_IP",addr:M.socket.getURL()})}catch(e){}return M.dispatchEvent({type:"onMultiIP",option:n.option})}I[t]&&M.rejoinAttempt<4?M._doWithAction(I[t],r,i):i&&i(t),y.report.joinGateway(e.sid,{lts:o,succ:!1,ec:t,addr:M.socket&&M.socket.getURL()})}))}))}),(function(t){v.default.error("[".concat(M.clientId,"] User join failed [").concat(t,"]")),i&&i(t),y.report.joinGateway(e.sid,{lts:o,succ:!1,ec:t,addr:M.socket.getURL()})})),this.remoteMuteState={},M.resetAudioVolumeIndication()},M.leave=function(e,t){var n=j.unregister(M);switch(n&&v.default.debug("[".concat(M.clientId,"] "),n),M.p2ps.clear(),M.state){case h:return v.default.debug("[".concat(M.clientId,"] Client Already in DISCONNECTED status")),void N(e);case O:return v.default.debug("[".concat(M.clientId,"] Client Already in DISCONNECTING status")),void N(t,A.default.INVALID_OPERATION);case _:return M.socket&&M.socket.close(),M.socket=void 0,v.default.info("[".concat(M.clientId,"] Client connecting, Leave channel success")),M.state=h,e&&e()}for(var r in M.state=O,M.channelMediaConfig&&(M.channelMediaRelayController&&M.channelMediaRelayController.dispose(),M.channelMediaConfig,M.channelMediaRelayController=null),clearInterval(M.pingTimer),M.timers)M.timers.hasOwnProperty(r)&&clearInterval(M.timers[r]);for(var r in M.inChannelInfo.joinAt&&(M.inChannelInfo.duration+=Date.now()-M.inChannelInfo.joinAt,M.inChannelInfo.joinAt=null),M.hasJoined?M.makeRequest({_type:"leave"},(function(t){M.socket.close(),M.socket=void 0,v.default.info("[".concat(M.clientId,"] Leave channel success")),M.state=h,e&&e(t)}),(function(e){"TIMEOUT"!==e&&"REQUEST_ABORT"!==e&&(v.default.error("[".concat(M.clientId,"] Leave Channel Failed"),e),M.state=S,t&&t(e))})):(M.socket&&(M.socket.close(),M.socket=void 0),v.default.info("[".concat(M.clientId,"] Leave channel before joined")),M.state=h,e&&e()),M.localStreams)if(M.localStreams.hasOwnProperty(r)){var i=M.localStreams[r];delete M.localStreams[r],void 0!==i.pc&&(i.pc.close(),i.pc=void 0)}W()},M.publish=function(e,t,n,r){var o=(new Date).getTime(),a=!1;if(e.publishLTS=o,"object"!==u()(e)||null===e)return v.default.error("[".concat(M.clientId,"] Invalid local stream")),r&&r(A.default.INVALID_LOCAL_STREAM),void y.report.publish(M.joinInfo.sid,{lts:o,succ:!1,audio:!1,video:!1,screenshare:!1,audioName:"",videoName:"",screenName:"",ec:A.default.INVALID_LOCAL_STREAM});if(!e.stream&&void 0===e.url)return v.default.error("[".concat(M.clientId,"] Invalid local media stream")),r&&r(A.default.INVALID_LOCAL_STREAM),void y.report.publish(M.joinInfo.sid,{lts:o,succ:!1,audio:!1,video:!1,screenshare:!1,audioName:"",videoName:"",screenName:"",ec:A.default.INVALID_LOCAL_STREAM});if(M.state!==S)return v.default.error("[".concat(M.clientId,"] User is not in the session")),r&&r(A.default.INVALID_OPERATION),void y.report.publish(M.joinInfo.sid,{lts:o,succ:!1,audio:e.hasAudio(),video:e.hasVideo(),screenshare:e.hasScreen(),audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:A.default.INVALID_OPERATION});var s=e.getAttributes()||{};if(e.local&&void 0===M.localStreams[e.getId()]&&(e.hasAudio()||e.hasVideo()||e.hasScreen())){var l=M.generateP2PId();if(M.p2ps.set(l,e),e.p2pId=l,void 0!==e.url)H(c({state:"url",audio:e.hasAudio(),video:e.hasVideo(),attributes:e.getAttributes()},e.url),(function(t,n){"success"===t?(e.getUserId()!==n&&e.setUserId(n),M.localStreams[n]=e,e.onClose=function(){M.unpublish(e)}):v.default.error("[".concat(M.clientId,"] Publish local stream failed"),t)}));else{M.localStreams[e.getId()]=e,e.connectionSpec={callback:function(s){s||r&&r("CANNOT_GET_OFFER"),"motion"===e.optimizationMode&&e.pc.setRtpSenderParameters("maintain-framerate"),"detail"===e.optimizationMode&&e.pc.setRtpSenderParameters("maintain-resolution"),M.makeRequest(c({state:"offer",stream_type:1==t.streamType?"low":"high",p2p_id:l,sdp:s,audio:e.audio||e.screenAudio,video:e.screen||e.video,screen:e.screen,attributes:e.getAttributes(),dtx:e.DTX,hq:e.highQuality,lq:e.lowQuality,stereo:e.stereo,speech:e.speech,codec:M.codec,extend:Object(E.getParameter)("PUB_EXTEND")}),(function(t){e.getUserId()!==t.uid&&e.setUserId(t.uid),v.default.info("[".concat(M.clientId,"] Local stream published with uid"),t.uid),e.onClose=function(){M.unpublish(e)},e._onAudioUnmute=function(){M.makeReport(i({action:"unmute_local_audio",stream_id:e.getId()}))},e._onVideoUnmute=function(){M.makeReport(i({action:"unmute_local_video",stream_id:e.getId()}))},e._onAudioMute=function(){M.makeReport(i({action:"mute_local_audio",stream_id:e.getId()}))},e._onVideoMute=function(){M.makeReport(i({action:"mute_local_video",stream_id:e.getId()}))},e.getId()===e.getUserId()&&(e.isAudioOn()||e.hasAudio()&&(v.default.debug("[".concat(M.clientId,"] local stream audio mute")),e._onAudioMute()),e.isVideoOn()||(e.hasVideo()||e.hasScreen())&&(v.default.debug("[".concat(M.clientId,"] local stream video mute")),e._onVideoMute())),e.pc.oniceconnectionstatechange=function(t){if("failed"===t){if(null!=M.timers[e.getId()]&&(clearInterval(M.timers[e.getId()]),clearInterval(M.timers[e.getId()]+"_RelatedStats")),v.default.error("[".concat(M.clientId,"] Publisher connection is lost -- streamId: ").concat(e.getId(),", p2pId: ").concat(l)),M.p2ps.delete(l),v.default.debug("[".concat(M.clientId,"] publish p2p failed: "),M.p2ps),!a)return a=!0,y.report.publish(M.joinInfo.sid,{lts:o,succ:!1,audio:e.hasAudio(),video:e.hasVideo(),screenshare:e.hasScreen(),audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:A.default.PEERCONNECTION_FAILED,publishRequestid:M.publishRequestId||0,p2pid:l}),M.dispatchEvent(Object(m.a)({type:"pubP2PLost",stream:e})),r&&r(A.default.PEERCONNECTION_FAILED);M.dispatchEvent(Object(m.a)({type:"pubP2PLost",stream:e}))}else if("connected"===t&&(v.default.debug("[".concat(M.clientId,"] publish p2p connected: "),M.p2ps),e.getId()===e.getUserId()&&(e._isAudioMuted()?M.makeReport(i({action:"mute_local_audio",stream_id:e.getId()})):M.makeReport(i({action:"unmute_local_audio",stream_id:e.getId()})),e._isVideoMuted()?M.makeReport(i({action:"mute_local_video",stream_id:e.getId()})):M.makeReport(i({action:"unmute_local_video",stream_id:e.getId()}))),!a))return a=!0,y.report.publish(M.joinInfo.sid,{lts:o,succ:!0,audio:e.hasAudio(),video:e.hasVideo(),screenshare:e.hasScreen(),audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:null,publishRequestid:M.publishRequestId||0,p2pid:l}),n&&n()},e.pc.processSignalingMessage(t.sdp)}),(function(t,n){v.default.error("Publish Failed: ".concat(t)),y.report.publish(M.joinInfo.sid,{lts:o,succ:!1,audio:e.hasAudio(),video:e.hasVideo(),screenshare:e.hasScreen(),audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:t,publishRequestid:M.publishRequestId||0,p2pid:l}),"TIMEOUT"!=t&&(M.processPublishFailure(e),r&&r(t))}))},audio:e.hasAudio(),video:e.hasVideo(),screen:e.hasScreen(),optimizationMode:e.optimizationMode,isSubscriber:!1,stunServerUrl:M.stunServerUrl,turnServers:M.joinInfo.turnServers,maxAudioBW:s.maxAudioBW,minVideoBW:s.minVideoBW,maxVideoBW:s.maxVideoBW,mode:M.mode,codec:M.codec,isVideoMute:e.userMuteVideo||e.peerMuteVideo,isAudioMute:e.userMuteAudio||e.peerMuteAudio,maxFrameRate:e.attributes.maxFrameRate,agoraStream:e,clientId:M.clientId,isCloudProxy3:3===M.joinInfo.proxyServerType,onNoIceCandidate:function(){M.dispatchEvent({type:"no_ice_candidate",stream:e})}},e.pc=Object(T.a)(e.connectionSpec),e.pc.addStream(e.stream),v.default.debug("[".concat(M.clientId,"] PeerConnection add stream :"),e.stream),e.pc.onnegotiationneeded=function(n){"motion"===e.optimizationMode&&e.pc.setRtpSenderParameters("maintain-framerate"),"detail"===e.optimizationMode&&e.pc.setRtpSenderParameters("maintain-resolution");var r={state:"negotiation",stream_type:1===t.streamType?"low":"high",p2p_id:l,sdp:n};M.makeRequest(c(r),(function(t){v.default.debug("Negotating Stream ".concat(e.getId())),e.pc.processSignalingMessage(t.sdp)}),(function(e,t){v.default.error("Negotiation failed ".concat(e),t,r)}))},clearInterval(M.timers[e.getId()]),M.timers[e.getId()]=setInterval((function(){if(Object(E.getParameter)("REPORT_STATS")){var t=0;e&&e.pc&&e.pc.getStats&&e.pc.getStatsRate((function(n){n.forEach((function(n){if(n&&n.id&&!(/_recv$/.test(n.id)||/^time$/.test(n.id)||~n.type.toLowerCase().indexOf("inbound"))&&e.getUserId()){if(-1===n.id.indexOf("outbound_rtp")&&-1===n.id.indexOf("OutboundRTP")&&-1===n.type.toLowerCase().indexOf("outbound")||"video"!==n.mediaType||(n.googFrameWidthSent=e.videoWidth+"",n.googFrameHeightSent=e.videoHeight+""),"video"===n.mediaType)try{var r=e.stream.getVideoTracks()[0];n.A_vstd=r.enabled?"0":"1"}catch(e){}if("audio"===n.mediaType)try{var i=e.stream.getAudioTracks()[0];n.A_astd=i.enabled?"0":"1"}catch(e){}if(e.getId()==e.getUserId()){var o=200*t;t++,setTimeout((function(){var e=M.socket&&M.socket.getLastMsgTime()&&Date.now()-M.socket.getLastMsgTime();e>Object(E.getParameter)("REPORT_STATS_TIMEOUT")?v.default.debug("PublishStats report blocked by REPORT_STATS_TIMEOUT ".concat(e)):M.makeReport(function(e){var t={};return Object.keys(e).forEach((function(n){Object(E.getParameter)("STATS_FILTER")[n]||(t[L(n)]=e[n])})),{_type:"publish_stats",_message:{stream_type:"high",stats:t}}}(n))}),o)}else o=200*t,t++,setTimeout((function(){var e=M.socket&&M.socket.getLastMsgTime()&&Date.now()-M.socket.getLastMsgTime();e>Object(E.getParameter)("REPORT_STATS_TIMEOUT")?v.default.debug("PublishStatsLow report blocked by REPORT_STATS_TIMEOUT ".concat(e)):M.makeReport(function(e){var t={};return Object.keys(e).forEach((function(n){Object(E.getParameter)("STATS_FILTER")[n]||(t[L(n)]=e[n])})),{_type:"publish_stats",_message:{stream_type:"low",stats:t}}}(n))}),o)}}))}))}}),3e3);var d=function(){Object(E.getParameter)("REPORT_STATS")&&e&&e.pc&&e.pc.getVideoRelatedStats&&e.pc.getVideoRelatedStats((function(t){var n,r,i=M.socket&&M.socket.getLastMsgTime()&&Date.now()-M.socket.getLastMsgTime();i>Object(E.getParameter)("REPORT_STATS_TIMEOUT")?v.default.debug("PublishRelatedStats report blocked by REPORT_STATS_TIMEOUT ".concat(i)):e.getId()===e.getUserId()?M.makeReport((n=t,r={},Object.keys(n).forEach((function(e){Object(E.getParameter)("STATS_FILTER")[e]||(r[L(e)]=n[e])})),{_type:"publish_related_stats",_message:{stream_type:"high",stats:r}})):M.makeReport(function(e){var t={};return Object.keys(e).forEach((function(n){Object(E.getParameter)("STATS_FILTER")[n]||(t[L(n)]=e[n])})),{_type:"publish_related_stats",_message:{stream_type:"low",stats:t}}}(t))}))};d(),clearInterval(M.timers[e.getId()+"_RelatedStats"]),M.timers[e.getId()+"_RelatedStats"]=setInterval(d,1e3)}}},M.unpublish=function(e,t,n,r){if("object"!==u()(e)||null===e)return v.default.error("[".concat(M.clientId,"] Invalid local stream")),void N(r,A.default.INVALID_LOCAL_STREAM);if(M.state!==S)return v.default.error("[".concat(M.clientId,"] User not in the session")),void N(r,A.default.INVALID_OPERATION);if(null!=M.timers[e.getId()]&&(clearInterval(M.timers[e.getId()]),clearInterval(M.timers[e.getId()+"_RelatedStats"])),void 0!==M.socket)if(e.local&&void 0!==M.localStreams[e.getId()]){delete M.localStreams[e.getId()];var i={stream_id:e.getUserId(),stream_type:1===t.streamType?"low":"high"};M.makeRequest({_type:"unpublish",_message:i}),(e.hasAudio()||e.hasVideo()||e.hasScreen())&&void 0===e.url&&void 0!==e.pc&&(e.pc.close(),e.pc=void 0),e.onClose=void 0,e._onAudioMute=void 0,e._onAudioUnute=void 0,e._onVideoMute=void 0,e._onVideoUnmute=void 0,M.p2ps.delete(e.p2pId),n&&n()}else v.default.error("[".concat(M.clientId,"] Invalid local stream")),N(r,A.default.INVALID_LOCAL_STREAM);else v.default.error("[".concat(M.clientId,"] User not in the session")),N(r,A.default.INVALID_OPERATION)},M.subscribe=function(e,t,n){var r=(new Date).getTime();e.subscribeLTS=r;var o=!1;if(v.default.info("[".concat(M.clientId,"] Gatewayclient ").concat(M.uid," Subscribe ").concat(e.getId(),": ").concat(JSON.stringify(e.subscribeOptions))),"object"!==u()(e)||null===e)return v.default.error("[".concat(M.clientId,"] Invalid remote stream")),n&&n(A.default.INVALID_REMOTE_STREAM),void y.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:A.default.INVALID_REMOTE_STREAM});if(M.state!==S&&(v.default.error("[".concat(M.clientId,"] User is not in the session")),!o))return o=!0,y.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:A.default.INVALID_OPERATION}),n&&n(A.default.INVALID_OPERATION);if(!e.local&&M.remoteStreams.hasOwnProperty(e.getId()))if(e.hasAudio()||e.hasVideo()||e.hasScreen()){var s=M.generateP2PId();M.p2ps.set(s,e),e.p2pId=s,e.pc=Object(T.a)({callback:function(t){t||n&&n("CANNOT_GET_OFFER");var i={stream_id:e.getId(),audio:!e.subscribeOptions||e.subscribeOptions.audio,video:!e.subscribeOptions||e.subscribeOptions.video,codec:M.codec,p2p_id:s,sdp:t,tcc:Object(E.getParameter)("SUBSCRIBE_TCC"),extend:Object(E.getParameter)("SUB_EXTEND")};M.makeRequest({_type:"subscribe",_message:i},(function(t){e.pc.processSignalingMessage(t.sdp)}),(function(t,i){v.default.error("[".concat(M.clientId,"] Subscribe remote stream Failed: ").concat(t,", closing stream "),e.getId(),i),y.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:t}),"TIMEOUT"!=t&&(M.processSubscribeFailure(e),n&&n(t))}))},nop2p:!0,audio:!0,video:!0,screen:e.hasScreen(),isSubscriber:!0,stunServerUrl:M.stunServerUrl,turnServers:M.joinInfo.turnServers,isVideoMute:e.userMuteVideo,isAudioMute:e.userMuteAudio,uid:e.getId(),agoraStream:e,clientId:M.clientId}),e.pc.onaddstream=function(t,n){if(e._onAudioUnmute=function(){M.makeReport(i({action:"unmute_remote_audio",stream_id:e.getId()}),(function(){}),(function(){}))},e._onAudioMute=function(){M.makeReport(i({action:"mute_remote_audio",stream_id:e.getId()}),(function(){}),(function(){}))},e._onVideoUnmute=function(){M.makeReport(i({action:"unmute_remote_video",stream_id:e.getId()}),(function(){}),(function(){}))},e._onVideoMute=function(){M.makeReport(i({action:"mute_remote_video",stream_id:e.getId()}),(function(){}),(function(){}))},"ontrack"===n&&"video"===t.track.kind||"onaddstream"===n){v.default.info("[".concat(M.clientId,"] Remote stream subscribed with uid "),e.getId());var r=M.remoteStreams[e.getId()];if(M.remoteStreams[e.getId()].stream="onaddstream"===n?t.stream:t.streams[0],M.remoteStreams[e.getId()].hasVideo()){if(Object(x.isFireFox)()||Object(x.isSafari)()){var o=M.remoteStreams[e.getId()].stream;Object(b.vsResHack)(o,(function(t,n){e.videoWidth=t,e.videoHeight=n}),(function(e){return v.default.warning("[".concat(M.clientId,"] vsResHack failed: ")+e)}))}}else{var a=M.remoteStreams[e.getId()];a.peerMuteVideo=!0,M._adjustPCMuteStatus(a)}r&&r.isPlaying()&&r.elementID&&(v.default.debug("[".concat(M.clientId,"] Reload Player ").concat(r.elementID," StreamId ").concat(r.getId())),e.audioOutput=r.audioOutput,r.stop(),e.play(r.elementID,r.playOptions)),delete e.audioLevelHelper;var s=Object(m.e)({type:"stream-subscribed",stream:M.remoteStreams[e.getId()]});M.dispatchEvent(s)}},clearInterval(M.timers[e.getId()]),M.timers[e.getId()]=setInterval((function(){if(Object(E.getParameter)("REPORT_STATS")){var t=0;e&&e.pc&&e.pc.getStats&&e.pc.getStatsRate((function(n){n.forEach((function(n){if(n&&n.id){if(/_send$/.test(n.id)||/^time$/.test(n.id)||/^bweforvideo$/.test(n.id))return;-1===n.id.indexOf("inbound_rtp")&&-1===n.id.indexOf("inbound-rtp")&&-1===n.type.toLowerCase().indexOf("inbound")||"video"!==n.mediaType||(n.googFrameWidthReceived=e.videoWidth+"",n.googFrameHeightReceived=e.videoHeight+"");var r=200*t;t++;var i=e.getId();setTimeout((function(){var t=M.socket&&M.socket.getLastMsgTime()&&Date.now()-M.socket.getLastMsgTime();if(t>Object(E.getParameter)("REPORT_STATS_TIMEOUT"))v.default.debug("SubscribeStats report blocked by REPORT_STATS_TIMEOUT ".concat(t));else{if("video"===n.mediaType)try{var r=e.stream.getVideoTracks()[0];n.A_vrtd=r.enabled?"0":"1",e.player&&e.player.freezeTimeCounterList.length>0&&(n.A_vrft=e.player.freezeTimeCounterList.splice(0,1)[0].toString())}catch(e){}if("audio"===n.mediaType)try{var o=e.stream.getAudioTracks()[0];n.A_artd=o.enabled?"0":"1"}catch(e){}M.makeReport(l(i,n))}}),r)}}))}))}}),3e3),clearInterval(M.timers[e.getId()+"_RelatedStats"]),M.timers[e.getId()+"_RelatedStats"]=setInterval((function(){if(Object(E.getParameter)("REPORT_STATS")&&e&&e.pc){var t=M.socket&&M.socket.getLastMsgTime()&&Date.now()-M.socket.getLastMsgTime();if(t>Object(E.getParameter)("REPORT_STATS_TIMEOUT"))return void v.default.debug("SubscribeRelatedStats report blocked by REPORT_STATS_TIMEOUT ".concat(t));e.pc.getVideoRelatedStats&&e.pc.getVideoRelatedStats((function(t){e.player&&(e.hasVideo()&&!e.peerMuteVideo&&(t.isFreeze=e.player.freezeCount>e.player.lastFreezeCount),e.player.lastFreezeCount=e.player.freezeCount),M.makeReport(a(e.getId(),t))})),e.pc.getAudioRelatedStats&&e.pc.getAudioRelatedStats((function(t){M.makeReport(a(e.getId(),t))}))}}),1e3),M.audioLevel[e.getId()]=0,clearInterval(M.timers[e.getId()+"audio"]),M.timers[e.getId()+"audio"]=setInterval((function(){M.hasListeners("active-speaker")&&e&&e.pc&&"established"===e.pc.state&&e.pc.getStats&&e.pc.getStats((function(t){t.forEach((function(t){if("audio"===t.mediaType){if(t.audioOutputLevel>5e3)for(var n in M.audioLevel[e.getId()]<20&&(M.audioLevel[e.getId()]+=1),M.audioLevel)n!==""+e.getId()&&M.audioLevel[n]>0&&(M.audioLevel[n]-=1);var r=Object.keys(M.audioLevel).sort((function(e,t){return M.audioLevel[t]-M.audioLevel[e]}));if(M.activeSpeaker!==r[0]){var i=Object(m.a)({type:"active-speaker",uid:r[0]});M.dispatchEvent(i),M.activeSpeaker=r[0],v.default.debug("[".concat(M.clientId,"] Update active speaker: ").concat(M.activeSpeaker))}}}))}),50)}),50),e.pc.oniceconnectionstatechange=function(i){if("failed"===i)null!=M.timers[e.getId()]&&(clearInterval(M.timers[e.getId()]),clearInterval(M.timers[e.getId()]+"audio")),v.default.error("[".concat(M.clientId,"] Subscriber connection is lost -- streamId: ").concat(e.getId(),", p2pId: ").concat(s)),v.default.debug("[".concat(M.clientId,"] subscribe p2p failed: "),M.p2ps),o||(o=!0,n&&n(A.default.PEERCONNECTION_FAILED),y.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:A.default.PEERCONNECTION_FAILED,subscribeRequestid:M.subscribeRequestId.get(e.getId())||0,p2pid:s})),M.remoteStreams[e.getId()]&&M.p2ps.has(s)&&(M.p2ps.delete(s),M.dispatchEvent(Object(m.a)({type:"subP2PLost",stream:e})));else if("connected"===i&&(v.default.debug("[".concat(M.clientId,"] subscribe p2p connected: "),M.p2ps),!o)){o=!0,y.report.subscribe(M.joinInfo.sid,{lts:r,succ:!0,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:null,subscribeRequestid:M.subscribeRequestId.get(e.getId())||0,p2pid:s}),M._adjustPCMuteStatus(e);var a=!1,c=!1,u=!1,l=setInterval((function(){a&&c||(e.pc?e.pc.getStats((function(t){t.forEach((function(t){if((-1!==t.id.indexOf("recv")||t.type&&-1!==t.type.toLowerCase().indexOf("inbound")||-1!==t.id.indexOf("inbound_rtp")||-1!==t.id.indexOf("inbound-rtp")||-1!==t.id.indexOf("InboundRTP"))&&"audio"===t.mediaType){if((t.googDecodingNormal>0||t.audioOutputLevel>0)&&!a){a=!0,M.dispatchEvent({type:"first-audio-frame-decode",stream:e}),a&&c&&clearInterval(l);var n=Date.now(),r=y.report.getSessionStartTime(M.joinInfo.sid);y.report.firstAudioDecode(M.joinInfo.sid,{peerid:e.uintId,uid:M.uid,elapse:n-r,subscribeElapse:n-e.subscribeLTS,subscribeRequestid:M.subscribeRequestId.get(e.getId())||0,p2pid:s})}parseInt(t.packetsReceived)>0&&!c&&(c=!0,M.dispatchEvent({type:"first-audio-packet-received",stream:e}),a&&c&&clearInterval(l),n=Date.now(),r=y.report.getSessionStartTime(M.joinInfo.sid),y.report.firstAudioReceived(M.joinInfo.sid,{peerid:e.uintId,uid:M.uid,elapse:n-r,subscribeElapse:n-e.subscribeLTS,subscribeRequestid:M.subscribeRequestId.get(e.getId())||0,p2pid:s}))}}))}),100):clearInterval(l))}),100),d=!1,h=!1,f=setInterval((function(){d&&h||(e.pc?e.pc.getStats((function(t){t.forEach((function(t){if((-1!==t.id.indexOf("recv")||t.type&&-1!==t.type.toLowerCase().indexOf("inbound")||-1!==t.id.indexOf("inbound_rtp")||-1!==t.id.indexOf("inbound-rtp")||-1!==t.id.indexOf("InboundRTP"))&&"video"===t.mediaType){if((t.framesDecoded>0||t.googFramesDecoded>0)&&!d){d=!0,M.dispatchEvent({type:"first-video-frame-decode",stream:e}),d&&h&&clearInterval(f);var n=Date.now(),r=y.report.getSessionStartTime(M.joinInfo.sid);e.firstFrameTime=(new Date).getTime()-e.subscribeLTS,y.report.firstVideoDecode(M.joinInfo.sid,{peerid:e.uintId,width:parseInt(t.googFrameWidthReceived)||0,height:parseInt(t.googFrameHeightReceived)||0,uid:M.uid,elapse:n-r,subscribeElapse:n-e.subscribeLTS,subscribeRequestid:M.subscribeRequestId.get(e.getId())||0,p2pid:s})}t.packetsReceived>0&&!h&&(h=!0,M.dispatchEvent({type:"first-video-packet-received",stream:e}),d&&h&&clearInterval(f),n=Date.now(),r=y.report.getSessionStartTime(M.joinInfo.sid),y.report.firstVideoReceived(M.joinInfo.sid,{peerid:e.uintId,uid:M.uid,elapse:n-r,subscribeElapse:n-e.subscribeLTS,subscribeRequestid:M.subscribeRequestId.get(e.getId())||0,p2pid:s}))}}))}),100):clearInterval(f))}),100),p=setInterval((function(){if(!u){var t=e.getId(),n=M.traffic_stats;if(n&&n.peer_delay){var r=n.peer_delay.find((function(e){return e.peer_uid==t}));if(r){if(u=!0,M.peerPublishDurationMap.get(e.getId()))return void clearInterval(p);var i=r.peer_publish_audio_duration,o=r.peer_publish_video_duration;if(void 0===i||void 0===o)return;M.peerPublishDurationMap.set(e.getId(),!0);var a=y.report.getSessionStartTime(M.joinInfo.sid),s=(i||o)+(Date.now()-n.timestamp),c=Date.now();y.report.peerPublishStatus({audiotag:i?1:-1,videotag:o?1:-1,lts:c,sid:M.joinInfo.sid,cname:M.joinInfo.cname,cid:M.joinInfo.cid,uid:M.joinInfo.uid,elapse:c-a,peer:e.uintId,peerPublishDuration:s,joinChannelSuccessElapse:c-M.joinSuccessLts,subscribeElapse:c-e.subscribeLTS}),clearInterval(p)}}}}),1e3);return e.sid=M.joinInfo.sid,t&&t()}}}else v.default.error("[".concat(M.clientId,"] Invalid remote stream")),o||(o=!0,n&&n(A.default.INVALID_REMOTE_STREAM),y.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:A.default.INVALID_REMOTE_STREAM}));else v.default.error("[".concat(M.clientId,"] No such remote stream")),o||(o=!0,n&&n(A.default.NO_SUCH_REMOTE_STREAM),y.report.subscribe(M.joinInfo.sid,{lts:r,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:A.default.NO_SUCH_REMOTE_STREAM}))},M.subscribeChange=function(e,t,n){var r=Date.now();v.default.info("[".concat(M.clientId,"] Gatewayclient ").concat(M.uid," SubscribeChange ").concat(e.getId(),": ").concat(JSON.stringify(e.subscribeOptions))),M._adjustPCMuteStatus(e);var i={stream_id:e.getId(),audio:e.subscribeOptions.audio,video:e.subscribeOptions.video};M.makeRequest({_type:"subscribe_change",_message:i},(function(n){var i=Object(m.e)({type:"stream-subscribe-changed",stream:M.remoteStreams[e.getId()]});y.report.subscribe(M.joinInfo.sid,{lts:r,succ:!0,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:null,subscribeRequestid:M.subscribeRequestId.get(e.getId())||0,p2pid:M.p2ps.get(e.getId())}),M.dispatchEvent(i),t&&t()}),(function(t,r){v.default.error("[".concat(M.clientId,"] Subscribe Change Failed ").concat(e.getId()),t,r),n&&n(t,r)}))},M.processPublishFailure=function(e){e.publishLTS=null,e.p2pId&&M.p2ps.get(e.p2pId)===e&&M.p2ps.delete(e.p2pId),M.localStreams[e.getUserId()]===e&&delete M.localStreams[e.getUserId()],M.localStreams[e.getId()]===e&&delete M.localStreams[e.getId()],e.pc&&(e.pc.processSignalingMessage=function(){},e.pc.oniceconnectionstatechange=function(){},e.pc.close(),delete e.pc),delete e.onClose,delete e._onAudioUnmute,delete e._onVideoUnmute,delete e._onAudioMute,delete e._onVideoMute,delete e._onAudioUnmute},M.processSubscribeFailure=function(e){e.p2pId&&M.p2ps.get(e.p2pId)===e&&M.p2ps.delete(e.p2pId),e.pc&&(e.pc.onaddstream=function(){},e.pc.processSignalingMessage=function(){},e.pc.oniceconnectionstatechange=function(){},e.pc.close(),delete e.pc),delete e.onClose,delete e._onAudioUnmute,delete e._onVideoUnmute,delete e._onAudioMute,delete e._onVideoMute,delete e._onAudioUnmute},M._adjustPCMuteStatus=function(e){v.default.debug("[".concat(M.clientId,"]: use _adjustPCMuteStatus: ").concat(e.getId())),v.default.debug("[".concat(M.clientId,"]: video: ").concat(e.video,", audio: ").concat(e.audio,", suboption: ").concat(JSON.stringify(e.subscribeOptions),",userMuteVideo: ").concat(e.userMuteVideo,", peerMuteVideo: ").concat(e.peerMuteVideo,", userMuteAudio: ").concat(e.userMuteAudio,", peerMuteAudio: ").concat(e.peerMuteAudio)),!e.local&&e.pc&&e.pc.peerConnection.getReceivers&&e.pc.peerConnection.getReceivers().forEach((function(t){if(t&&t.track&&"audio"===t.track.kind){var n=!e.userMuteAudio&&!e.peerMuteAudio;e.subscribeOptions&&!e.subscribeOptions.audio&&(n=!1),v.default.debug("[".concat(M.clientId,"]: set receiver audio track: ").concat(n)),t.track.enabled=!!n}else if(t&&t.track&&"video"===t.track.kind){var r=!e.userMuteVideo&&!e.peerMuteVideo;e.subscribeOptions&&!e.subscribeOptions.video&&(r=!1),v.default.debug("[".concat(M.clientId,"]: set receiver video track: ").concat(r)),t.track.enabled=!!r}}))},M.unsubscribe=function(e,t,n){if("object"!==u()(e)||null===e)return v.default.error("[".concat(M.clientId,"] Invalid remote stream")),void N(n,A.default.INVALID_REMOTE_STREAM);if(M.state!==S)return v.default.error("[".concat(M.clientId,"] User is not in the session")),void N(n,A.default.INVALID_OPERATION);if(null!=M.timers[e.getId()]&&(clearInterval(M.timers[e.getId()]),clearInterval(M.timers[e.getId()]+"audio")),null!=M.audioLevel[e.getId()]&&delete M.audioLevel[e.getId()],null!=M.timer_counter[e.getId()]&&delete M.timer_counter[e.getId()],M.remoteStreams.hasOwnProperty(e.getId())){if(!M.socket)return v.default.error("[".concat(M.clientId,"] User is not in the session")),void N(n,A.default.INVALID_OPERATION);if(e.local)return v.default.error("[".concat(M.clientId,"] Invalid remote stream")),void N(n,A.default.INVALID_REMOTE_STREAM);e.close(),e.stop();var r={stream_id:e.getId()};M.makeRequest({_type:"unsubscribe",_message:r}),void 0!==e.pc&&(e.pc.close(),e.pc=void 0),e.onClose=void 0,e._onAudioMute=void 0,e._onAudioUnute=void 0,e._onVideoMute=void 0,e._onVideoUnmute=void 0,delete e.subscribeOptions,M.p2ps.delete(e.p2pId),v.default.info("[".concat(M.clientId,"] Unsubscribe stream success")),t&&t()}else N(n,A.default.NO_SUCH_REMOTE_STREAM)},M.setRemoteVideoStreamType=function(e,t){if(v.default.debug("[".concat(M.clientId,"] Switching remote video stream ").concat(e.getId()," to ").concat(t)),"object"===u()(e)&&null!==e)if(M.state===S){if(!e.local){switch(t){case M.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:case M.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:case M.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:break;default:return}var n={stream_id:e.getId(),stream_type:t};M.makeRequest({_type:"switch_video_stream",_message:n},(function(){v.default.debug("SwitchVideoStream Success ".concat(n.stream_id," ").concat(n.stream_type))}),(function(e,t){v.default.error("SwitchVideoStream Error ".concat(e," ").concat(n.stream_id," ").concat(n.stream_type),t)}))}}else v.default.error("[".concat(M.clientId,"] User is not in the session"));else v.default.error("[".concat(M.clientId,"] Invalid remote stream"))},M.renewToken=function(e,t,n){e?M.key?M.state!==S?(v.default.debug("[".concat(M.clientId,"] Client is not connected. Trying to rejoin")),M.key=e,M.rejoin(),t&&t()):(v.default.debug("[".concat(M.clientId,"] renewToken from ").concat(M.key," to ").concat(e)),M.key=e,M.makeRequest({_type:"renew_token",_message:{token:e}},t,n)):(v.default.error("[".concat(M.clientId,"] Client is previously joined without token")),n&&n(A.default.INVALID_PARAMETER)):(v.default.error("[".concat(M.clientId,"] Invalid Token ").concat(e)),n&&n(A.default.INVALID_PARAMETER))},M.setStreamFallbackOption=function(e,t){if(v.default.debug("[".concat(M.clientId,"] Set stream fallback option ").concat(e.getId()," to ").concat(t)),"object"===u()(e)&&null!==e)if(M.state===S){if(!e.local){switch(t){case M.streamFallbackTypes.STREAM_FALLBACK_OPTION_DISABLED:case M.streamFallbackTypes.STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:case M.streamFallbackTypes.STREAM_FALLBACK_OPTION_AUDIO_ONLY:break;default:return}var n={stream_id:e.getId(),fallback_type:t};M.makeRequest({_type:"set_fallback_option",_message:n},(function(){v.default.debug("SetStreamFallbackOption success ".concat(n.stream_id," ").concat(t))}),(function(e,r){v.default.error("Failed to SetStreamFallbackOption ".concat(n.stream_id," ").concat(t," ").concat(e),r)}))}}else v.default.error("[".concat(M.clientId,"] User is not in the session"));else v.default.error("[".concat(M.clientId,"] Invalid remote stream"))},M.enableAudioVolumeIndicator=function(e,t){M.audioVolumeIndication.enabled=!0,M.audioVolumeIndication.interval=e,M.audioVolumeIndication.smooth=t,M.resetAudioVolumeIndication()},M.resetAudioVolumeIndication=function(){if(clearInterval(M.timers.audioVolumeIndication),clearInterval(M.timers.audioVolumeSampling),M.audioVolumeIndication.enabled&&M.audioVolumeIndication.interval){var e=Math.floor(1e3*M.audioVolumeIndication.smooth/100);clearInterval(M.timers.audioVolumeSampling),M.timers.audioVolumeSampling=setInterval((function(){M.audioVolumeSampling||(M.audioVolumeSampling={});var t={};for(var n in M.remoteStreams){var r=M.remoteStreams[n];if(r.stream&&r.hasAudio()){var i=r.getAudioLevel();i>0&&i<1&&(i*=100);var o=M.audioVolumeSampling[n]||[];for(o.push(i);o.length>e;)o.shift();t[n]=o}}M.audioVolumeSampling=t}),100),clearInterval(M.timers.audioVolumeIndication),M.timers.audioVolumeIndication=setInterval((function(){if(M.socket&&M.socket.signal&&M.socket.signal.connection&&M.socket.signal.connection.readyState===WebSocket.OPEN){var e=[];for(var t in M.remoteStreams)if(M.audioVolumeSampling&&M.audioVolumeSampling[t]){var n=M.audioVolumeSampling[t],r=0;n.forEach((function(e){r+=e}));var i={uid:t,level:Math.floor(r/n.length)};i.level&&e.push(i)}var o=e.sort((function(e,t){return e.level-t.level}));v.default.debug("[".concat(M.clientId,"] volume-indicator "),JSON.stringify(o)),M.audioVolumeIndication.sortedAudioVolumes=o;var a=Object(m.a)({type:"volume-indicator",attr:o});M.dispatchEvent(a)}}),M.audioVolumeIndication.interval)}},M.closeGateway=function(){v.default.debug("[".concat(M.clientId,"] close gateway")),M.state=h,M.socket.close(),B()},M.startChannelMediaRelay=function(){var e=s()(o.a.mark((function e(t){var n,r,i,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!M.channelMediaRelayController){e.next=2;break}throw new P.ChannelMediaError("RELAY_ALREADY_START","",P.CHANNEL_MEDIA_RELAY_ERROR.RELAY_ALREADY_START);case 2:return n=function(e){M.dispatchEvent({type:"channel-media-relay-event",code:e})},r=function(e,t,n){e===P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE&&t===P.CHANNEL_MEDIA_RELAY_ERROR.SERVER_CONNECTION_LOST&&(M.channelMediaRelayController.dispose(),M.channelMediaRelayController=null),M.dispatchEvent({type:"channel-media-relay-state",state:e,code:t,data:n})},M.channelMediaRelayController=new D.a(M.joinInfo,M.clientId),M.channelMediaRelayController.on("event",n),M.channelMediaRelayController.on("state",r),e.prev=7,e.next=10,M.channelMediaRelayController.startChannelMediaRelay(t);case 10:e.next=22;break;case 12:throw e.prev=12,e.t0=e.catch(7),v.default.debug("[".concat(M.clientId,"] startChannelMediaRelay exception: ").concat(JSON.stringify(e.t0))),i=P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,"",a=e.t0 instanceof P.ChannelMediaError?"SetSourceChannelStatus"===e.t0.data||e.t0.data&&e.t0.data.serverResponse&&"SetSourceChannel"===e.t0.data.serverResponse.command?"FAILED_JOIN_SRC":"SetDestChannelStatus"===e.t0.data||e.t0.data&&e.t0.data.serverResponse&&"SetDestChannel"===e.t0.data.serverResponse.command?"FAILED_JOIN_DEST":e.t0.data&&e.t0.data.serverResponse&&"StartPacketTransfer"===e.t0.data.serverResponse.command?"FAILED_PACKET_SENT_TO_DEST":e.t0.message===P.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.t0.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.t0.message===P.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.t0.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":e.t0.message===P.CHANNEL_MEDIA_ERROR.AP_REQUEST_TIMEOUT?"NO_RESOURCE_AVAILABLE":e.t0.message===P.CHANNEL_MEDIA_ERROR.WS_ABORT||e.t0.message===P.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",M.dispatchEvent({type:"channel-media-relay-state",state:i,code:P.CHANNEL_MEDIA_RELAY_ERROR[a]}),M.channelMediaRelayController&&(M.channelMediaRelayController.dispose(),M.channelMediaConfig=null,M.channelMediaRelayController=null),M.dispatchEvent({type:"channel-media-relay-state",state:P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new P.ChannelMediaError(a,null,P.CHANNEL_MEDIA_RELAY_ERROR[a]);case 22:M.dispatchEvent({type:"channel-media-relay-state",state:P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_RUNNING,code:P.CHANNEL_MEDIA_RELAY_ERROR.RELAY_OK}),M.channelMediaConfig=t;case 24:case"end":return e.stop()}}),e,null,[[7,12]])})));return function(t){return e.apply(this,arguments)}}(),M.updateChannelMediaRelay=function(){var t=s()(o.a.mark((function t(n){var r,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(M.channelMediaRelayController){t.next=2;break}throw new P.ChannelMediaError("RELAY_NOT_START",null,P.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return t.prev=2,t.next=5,M.channelMediaRelayController.updateChannelMediaRelay(n);case 5:t.next=18;break;case 7:throw t.prev=7,t.t0=t.catch(2),v.default.debug("[".concat(M.clientId,"] updateChannelMediaRelay exception: ").concat(JSON.stringify(e))),r=P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,"",i=e instanceof P.ChannelMediaError?e.message===P.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.message===P.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":e.message===P.CHANNEL_MEDIA_ERROR.WS_ABORT||e.message===P.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",M.dispatchEvent({type:"channel-media-relay-event",code:P.CHANNEL_MEDIA_RELAY_EVENT.PACKET_UPDATE_DEST_CHANNEL_REFUSED}),M.dispatchEvent({type:"channel-media-relay-state",state:r,code:P.CHANNEL_MEDIA_RELAY_ERROR[i]}),M.channelMediaRelayController&&(M.channelMediaRelayController.dispose(),M.channelMediaConfig=null,M.channelMediaRelayController=null),M.dispatchEvent({type:"channel-media-relay-state",state:P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new P.ChannelMediaError(i,null,P.CHANNEL_MEDIA_RELAY_ERROR[i]);case 18:M.channelMediaConfig=n;case 19:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e){return t.apply(this,arguments)}}(),M.stopChannelMediaRelay=s()(o.a.mark((function t(){var n,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(M.channelMediaRelayController){t.next=2;break}throw new P.ChannelMediaError("RELAY_NOT_START",null,P.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return t.prev=2,t.next=5,M.channelMediaRelayController.stopChannelMediaRelay();case 5:t.next=17;break;case 7:throw t.prev=7,t.t0=t.catch(2),v.default.debug("[".concat(M.clientId,"] stopChannelMediaRelay exception: ").concat(JSON.stringify(e))),n=P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,"",r=e instanceof P.ChannelMediaError?e.message===P.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.message===P.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.message===P.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":"INTERNAL_ERROR":"INTERNAL_ERROR",M.dispatchEvent({type:"channel-media-relay-state",state:n,code:P.CHANNEL_MEDIA_RELAY_ERROR[r]}),M.channelMediaRelayController&&(M.channelMediaRelayController.dispose(),M.channelMediaConfig=null,M.channelMediaRelayController=null),M.dispatchEvent({type:"channel-media-relay-state",state:P.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new P.ChannelMediaError(r,null,P.CHANNEL_MEDIA_RELAY_ERROR[r]);case 17:M.channelMediaConfig=null,M.channelMediaRelayController=null;case 19:case"end":return t.stop()}}),t,null,[[2,7]])}))),M.sendMetadata=function(e,t){M.makeRequest(function(e){return{_type:"send_metadata",_message:{session_id:M.joinInfo.sid,metadata:window.btoa(unescape(encodeURIComponent(e)))}}}(e),(function(){v.default.debug("[".concat(M.clientId,'] send metadata "').concat(e,'" success')),t&&t(null)}),(function(n){v.default.error("[".concat(M.clientId,'] send metadata "').concat(e,'" failed'),n),t&&t(n)}))},M._reportWebsocketCloseEvent=function(e,t){try{var n=y.report.getSessionStartTime(M.joinInfo.sid),r=Date.now();y.report.webSocketQuit({lts:r,sid:M.joinInfo.sid,cname:M.joinInfo.cname,cid:M.joinInfo.cid,uid:M.joinInfo.uid,elapse:r-n,succ:e,errorCode:t,ip:null})}catch(e){v.default.debug("[".concat(M.clientId,"]: _reportWebsocketCloseEvent exception, ").concat(e))}};var F=function(){v.default.debug("[".concat(M.clientId,"] Reconnect gateway")),M.state=h,M.socket.close(),B(),M.reconnectMode="recover",M.state=_,V()};M.recover=F;var B=function(){for(var e in M.dispatchEvent({type:"before-clear-connection"}),M.timers)M.timers.hasOwnProperty(e)&&clearInterval(M.timers[e]);for(var e in M.remoteStreams)if(M.remoteStreams.hasOwnProperty(e)){var t=M.remoteStreams[e],n=Object(m.a)({type:"stream-removed",uid:t.getId(),stream:t});M.dispatchEvent(n)}M.p2ps.clear(),W(),z(),clearInterval(M.pingTimer)};M.rejoin=function(){M.socket&&(clearInterval(M.pingTimer),M.socket.close(),M.socket=void 0),M.state=_,V()};var V=function(e,t){M.dispatchEvent(Object(m.a)({type:"rejoin-start"})),e=e||function(e){v.default.info("[".concat(M.clientId,"] User ").concat(e," is re-joined to ").concat(M.joinInfo.cname)),M.dispatchEvent(Object(m.a)({type:"rejoin"})),M.channelMediaConfig&&M.startChannelMediaRelay(M.channelMediaConfig).then((function(){v.default.debug("[".concat(M.clientId,"] restartChannelMediaRelay success"))})).catch((function(e){v.default.debug("[".concat(M.clientId,"] restartChannelMediaRelay failed: ").concat(JSON.stringify(e)))})),M.liveStreams&&M.liveStreams.size&&M.liveStreams.forEach((function(e,t){e&&M.setLiveTranscoding(M.transcoding),M.startLiveStreaming(t,e)})),M.injectLiveStreams&&M.injectLiveStreams.size&&M.injectLiveStreams.forEach((function(e,t){M.addInjectStreamUrl(t,e)}))},t=t||function(e){v.default.error("[".concat(M.clientId,"] Re-join to channel failed "),e),M.dispatchEvent(Object(m.e)({type:"error",reason:e}))},M.key?(++M.rejoinAttempt,M.join(M.joinInfo,M.key,e,t)):v.default.error("[".concat(M.clientId,"] Connection recover failed [Invalid channel key]"))},G=function(e,t,n){if(M.onConnect=t,M.socket){if(M.dispatchEvent({type:"reconnect"}),"retry"===M.reconnectMode)v.default.debug("[".concat(M.clientId,"] Retry current gateway")),M.socket.reconnect();else if("tryNext"===M.reconnectMode)v.default.debug("[".concat(M.clientId,"] Try next gateway")),M.socket.connectNext();else if("recover"===M.reconnectMode){v.default.debug("[".concat(M.clientId,"] Recover gateway")),v.default.debug("[".concat(M.clientId,"] Try to reconnect choose server and get gateway list again ")),M.reconnectingCS=!0;var i=M.joinInfo&&M.joinInfo.sid;Object(R.getGatewayList)(M.joinInfo,(function(e){v.default.debug("[".concat(M.clientId,"] session:  ").concat(i," get gateway list success")),M.joinInfo.apResponse=e.res,M.reconnectingCS?M.socket.replaceHost(e.gateway_addr):v.default.debug("[".concat(M.clientId,"] session:  ").concat(i," already leave"))}))}}else o=e.gatewayAddr,M.socket=w(o,{sid:M.joinInfo.sid,clientId:M.clientId,proxyServerType:M.joinInfo.proxyServerType}),M.socket.on("start-connection",(function(e){M.ticket=e&&e.msg&&e.msg.ticket})),M.socket.on("on_uplink_stats",(function(e){var t={};for(var n in e)t[k(n)]=e[n];if(M.OutgoingAvailableBandwidth=t.uplink_available_bandwidth,M.localStreams[M.uid]){var r=M.localStreams[M.uid].uplinkStats;r&&r.period_fir===t.period_fir||v.default.debug("[".concat(M.clientId,"]: Period fir change to: ").concat(t.period_fir)),M.localStreams[M.uid].uplinkStats=t}})),M.socket.on("connect",(function(){M.dispatchEvent({type:"connected"}),M.attemps=1,M.onConnect()})),M.socket.on("recover",(function(){M.state=_,v.default.debug("[".concat(M.clientId,"] Try to reconnect choose server and get gateway list again ")),M.reconnectingCS=!0;var e=M.joinInfo&&M.joinInfo.sid;Object(R.getGatewayList)(M.joinInfo,(function(t){v.default.debug("[".concat(M.clientId,"] session:  ").concat(e," get gateway list success")),M.reconnectingCS?M.socket.replaceHost(t.gateway_addr):v.default.debug("[".concat(M.clientId,"] session:  ").concat(e," already leave"))}))})),M.socket.on("disconnect",(function(e){if(v.default.debug("[".concat(M.clientId,"] Receive disconnect message")),M.state!==h){M.state=h,M._reportWebsocketCloseEvent(-1,A.WEBSOCKET_CLOSE_REASON.WS_DISCONNECT);var t=Object(m.e)({type:"error",reason:A.default.SOCKET_DISCONNECTED});if(M.dispatchEvent(t),0===M.p2ps.size?M.reconnectMode="tryNext":M.reconnectMode="retry",B(),M.channelMediaRelayController&&M.channelMediaRelayController.dispose(),M.channelMediaRelayController=null,1!=r){var n,i=(n=M.attemps,1e3*Math.min(30,Math.pow(2,n)-1));if(v.default.error("[".concat(M.clientId,"] Disconnect from server [").concat(JSON.stringify(e),"], attempt to recover [#").concat(M.attemps,"] after ").concat(i/1e3," seconds")),M.hasInvokeLeave)return v.default.debug("[".concat(M.clientId,"] No reconnection because Client.leave has been invoked")),void(M.hasInvokeLeave=!1);setTimeout((function(){M.attemps++,M.state=_,M.inChannelInfo&&Date.now()-M.inChannelInfo.joinAt>Object(E.getParameter)("TICKET_RENEW_TIMEOUT")?(v.default.debug("Recovering to renew ticket"),F()):V()}),i)}else{var o=j.unregister(M);o&&v.default.debug("[".concat(M.clientId,"] "),o)}}})),M.socket.on("on_add_audio_stream",(function(e){if(v.default.info("[".concat(M.clientId,"] Newly added audio stream with uid ").concat(e.uid)),M.joinInfo.stringUid&&"string"!=typeof e.uid&&v.default.error("StringUID is Mixed with UintUID"),M.remoteStreamsInChannel.has(e.uid)||M.remoteStreamsInChannel.add(e.uid),void 0===M.remoteStreams[e.uid]){var t=Object(p.a)({streamID:e.uid,local:!1,audio:e.audio,video:e.video,uintUID:e.uint_id||e.uid});t.peerMuteVideo=!0,M.remoteStreams[e.uid]=t;var n=Object(m.e)({type:"stream-added",stream:t});M.dispatchEvent(n);var r=M.remoteMuteState[e.uid];r&&r.audio&&(n=Object(m.a)({type:"mute-audio",uid:e.uid}),M.dispatchEvent(n)),r&&r.video&&(n=Object(m.a)({type:"mute-video",uid:e.uid}),M.dispatchEvent(n))}y.report.onAddAudioStream(M.joinInfo.sid,{peerid:e.uint_id||e.uid,uid:M.uid})})),M.socket.on("on_update_stream",(function(e){v.default.info("[".concat(M.clientId,"] on_update_stream:"),e);var t=M.remoteStreams[e.uid];if(M.joinInfo.stringUid&&"string"!=typeof e.uid&&v.default.error("StringUID is Mixed with UintUID"),t){t.audio=e.audio,t.video=e.video,t.screen=e.screen,t.pc&&M._adjustPCMuteStatus(t);var n=Object(m.e)({type:"stream-updated",stream:t});M.dispatchEvent(n)}else v.default.debug("[".concat(M.clientId,"] Ignoring onUpdateStream event before onAddStream for uid ").concat(e.uid));y.report.onUpdateStream(M.joinInfo.sid,{peerid:e.uint_id||e.uid,audio:e.audio,video:e.video,uid:M.uid})})),M.socket.on("on_add_video_stream",(function(e){if(v.default.info("[".concat(M.clientId,"] Newly added remote stream with uid ").concat(e.uid,".")),M.joinInfo.stringUid&&"string"!=typeof e.uid&&v.default.error("StringUID is Mixed with UintUID"),M.remoteStreamsInChannel.has(e.uid)||M.remoteStreamsInChannel.add(e.uid),void 0===M.remoteStreams[e.uid]){var t=Object(p.a)({streamID:e.uid,local:!1,audio:e.audio,video:e.video,uintUID:e.uint_id||e.uid});M.remoteStreams[e.uid]=t;var n=Object(m.e)({type:"stream-added",stream:t});M.dispatchEvent(n);var r=M.remoteMuteState[e.uid];r&&r.audio&&(n=Object(m.a)({type:"mute-audio",uid:e.uid}),M.dispatchEvent(n)),r&&r.video&&(n=Object(m.a)({type:"mute-video",uid:e.uid}),M.dispatchEvent(n))}else{var i=M.remoteStreams[e.uid];if(i.video=!0,i.peerMuteVideo=!1,i.pc&&M._adjustPCMuteStatus(i),v.default.info("[".concat(M.clientId,"] Stream changed: enable video ").concat(e.uid)),void 0!==i.stream&&i.isPlaying()){var o=i.player.elementID;i.stop(),i.play(o,i.playOptions)}}y.report.onAddVideoStream(M.joinInfo.sid,{peerid:e.uint_id||e.uid,uid:M.uid})})),M.socket.on("on_remove_stream",(function(e){v.default.info("[".concat(M.clientId,"] on_remove_stream:"),e),M.remoteStreamsInChannel.has(e.uid)&&M.remoteStreamsInChannel.delete(e.uid);var t=M.remoteStreams[e.uid];if(t){delete M.remoteStreams[e.uid],delete M.remoteMuteState[e.uid];var n=Object(m.e)({type:"stream-removed",stream:t});M.dispatchEvent(n),t.close(),void 0!==t.pc&&(t.pc.close(),t.pc=void 0,M.p2ps.delete(t.p2pId)),y.report.onRemoveStream(M.joinInfo.sid,{peerid:e.uint_id||e.uid,uid:M.uid})}else v.default.error("ERROR stream ",e.uid," not found onRemoveStream ",e)})),M.socket.on("on_publish_stream",(function(e){v.default.info("[".concat(M.clientId,"] on_publish_stream:"),e);var t=M.localStreams[e.uid];M.dispatchEvent({type:"streamPublished",stream:t,proxy:e.proxy}),y.report.reportApiInvoke(M.joinInfo.sid,{name:"on_publish_stream",options:{proxy:e.proxy}})()})),M.socket.on("mute_audio",(function(e){v.default.info("[".concat(M.clientId,"] rcv peer mute audio: ").concat(e.uid)),M.remoteMuteState[e.uid]=M.remoteMuteState[e.uid]||{audio:!1,video:!1},M.remoteMuteState[e.uid].audio=!0;var t=Object(m.a)({type:"mute-audio",uid:e.uid}),n=M.remoteStreams[e.uid];n?(n.peerMuteAudio=!0,n.pc&&M._adjustPCMuteStatus(n),M.dispatchEvent(t)):v.default.debug("Ignoring event ".concat(e.type),e)})),M.socket.on("unmute_audio",(function(e){v.default.info("[".concat(M.clientId,"] rcv peer unmute audio: ").concat(e.uid)),M.remoteMuteState[e.uid]=M.remoteMuteState[e.uid]||{audio:!1,video:!1},M.remoteMuteState[e.uid].audio=!1;var t=Object(m.a)({type:"unmute-audio",uid:e.uid}),n=M.remoteStreams[e.uid];n?(n.peerMuteAudio=!1,n.pc&&M._adjustPCMuteStatus(n),M.dispatchEvent(t)):v.default.debug("Ignoring event ".concat(e.type),e)})),M.socket.on("mute_video",(function(e){v.default.info("[".concat(M.clientId,"] rcv peer mute video: ").concat(e.uid)),M.remoteMuteState[e.uid]=M.remoteMuteState[e.uid]||{audio:!1,video:!1},M.remoteMuteState[e.uid].video=!0;var t=Object(m.a)({type:"mute-video",uid:e.uid}),n=M.remoteStreams[e.uid];n?(n.peerMuteVideo=!0,n.player&&(n.player.peerVideoReady=!1),n.pc&&M._adjustPCMuteStatus(n),M.dispatchEvent(t)):v.default.debug("Ignoring event ".concat(e.type),e)})),M.socket.on("unmute_video",(function(e){v.default.info("[".concat(M.clientId,"] rcv peer unmute video: ").concat(e.uid)),M.remoteMuteState[e.uid]=M.remoteMuteState[e.uid]||{audio:!1,video:!1},M.remoteMuteState[e.uid].video=!1;var t=Object(m.a)({type:"unmute-video",uid:e.uid}),n=M.remoteStreams[e.uid];n?(n.peerMuteVideo=!1,n.pc&&M._adjustPCMuteStatus(n),M.dispatchEvent(t)):v.default.debug("Ignoring event ".concat(e.type),e)})),M.socket.on("on_crypt_error",(function(e){v.default.warning("[".concat(M.clientId,"] stream crypt error"));var t=Object(m.a)({type:"crypt-error",cryptType:e.crypt_type});M.dispatchEvent(t)})),M.socket.on("on_user_banned",(function(e){v.default.info("[".concat(M.clientId,"] user banned uid: ").concat(e.uid," error: ").concat(e.error_code));var t=Object(m.a)({type:"client-banned",uid:e.uid,attr:e.error_code});M.dispatchEvent(t),r=!0})),M.socket.on("on_stream_fallback_update",(function(e){v.default.info("[".concat(M.clientId,"] stream fallback peerId: ").concat(e.stream_id," type: ").concat(e.stream_type));var t=Object(m.a)({type:"stream-fallback",uid:e.stream_id,stream:e.stream_id,attr:e.stream_type});M.dispatchEvent(t)})),M.socket.on("stream_recover",(function(e){v.default.info("[".concat(M.clientId,"] stream recover uid: ").concat(e.id," peerId: ").concat(e.peerid," type: ").concat(e.type));var t=Object(m.a)({type:"stream-recover",uid:e.id,stream:e.peerid,attr:e.type});M.dispatchEvent(t)})),M.socket.on("on_p2p_lost",(function(e){v.default.debug("[".concat(M.clientId,"] p2plost: "),e,"p2ps:",M.p2ps);var t,n="DTLS failed";(t=M.localStreams[e.uid]||M.remoteStreams[e.uid])?(t.pc&&t.pc.offerCandidates&&0===t.pc.offerCandidates.length&&(n="NO_CANDIDATES_IN_OFFER"),"publish"===e.event&&y.report.publish(M.joinInfo.sid,{lts:t.publishLTS,succ:!1,audio:t.hasAudio(),video:t.hasVideo(),screenshare:t.hasScreen(),audioName:t.hasAudio()&&t.audioName,videoName:t.hasVideo()&&t.videoName,screenName:t.hasScreen()&&t.screenName,ec:n,publishRequestid:M.publishRequestId||0,p2pid:M.p2ps.get(t.getId())}),"subscribe"===e.event&&y.report.subscribe(M.joinInfo.sid,{lts:t.subscribeLTS,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:e.uid+"",ec:n,subscribeRequestid:M.subscribeRequestId.get(t.getId())||0,p2pid:M.p2ps.get(t.getId())})):v.default.warning("P2PLost Stream Not found",e),v.default.debug("[".concat(M.clientId,"] p2plost:"),e.p2pid),(t=M.p2ps.get(e.p2pid))&&(M.p2ps.delete(e.p2pid),t.local?M.dispatchEvent(Object(m.a)({type:"pubP2PLost",stream:t,attr:n})):M.remoteStreams[t.getId()]&&M.dispatchEvent(Object(m.a)({type:"subP2PLost",stream:t,attr:n})))})),M.socket.on("on_token_privilege_will_expire",(function(e){v.default.debug("[".concat(M.clientId,"] Received Message onTokenPrivilegeWillExpire")),M.dispatchEvent(Object(m.a)({type:"onTokenPrivilegeWillExpire"}))})),M.socket.on("on_token_privilege_did_expire",(function(){v.default.warning("[".concat(M.clientId,"] Received Message onTokenPrivilegeDidExpire, please get new token and join again")),M.closeGateway(),M.dispatchEvent(Object(m.a)({type:"onTokenPrivilegeDidExpire"}))})),M.socket.on("enable_local_video",(function(e){v.default.info("[".concat(M.clientId,"] enable_local_video:"),e),M.dispatchEvent(Object(m.a)({type:"enable-local-video",uid:e.uid}))})),M.socket.on("disable_local_video",(function(e){v.default.info("[".concat(M.clientId,"] disable_local_video:"),e),M.dispatchEvent(Object(m.a)({type:"disable-local-video",uid:e.uid}))})),M._doWithAction=function(e,t,n){"tryNext"===e?function(e,t){v.default.debug("[".concat(M.clientId,"] Connect next gateway")),M.state=h,M.socket.close(),B(),M.reconnectMode="tryNext",M.state=_,V(e,t)}(t,n):"retry"===e?function(e,t){v.default.debug("[".concat(M.clientId,"] Reconnect gateway")),M.state=h,M.socket.close(),B(),M.reconnectMode="retry",M.state=_,V(e,t)}(t,n):"quit"===e?(v.default.debug("[".concat(M.clientId,"] quit gateway")),M.state=h,M.socket.close(),B()):"recover"===e&&F()},M.socket.on("on_notification",(function(e){if(v.default.debug("[".concat(M.clientId,"] Receive notification: "),e),"ERR_JOIN_BY_MULTI_IP"===A.GatewayErrorCode[e.code])return M.dispatchEvent({type:"onMultiIP",option:e.option});e.detail?M._doWithAction(I[A.GatewayErrorCode[e.code]]):e.action&&M._doWithAction(e.action)})),M.socket.on("on_user_offline",(function(e){v.default.info("[".concat(M.clientId,"] on_user_offline:"),e);var t=Object(m.a)({type:"peer-leave",uid:e.uid});if(M.remoteStreamsInChannel.has(e.uid)&&M.remoteStreamsInChannel.delete(e.uid),M.remoteStreams.hasOwnProperty(e.uid)&&(t.stream=M.remoteStreams[e.uid]),t.reason=e.reason,M.dispatchEvent(t),v.default.info("[".concat(M.clientId,"] remove remoteMuteState "),e.uid),delete M.remoteMuteState[e.uid],M.remoteStreams.hasOwnProperty(e.uid)){v.default.info("[".concat(M.clientId,"] closing stream on peer leave"),e.uid);var n=M.remoteStreams[e.uid];n.close(),delete M.remoteStreams[e.uid],y.report.onRemoveStream(M.joinInfo.sid,{peerid:e.uint_id||e.uid,uid:M.uid}),void 0!==n.pc&&(n.pc.close(),n.pc=void 0,M.p2ps.delete(n.p2pId))}M.timers.hasOwnProperty(e.uid)&&(clearInterval(M.timers[e.uid]),clearInterval(M.timers[e.uid]+"_RelatedStats"),delete M.timers[e.uid]),null!=M.audioLevel[e.uid]&&delete M.audioLevel[e.uid],null!=M.timer_counter[e.uid]&&delete M.timer_counter[e.uid]})),M.socket.on("onUplinkStats",(function(e){})),M.socket.on("liveStreamingStarted",(function(e){var t=Object(m.c)({type:"liveStreamingStarted",url:e.url});M.dispatchEvent(t)})),M.socket.on("liveStreamingFailed",(function(e){var t=Object(m.c)({type:"liveStreamingFailed",url:e.url});M.dispatchEvent(t)})),M.socket.on("liveStreamingStopped",(function(e){var t=Object(m.c)({type:"liveStreamingStopped",url:e.url});M.dispatchEvent(t)})),M.socket.on("liveTranscodingUpdated",(function(e){var t=Object(m.c)({type:"liveTranscodingUpdated",reason:e.reason});M.dispatchEvent(t)})),M.socket.on("streamInjectedStatus",(function(e){var t=Object(m.c)({type:"streamInjectedStatus",url:e.url,uid:e.uid,status:e.status});M.dispatchEvent(t)})),M.socket.on("on_user_online",(function(e){M.joinInfo.stringUid&&"string"!=typeof e.uid&&v.default.error("StringUID is Mixed with UintUID"),M.dispatchEvent({type:"peer-online",uid:e.uid})})),M.socket.on("receive_metadata",(function(e){M.joinInfo.stringUid&&"string"!=typeof e.uid&&v.default.error("StringUID is Mixed with UintUID");var t=decodeURIComponent(escape(window.atob(e.metadata)));v.default.debug("[".concat(M.clientId,"] received ").concat(e.uid," metadata: ").concat(t)),M.dispatchEvent({type:"receive-metadata",uid:e.uid,metadata:t})}));var o},H=function(e,t){if(void 0!==M.socket)try{M.socket.emitSimpleMessage(e,(function(e,n){t&&t(e,n)}))}catch(e){v.default.error("[".concat(M.clientId,"] Error in sendSimpleSdp [").concat(e,"]"))}else v.default.error("[".concat(M.clientId,"] Error in sendSimpleSdp [socket not ready]"))},z=function(){for(var e in M.localStreams)if(void 0!==M.localStreams[e]){var t=M.localStreams[e];delete M.localStreams[e],void 0!==t.pc&&(t.pc.close(),t.pc=void 0)}},W=function(){for(var e in M.remoteStreamsInChannel.clear(),M.remoteStreams)if(M.remoteStreams.hasOwnProperty(e)){var t=M.remoteStreams[e];t.isPlaying()&&t.stop(),t.close(),delete M.remoteStreams[e],void 0!==t.pc&&(t.pc.close(),t.pc=void 0)}};return M},j={_gatewayClients:{},register:function(e,t){if(!t.uid){var n="NO_UID_PROVIDED";return v.default.error("[".concat(e.clientId,"] "),n,t),n}if(t.cname)return this._gatewayClients[t.cname]&&this._gatewayClients[t.cname][t.uid]&&this._gatewayClients[t.cname][t.uid]!==e?(n="UID_CONFLICT",v.default.error("[".concat(e.clientId,"] "),n,t),n):(v.default.debug("[".concat(e.clientId,"] register client Channel"),t.cname,"Uid",t.uid),this._gatewayClients[t.cname]||(this._gatewayClients[t.cname]={}),this._gatewayClients[t.cname][t.uid]=e,null);n="NO_CHANNEL_PROVIDED";return v.default.error("[".concat(e.clientId,"] "),n,t),n},unregister:function(e){var t=e&&e.uid,n=e.joinInfo&&e.joinInfo.cname;if(!t||!n){var r="INVALID_GATEWAYCLIENT";return v.default.error("[".concat(e.clientId,"] "),r),r}if(this._gatewayClients[n]&&this._gatewayClients[n][t])return this._gatewayClients[n][t]!==e?(r="GATEWAYCLIENT_UID_CONFLICT",v.default.error("[".concat(e.clientId,"] "),r),r):(v.default.debug("[".concat(e.clientId,"] unregister client "),e.uid),delete this._gatewayClients[n][t],null);r="GATEWEAY_CLIENT_UNREGISTERED";v.default.error("[".concat(e.clientId,"] "),r)}};F.DISCONNECTED=0,F.CONNECTING=1,F.CONNECTED=2,F.DISCONNECTING=3,F.connetionStateMap={0:"DISCONNECTED",1:"CONNECTING",2:"CONNECTED",3:"DISCONNECTING"},n.a=F},function(e,t,n){"use strict";n.r(t),n.d(t,"post",(function(){return d})),n.d(t,"postFormData",(function(){return l})),n.d(t,"shouldUseHttps",(function(){return h})),n.d(t,"getHTTPSendBytes",(function(){return s})),n.d(t,"getHTTPRecvBytes",(function(){return c})),n.d(t,"resetHTTPByetsCount",(function(){return u}));var r=n(2),i=n(10),o=0,a=0,s=function(){return o},c=function(){return a},u=function(){o=0,a=0},l=function(e,t,n,s,c){var u=new XMLHttpRequest;if(u.timeout=t.timeout||Object(r.getParameter)("HTTP_CONNECT_TIMEOUT"),u.open("POST",e,!0),c)for(var l in c)"withCredentials"==l?u.withCredentials=!0:u.setRequestHeader(l,c[l]);u.onload=function(t){a+=Object(i.lengthInUtf8Bytes)(u.responseText),200!==u.status?s&&s({httpErrorCode:"httpcode-xhr.status"},e):n&&n(u.responseText)},u.onerror=function(t){s&&s(t,e)},u.ontimeout=function(t){s&&s(t,e)};var d=JSON.stringify(t);o+=Object(i.lengthInUtf8Bytes)(d);var h=new FormData;h.append("request",d),u.send(h)},d=function(e,t,n,s,c){var u=new XMLHttpRequest;if(u.timeout=t.timeout||Object(r.getParameter)("HTTP_CONNECT_TIMEOUT"),u.open("POST",e,!0),u.setRequestHeader("Content-type","application/json; charset=utf-8"),c)for(var l in c)"withCredentials"==l?u.withCredentials=!0:u.setRequestHeader(l,c[l]);u.onload=function(t){a+=Object(i.lengthInUtf8Bytes)(u.responseText),200!==u.status?s&&s({httpErrorCode:"httpcode-xhr.status"},e):n&&n(u.responseText)},u.onerror=function(t){s&&s(t,e)},u.ontimeout=function(t){s&&s(t,e)};var d=JSON.stringify(t);o+=Object(i.lengthInUtf8Bytes)(d),u.send(d)},h=function(){return"https:"==document.location.protocol}},function(e,t,n){"use strict";n.r(t),n.d(t,"RTCPeerConnection",(function(){return w})),n.d(t,"getUserMedia",(function(){return a})),n.d(t,"attachMediaStream",(function(){return s})),n.d(t,"reattachMediaStream",(function(){return c})),n.d(t,"setSrcObject",(function(){return f})),n.d(t,"getSrcObject",(function(){return p})),n.d(t,"webrtcDetectedBrowser",(function(){return u})),n.d(t,"webrtcDetectedVersion",(function(){return l})),n.d(t,"webrtcMinimumVersion",(function(){return d})),n.d(t,"webrtcTesting",(function(){return T})),n.d(t,"webrtcUtils",(function(){return v}));var r=n(11),i=n.n(r),o=n(4),a=null,s=null,c=null,u=null,l=null,d=null,h=null,f=null,p=null,m=null,g={addStream:null},v={log:function(){},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n])}};if("object"==("undefined"==typeof window?"undefined":i()(window))?(window.HTMLMediaElement&&!("srcObject"in window.HTMLMediaElement.prototype)?(f=function(e,t){"mozSrcObject"in e?e.mozSrcObject=t:(e._srcObject=t,e.src=t?URL.createObjectURL(t):null)},p=function(e){return"mozSrcObject"in e?e.mozSrcObject:e._srcObject}):(f=function(e,t){e.srcObject=t},p=function(e){return e.srcObject}),a=window.navigator&&window.navigator.getUserMedia):(f=function(e,t){e.srcObject=t},p=function(e){return e.srcObject}),s=function(e,t){f(e,t)},c=function(e,t){f(e,p(t))},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){for(var y in v.log("This appears to be Firefox"),u="firefox",l=v.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),d=31,m=mozRTCPeerConnection,g)g[y]=m.prototype[y];if(h=function(e,t){if(l<38&&e&&e.iceServers){for(var n=[],r=0;r<e.iceServers.length;r++){var i=e.iceServers[r];if(i.hasOwnProperty("urls"))for(var o=0;o<i.urls.length;o++){var a={url:i.urls[o]};0===i.urls[o].indexOf("turn")&&(a.username=i.username,a.credential=i.credential),n.push(a)}else n.push(e.iceServers[r])}e.iceServers=n}var s=new m(e,t);for(var c in g)s[c]=g[c];return s},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),a=function(e,t,n){var r=function(e){if("object"!==i()(e)||e.require)return e;var t=[];return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"===i()(e[n])?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var o={};"number"==typeof r.ideal?o[n]={min:r.ideal,max:r.ideal}:o[n]=r.ideal,e.advanced.push(o),delete r.ideal,Object.keys(r).length||delete e[n]}}})),t.length&&(e.require=t),e};return l<38&&(v.log("spec: "+JSON.stringify(e)),e.audio&&(e.audio=r(e.audio)),e.video&&(e.video=r(e.video)),v.log("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,t,n)},navigator.getUserMedia=a,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:S,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise((function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])}))},l<41){var b=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return b().then(void 0,(function(e){if("NotFoundError"===e.name)return[];throw e}))}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){for(var y in v.log("This appears to be Chrome"),u="chrome",l=v.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),d=38,m=webkitRTCPeerConnection,g)g[y]=m.prototype[y];h=function(e,t){e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new m(e,t);for(var r in g)n[r]=g[r];var i=n.getStats.bind(n);return n.getStats=function(e,t,n){var r=arguments;r.length>0&&"function"==typeof e&&(t?(n=t,t=e,r=[e=null,t,n]):(t=e,r=[e=null,t]));var o=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t};if(r.length>=2){var a=function(e){r[1](o(e))};return i.apply(this,[a,r[0]])}return i()},n},["createOffer","createAnswer"].forEach((function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===i()(arguments[0])){var n=1===arguments.length?arguments[0]:void 0;return new Promise((function(r,i){t.apply(e,[r,i,n])}))}return t.apply(this,arguments)}})),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this;return new Promise((function(r,i){t.apply(n,[e[0],function(){r(),e.length>=2&&e[1].apply(null,[])},function(t){i(t),e.length>=3&&e[2].apply(null,[t])}])}))}}));var _=function(e){if("object"!==i()(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"===i()(e[n])?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var a={};"number"==typeof r.ideal?(a[o("min",n)]=r.ideal,t.optional.push(a),(a={})[o("max",n)]=r.ideal,t.optional.push(a)):(a[o("",n)]=r.ideal,t.optional.push(a))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=r.exact):["min","max"].forEach((function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=r[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};if(a=function(e,t,n){return e.audio&&(e.audio=_(e.audio)),e.video&&(e.video=_(e.video)),v.log("chrome: "+JSON.stringify(e)),navigator.webkitGetUserMedia(e,t,n)},navigator.getUserMedia=a,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:S,enumerateDevices:function(){return new Promise((function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(n){e(n.map((function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}})))}))}))}}),navigator.mediaDevices.getUserMedia){if((Object(o.getBrowserVersion)()?Number(Object(o.getBrowserVersion)().split(".")[0]):void 0)<46){var E=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return v.log("spec:   "+JSON.stringify(e)),e.audio=_(e.audio),e.video=_(e.video),v.log("chrome: "+JSON.stringify(e)),E(e)}}}else navigator.mediaDevices.getUserMedia=function(e){return S(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){v.log("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){v.log("Dummy mediaDevices.removeEventListener called.")}),s=function(e,t){l>=43?f(e,t):void 0!==e.src?e.src=t?URL.createObjectURL(t):null:v.log("Error attaching stream to element.")},c=function(e,t){l>=43?f(e,p(t)):e.src=t.src}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(v.log("This appears to be Edge"),u="edge",l=v.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),d=12):v.log("Browser does not appear to be WebRTC-capable");else v.log("This does not appear to be a browser"),u="not a browser";function S(e){return new Promise((function(t,n){a(e,t,n)}))}var w,T={};try{Object.defineProperty(T,"version",{set:function(e){l=e}})}catch(e){}h?w=h:"undefined"!=typeof window&&(w=window.RTCPeerConnection)},function(e,t,n){"use strict";var r=n(12),i=n.n(r),o=n(17),a=n.n(o),s=n(51),c=n.n(s),u=n(4),l=n(1),d=n(3),h=n(0),f=(n(25),n(2),n(5),n(52)),p=n.n(f),m=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189];function g(e){for(var t=new Uint8Array([99,114,121,112,116,105,105]),n=t.length,r=e,i=r.length,o=new Uint8Array(i),a=new Uint8Array(256),s=0;s<256;s++)a[s]=s;for(var c=0,u=0;u<256;u++){var l=[a[c=(c+a[u]+t[u%n])%256],a[u]];a[u]=l[0],a[c]=l[1]}var d,h=0;c=0;for(var f=0;f<0+i;f++){var p=[a[c=(c+a[h=(h+1)%256])%256],a[h]];a[h]=p[0],a[c]=p[1],d=a[(a[h]+a[c])%256],f>=0&&(o[f-0]=r[f-0]^d)}var m=String.fromCharCode.apply(null,o);return Function("var winSize = 5; return `"+m+"`")()}function v(e,t){var n=g(t),r=p.a.createProgramFromSources(e,[g(m),n]),i=e.getAttribLocation(r,"a_position"),o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(i);var a=2,s=e.FLOAT,c=!1,u=0,l=0;e.vertexAttribPointer(i,a,s,c,u,l);var d=e.getAttribLocation(r,"a_texCoord"),h=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(d),a=2,s=e.FLOAT,c=!1,u=0,l=0,e.vertexAttribPointer(d,a,s,c,u,l),r}var y=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];function b(e,t,n){var r=e.gl;this.program=v(r,y),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var e=r.getUniformLocation(this.program,"u_flipY");r.uniform1f(e,1)}}var _=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];function E(e,t,n){var r=e.gl,i=1/t,o=1/n,a=5;this.program=v(r,_),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var e=r.getUniformLocation(this.program,"u_flipY"),t=r.getUniformLocation(this.program,"u_singleStepOffset"),n=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform2f(t,i,o),r.uniform1f(n,a),r.uniform1f(e,1)},this.setParameters=function(e){void 0!==e.denoiseLevel&&(a=e.denoiseLevel)},this.setSize=function(e,t){i=1/e,o=1/t}}var S=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];function w(e,t,n){var r=e.gl,i=1/t,o=1/n,a=5;this.program=v(r,S),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var e=r.getUniformLocation(this.program,"u_flipY"),t=r.getUniformLocation(this.program,"u_singleStepOffset"),n=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform2f(t,i,o),r.uniform1f(n,a),r.uniform1f(e,1)},this.setParameters=function(e){void 0!==e.denoiseLevel&&(a=e.denoiseLevel)},this.setSize=function(e,t){i=1/e,o=1/t}}var T=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];function A(e,t,n){var r=e.gl,i=1/t,o=1/n,a=5;this.program=v(r,T),this.setUniforms=function(){r.getUniformLocation(this.program,"u_image");var e=r.getUniformLocation(this.program,"u_flipY"),t=r.getUniformLocation(this.program,"u_singleStepOffset"),n=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform2f(t,i,o),r.uniform1f(n,a),r.uniform1f(e,1)},this.setParameters=function(e){void 0!==e.denoiseLevel&&(a=e.denoiseLevel)},this.setSize=function(e,t){i=1/e,o=1/t}}var R=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144];function x(e,t,n){var r=e.gl,i=5,o=.1,a=.5,s=175/180*3.141593,c=115/180*3.141593,u=173/180*3.141593,l=116/180*3.141593,d=2.04203545,h=0,f=0,p=0,m=[],g=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],y=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],b=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];this.program=v(r,R),this.setUniforms=function(){var t=r.getUniformLocation(this.program,"u_flipY"),n=r.getUniformLocation(this.program,"u_denoiseLevel");r.uniform1f(n,i),r.uniform1f(t,1);var g=r.getUniformLocation(this.program,"light");r.uniform1f(g,o);var v=r.getUniformLocation(this.program,"redness");r.uniform1f(v,a);var y=r.getUniformLocation(this.program,"skin_he_max"),b=r.getUniformLocation(this.program,"skin_he_min"),_=r.getUniformLocation(this.program,"skin_hc_max"),E=r.getUniformLocation(this.program,"skin_hc_min"),S=r.getUniformLocation(this.program,"skin_hc_axis"),w=r.getUniformLocation(this.program,"facts_rotate_c"),T=r.getUniformLocation(this.program,"facts_rotate_le"),A=r.getUniformLocation(this.program,"facts_rotate_ge");r.uniform1f(y,s),r.uniform1f(b,c),r.uniform1f(_,u),r.uniform1f(E,l),r.uniform1f(S,d),r.uniform1f(w,h),r.uniform1f(T,f),r.uniform1f(A,p);var R=r.getUniformLocation(this.program,"u_originImage");r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,e.inputTexture),r.uniform1i(R,2);for(var x=["lighten_lut"],I=[r.TEXTURE3],O=0;O<x.length;O++){var C=r.getUniformLocation(this.program,x[O]);r.activeTexture(I[O]),r.bindTexture(r.TEXTURE_2D,m[O]),r.uniform1i(C,O+3)}},this.setParameters=function(e){void 0!==e.denoiseLevel&&(i=e.denoiseLevel),void 0!==e.lightLevel&&(o=e.lightLevel),void 0!==e.rednessLevel&&(a=e.rednessLevel,this._updateRedness(a)),void 0!==e.lighteningContrastLevel&&this._updateLut(e.lighteningContrastLevel)},this._updateRedness=function(e){var t,n,r=3.141593,i=e,o=i;i>1&&(i=1),i<0&&(i=0),o>1&&(o=1),o<0&&(o=0),h=.8*i,o<.8&&(o=0),(d=(117-4*o)/180*r)<(l=(116-4*o)/180*r)&&(d=l),l<r/2&&(l=r/2),d<r/2&&(d=r/2),(c=(115-4*o)/180*r)<r/2&&(c=r/2),(u=173/180*r)>r&&(u=r),d>r&&(d=r),(s=175/180*r)>r&&(s=r),n=u-d,p=(t=s-u)>.01?h*n/t:h,n=d-l,f=(t=l-c)>.01?h*n/t:h},this._updateLut=function(e){var t=null;0==e&&(t=y),1==e&&(t=b),2==e&&(t=g);for(var n=[new Uint8Array(t)],i=[256],o=[1],a=0;a<n.length;a++)r.bindTexture(r.TEXTURE_2D,m[a]),r.texImage2D(r.TEXTURE_2D,0,r.LUMINANCE,i[a],o[a],0,r.LUMINANCE,r.UNSIGNED_BYTE,n[a])},this._init=function(){for(var e=[new Uint8Array(y)],t=[256],n=[1],i=0;i<e.length;i++){var o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.LUMINANCE,t[i],n[i],0,r.LUMINANCE,r.UNSIGNED_BYTE,e[i]),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),m.push(o)}},this._init()}var I=!1;function O(){this.programs=[];var e=this,t=null,n=null;e.gl=null,e.inputTexture=null;var r=[],i=[],o=0,a=0;e._initGl=function(n,s){e.inputTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,e.inputTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);for(var c=0;c<4;c++){var u=t.createTexture();t.bindTexture(t.TEXTURE_2D,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),c<2?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,s,0,t.RGBA,t.UNSIGNED_BYTE,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,s,n,0,t.RGBA,t.UNSIGNED_BYTE,null);var l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,u,0),r.push(u),i.push(l)}t.viewport(0,0,n,s),o=n,a=s},e.render=function(s){if(t){var c=0;a==s.videoWidth&&o===s.videoHeight&&(c=2),t.viewport(0,0,s.videoWidth,s.videoHeight),t.bindTexture(t.TEXTURE_2D,e.inputTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s);for(var u=I?e.programs.length-1:0,l=0;l<=u;l++){var d=e.programs[l].program;t.useProgram(d);var h=t.getUniformLocation(d,"u_image");e.programs[l].setUniforms(),t.bindFramebuffer(t.FRAMEBUFFER,i[c+l%2]),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,6),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r[c+l%2]),t.uniform1i(h,0)}t.useProgram(n);var f=t.getUniformLocation(n,"u_flipY");t.uniform1f(f,-1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,6)}},e.setEnableBeauty=function(e){I=e},e.init=function(r,i,o){if("undefined"==typeof WebGLRenderingContext)throw new Error("NOT_SUPPORT");t=o.getContext("webgl"),e.gl=t,e._initGl(r,i),e.programs.push(new b(this,r,i)),e.programs.push(new E(this,r,i)),e.programs.push(new w(this,r,i)),e.programs.push(new A(this,r,i)),e.programs.push(new x(this,r,i)),n=e.programs[0].program},e.release=function(){e.gl=null,t=null,n=null,e.inputTexture=null,e.programs=[],r=[],i=[]},e.setDenoiseLevel=function(t){e.programs.forEach((function(e){e.setParameters&&e.setParameters({denoiseLevel:t})}))},e.setLightLevel=function(t){e.programs.forEach((function(e){e.setParameters&&e.setParameters({lightLevel:t})}))},e.setRednessLevel=function(t){e.programs.forEach((function(e){e.setParameters&&e.setParameters({rednessLevel:t})}))},e.setContrastLevel=function(t){e.programs.forEach((function(e){e.setParameters&&e.setParameters({lighteningContrastLevel:t})}))},e.setSize=function(t,n){e.programs.forEach((function(e){e.setSize&&e.setSize(t,n)}))}}O._instance=null,O.getInstance=function(){return O._instance||(O._instance=new O),O._instance},t.a={addVideoEffectCapability:function(e){e.videoEffect={canvas:null,video:null,fps:30,stopChromeBackgroundLoop:null,enableBeauty:!1,denoiseLevel:5,lightLevel:.35,rednessLevel:.5,lighteningContrastLevel:1,videoContextInited:!1,originVideoTrack:null,canvasVideoTrack:null,ctx:null},e._initVideoContext=function(){if(e.videoEffect.videoContextInited)throw new Error("Failed to init video context. Already inited");if(!e.stream)throw new Error("Failed to init video context. Local Stream not initialized");e.videoEffect.originVideoTrack=e.stream.getVideoTracks()[0],e.attributes&&e.attributes.maxFrameRate&&(e.videoEffect.fps=e.attributes.maxFrameRate),e.videoEffect.videoContextInited=!0},e._renderWithWebGL=function(t){return new Promise((function(n){e.videoEffect.canvas||(e.videoEffect.canvas=document.createElement("canvas")),e.videoEffect.video||(e.videoEffect.video=document.createElement("video")),e.videoEffect.video.setAttribute("autoplay",""),e.videoEffect.video.setAttribute("muted",""),e.videoEffect.video.muted=!0,e.videoEffect.video.setAttribute("playsinline",""),e.videoEffect.video.setAttribute("style","display:none"),e.videoEffect.video.srcObject=t;var r=t.getVideoTracks()[0].getSettings(),i=r.width,o=r.height;e.videoEffect.canvas.setAttribute("width",i),e.videoEffect.canvas.setAttribute("height",o),e.videoEffect.video.setAttribute("width",i),e.videoEffect.video.setAttribute("height",o);var a=O.getInstance();a.init(e.videoEffect.video.width,e.videoEffect.video.height,e.videoEffect.canvas),a.setDenoiseLevel(e.videoEffect.denoiseLevel),a.setLightLevel(e.videoEffect.lightLevel),a.setRednessLevel(e.videoEffect.rednessLevel),a.setContrastLevel(e.videoEffect.lighteningContrastLevel),e.videoEffect.video.addEventListener("playing",(function t(){var r=e.videoEffect.canvas.captureStream(e.videoEffect.fps);e.videoEffect.video.removeEventListener("playing",t,!0),n([r.getVideoTracks()[0],e.videoEffect.video])}),!0),e.videoEffect.video.play()}))},e._disableEffect=function(){e.videoEffect.videoContextInited||e._initVideoContext();var t=e.videoEffect.originVideoTrack;if(!t)return h.default.warning("Video track is null, fail to disable video effect!"),Promise.resolve();if(e.pc&&e.pc.peerConnection&&e.pc.peerConnection){var n=(e.pc.peerConnection&&e.pc.peerConnection.getSenders()).find((function(e){return e&&e.track&&"video"==e.track.kind}));if(n&&n.replaceTrack&&t)return n.replaceTrack(t)}return Promise.resolve()},e._releaseEffect=function(){var t;return t=e.videoEffect.enableBeauty?e._disableEffect():Promise.resolve(),O.getInstance().release(),e.videoEffect.videoContextInited=!1,e.videoEffect.canvasVideoTrack=null,t},e._enableEffect=function(){return e.videoEffect.videoContextInited||e._initVideoContext(),e.videoEffect.originVideoTrack?e.videoEffect.canvasVideoTrack?(e._showEffectInLocalPlayer(),e._replaceWithCanvasTrack()):e._renderWithWebGL(e.stream).then((function(t){var n=c()(t,2),r=n[0],i=n[1];e.videoEffect.canvasVideoTrack=r;var o=O.getInstance();return requestAnimationFrame((function t(){e.videoEffect.enableBeauty&&o.render(i),e.videoEffect.videoContextInited&&requestAnimationFrame(t)})),u.isChrome()&&document.addEventListener("visibilitychange",(function(){document.hidden,document.hidden?e.videoEffect.stopChromeBackgroundLoop=function(e,t){var n=1/t,r=new AudioContext,i=r.createGain();i.gain.value=0,i.connect(r.destination),function t(){var a=r.createOscillator();a.onended=t,a.connect(i),a.start(0),a.stop(r.currentTime+n),e(r.currentTime),o&&(a.onended=function(){r.close()})}();var o=!1;return function(){o=!0}}((function(){e.videoEffect.enableBeauty&&o.render(i)}),e.videoEffect.fps):e.videoEffect.stopChromeBackgroundLoop&&(e.videoEffect.stopChromeBackgroundLoop(),e.videoEffect.stopChromeBackgroundLoop=null)}),!1),e._showEffectInLocalPlayer(),e._replaceWithCanvasTrack()})):(h.default.warning("Video track is null, fail to enable video effect!"),Promise.resolve())},e._showEffectInLocalPlayer=function(){if(e.player){var t=e.player.div.children[0];if("none"!==t.style.display&&(e.player.div.appendChild(e.videoEffect.canvas),"video"===t.tagName.toLowerCase())){var n=t.getAttribute("style");e.videoEffect.canvas.setAttribute("style",n),"none"!==t.style.display&&(t.style.display="none")}}},e._removeEffectFromLocalPlayer=function(){if(e.player&&e.player.div&&e.videoEffect.enableBeauty&&e.videoEffect.canvas){e.player.div.removeChild(e.videoEffect.canvas);var t=e.player.div.children[0];"video"===t.tagName.toLowerCase()&&(e.videoEffect.canvas.style.display="none",t.style.display="block")}},e._replaceWithCanvasTrack=function(){var t=null;return e.pc&&e.pc.peerConnection&&e.pc.peerConnection&&(t=(e.pc.peerConnection&&e.pc.peerConnection.getSenders()).find((function(e){return e&&e.track&&"video"==e.track.kind}))),t&&t.replaceTrack&&e.videoEffect.canvasVideoTrack?t.replaceTrack(e.videoEffect.canvasVideoTrack):Promise.resolve()},e.setBeautyEffectOptions=function(){var t=a()(i.a.mark((function t(n,r){var o,a=arguments;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Object(d.checkValidBoolean)(n,"enabled"),o=O.getInstance(),e.videoEffect.enableBeauty==n){t.next=14;break}if(o.setEnableBeauty(n),!n){t.next=9;break}return t.next=7,e._enableEffect();case 7:t.next=12;break;case 9:return e._removeEffectFromLocalPlayer(),t.next=12,e._releaseEffect();case 12:e.videoEffect.enableBeauty=n,l.report.reportApiInvoke(e.sid,{callback:null,options:a,name:"Stream.setBeautyEffectOptions",tag:"tracer"});case 14:if(n){t.next=16;break}return t.abrupt("return");case 16:if(!r){t.next=20;break}Object(d.checkValidObject)(r,"options"),t.next=21;break;case 20:return t.abrupt("return");case 21:if(void 0!==r.smoothnessLevel&&(Object(d.checkValidFloatNumber)(r.smoothnessLevel,"smoothnessLevel",0,1),e.videoEffect.denoiseLevel=10*r.smoothnessLevel,e.videoEffect.denoiseLevel<.1&&(e.videoEffect.denoiseLevel=.1),o.setDenoiseLevel(e.videoEffect.denoiseLevel)),void 0!==r.lighteningLevel&&(Object(d.checkValidFloatNumber)(r.lighteningLevel,"lighteningLevel",0,1),e.videoEffect.lightLevel=r.lighteningLevel/2,e.videoEffect.lightLevel<.01&&(e.videoEffect.lightLevel=.01),o.setLightLevel(e.videoEffect.lightLevel)),void 0!==r.rednessLevel&&(Object(d.checkValidFloatNumber)(r.rednessLevel,"rednessLevel",0,1),e.videoEffect.rednessLevel=r.rednessLevel,e.videoEffect.rednessLevel<.01&&(e.videoEffect.rednessLevel=.01),o.setRednessLevel(e.videoEffect.rednessLevel)),void 0===r.lighteningContrastLevel){t.next=29;break}if(0===r.lighteningContrastLevel||1===r.lighteningContrastLevel||2===r.lighteningContrastLevel){t.next=27;break}throw new Error("Invalid lighteningContrastLevel: The value should be 0, 1 or 2.");case 27:e.videoEffect.lighteningContrastLevel=parseFloat(r.lighteningContrastLevel),o.setContrastLevel(e.videoEffect.lighteningContrastLevel);case 29:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},restoreVideoEffect:function(e){return e.videoEffect.enableBeauty?e._enableEffect():Promise.resolve()},disableVideoEffect:function(e){return e._releaseEffect?e._releaseEffect():Promise.resolve()},applyEffectInPlayer:function(e){e.videoEffect.enableBeauty&&e.videoEffect.canvas&&e._showEffectInLocalPlayer()},removeEffectFromLocalPlayer:function(e){e._removeEffectFromLocalPlayer()},replaceWithCanvasTrack:function(e){return e.videoEffect.enableBeauty?e._replaceWithCanvasTrack():Promise.resolve()},checkVideoEffectEnabled:function(e){return!!(e.videoEffect.enableBeauty&&e.videoEffect&&e.videoEffect.videoContextInited)&&(h.default.error("Operation not permitted: ".concat("VIDEO_EFFECT_ENABLED")),"VIDEO_EFFECT_ENABLED")}}},function(e,t){function n(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,o){var a=e.apply(t,r);function s(e){n(a,i,o,s,c,"next",e)}function c(e){n(a,i,o,s,c,"throw",e)}s(void 0)}))}}},function(e,t,n){"use strict";var r=n(38),i=Object.prototype.toString;function o(e){return"[object Array]"===i.call(e)}function a(e){return void 0===e}function s(e){return null!==e&&"object"==typeof e}function c(e){return"[object Function]"===i.call(e)}function u(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),o(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:o,isArrayBuffer:function(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isUndefined:a,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:c,isStream:function(e){return s(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]=n}for(var r=0,i=arguments.length;r<i;r++)u(arguments[r],n);return t},deepMerge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]="object"==typeof n?e({},n):n}for(var r=0,i=arguments.length;r<i;r++)u(arguments[r],n);return t},extend:function(e,t,n){return u(t,(function(t,i){e[i]=n&&"function"==typeof t?r(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(7),i=n.n(r),o=n(8),a=n(0),s=n(5);function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=new function(){var e=Object(o.b)();return e.devicesHistory={},e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.deviceStates={ACTIVE:"ACTIVE",INACTIVE:"INACTIVE"},e.deviceReloadTimer=null,e._init=function(t,n){e.state=e.states.INITING,e.devicesHistory={},e._reloadDevicesInfo((function(){e.state=e.states.INITED,e.dispatchEvent({type:"inited"}),t&&t()}),(function(t){a.default.warning("Device Detection functionality cannot start properly."),e.state=e.states.UNINIT,n&&n(t)}))},e._enumerateDevices=function(e,t){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return a.default.warning("enumerateDevices() not supported."),t&&t("enumerateDevices() not supported");navigator.mediaDevices.enumerateDevices().then((function(t){e&&setTimeout((function(){e(t)}),0)})).catch((function(e){t&&t(e)}))},e._reloadDevicesInfo=function(t,n){var r=[];e._enumerateDevices((function(n){var o=Date.now();for(var s in n.forEach((function(t){var n=e.devicesHistory[t.deviceId];if((n?n.state:e.deviceStates.INACTIVE)!=e.deviceStates.ACTIVE){var i=n||{initAt:o};i.device=t,i.state=e.deviceStates.ACTIVE,r.push(i),e.devicesHistory[t.deviceId]=i}e.devicesHistory[t.deviceId].lastReloadAt=o})),e.devicesHistory){var c=e.devicesHistory[s];c&&c.state==e.deviceStates.ACTIVE&&c.lastReloadAt!==o&&(c.state=e.deviceStates.INACTIVE,r.push(c)),c.lastReloadAt=o}e.state==e.states.INITED&&r.forEach((function(t){var n=i()({},t);switch(t.device.kind){case"audioinput":n.type="recordingDeviceChanged";break;case"audiooutput":n.type="playoutDeviceChanged";break;case"videoinput":n.type="cameraChanged";break;default:a.default.warning("Unknown device change",n),n.type="unknownDeviceChanged"}e.dispatchEvent(n)})),t&&t()}),n)},e.getDeviceById=function(t,n,r){e.getDevices((function(e){for(var i=0;i<e.length;i++){var o=e[i];if(o&&o.deviceId===t)return n&&n(o)}return r&&r()}))},e.searchDeviceNameById=function(t){var n=e.devicesHistory[t];return n?n.device.label||n.device.deviceId:null},e.getDevices=function(t,n){e._enumerateDevices(t,(function(e){n&&n(e.name+": "+e.message)}))},e.getVideoCameraIdByLabel=function(t,n,r){e.getCameras((function(e){var i,o=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(e);try{for(o.s();!(i=o.n()).done;){var a=i.value;if(a.label===t)return n&&n(a.deviceId)}}catch(e){o.e(e)}finally{o.f()}return r&&r(s.default.NOT_FIND_DEVICE_BY_LABEL)}),r)},e.getRecordingDevices=function(t,n){return e._enumerateDevices((function(e){var n=e.filter((function(e){return"audioinput"==e.kind}));t&&t(n)}),(function(e){n&&n(e)}))},e.getPlayoutDevices=function(t,n){return e._enumerateDevices((function(e){var n=e.filter((function(e){return"audiooutput"==e.kind}));t&&t(n)}),(function(e){n&&n(e)}))},e.getCameras=function(t,n){return e._enumerateDevices((function(e){var n=e.filter((function(e){return"videoinput"==e.kind}));t&&t(n)}),(function(e){n&&n(e)}))},e._init((function(){navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",(function(){e._reloadDevicesInfo()})),e.deviceReloadTimer=setInterval(e._reloadDevicesInfo,5e3)})),e}},function(e,t,n){"use strict";n.r(t),n.d(t,"_getReconnectCSTimer",(function(){return R})),n.d(t,"_setClientConnectionStateRecord",(function(){return x})),n.d(t,"getGatewayList",(function(){return O})),n.d(t,"getUserAccount",(function(){return M}));var r=n(11),i=n.n(r),o=n(12),a=n.n(o),s=n(17),c=n.n(s),u=n(2),l=(n(4),n(0)),d=n(14),h=n(1),f=n(5),p=function(e,t){var n=!1,r=0,i=Object(u.getParameter)("PROXY_CS"),o=Object(u.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),a=0,s={command:"convergeAllocateEdge",sid:e.sid,appId:e.appId,token:e.token,uid:e.uid,cname:e.cname,ts:Math.floor(Date.now()/1e3),version:u.VERSION,seq:0,requestId:1},c=function(c){var u=(new Date).getTime();m("https://"+c+"/api/v1",s,(function(s,f){if(s)return l.default.debug("["+e.clientId+"] Request proxy server failed: ",s),r++,h.report.requestProxyAppCenter(e.sid,{lts:u,succ:!1,APAddr:c,workerManagerList:null,ec:JSON.stringify(s),response:JSON.stringify({err:s,res:f})}),r>=i.length&&t&&t("Get proxy server failed: request all failed"),void(!(r%o)&&r<i.length&&(a++,d()));if(!n)if((f=JSON.parse(f)).json_body){var p=JSON.parse(f.json_body);if(l.default.debug("["+e.clientId+"] App return:",p.servers),200!==p.code)s="Get proxy server failed: response code ["+p.code+"], reason [ "+p.reason+"]",r++,l.default.debug("["+e.clientId+"] "+s),h.report.requestProxyAppCenter(e.sid,{lts:u,succ:!1,APAddr:c,workerManagerList:null,ec:s,response:JSON.stringify({err:s,res:f})}),r>=i.length&&t&&t(s),!(r%o)&&r<i.length&&(a++,d());else{n=!0;var m=v(p.servers);h.report.requestProxyAppCenter(e.sid,{lts:u,succ:!0,APAddr:c,workerManagerList:JSON.stringify(m),ec:null,response:JSON.stringify({res:f})}),t&&t(null,m)}}else l.default.debug("["+e.clientId+"] Get proxy server failed: no json_body"),h.report.requestProxyAppCenter(e.sid,{lts:u,succ:!1,APAddr:c,workerManagerList:null,ec:"Get proxy server failed: no json_body",response:JSON.stringify({res:f})})}))},d=function(){for(var e=a*o,t=e;t<Math.min(i.length,e+o);t++){var n=i[t];c(n)}};d()},m=function(e,t,n){var r={service_name:"webrtc_proxy",json_body:JSON.stringify(t)};Object(d.post)(e,r,(function(e){n&&n(null,e)}),(function(e){n&&n(e)}),{"X-Packet-Service-Type":0,"X-Packet-URI":61})},g=function(e,t,n){var r=!1,i=0,o={command:"request",gatewayType:"http",appId:e.appId,cname:e.cname,uid:e.uid+"",sdkVersion:"2.3.1",sid:e.sid,seq:1,ts:+new Date,requestId:3,clientRequest:{appId:e.appId,cname:e.cname,uid:e.uid+"",sid:e.sid}};t.map((function(a){var s=(new Date).getTime();!function(e,t,n){Object(d.post)(e,t,(function(e){n&&n(null,e)}),(function(e){n&&n(e)}))}("https://"+a+":4000/v2/machine",o,(function(o,c){if(o)return l.default.debug("["+e.clientId+"] Request worker manager failed: ",o),i++,h.report.requestProxyWorkerManager(e.sid,{lts:s,succ:!1,workerManagerAddr:a,ec:JSON.stringify(o),response:JSON.stringify({res:c})}),void(i>=t.length&&n&&n("requeet worker manager server failed: request failed"));if(!r){if(!(c=JSON.parse(c)).serverResponse)return n&&n("requeet worker manager server failed: serverResponse is undefined");r=!0,h.report.requestProxyWorkerManager(e.sid,{lts:s,succ:!0,workerManagerAddr:a,ec:JSON.stringify(o),response:JSON.stringify({res:c})}),n&&n(null,{address:a,serverResponse:c.serverResponse})}}))}))},v=function(e){if(!e||[]instanceof Array==0)return[];var t=[];return e.forEach((function(e){var n;e.address&&e.tcp?(e.address.match(/^[\.\:\d]+$/)?n="".concat(e.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(l.default.info("["+joinInfo.clientId+"] "+"Cannot recognized as IP address ".concat(e.address,". Used As Host instead")),n="".concat(e.address,":").concat(e.tcp)),t.push(n)):l.default.error("["+joinInfo.clientId+"] Invalid address format ",e)})),t},y=n(21),b=function(e,t,n,r){var i=Object(u.getParameter)("WEBCS_DOMAIN").concat(Object(u.getParameter)("WEBCS_DOMAIN_BACKUP_LIST")),o=Object(u.getParameter)("PROXY_SERVER_TYPE3");i=i.map((function(e,t){return"".concat(o[(t+1)%o.length],"/ap/?url=").concat(e)}));var a,s=0,c=!0,p=Object(u.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),m=0,g=function(g){!function(e,t,n,r,i){var o=Date.now(),a=function(e,r){try{h.report.joinChooseServer2(n.sid,{lts:o,succ:!e,csAddr:t,serverList:r&&r.gateway_addr,cid:r&&r.cid+"",uid:r&&r.uid+"",ec:e,chooseServerIp:r&&r.detail&&r.detail[502]})}catch(e){}},s=function(r,i){var a=Date.now();try{h.report.joinWebProxyAP({lts:a,sid:n.sid,cname:n.cname,cid:n.cid,uid:n.uid,sucess:r?-1:1,elapse:a-o,eventType:e,apServerAddr:t,turnServerAddrList:JSON.stringify(i),errorCode:r||"0"})}catch(e){}},c=Object(u.getParameter)("AREA_SETTING").reduce((function(e,t,n){var r=Object(y.getAreaCodeByArea)(t);return r?0===n?r:"".concat(e,",").concat(r):e}),""),p={appid:n.token,client_ts:Date.now(),opid:133,sid:n.sid,request_bodies:[{uri:22,buffer:{cname:n.cname,detail:{11:c,6:n.stringUid},key:n.token,service_ids:[11,i?20:18],uid:n.uid||0}}]};t="https://".concat(t,"/api/v2/transpond/webrtc?v=2"),Object(d.postFormData)(t,p,(function(e){var o=function(e){return new RegExp(/10102\d{2}$/).test(e)?"NO_SERVICE_AVAILABLE":f.APErrorCode[e]||e};try{var c,d,h=JSON.parse(e);if(30===(h=h.response_body)[0].uri&&0!==h[0].buffer.code){var p=o(h[0].buffer.code);return s(p,h),r(p)}if(4096===h[0].buffer.flag?(d=h[0].buffer,c=h[1].buffer):(d=h[1].buffer,c=h[0].buffer),0!==c.code)return p=o(c.code),l.default.error("[".concat(n.clientId,"] requestProxyServer failed: ").concat(p)),s(p,c),r(p);if(!c.edges_services||!c.edges_services instanceof Array)return s("UNEXPECTED_ERROR",c),r("UNEXPECTED_ERROR");var m=Object(u.getParameter)("GATEWAY_DOMAINS"),g=0;if(t.indexOf(m[1])>-1&&(g=1),0===c.edges_services.length)return s("EMPTY_PROXY_LIST",c),r("EMPTY_PROXY_LIST");var v=c.edges_services.map((function(e){if(e.ip)return e.ip=i?"".concat(e.ip.replace(/[^\d]/g,"-"),".").concat(m[g++%m.length]):"".concat(e.ip),e}));if(s(null,v),0!==d.code)return p=o(d.code),l.default.error("[".concat(n.clientId,"] requestChooseServer failed: ").concat(p)),a(p),r(p);var y=[];if(m=Object(u.getParameter)("GATEWAY_DOMAINS"),g=0,t.indexOf(m[1])>-1&&(g=1),d.edges_services.forEach((function(e){var r;if(e.ip&&e.port){if(!e.ip.match(/^[\.\:\d]+$/))return l.default.info("["+n.clientId+"] "+"Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),void a("UNEXPECTED_IP");r="".concat(e.ip.replace(/[^\d]/g,"-"),".").concat(m[g++%m.length]);var i=Object(u.getParameter)("PROXY_SERVER_TYPE3");r=/sd-rtn/.test(t)?"".concat(i[0],"/ws/?h=").concat(r,"&p=").concat(e.port):"".concat(i[1],"/ws/?h=").concat(r,"&p=").concat(e.port),y.push(r)}else l.default.error("["+n.clientId+"] Invalid address format ",e)})),!y.length)return l.default.error("["+n.clientId+"] Empty Address response",h),a("EMPTY_ADDRESS_RESPONSE"),r("EMPTY_ADDRESS_RESPONSE");d.ticket=d.cert;var b={gateway_addr:y,uid:d.uid,cid:d.cid,vid:d.detail&&d.detail[8],res:d,detail:h.detail};a(null,b),r(null,{gatewayServers:b,turnServers:v})}catch(e){return l.default.error("[".concat(n.clientId,"] requestProxyServer failed with unexpected body "),e),s("UNEXPECTED_ERROR"),r("UNEXPECTED_ERROR")}}),(function(e,t){"timeout"===e.type?(s("REQUEST_PROXY_SERVER_TIME_OUT"),r("REQUEST_PROXY_SERVER_TIME_OUT")):(s("REQUEST_PROXY_SERVER_FAILED"),r("REQUEST_PROXY_SERVER_FAILED"))}))}(e,g,t,(function(e,r){e?(s++,l.default.error("[".concat(t.clientId,"] request ").concat(g," failed: ").concat(e)),e&&-1===f.JOIN_PROXY_RETRY_LIST.indexOf(e)&&(a=e),s===i.length&&(a||(a="RETRYABLE_ERROR"),n(a)),!(s%p)&&s<i.length&&(m++,v())):c&&(/sd-rtn/.test(r.gatewayServers.gateway_addr[0])?Object(u.setParameter)("NGINX",o[0]):Object(u.setParameter)("NGINX",o[1]),c=!1,n(null,r))}),r)},v=function(){for(var e=m*p,t=e;t<Math.min(i.length,e+p);t++){var n=i[t];g(n)}};v()},_=n(13),E=n(29),S=n.n(E),w=n(30),T={},A={},R=function(e){return T[e]},x=function(e,t){A[e]=t},I=function(e,t,n,r,i,o){var a=(new Date).getTime(),s=t,c="";t.multiIP&&t.multiIP.gateway_ip&&(c={vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]});var p=Object(u.getParameter)("AREA_SETTING").reduce((function(e,t,n){var r=Object(y.getAreaCodeByArea)(t);return r?0===n?r:"".concat(e,",").concat(r):e}),""),m={appid:t.token,opid:133,client_ts:+new Date,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:{5:c?JSON.stringify(c):void 0,6:t.stringUid,11:p},key:t.token,service_ids:[11],uid:t.uid||0}}]};Object(d.postFormData)(e,m,(function(i){try{var c=JSON.parse(i),d=(c=c.response_body[0].buffer).code}catch(e){var p="requestChooseServer failed with unexpected body "+i;return l.default.error("["+s.clientId+"]",p),r(p,void 0,void 0,o)}if(d)return y=new RegExp(/10102\d{2}$/).test(d)?"NO_SERVICE_AVAILABLE":f.APErrorCode[c.code]||d,h.report.joinChooseServer(t.sid,{lts:a,succ:!1,csAddr:e,serverList:null,ec:y,chooseServerIp:c&&c.detail&&c.detail[502]}),r("Get server node failed ["+y+"]",e,y,o);var m=[],g=Object(u.getParameter)("GATEWAY_DOMAINS"),v=0;if(e.indexOf(g[1])>-1&&(v=1),c.edges_services.forEach((function(e){var t;e.ip&&e.port?(e.ip.match(/^[\.\:\d]+$/)?t="".concat(e.ip.replace(/[^\d]/g,"-"),".").concat(g[v++%g.length],":").concat(e.port):(l.default.info("["+s.clientId+"] "+"Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),t="".concat(e.ip,":").concat(e.port)),m.push(t)):l.default.error("["+s.clientId+"] Invalid address format ",e)})),!m.length){l.default.error("["+s.clientId+"] Empty Address response",c);var y="EMPTY_ADDRESS_RESPONSE";return h.report.joinChooseServer(t.sid,{lts:a,succ:!1,csAddr:e,serverList:null,ec:y,chooseServerIp:c&&c.detail&&c.detail[502]}),r("Get server node failed ["+y+"]",e,y,o)}c.ticket=c.cert;var b={gateway_addr:m,uid:c.uid,cid:c.cid,vid:c.detail&&c.detail[8],res:c,uni_lbs_ip:c.detail};return n(b,e)}),(function(e,n){"timeout"===e.type?(h.report.joinChooseServer(t.sid,{lts:a,succ:!1,csAddr:n,serverList:null,ec:"timeout"}),r("Connect choose server timeout",n,void 0,o)):(h.report.joinChooseServer(t.sid,{lts:a,succ:!1,csAddr:n,serverList:null,ec:e.httpErrorCode||"server_wrong"}),r("Connect choose server error",n,void 0,o))}))},O=function(e,t,n){var r=!1,i=null,o=1,a=1,s=e.clientId,c=function t(a,c){if(!r){var d=[];!function(e,t,n){var r,i=(new Date).getTime(),o=!1,a=0,s=0,c=Object(u.getParameter)("WEBCS_DOMAIN"),d=c.length,p=Object(u.getParameter)("WEBCS_DOMAIN_BACKUP_LIST"),m=p.length,g=Object(u.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),v=0,b=0,_=function(n,r){var a;try{a=n.res.detail[8]}catch(t){l.default.debug("["+e.clientId+"] get vid failed",t)}if(o)h.report.joinChooseServer(e.sid,{lts:i,succ:!0,csAddr:r,serverList:n.gateway_addr,cid:n.cid+"",uid:n.uid+"",ec:null,vid:a,chooseServerIp:n.res&&n.res.detail&&n.res.detail[502]},!1);else{if(clearTimeout(T),o=!0,e.proxyServer)for(var s=n.gateway_addr,c=0;c<s.length;c++){var u=s[c].split(":");n.gateway_addr[c]=e.proxyServer+"/ws/?h="+u[0]+"&p="+u[1]}t(n),h.report.joinChooseServer(e.sid,{lts:i,succ:!0,csAddr:r,serverList:n.gateway_addr,cid:n.cid+"",uid:n.uid+"",ec:null,vid:a,chooseServerIp:n.res&&n.res.detail&&n.res.detail[502]},!0)}},E=function(t,i,o,c){"domain"===c&&a++,"backup"===c&&s++,l.default.error("["+e.clientId+"]",t,i,o),o&&-1===f.JOIN_CS_RETRY_LIST.indexOf(o)&&(r=o),a===d&&s===m&&n(r),"domain"===c&&!(a%g)&&a<d&&(v++,S()),"backup"===c&&!(s%g)&&s<m&&(b++,w())},S=function t(){for(var n=v*g,r=n;r<Math.min(d,n+g);++r){var i;if("string"==typeof c[r]){var o=c[r];i=e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v2/transpond/webrtc?v=2"):"https://".concat(o,"/api/v2/transpond/webrtc?v=2");var s=Object(y.getAreaCodeByWebCS)(o);l.default.debug("["+e.clientId+"] "+"Connect to choose_server: ".concat(i,", ").concat(s)),I(i,e,_,E,0,"domain")}else a++,l.default.error("["+e.clientId+"] Invalid Host",c[r]),r===n+g-1&&r<d-1-1&&(v++,t())}};S();var w=function t(){if(!o)for(var n=b*g,r=n;r<Math.min(m,n+g);r++){var i;if("string"==typeof p[r]){var a=p[r];i=e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(a+"/api/v2/transpond/webrtc?v=2"):"https://".concat(a,"/api/v2/transpond/webrtc?v=2");var c=Object(y.getAreaCodeByWebCS)(a);l.default.debug("["+e.clientId+"] "+"Connect to backup_choose_server: ".concat(i,", ").concat(c)),I(i,e,_,E,0,"backup")}else s++,l.default.error("["+e.clientId+"] Invalid Host",p[r]),r===n+g-1&&r<p-1-1&&(v++,t())}},T=setTimeout(w,1e3)}(e,(function(t){r=!0,d=t,clearTimeout(i),A[s]!==_.a.DISCONNECTED&&A[s]!==_.a.DISCONNECTING?c&&c(d,null):l.default.debug("[".concat(e.clientId,"] Request gateway list success when connection state is ").concat(A[s]))}),(function(r){if(r)return l.default.info("["+e.clientId+"] Join failed: "+r),void(n&&n(r));if(A[s]===_.a.DISCONNECTED||A[s]===_.a.DISCONNECTING)return l.default.debug("[".concat(e.clientId,"] Request gateway list falied when connection state is ").concat(A[s])),void(n&&n("OPERATION_ABORT"));l.default.debug("["+e.clientId+"] Request gateway list will be restart in "+o+"s"),i=setTimeout((function(){t(a,c)}),1e3*o),T[s]=i;var d=Object(u.getParameter)("AP_BACKOFF_MAX_TIME");o=o>=d?d:2*o}))}},d=function n(){!function(e,t){p(e,(function(n,r){if(n)return t&&t(n);l.default.debug("["+e.clientId+"] getProxyServerList: ",r),g(e,r,t)}))}(e,(function(r,o){if(r){l.default.debug("["+e.clientId+"]",r),l.default.debug("["+e.clientId+"] Request proxy will be restart in "+a+"s"),i=setTimeout((function(){n()}),1e3*a),T[s]=i;var d=Object(u.getParameter)("AP_BACKOFF_MAX_TIME");a=a>=d?d:2*a}else{clearTimeout(i);var f=o.address;e.proxyServer=f;var p={mode:"manual",url:o.address,tcpport:o.serverResponse.tcpport||"3433",udpport:o.serverResponse.udpport||"3478",username:o.serverResponse.username||"test",credential:o.serverResponse.password||Object(u.getParameter)("TURN_SERVER_PASSWORD"),forceturn:!0};p.tcpport+="",p.udpport+="",e.turnServers=[],e.turnServers.push(p),h.report.setProxyServer(f),l.default.setProxyServer(f),c(f,t)}}))};e.useProxyServer?1==e.proxyServerType?d():2==e.proxyServerType?function n(){!function(e,t){p(e,(function(n,r){return n?t&&t(n):(l.default.debug("["+e.clientId+"] getProxyServerList: ",r),t&&t(null,{address:r[0],serverResponse:{tcpport:"443",udpport:"3478",username:"test",password:"111111"}}))}))}(e,(function(r,o){if(r)return l.default.debug("["+e.clientId+"]",r),l.default.debug("["+e.clientId+"] Request proxy will be restart in "+a+"s"),i=setTimeout((function(){n()}),1e3*a),T[s]=i,void(a=a>=3600?3600:2*a);clearTimeout(i);var d=Object(u.getParameter)("PROXY_SERVER_TYPE2");e.proxyServer=d;var f={mode:"manual",url:o.address,tcpport:o.serverResponse.tcpport||"3433",udpport:o.serverResponse.udpport||"3478",username:o.serverResponse.username||"test",credential:o.serverResponse.password||"111111",forceturn:!0};f.tcpport+="",f.udpport+="",e.turnServers=[],e.turnServers.push(f),h.report.setProxyServer(d),l.default.setProxyServer(d),c(d,t)}))}():3==e.proxyServerType?function r(){b("proxy3",e,(function(o,c){if(o)return"RETRYABLE_ERROR"!==o?n&&n(o):(l.default.debug("["+e.clientId+"]",o),l.default.debug("["+e.clientId+"] Request proxy will be restart in "+a+"s"),i=setTimeout((function(){r()}),1e3*a),T[s]=i,void(a=a>=3600?3600:2*a));var d=c.gatewayServers,f=c.turnServers;clearTimeout(i);var p=Object(u.getParameter)("NGINX");e.proxyServer=p,e.turnServers=[];var m=Object(w.randomString)();f.map((function(t){var n={mode:"manual",url:t.ip,tcpport:"",udpport:t.port||"3478",username:t.username||m,credential:t.password||S()(m).toString(),forceturn:!0};n.tcpport+="",n.udpport+="",e.turnServers.push(n)})),h.report.setProxyServer(p),l.default.setProxyServer(p),t(d)}))}():4==e.proxyServerType?function r(){b("proxy4",e,(function(o,c){if(o)return"RETRYABLE_ERROR"!==o?n&&n(o):(l.default.debug("["+e.clientId+"]",o),l.default.debug("["+e.clientId+"] Request proxy will be restart in "+a+"s"),i=setTimeout((function(){r()}),1e3*a),T[s]=i,void(a=a>=3600?3600:2*a));var d=c.gatewayServers,f=c.turnServers;clearTimeout(i);var p=Object(u.getParameter)("NGINX");e.proxyServer=p,e.turnServers=[];var m=Object(w.randomString)();f.map((function(t){var n={mode:"manual",url:t.ip,tcpport:t.port||"443",udpport:"",username:t.username||m,credential:t.password||S()(m).toString(),forceturn:!1};n.tcpport+="",n.udpport+="",e.turnServers.push(n)})),h.report.setProxyServer(p),l.default.setProxyServer(p),t(d)}))}():5==e.proxyServerType?function r(){b("proxy5",e,(function(o,c){if(o)return"RETRYABLE_ERROR"!==o?n&&n(o):(l.default.debug("["+e.clientId+"]",o),l.default.debug("["+e.clientId+"] Request proxy will be restart in "+a+"s"),i=setTimeout((function(){r()}),1e3*a),T[s]=i,void(a=a>=3600?3600:2*a));var d=c.gatewayServers,f=c.turnServers;clearTimeout(i);var p=Object(u.getParameter)("NGINX");e.proxyServer=p,e.turnServers=[];var m=Object(w.randomString)();f.map((function(t){var n={mode:"manual",url:t.ip,tcpport:t.port||"443",udpport:"",username:t.username||m,credential:t.password||S()(m).toString(),forceturn:!1,useTurns:!0};n.tcpport+="",n.udpport+="",e.turnServers.push(n)})),h.report.setProxyServer(p),l.default.setProxyServer(p),t(d)}),!0)}():d():c(null,t)},C=function(e,t,n,r,i){var o=Date.now();r=r||t.stringUid;var a={sid:t.sid,opid:10,appid:t.appId,string_uid:r};return new Promise((function(i,s){Object(d.post)(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),a,(function(c){try{var u=JSON.parse(c),d=u.code}catch(i){var p="requestUserAccount failed with unexpected body "+c;return l.default.error("["+t.clientId+"]",p),s({retryable:!0,info:p,url:e,error:"UNEXPECTED_ERROR"}),n&&n.dispatchEvent({type:"error",reason:"USER_ACCOUNT_BODY_NOT_JSON"}),void h.report.reqUserAccount(a.sid,{lts:o,success:!1,serverAddress:e,stringUid:r,uid:null,extend:c,errorCode:"USER_ACCOUNT_BODY_NOT_JSON"})}if(d){var m=!1;return"INTERNAL_SERVER_ERROR"===(v=f.StringUidErrorCode[u.code%1e4]||"REQ_ACCOUNT_ERR_".concat(d))&&(m=!0),n&&n.dispatchEvent({type:"error",reason:v}),h.report.reqUserAccount(a.sid,{lts:o,success:!1,serverAddress:e,stringUid:r,uid:null,errorCode:v,extend:a}),s({retryable:m,info:p="Get String Uid Failed ["+v+"]",url:e,error:v})}var g=u.uid;if(!(g>0&&g<Math.pow(2,32))){l.default.error("["+t.clientId+"] "+"Invalid Uint Uid ".concat(r," => ").concat(g),u);var v="INVALID_UINT_UID_".concat(g);return n&&n.dispatchEvent({type:"error",reason:v}),h.report.reqUserAccount(a.sid,{lts:o,success:!1,serverAddress:e,stringUid:r,uid:null,errorCode:v,extend:a}),s({retryable:!0,error:v,info:"Get String Uid failed ["+v+"]",url:e})}i({uid:g,url:e}),h.report.reqUserAccount(a.sid,{lts:o,success:!0,serverAddress:e,stringUid:r,uid:g,errorCode:null,extend:a})}),(function(e,t){if("timeout"===e.type){var i="USER_ACCOUNT_TIMEOUT";n&&n.dispatchEvent({type:"error",reason:i}),h.report.reqUserAccount(a.sid,{lts:o,success:!1,serverAddress:t,stringUid:r,uid:null,errorCode:i,extend:a}),s({retryable:!0,info:i,url:t,error:i})}else{var c="USER_ACCOUNT_SERVER_WRONG_".concat(e.type);n&&n.dispatchEvent({type:"error",reason:c}),h.report.reqUserAccount(a.sid,{lts:o,success:!1,serverAddress:t,stringUid:r,uid:null,errorCode:c,extend:a}),s({retryable:!0,info:c,url:t,error:c})}}),{"X-Packet-Service-Type":0,"X-Packet-URI":72})}))},M=function(e,t,n){Date.now();var r,o=Object(u.getParameter)("ACCOUNT_REGISTER"),s=!1,d=Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT"),h=null,f=null,p=new Promise(function(){var p=c()(a.a.mark((function c(p,m){var g,v,y;return a.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:h=p,f=m,r=0;case 3:if(!(r<Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_COUNT_MAX"))){c.next=33;break}if(!s){c.next=6;break}return c.abrupt("return");case 6:return g=o[r%o.length],v=e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1"),c.prev=8,c.delegateYield(a.a.mark((function r(){var i;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.proxyServer,r.next=3,C(v,e,t,n);case 3:if(i=r.sent,!s){r.next=6;break}return r.abrupt("return",{v:void 0});case 6:s=!0,setTimeout((function(){l.default.debug("Get UserAccount Successfully",i),h(i)}),0);case 8:case"end":return r.stop()}}),r)}))(),"t0",10);case 10:if(y=c.t0,"object"!==i()(y)){c.next=13;break}return c.abrupt("return",y.v);case 13:c.next=30;break;case 15:if(c.prev=15,c.t1=c.catch(8),!s){c.next=19;break}return c.abrupt("return");case 19:if(!c.t1.retryable){c.next=27;break}return(d=Math.ceil(d*Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_RATIO")))>Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")&&(d=Object(u.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")),l.default.error("".concat(c.t1.info," ").concat(c.t1.url," Will Fetch User Account in ").concat(d/1e3," seconds")),c.next=25,new Promise((function(e){setTimeout(e,d)}));case 25:c.next=30;break;case 27:l.default.error("Get UserAccount Error: ".concat(c.t1.info," ").concat(c.t1.url),c.t1.error),s=!0,f(c.t1.error);case 30:r++,c.next=3;break;case 33:case"end":return c.stop()}}),c,null,[[8,15]])})));return function(e,t){return p.apply(this,arguments)}}());return p.cancel=function(){s||(s=!0,f({info:"Request Cancelled",retryable:!1}))},p.isFinished=function(){return s},p}},function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o,a,s=i(n(0));!function(e){e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(o||(o={})),t.AREAS=o,function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(a||(a={}));var c={ASIA:{CODE:a.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:a.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:a.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:a.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:a.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:a.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],NGINX:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:a.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],NGINX:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:a.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:a.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:a.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};t.AREA_DOMAIN_MAP=c;var u={GLOBAL:{ASIA:[o.CHINA,o.JAPAN,o.INDIA],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},l=Object.keys(u[o.GLOBAL]),d=[o.CHINA,o.NORTH_AMERICA,o.EUROPE,o.ASIA,o.JAPAN,o.INDIA,o.OCEANIA,o.SOUTH_AMERICA,o.AFRICA];t.getAreaCodeByConfig=function(e){var t=e.areaCode,n=e.excludedArea;return n?function(e,t){var n,i=[];if("string"==typeof e&&(e=[e]),t&&!e.includes(o.GLOBAL)&&(i=e),t||(i=e),t&&e.includes(o.GLOBAL)){var a=[o.GLOBAL,o.OVERSEA],s=Object.keys(c);if(t===o.GLOBAL)throw new Error("Can not set excludedArea to 'GLOBAL'");if(t===o.CHINA)i=[o.OVERSEA];else if(n=t,l.includes(n)){var h=function(e){return void 0===e&&(e=""),u[o.GLOBAL][e]||[]}(t),f=r(a,[t],h);i=s.filter((function(e){return!f.includes(e)}))}else if(function(e){var t=!1;return l.forEach((function(n){u.GLOBAL[n].includes(e)&&(t=!0)})),t}(t)){var p=function(e){void 0===e&&(e="");var t="";return l.forEach((function(n){u.GLOBAL[n].includes(e)&&(t=n)})),t}(t),m=r(a,[p,t]);i=s.filter((function(e){return!m.includes(e)}))}else i=e;i=function(e){var t=[];return d.forEach((function(n){e.includes(n)&&t.push(n)})),t.concat(e.filter((function(e){return!d.includes(e)})))}(i)}return i}(t,n):t},c.CHINA={CODE:a.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]},t.getAreaCodeByWebCS=function(e){for(var t=Object.keys(c),n=0;n<t.length;n++){var r=t[n],i=c[r];if(i.WEBCS_DOMAIN.includes(e)||i.WEBCS_DOMAIN_BACKUP_LIST.includes(e))return i.CODE===a.OVERSEA?a.ASIA+","+a.EUROPE+","+a.AFRICA+","+a.NORTH_AMERICA+","+a.SOUTH_AMERICA+","+a.OCEANIA:i.CODE}},t.getAreaCodeByArea=function(e){return e===o.OVERSEA?a.ASIA+","+a.EUROPE+","+a.AFRICA+","+a.NORTH_AMERICA+","+a.SOUTH_AMERICA+","+a.OCEANIA:a[e]},t.getAreaDomainConfig=function(e){var t={WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],NGINX:[]};return e.map((function(e){var n=c[e];if(n){var r=Object.keys(n);r?r.map((function(e){"CODE"!==e&&(t[e]=t[e].concat(n[e]))})):s.default.info(e+" is not exist")}else s.default.info(e+" is not exist")})),t}},function(e,t,n){"use strict";n.d(t,"a",(function(){return x})),n.d(t,"b",(function(){return I}));var r=n(7),i=n.n(r),o=n(4),a=n(8),s=function(e){var t=Object(a.b)(e);return t.url=".",t},c=n(0),u=n(15),l=n(5),d=n(2),h=n(1),f=0,p=function(e){var t=s({});t.id=e.id,t.playerId=f++,t.destroyed=!1,t.fit=e.options&&e.options.fit,"contain"!==t.fit&&"cover"!==t.fit&&(t.fit=null),t.url=e.url,t.stream=e.stream.stream,t.peerVideoReady=!1,t.isFreeze=!1,t.freezeTimeCounterList=[],t.freezeCount=0,t.lastFreezeCount=0,t.lastTimeupdateTime=0,t.elementID=e.elementID,t.setAudioOutput=function(e,n,r){var i=t.video||t.audio;return i?i.setSinkId?void i.setSinkId(e).then((function(){return c.default.debug("["+t.id+"] "+"video ".concat(t.id," setAudioOutput ").concat(e," SUCCESS")),i==t.video&&t.audio?t.audio.setSinkId(e):Promise.resolve()})).then((function(){return c.default.debug("["+t.id+"] "+"audio ".concat(t.id," setAudioOutput ").concat(e," SUCCESS")),n&&n()})).catch((function(e){return c.default.error("["+t.id+"] VideoPlayer.setAudioOutput",e),r&&r(e)})):(c.default.error("["+t.id+"] ",l.default.WEB_API_NOT_SUPPORTED),r&&r(l.default.WEB_API_NOT_SUPPORTED)):(c.default.error("["+t.id+"] ",l.default.PLAYER_NOT_FOUND),r&&r(l.default.PLAYER_NOT_FOUND))},t.destroy=function(){c.default.debug("[".concat(t.id,"] destroy ").concat(e.stream.local?"local":"remote"," Player ").concat(t.id)),Object(u.setSrcObject)(t.video,null),Object(u.setSrcObject)(t.audio,null),t.video.load(),t.audio.load(),t.video.pause(),t.video.remove(),t.audio.remove(),t.freezeCheckInterval&&clearInterval(t.freezeCheckInterval),t.destroyed=!0,delete t.resizer,document.getElementById(t.div.id)&&t.parentNode.contains(t.div)&&t.div.remove()&&t.parentNode.removeChild(t.div),["video","audio"].forEach((function(n){t[n];var r=a[n];clearTimeout(r.playDeferTimeout),r.formerMediaState=null;var i={playerId:t.playerId,stateId:r.stateId+1,playDeferTimeout:null,error:!1,status:"aborted",reason:"stop",updatedAt:Date.now()};a[n]=i;var o={type:"player-status-change",playerId:t.playerId,mediaType:n,status:i.status,reason:i.reason,isErrorState:!1,streamId:t.id};c.default.debug("[".concat(t.id,"] Media Player Status Change Triggered by destroy()"),o),e.stream.dispatchEvent(o),h.report.reportApiInvoke(e.stream.sid,{name:"Stream.playerStatusChange",options:o,tag:"tracer"})()}))},t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),e.stream.video?t.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"):t.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),t.video=document.createElement("video"),t.video.setAttribute("id","video"+t.id),e.stream.local&&!e.stream.screen?e.stream.mirror?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; transform: rotateY(180deg); object-fit: ".concat(t.fit||"cover",";")):t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"cover",";")):e.stream.video?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"cover",";")):e.stream.screen?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"contain")):t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; display: none; object-fit: ".concat(t.fit||"cover"));var n={autoplay:!0,muted:!!e.stream.local||!(!o.isSafari()&&"iOS"!==o.getBrowserOS())&&"video_element_muted",playsinline:!0,controls:!1,volume:null},r=i()({},n,e.options);!0!==r.muted||r.volume||(r.volume=0),t.video.setAttribute("autoplay",""),t.video.setAttribute("muted",""),t.video.muted=!0,t.video.autoplay=!0,r.playsinline&&t.video.setAttribute("playsinline",""),r.controls&&t.video.setAttribute("controls",""),r.contains&&(t.video.controls=!0),Number.isFinite(r.volume)&&(t.video.volume=r.volume),t.audio=document.createElement("audio"),t.audio.setAttribute("id","audio"+t.id),!0===r.muted&&t.audio.setAttribute("muted",""),!0===r.muted&&(t.audio.muted=!0),r.playsinline&&t.audio.setAttribute("playsinline",""),Number.isFinite(r.volume)&&(t.audio.volume=r.volume),void 0!==t.elementID?(document.getElementById(t.elementID).appendChild(t.div),t.container=document.getElementById(t.elementID)):(document.body.appendChild(t.div),t.container=document.body),t.parentNode=t.div.parentNode;var a={video:{playerId:t.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()},audio:{playerId:t.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()}};t.mediaElemExists=function(e){for(var t=e,n=0;n<Object(d.getParameter)("MEDIA_ELEMENT_EXISTS_DEPTH")&&t;n++)t=t.parentNode;return!!t};var p=function(e){return t.mediaElemExists(e)?e.paused?"paused":"play":"aborted"},m=function(e,t,n){var r=p(e),i=!0;return"paused"===r?("audio"===t&&!0===n.muted&&(i=!1),n.autoplay||(i=!1)):"play"===r?"video"===t?i=!1:!0===n.muted?e.muted&&(i=!1):e.muted||(i=!1):"aborted"===r&&(i=!1),i},g=function(n){var i,o=this;if(o===t.video?i="video":o===t.audio&&(i="audio"),i){if(n.type||c.default.error("[".concat(t.id,"] Unexpected evt"),n),"video"===i&&o.muted&&o.paused)return c.default.debug("[".concat(t.id,"] auto resume video element")),void o.play();var s=p(o);clearTimeout(a[i].playDeferTimeout),a[i].playDeferTimeout=setTimeout((function(){a[i].playDeferTimeout=null;var u=a[i],l=p(o);if(s===l){var d={playerId:t.playerId,stateId:u.stateId+1,playDeferTimeout:null,error:m(o,i,r),status:p(o),reason:n.type,updatedAt:Date.now()};if(u.status!==d.status){a[i]=d;var f={type:"player-status-change",playerId:t.playerId,mediaType:i,status:d.status,reason:d.reason,isErrorState:d.error,streamId:t.id};c.default.debug("[".concat(t.id,"] Media Player Status Change"),f),e.stream.dispatchEvent(f),h.report.reportApiInvoke(e.stream.sid,{name:"Stream.playerStatusChange",options:f,tag:"tracer"})()}}else c.default.debug("[".concat(t.id,"] Status Change after event Triggered.")+"Stream ".concat(t.id," PlayerId ").concat(t.playerId," mediaType ").concat(i," Status ").concat(s,"=>").concat(l))}),Object(d.getParameter)("PLAYER_STATE_DEFER"))}else c.default.error("[".concat(t.id,"] Unknown media element"),o)};t.video.addEventListener("playing",(function(e){!function e(){t.video.videoWidth*t.video.videoHeight>4?c.default.debug("["+t.id+"] video dimensions:",t.video.videoWidth,t.video.videoHeight):setTimeout(e,50)}()}));var v=0,y=0,b=0;t.freezeCheckInterval=setInterval((function(){Date.now()-t.lastTimeupdateTime>500&&t.peerVideoReady?(t.isFreeze=!0,t.freezeCount+=1):t.isFreeze=!1}),500),t.video.addEventListener("playing",g),t.video.addEventListener("canplay",g),t.video.addEventListener("abort",g),t.video.addEventListener("onerror",g),t.video.addEventListener("suspend",g),t.video.addEventListener("stalled",g),t.video.addEventListener("pause",g),t.audio.addEventListener("playing",g),t.audio.addEventListener("canplay",g),t.audio.addEventListener("abort",g),t.audio.addEventListener("onerror",g),t.audio.addEventListener("suspend",g),t.audio.addEventListener("stalled",g),t.audio.addEventListener("pause",g);var _=t.audio,E="audio";if(e.stream.hasVideo()||e.stream.hasScreen())t.div.appendChild(t.video),t.div.appendChild(t.audio),o.isEdge()?t.video.srcObject=e.stream.stream:(Object(u.attachMediaStream)(t.video,e.stream.stream),Object(u.attachMediaStream)(t.audio,e.stream.stream)),t.video.addEventListener("timeupdate",(function(){var e=Date.now();if((v+=1)<10)t.lastTimeupdateTime=e;else for(e-t.lastTimeupdateTime>500&&(t.peerVideoReady?y+=e-t.lastTimeupdateTime:t.peerVideoReady=!0),b+=e-t.lastTimeupdateTime,t.lastTimeupdateTime=e;b>=6e3;)b-=6e3,t.freezeTimeCounterList.push(Math.min(6e3,y)),y-=6e3,y=Math.max(y,0)}));else{!1!==r.muted&&"video_element_muted"!==r.muted||(t.video.removeAttribute("muted"),t.video.muted=!1),t.video.removeAttribute("autoplay"),t.video.autoplay=!1,t.div.appendChild(t.video),_=t.video,E="video";var S=a.audio,w={playerId:t.playerId,stateId:S.stateId+1,playDeferTimeout:null,error:!1,status:"aborted",reason:"audioonly",updatedAt:Date.now()};a.audio=w;var T={type:"player-status-change",playerId:t.playerId,mediaType:"audio",status:w.status,reason:w.reason,isErrorState:w.error,streamId:t.id};if(c.default.debug("[".concat(t.id,"] Media Player Status Change"),T),Promise.resolve().then((function(){return e.stream.dispatchEvent(T)})),h.report.reportApiInvoke(e.stream.sid,{name:"Stream.playerStatusChange",options:T,tag:"tracer"})(),window.MediaStream&&(o.isSafari()||"iOS"===o.getBrowserOS())){var A=new MediaStream(e.stream.stream.getAudioTracks());Object(u.setSrcObject)(t.video,A)}else Object(u.setSrcObject)(t.video,e.stream.stream)}if(r.autoplay&&_){var R=_.play();R&&R.catch&&R.catch((function(n){if(!t.destroyed&&_){var i=a[E],o={playerId:t.playerId,stateId:i.stateId+1,playDeferTimeout:null,error:m(_,E,r),status:p(_),reason:"error",updatedAt:Date.now()};if(i.status!==o.status){c.default.debug("[".concat(t.id,"] Player ").concat(t.playerId," Status Changed Detected by promise error: ").concat(i.status,"=>").concat(o.status),n),a[E]=o;var s={type:"player-status-change",playerId:t.playerId,mediaType:E,status:o.status,reason:o.reason,isErrorState:o.error,streamId:t.id};c.default.debug("[".concat(t.id,"] Media Player Status Change"),s),e.stream.dispatchEvent(s),h.report.reportApiInvoke(e.stream.sid,{name:"Stream.playerStatusChange",options:s,tag:"tracer"})()}}}))}return t.setAudioVolume=function(e){var n=parseInt(e)/100;isFinite(n)&&(n<0?n=0:n>1&&(n=1),t.video&&(t.video.volume=n),t.audio&&(t.audio.volume=n))},t},m=n(23),g=n(10),v=n(6),y=n(19),b=n(3),_=n(25),E=n(16),S=n(11),w=n.n(S),T=function(e){Object(b.checkValidString)(e,"profileName"),-1===(e=e.toLowerCase()).indexOf("_")&&(e+="_1"),Object(b.checkValidEnum)(e,"profileName",Object.keys(d.SUPPORT_RESOLUTION_LIST));var t=d.SUPPORT_RESOLUTION_LIST[e];t||(e=Object(d.getParameter)("DEFAULT_PROFILE"),t=d.SUPPORT_RESOLUTION_LIST[e]);var n={profileName:e,video:{width:t[0],height:t[1]},attributes:{resolution:"".concat(t[0],"x").concat(t[1]),minFrameRate:t[2],maxFrameRate:t[3],minVideoBW:t[4],maxVideoBW:t[5]}};return t[2]&&(n.video.frameRate=t[2]),t[6]&&t[7]&&(n.screen={width:t[0],height:t[1],frameRate:{min:t[6],max:t[7]}}),n},A=function(e){return Object.keys(d.SUPPORT_RESOLUTION_LIST).filter((function(t){var n=d.SUPPORT_RESOLUTION_LIST[t],r=["width","height","frameRate"];for(var i in r){var o=r[i];if(e[o]&&n[i]){if("number"==typeof e[o].max&&e[o].max<n[i])return!1;if("number"==typeof e[o].min&&e[o].min>n[i])return!1}}return!0})).reverse()},R=function(e){var t=d.AUDIO_PROFILE_SETTINGS[e]||d.AUDIO_PROFILE_SETTINGS.default;return{highQuality:t[0],stereo:t[1],speech:t[2],lowQuality:t[3]}},x=function(e){var t=Object(a.b)();if(t.params=i()({},e),t.stream=e.stream,t.url=e.url,t.onClose=void 0,t.local=!1,t.videoSource=e.videoSource,t.audioSource=e.audioSource,e.video=!(!e.videoSource&&!e.video),t.video=e.video,e.audio=!(!e.audioSource&&!e.audio),t.audio=e.audio,t.screen=!!e.screen,t.screenAudio=!!e.screenAudio,t.screenAttributes={width:1920,height:1080,maxFr:5,minFr:1},t.videoSize=e.videoSize,t.player=void 0,t.audioLevelHelper=null,e.attributes=e.attributes||{},t.attributes=e.attributes,t.microphoneId=e.microphoneId,t.cameraId=e.cameraId,t.facingMode=e.facingMode,t.inSwitchDevice=!1,t.userMuteVideo=!1,t.userMuteAudio=!1,t.peerMuteVideo=!1,t.peerMuteAudio=!1,t.lowStream=null,t.videoWidth=0,t.videoHeight=0,t.streamId=e.streamID,t.userId=null,t.uintId=e.uintUID||null,t.mirror=!1!==e.mirror,t.DTX=e.audioProcessing&&e.audioProcessing.DTX,t.audioProcessing=e.audioProcessing,t.optimizationMode=e.optimizationMode,t.highQuality=!1,t.stereo=!1,t.speech=!1,t.screen||delete t.screen,!(void 0===t.videoSize||t.videoSize instanceof Array&&4===t.videoSize.length))throw Error("Invalid Video Size");function n(){var e={};t.getVideoTrack()===this?(c.default.debug("Video Track Ended"),e.type="videoTrackEnded",e.track=this):t.getAudioTrack()===this?(c.default.debug("Audio Track Ended"),e.type="audioTrackEnded",e.track=this):c.default.debug("Detached Track ended",this.kind,this.label,this),e.type&&t.dispatchEvent(e)}return t.videoSize=[640,480,640,480],void 0!==e.local&&!0!==e.local||(t.local=!0),t.initialized=!t.local,t._streamInitID=null,function(e){e.audioMixing={audioContextInited:!1,defaultVolume:100,inEarMonitoring:"FILE",sounds:{},states:{IDLE:"IDLE",STARTING:"STARTING",BUSY:"BUSY",PAUSED:"PAUSED"},inEarMonitoringModes:{NONE:"NONE",FILE:"FILE",MICROPHONE:"MOCROPHONE",ALL:"ALL"},ctx:null,mediaStreamSource:null,mediaStreamDest:null,buffer:{}},e._initSoundIfNotExists=function(t,n){e.audioMixing.sounds[t]||(e.audioMixing.sounds[t]={soundId:t,state:"IDLE",muted:e.userMuteAudio,filePath:n,volume:e.audioMixing.defaultVolume,startAt:null,startOffset:null,pauseAt:null,pauseOffset:null,resumeAt:null,resumeOffset:null,stopAt:null,options:null,source:null})},e._initSoundIfNotExists(-1),e.loadAudioBuffer=function(t,n,r){var i=h.report.reportApiInvoke(e.sid,{callback:r,name:"Stream.loadAudioBuffer",options:arguments,tag:"tracer"});Object(b.checkValidString)(n,"url",1,1024,!1),Object(b.checkValidString)(t,"id",1,1024,!1);var o=function(t){c.default.error("[".concat(e.streamId,"] loadAudioBuffer Failed: ")+t),i(l.default.LOAD_AUDIO_FAILED)},a=new XMLHttpRequest;a.open("GET",n,!0),a.responseType="arraybuffer",a.onload=function(){if(a.status>400)o("".concat(a.status," ").concat(a.statusText));else{var n=a.response;e.audioMixing.audioContextInited||e._initAudioContext(),e.audioMixing.ctx.decodeAudioData(n,(function(n){e.audioMixing.buffer[t]=n,i(null)}),(function(t){c.default.error("[".concat(e.streamId,"] decodeAudioData Failed: "),t),i(t)}))}},a.onerror=function(){return o("load error")},a.ontimeout=function(){return o("timeout")},a.send()},e.createAudioBufferSource=function(t){var n=h.report.reportApiInvoke(e.sid,{name:"Stream.createAudioBufferSource",options:arguments,tag:"tracer"});if(e.audioMixing.buffer[t.id]){var r=e.audioMixing.buffer[t.id],i=e.audioMixing.ctx.createBufferSource();i.buffer=r;var a=e.audioMixing.ctx.createGain();if(i.connect(a),a.connect(e.audioMixing.mediaStreamDest),i.gainNode=a,t.loop)i.loop=!0,i.start(0,t.playTime/1e3);else if(t.cycle>1)if(Object(o.isChrome)()){i.loop=!0;var s=t.cycle*r.duration*1e3-(t.playTime||0);i.start(0,t.playTime/1e3,s/1e3)}else c.default.warning("[".concat(e.streamId,"] Cycle Param is ignored by current browser")),i.start(0,t.playTime/1e3);else i.start(0,t.playTime/1e3);var u=e.audioMixing.sounds[t.soundId];return u.source=i,e._flushAudioMixingMuteStatus(),i.addEventListener("ended",(function(){i===u.source&&e.dispatchEvent({type:"audioSourceEnded",soundId:t.soundId,source:i,sound:u})})),n(),i}var l="AUDIOBUFFER_NOT_FOUND";return c.default.error("[".concat(e.streamId,"] "),l,t.id),n(!1),!1},e.on("audioSourceEnded",(function(t){var n=t.source,r=t.sound;r&&r.state===e.audioMixing.states.BUSY&&!r.pauseAt&&(r.state=e.audioMixing.states.IDLE,r.startAt=null,r.startOffset=null,r.resumeAt=null,r.resumeOffset=null,n.gainNode&&n.gainNode.disconnect&&n.gainNode.disconnect(),n.buffer=null,e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest))})),e.clearAudioBufferSource=function(){e.audioBufferSource.forEach((function(e){e.stop()}))},e._isSoundExists=function(t){return!!e.audioMixing.sounds[t.soundId]||(c.default.error("SoundId not exists. #".concat(t.soundId)),!1)},e._initAudioContext=function(){if(e.audioMixing.audioContextInited)throw new Error("Failed to init audio context. Already inited");if(!e.stream)throw new Error("Failed to init audio context. Local Stream not initialized");e.audioMixing.ctx=Object(_.a)(),e.audioMixing.mediaStreamSource=e.audioMixing.ctx.createMediaStreamSource(e.stream),e.audioMixing.mediaStreamDest=e.audioMixing.ctx.createMediaStreamDestination(),e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest);var t=e.stream.getVideoTracks()[0];if(t&&e.audioMixing.mediaStreamDest.stream.addTrack(t),e._originStream=e.stream,e._isAudioMuted()?(e._unmuteAudio(),e.stream=e.audioMixing.mediaStreamDest.stream,e._muteAudio()):e.stream=e.audioMixing.mediaStreamDest.stream,e.audioLevelHelper=null,e.pc&&e.pc.peerConnection&&e.pc.peerConnection){var n=(e.pc.peerConnection&&e.pc.peerConnection.getSenders()).find((function(e){return e&&e.track&&"audio"==e.track.kind})),r=e.audioMixing.mediaStreamDest.stream.getAudioTracks()[0];n&&n.replaceTrack&&r&&n.replaceTrack(r)}e.audioMixing.audioContextInited=!0},e._cleanupAudioMixing=function(){if(e.audioMixing.audioContextInited){for(var t in e.audioMixing.sounds){var n=e.audioMixing.sounds[t];n.state!==e.audioMixing.states.BUSY&&n.state!==e.audioMixing.states.PAUSED||e._stopOneEffect({soundId:t})}e.audioLevelHelper=null,e.audioMixing.audioContextInited=!1}},e._reloadInEarMonitoringMode=function(t){if(t){if(!e.audioMixing.inEarMonitoringModes[t])return c.default.error("[".concat(e.streamId,"] Invalid InEarMonitoringMode ").concat(t));e.audioMixing.inEarMonitoring=t}switch(e.audioMixing.audioContextInited||e._initAudioContext(),e.audioMixing.inEarMonitoring){case e.audioMixing.inEarMonitoringModes.FILE:e.audioMixing.mediaStreamSource.connectedToDestination&&(e.audioMixing.mediaStreamSource.disconnect(e.audioMixing.ctx.destination),e.audioMixing.mediaStreamSource.connectedToDestination=!1);case e.audioMixing.inEarMonitoringModes.ALL:for(var n in e.audioMixing.sounds){var r=e.audioMixing.sounds[n];r&&r.source&&!r.source.connectedToDestination&&(r.source.gainNode.connect(e.audioMixing.ctx.destination),r.source.connectedToDestination=!0)}}switch(e.audioMixing.inEarMonitoring){case e.audioMixing.inEarMonitoringModes.MICROPHONE:e.audioMixing.source.forEach((function(t){t.connectedToDestination&&(t.gainNode.disconnect(e.audioMixing.ctx.destination),t.connectedToDestination=!1)}));case e.audioMixing.inEarMonitoringModes.ALL:e.audioMixing.mediaStreamSource.connectedToDestination||(e.audioMixing.mediaStreamSource.connect(e.audioMixing.ctx.destination),e.audioMixing.mediaStreamSource.connectedToDestination=!0)}},e._startAudioMixingBufferSource=function(t){e.audioMixing.audioContextInited||e._initAudioContext();var n={soundId:t.soundId,id:t.filePath,loop:t.loop,cycle:t.cycle,playTime:t.playTime||0},r=t.replace,i=e.createAudioBufferSource(n);return i.sound=e.audioMixing.sounds[t.soundId],i?(i.addEventListener("ended",e._audioMixingFinishedListener,{once:!0}),e._reloadInEarMonitoringMode(),r&&e.audioMixing.mediaStreamSource.disconnect(e.audioMixing.mediaStreamDest),i):null},e._stopAudioMixingBufferSource=function(t){var n=e.audioMixing.sounds[t.soundId].source;return n?(n.removeEventListener("ended",e._audioMixingFinishedListener),e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest),n.stop(),n.gainNode&&n.gainNode.disconnect&&n.gainNode.disconnect(),n.buffer=null,n):null},e._flushAudioMixingMuteStatus=function(t){for(var n in e.audioMixing.sounds){var r=e.audioMixing.sounds[n];r&&(void 0!==t&&(r.muted=!!t),r.source&&(r.muted?r.source.gainNode.gain.value=0:r.source.gainNode.gain.value=r.volume/100))}},e._handleAudioMixingInvalidStateError=function(t,n,r){var i=e.audioMixing.sounds[n.soundId],o=-1===n.soundId?"INVALID_AUDIO_MIXING_STATE":"INVALID_PLAY_EFFECT_STATE";c.default.error("[".concat(e.streamId,"] Cannot ").concat(t,": ").concat(o,", state is ").concat(i.state)),r&&r(o)},e._handleAudioMixingNoSourceError=function(t,n,r){e.audioMixing.sounds[n.soundId].state=e.audioMixing.states.IDLE;var i=-1===n.soundId?"NO_AUDIO_MIXING_SOURCE":"NO_EFFECT_SOURCE";c.default.error("[".concat(e.streamId,"] Cannot ").concat(t,": ").concat(i)),r&&r(i)},e._getOneEffectStates=function(t){var n=e.audioMixing.sounds[t.soundId];return function(){return n?{state:n.state,startAt:n.startAt,resumeAt:n.resumeAt,pauseOffset:n.pauseOffset,pauseAt:n.pauseAt,resumeOffset:n.resumeOffset,stopAt:n.stopAt,duration:e._getOneEffectDuration(t),position:e._getOneEffectCurrentPosition(t)}:{}}},e._audioMixingFinishedListener=function(){var t=this.sound;t.state===e.audioMixing.states.IDLE&&e.audioMixing.buffer[t.options.filePath]&&!t.options.cacheResource&&(c.default.debug("Recycled buffer ".concat(t.options.filePath)),delete e.audioMixing.buffer[t.options.filePath]),-1===t.soundId&&e.dispatchEvent({type:"audioMixingFinished"})},e._playOneEffect=function(t,n){Object(b.checkValidObject)(t,"options");var r=t.soundId,i=(t.filePath,t.cacheResource);if(t.cycle,t.loop,t.playTime,t.replace,Object(o.isSafari)()&&Object(o.getBrowserVersion)()<12){var a="BROWSER_NOT_SUPPORT";return c.default.error("[".concat(e.streamId,"] Cannot _playOneEffect: "),a),n(a)}e.audioMixing.audioContextInited||e._initAudioContext(),e._initSoundIfNotExists(r);var s=e.audioMixing.sounds[r];if(s.state===e.audioMixing.states.IDLE){if(void 0!==t.cycle&&!t.cycle>0)return a="Invalid Parmeter cycle: "+t.cycle,c.default.error("[".concat(e.streamId,"] ").concat(r),a),n(a);if(Object(b.isEmpty)(i)&&(t.cacheResource=!0),s.state=e.audioMixing.states.STARTING,s.options=t,e.audioMixing.buffer[t.filePath]){var u=e._startAudioMixingBufferSource(t);if(u)return s.source=u,s.startAt=Date.now(),s.resumeAt=null,s.pauseOffset=null,s.pauseAt=null,s.resumeOffset=null,s.stopAt=null,s.startOffset=t.playTime||0,s.state=e.audioMixing.states.BUSY,e._flushAudioMixingMuteStatus(),n(null);s.state=e.audioMixing.states.IDLE;var l="CREATE_BUFFERSOURCE_FAILED";if(n)return n(l);c.default.error("[".concat(e.streamId,"] "),l)}else e.loadAudioBuffer(t.filePath,t.filePath,(function(r){if(r)s.state=e.audioMixing.states.IDLE,n?n(r):c.default.error("[".concat(e.streamId,"] "),r);else{var i=e._startAudioMixingBufferSource(t);if(i)return s.source=i,s.startAt=Date.now(),s.resumeAt=null,s.pauseOffset=null,s.pauseAt=null,s.resumeOffset=null,s.stopAt=null,s.startOffset=t.playTime||0,s.state=e.audioMixing.states.BUSY,e._flushAudioMixingMuteStatus(),n(null);if(s.state=e.audioMixing.states.IDLE,r="CREATE_BUFFERSOURCE_FAILED",n)return n(r);c.default.error("[".concat(e.streamId,"] "),r)}}))}else e._handleAudioMixingInvalidStateError("_playEffect",t,n)},e._stopOneEffect=function(t,n){var r=e.audioMixing.sounds[t.soundId];return e._isSoundExists(t)?r.state===e.audioMixing.states.BUSY||r.state===e.audioMixing.states.PAUSED?(e._stopAudioMixingBufferSource(t),r.stopAt=Date.now(),r.state=e.audioMixing.states.IDLE,e.audioMixing.buffer[r.options.filePath]&&!r.options.cacheResource&&(c.default.debug("Recycled buffer ".concat(r.options.filePath)),delete e.audioMixing.buffer[r.options.filePath]),void(n&&n(null))):void e._handleAudioMixingInvalidStateError("_stopOneEffect",t,n):n("SOUND_NOT_EXISTS")},e._pauseOneEffect=function(t,n){var r=e.audioMixing.sounds[t.soundId];if(r.state===e.audioMixing.states.BUSY)return e._stopAudioMixingBufferSource(t)?(r.pauseAt=Date.now(),r.state=e.audioMixing.states.PAUSED,r.resumeAt?r.pauseOffset=r.pauseAt-r.resumeAt+r.resumeOffset:r.pauseOffset=r.pauseAt-r.startAt+r.startOffset,n&&n(null)):void e._handleAudioMixingNoSourceError("_pauseOneEffect",t,n);e._handleAudioMixingInvalidStateError("_pauseOneEffect",t,n)},e._resumeOneEffect=function(t,n){var r=e.audioMixing.sounds[t.soundId];if(r.state===e.audioMixing.states.PAUSED){var i={soundId:t.soundId,filePath:r.options.filePath,cycle:r.options.cycle,loop:r.options.loop,playTime:r.pauseOffset,replace:r.options.replace},o=e._startAudioMixingBufferSource(i);if(!o){var a="CREATE_BUFFERSOURCE_FAILED";return n(a),void c.default.error("[".concat(e.streamId,"] "),a)}r.source=o,r.resumeAt=Date.now(),r.resumeOffset=r.pauseOffset,r.state=e.audioMixing.states.BUSY,r.pauseAt=null,r.pauseOffset=null,n(null)}else e._handleAudioMixingInvalidStateError("_resumeOneEffect",t,n)},e._getOneEffectDuration=function(t){var n=e.audioMixing.sounds[t.soundId];return n.options&&n.options.filePath&&e.audioMixing.buffer[n.options.filePath]?1e3*e.audioMixing.buffer[n.options.filePath].duration:null},e._getOneEffectCurrentPosition=function(t,n){var r=e.audioMixing.sounds[t.soundId];return r.state===e.audioMixing.states.PAUSED?r.pauseOffset%e._getOneEffectDuration(t):r.state===e.audioMixing.states.BUSY?r.resumeAt?(Date.now()-r.resumeAt+r.resumeOffset)%e._getOneEffectDuration(t):(Date.now()-r.startAt+r.startOffset)%e._getOneEffectDuration(t):void(n&&e._handleAudioMixingInvalidStateError("_getOneEffectCurrentPosition",t))},e._setOneEffectPosition=function(t,n,r){var i=e.audioMixing.sounds[t.soundId];if(i.state===e.audioMixing.states.BUSY){if(!e._stopAudioMixingBufferSource(t))return void e._handleAudioMixingNoSourceError("_setOneEffectPosition",t,r);var o={soundId:t.soundId,filePath:i.options.filePath,loop:i.options.loop,cycle:i.options.cycle,playTime:n},a=e._startAudioMixingBufferSource(o);if(!a){var s="CREATE_BUFFERSOURCE_FAILED";return r&&r(s),void c.default.error("[".concat(e.streamId,"] "),s)}i.source=a,i.startAt=Date.now(),i.startOffset=n,i.resumeAt=null,i.resumeOffset=null,i.pauseOffset=null,i.pauseAt=null}else{if(i.state!==e.audioMixing.states.PAUSED)return void e._handleAudioMixingInvalidStateError("_setOneEffectPosition",t,r);i.pauseOffset=n}r&&r(null)},e.startAudioMixing=function(t,n){var r=h.report.reportApiInvoke(e.sid,{callback:function(t){if(t)return n&&n(t);e.dispatchEvent({type:"audioMixingPlayed"}),n&&n(null)},getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.startAudioMixing",options:t});Object(b.checkValidObject)(t,"options");var o=t.filePath,a=t.cacheResource,s=t.cycle,c=t.loop,u=t.playTime,l=t.replace;Object(b.checkValidString)(o,"filePath",1,Object(d.getParameter)("FILEPATH_LENMAX"),!1),Object(b.checkValidNumber)(u,"playTime",0,1e8),!Object(b.isEmpty)(s)&&Object(b.checkValidNumber)(s,"cycle"),!Object(b.isEmpty)(c)&&Object(b.checkValidBoolean)(c,"loop"),!Object(b.isEmpty)(l)&&Object(b.checkValidBoolean)(l,"replace"),!Object(b.isEmpty)(a)&&Object(b.checkValidBoolean)(a,"cacheResource");var f=i()({soundId:-1},t);e._playOneEffect(f,r)},e.stopAudioMixing=function(t){var n=h.report.reportApiInvoke(e.sid,{callback:t,getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.stopAudioMixing"});e._stopOneEffect({soundId:-1},n)},e.pauseAudioMixing=function(t){var n=h.report.reportApiInvoke(e.sid,{callback:t,getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.pauseAudioMixing"});return e._pauseOneEffect({soundId:-1},n)},e.resumeAudioMixing=function(t){var n=h.report.reportApiInvoke(e.sid,{callback:function(n,r){if(n)return t&&t(n);e.dispatchEvent({type:"audioMixingPlayed"}),t&&t(null)},getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.resumeAudioMixing"});e._resumeOneEffect({soundId:-1},n)},e.adjustAudioMixingVolume=function(t){var n=h.report.reportApiInvoke(e.sid,{getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.adjustAudioMixingVolume",options:arguments,tag:"tracer"});Object(b.checkValidNumber)(t,"volume",0,100),e.audioMixing.sounds[-1].volume=t,e._flushAudioMixingMuteStatus(),n()},e.getAudioMixingDuration=function(){var t=h.report.reportApiInvoke(e.sid,{getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingDuration"}),n=e._getOneEffectDuration({soundId:-1});return t(null,n),n},e.getAudioMixingCurrentPosition=function(){var t=h.report.reportApiInvoke(e.sid,{getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingCurrentPosition"}),n=e._getOneEffectCurrentPosition({soundId:-1},!0);return t(null,n),n},e.setAudioMixingPosition=function(t,n){var r=h.report.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.setAudioMixingPosition"});Object(b.checkValidNumber)(t,"position",0,1e8),e._setOneEffectPosition({soundId:-1},t,r)},e.playEffect=function(t,n){var r=h.report.reportApiInvoke(e.sid,{callback:function(t){if(t)return n&&n(t);e.dispatchEvent({type:"effectPlayed"}),n&&n(null)},name:"Stream.playEffect",options:t});Object(b.checkValidObject)(t,"options");var i=t.soundId,o=t.filePath,a=t.cycle;Object(b.checkValidNumber)(i,"soundId",1,1e4),Object(b.checkValidString)(o,"filePath",0,Object(d.getParameter)("FILEPATH_LENMAX"),!1),!Object(b.isEmpty)(a)&&Object(b.checkValidNumber)(a,"cycle"),e._playOneEffect(t,r)},e.stopEffect=function(t,n){var r=h.report.reportApiInvoke(e.sid,{callback:n,getStates:e._getOneEffectStates({soundId:t}),name:"Stream.stopEffect"});Object(b.checkValidNumber)(t,"soundId",1,1e4),e._stopOneEffect({soundId:t},r)},e.stopAllEffects=function(t){var n=h.report.reportApiInvoke(e.sid,{callback:t,name:"Stream.stopAllEffect"}),r=!1,i=0,o=0,a=function(e){r||(e?(n(e),r=!0):i+=1,i===o&&(n(null),r=!0))};for(var s in e.audioMixing.sounds){var c=e.audioMixing.sounds[s];-1!==c.soundId&&(c.state!==e.audioMixing.states.BUSY&&c.state!==e.audioMixing.states.PAUSED||(o++,e._stopOneEffect({soundId:s},a)))}o||n(null)},e.preloadEffect=function(t,n,r){var i=h.report.reportApiInvoke(e.sid,{callback:r,options:arguments,tag:"tracer",name:"Stream.preloadEffect"});Object(b.checkValidNumber)(t,"soundId",1,1e4),Object(b.checkValidString)(n,"filePath",1,Object(d.getParameter)("FILEPATH_LENMAX"),!1),e._initSoundIfNotExists(t,n),e.audioMixing.buffer[n]?i(null):e.loadAudioBuffer(n,n,i)},e.unloadEffect=function(t,n){var r=h.report.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.unloadEffect"});Object(b.checkValidNumber)(t,"soundId",1,1e4);var i=e.audioMixing.sounds[t];if(!i){var o="SOUND_NOT_EXISTS";return c.default.error(o,t),void r(o)}var a=i.options?i.options.filePath:i.filePath;if(a)delete e.audioMixing.buffer[a],delete e.audioMixing.sounds[t],r(null);else{var s="SOUND_BUFFER_NOT_FOUND";c.default.error(s,t),r(s)}},e.pauseEffect=function(t,n){var r=h.report.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.pauseEffect"});return e._pauseOneEffect({soundId:t},r)},e.pauseAllEffects=function(t){var n=h.report.reportApiInvoke(e.sid,{callback:t,name:"Stream.pauseAllEffects"}),r=!1,i=0,o=0,a=function(e){r||(e?(n(e),r=!0):i+=1,i===o&&(n(null),r=!0))};for(var s in e.audioMixing.sounds)"-1"!==s&&e.audioMixing.sounds[s].state===e.audioMixing.states.BUSY&&(o++,e._pauseOneEffect({soundId:s},a));o||n(null)},e.resumeEffect=function(t,n){Object(b.checkValidNumber)(t,"soundId",1,1e4);var r=h.report.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.resumeEffect"});return e._resumeOneEffect({soundId:t},r)},e.resumeAllEffects=function(t){var n=h.report.reportApiInvoke(e.sid,{callback:t,name:"Stream.resumeAllEffects"}),r=!1,i=0,o=0,a=function(e){r||(e?(n(e),r=!0):i+=1,i===o&&(n(null),r=!0))};for(var s in e.audioMixing.sounds)"-1"!==s&&e.audioMixing.sounds[s].state===e.audioMixing.states.PAUSED&&(o++,e._resumeOneEffect({soundId:s},a));o||n(null)},e.getEffectsVolume=function(){var t=[];for(var n in e.audioMixing.sounds){var r=e.audioMixing.sounds[n];r&&"-1"!==n&&t.push({soundId:parseInt(n),volume:r.volume})}return t},e.setEffectsVolume=function(t,n){var r=h.report.reportApiInvoke(e.sid,{name:"Stream.setEffectsVolume",options:arguments,tag:"tracer",callback:n});for(var i in Object(b.checkValidNumber)(t,"volume",0,100),e.audioMixing.defaultVolume=t,e.audioMixing.sounds){var o=e.audioMixing.sounds[i];"-1"!==i&&(o.volume=t)}e._flushAudioMixingMuteStatus(),r(null)},e.setVolumeOfEffect=function(t,n,r){var i=h.report.reportApiInvoke(e.sid,{name:"Stream.setVolumeOfEffect",options:arguments,tag:"tracer",callback:r});Object(b.checkValidNumber)(t,"soundId",0,1e4),Object(b.checkValidNumber)(n,"volume",0,100),e._initSoundIfNotExists(t);var o=e.audioMixing.sounds[t];o.volume=n,e._flushAudioMixingMuteStatus(),i(null)}}(t),E.a.addVideoEffectCapability(t),function(e,t){e.videoConstraint={},t.cameraId&&(e.videoConstraint.deviceId={exact:t.cameraId}),t.facingMode&&(e.videoConstraint.facingMode=t.facingMode),e.videoSize&&(e.videoConstraint.width=e.videoSize[0],e.videoConstraint.height=e.videoSize[1]),Object(o.isLegacyChrome)()||(e.videoConstraint.frameRate=30),e.audioConstraint={},t.microphoneId&&(e.audioConstraint.deviceId={exact:t.microphoneId}),Object(o.isLegacyChrome)()||e.audioProcessing&&(void 0!==e.audioProcessing.AGC&&(Object(o.isFireFox)()?e.audioConstraint.autoGainControl=e.audioProcessing.AGC:Object(o.isChrome)()&&(e.audioConstraint.googAutoGainControl=e.audioProcessing.AGC,e.audioConstraint.googAutoGainControl2=e.audioProcessing.AGC)),void 0!==e.audioProcessing.AEC&&(e.audioConstraint.echoCancellation=e.audioProcessing.AEC),void 0!==e.audioProcessing.ANS&&(Object(o.isFireFox)()?e.audioConstraint.noiseSuppression=e.audioProcessing.ANS:Object(o.isChrome)()&&(e.audioConstraint.googNoiseSuppression=e.audioProcessing.ANS))),e.screenConstraint={},t.sourceId&&(e.screenConstraint.sourceId=t.sourceId),t.extensionId&&Object(o.isChrome)()?(e.screenConstraint.extensionId=t.extensionId,e.screenConstraint.mandatory={chromeMediaSource:"desktop",maxWidth:e.screenAttributes.width,maxHeight:e.screenAttributes.height,maxFrameRate:e.screenAttributes.maxFr,minFrameRate:e.screenAttributes.minFr}):(e.screenConstraint.mediaSource="screen",e.screenConstraint.width=e.screenAttributes.width,e.screenConstraint.height=e.screenAttributes.height,e.screenConstraint.frameRate={ideal:e.screenAttributes.maxFr,max:e.screenAttributes.maxFr}),t.mediaSource&&(e.screenConstraint.mediaSource=t.mediaSource),e.setVideoResolution=function(n){var r=h.report.reportApiInvoke(e.sid,{name:"Stream.setVideoResolution",options:arguments,tag:"tracer"});if(!(n instanceof Array)){var o=T(n+="");return o&&o.video?(e.videoConstraint=i()(e.videoConstraint,{width:{ideal:o.video.width},height:{ideal:o.video.height}}),t.attributes.resolution=o.attributes.resolution,(a=e.stream&&e.stream.getVideoTracks&&e.stream.getVideoTracks()[0])&&a.applyConstraints?(c.default.debug("setVideoResolution applyConstraints",e.videoConstraint),a.applyConstraints(e.videoConstraint).then(r).catch(r)):r(),!0):(r("NO_PROFILE_".concat(n)),!1)}var a,s=n[0],u=n[1];e.videoConstraint=i()(e.videoConstraint,{width:{ideal:s},height:{ideal:u}}),t.attributes.resolution="".concat(s,"x").concat(u),(a=e.stream&&e.stream.getVideoTracks&&e.stream.getVideoTracks()[0])&&a.applyConstraints?(c.default.debug("setVideoResolution applyConstraints",e.videoConstraint),E.a.disableVideoEffect(e).then((function(){return a.applyConstraints(e.videoConstraint).then(r).catch(r)})).then((function(){return E.a.restoreVideoEffect(e)}))):r()},e.setVideoFrameRate=function(t){var n=h.report.reportApiInvoke(e.sid,{name:"Stream.setVideoFrameRate",options:arguments,tag:"tracer"});if(Object(o.isFireFox)())return n("FIREFOX_NOT_SUPPORTED"),!1;if("object"===w()(t)&&t instanceof Array&&t.length>1){e.videoConstraint=i()(e.videoConstraint,{frameRate:t[0]}),e.attributes.minFrameRate=t[0],e.attributes.maxFrameRate=t[1];var r=e.stream&&e.stream.getVideoTracks&&e.stream.getVideoTracks()[0];return r&&r.applyConstraints?(c.default.debug("setVideoFrameRate applyConstraints",e.videoConstraint),r.applyConstraints(e.videoConstraint).then(n).catch(n)):n(),!0}return n("INVALID_PARAM_".concat(JSON.stringify(t))),!1},e.setVideoBitRate=function(n){var r=h.report.reportApiInvoke(e.sid,{name:"Stream.setVideoBitRate",options:arguments,tag:"tracer"});return"object"===w()(n)&&n instanceof Array&&n.length>1?(t.attributes.minVideoBW=n[0],t.attributes.maxVideoBW=n[1],e.connectionSpec&&(e.connectionSpec.minVideoBW=n[0],e.connectionSpec.maxVideoBW=n[1]),e.pc&&e.pc.renegotiate&&e.pc.renegotiate(),r(),!0):(r("INVALID_PARAM_".concat(JSON.stringify(n))),!1)},e.setScreenBitRate=function(t){var n=h.report.reportApiInvoke(e.sid,{name:"Stream.setScreenBitRate",options:arguments,tag:"tracer"});return"object"===w()(t)&&t instanceof Array&&t.length>1?(e.screenAttributes.minVideoBW=t[0],e.screenAttributes.maxVideoBW=t[1],n(),!0):(n("INVALID_PARAM_".concat(JSON.stringify(t))),!1)},e.setScreenProfile=function(t){var n=h.report.reportApiInvoke(e.sid,{name:"Stream.setScreenProfile",options:arguments,tag:"tracer"});Object(b.checkValidEnum)(t,"profile",["480p_1","480p_2","720p_1","720p_2","1080p_1","1080p_2"]);var r=T(t);return r&&r.screen?(e.screenConstraint.mandatory?(e.screenConstraint.mandatory.maxWidth=r.screen.width,e.screenConstraint.mandatory.maxHeight=r.screen.height,r.screen.frameRate&&r.screen.frameRate.min&&r.screen.frameRate.max&&(e.screenConstraint.mandatory.minFrameRate=r.screen.frameRate.min,e.screenConstraint.mandatory.maxFrameRate=r.screen.frameRate.max)):e.screenConstraint=i()(e.screenConstraint,r.screen),e.screenAttributes.width=r.screen.width,e.screenAttributes.height=r.screen.height,e.screenAttributes.minFr=r.screen.frameRate.min,e.screenAttributes.maxFr=r.screen.frameRate.max,n(),!0):(n("NO_SCREEN_PROFILE_".concat(JSON.stringify(t))),!1)},e.setVideoProfileCustom=function(t){var n=h.report.reportApiInvoke(e.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});e.setVideoResolution(t[0]),e.setVideoFrameRate([t[1],t[1]]),e.setVideoBitRate([t[2],t[2]]),n()},e.setVideoProfileCustomPlus=function(n){var r=h.report.reportApiInvoke(e.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});e.setVideoResolution([n.width,n.height]),t.attributes.resolution="".concat(n.width,"x").concat(n.height),e.setVideoFrameRate([n.framerate,n.framerate]),e.setVideoBitRate([n.bitrate,n.bitrate]),r()},e.setVideoProfile=function(n){var r=h.report.reportApiInvoke(e.sid,{name:"Stream.setVideoProfile",options:arguments,tag:"tracer"}),a=T(n);if(!a){var s="Invalid Profile ".concat(n);throw new Error(s)}if(e.profile=n,a&&a.video){e.profile=a.profileName,e.videoConstraint=i()(e.videoConstraint,a.video),e.connectionSpec&&a.attributes.maxVideoBW&&(e.connectionSpec.minVideoBW=a.attributes.minVideoBW,e.connectionSpec.maxVideoBW=a.attributes.maxVideoBW),Object(o.isEdge)()&&(e.videoConstraint.frameRate.max=60),Object(o.isFireFox)()&&(e.videoConstraint.frameRate=30),t.attributes=i()(t.attributes,a.attributes),e.pc&&e.pc.renegotiate&&e.pc.renegotiate();var u=e.stream&&e.stream.getVideoTracks&&e.stream.getVideoTracks()[0];return u&&u.applyConstraints?(c.default.debug("setVideoProfile applyConstraints",e.videoConstraint),E.a.disableVideoEffect(e).then((function(){return u.applyConstraints(e.videoConstraint)})).then((function(){return E.a.restoreVideoEffect(e)})).then((function(t){return new Promise((function(n,i){r(t),setTimeout((function(){Object(g.vsResHack)(e.stream,(function(t,r){e.videoWidth=t,e.videoHeight=r,n()}),(function(t){c.default.warning("[".concat(e.streamId,"] vsResHack failed: "),t),i()}))}),2500)}))})).catch(r)):r(),!0}return r("INVALID_VIDEO_PROFILE_".concat(n)),!1},e.setAudioProfile=function(t){var n=h.report.reportApiInvoke(e.sid,{name:"Stream.setAudioProfile",options:arguments,tag:"tracer"});Object(b.checkValidEnum)(t,"profile",["speech_low_quality","speech_standard","music_standard","standard_stereo","high_quality","high_quality_stereo"]),e.audioProfile=t;var r=R(t);return e.highQuality=r.highQuality,e.stereo=r.stereo,e.speech=r.speech,e.lowQuality=r.lowQuality,e.stereo&&Object(o.isChrome)()&&(e.audioConstraint.googAutoGainControl=!1,e.audioConstraint.googAutoGainControl2=!1,e.audioConstraint.echoCancellation=!1,e.audioConstraint.googNoiseSuppression=!1),n(),!0},e.setVideoEncoderConfiguration=function(t){Object(b.checkValidObject)(t,"config");var n=h.report.reportApiInvoke(e.sid,{name:"Stream.setVideoEncoderConfiguration",options:t,tag:"tracer"});t.resolution&&(Object(b.checkValidNumber)(t.resolution.width,"config.resolution.width"),Object(b.checkValidNumber)(t.resolution.height,"config.resolution.height"),e.setVideoResolution([t.resolution.width,t.resolution.height])),t.frameRate&&(Object(b.checkValidNumber)(t.frameRate.min,"config.frameRate.min"),Object(b.checkValidNumber)(t.frameRate.max,"config.frameRate.max"),e.setVideoFrameRate([t.frameRate.min,t.frameRate.max])),t.bitrate&&(Object(b.checkValidNumber)(t.bitrate.min,"config.bitrate.min",1,1e7),Object(b.checkValidNumber)(t.bitrate.max,"config.bitrate.max",1,1e7),e.setVideoBitRate([t.bitrate.min,t.bitrate.max])),n()},e.getSupportedProfile=function(t){var n=h.report.reportApiInvoke(e.sid,{name:"Stream.getSupportedProfile",options:arguments,tag:"tracer",callback:t});if(!e.local){var r="ONLY_LOCAL_STREAM_SUPPORTED";return c.default.error(r),n(r)}if(!e.stream)return r="STREAM_NOT_INIT",c.default.error(r),n(r);if(!e.stream.getVideoTracks)return r="TRACK_NOT_SUPPORT",c.default.error(r),n(r);var i=e.stream.getVideoTracks()[0];if(!i)return r="NO_VIDEO_TRACK_FOUND",c.default.error(r),n(r);if(!i.getCapabilities)return r="GETCAPABILITY_NOT_SUPPORT",c.default.error(r),n(r);var o=i.getCapabilities(),a=A(o);return n(null,a)}}(t,e),t.getId=function(){return t.streamId},t.getUserId=function(){return t.userId},t.checkDualStreamEnabled=function(){return!(!Object(d.getParameter)("DUALSTREAM_OPERATION_CHECK")||!t.isDualStream)&&(c.default.error("Operation not permitted: ".concat("DUAL_STREAM_ENABLED")),"DUAL_STREAM_ENABLED")},t.setUserId=function(e){var n=h.report.reportApiInvoke(t.sid,{name:"Stream.setUserId",options:arguments,tag:"tracer"});t.userId&&c.default.warning("[".concat(t.streamId,"] Stream.userId ").concat(t.userId," => ").concat(e)),t.userId=e,n()},t.getAttributes=function(){return e.screen?t.screenAttributes:e.attributes},t.hasAudio=function(){return!!t.audio},t.hasVideo=function(){return!!t.video},t.hasScreen=function(){return!!t.screen},t.hasScreenAudio=function(){return!!t.screenAudio},t.isVideoOn=function(){return(t.hasVideo()||t.hasScreen())&&!t.userMuteVideo},t.isAudioOn=function(){return t.hasAudio()&&!t.userMuteAudio},t.init=function(r,i){var o=h.report.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return i&&i(e);r&&r(t)},name:"Stream.init",options:arguments,tag:"tracer"}),a=((new Date).getTime(),arguments[2]);if(void 0===a&&(a=2),!0===t.initialized)return o({type:"warning",msg:"STREAM_ALREADY_INITIALIZED"});if(!0!==t.local)return o({type:"warning",msg:"STREAM_NOT_LOCAL"});var s=Math.random().toString().slice(3);t._streamInitID=s,t.videoSource?t.videoName="videoSource":t.video&&(t.videoName=y.a.searchDeviceNameById(e.cameraId)||"default"),t.audioSource?t.audioName="audioSource":t.audio&&(t.audioName=y.a.searchDeviceNameById(e.microphoneId)||"default"),t.screen&&(t.screenName=e.extensionId||"default");try{if(e.audio||e.video||e.screen||e.screenAudio||e.videoSource||e.audioSource){c.default.debug("[".concat(t.streamId,"] Requested access to local media"));var u={streamId:t.streamId};e.videoSource?u.videoSource=e.videoSource:e.screen?u.screen=t.screenConstraint:e.video&&(u.video=t.videoConstraint),e.audioSource?u.audioSource=e.audioSource:e.screenAudio?u.screenAudio=e.screenAudio:e.audio&&(u.audio=t.audioConstraint),Object(m.b)(u,(function(r){if(u.screenAudio&&!r.getAudioTracks()[0]&&c.default.warning("[".concat(t.streamId,"] Audio sharing is not selected")),u.screen&&c.default.debug("[".concat(t.streamId,"] User has granted access to screen sharing")),(u.video||u.audio)&&c.default.debug("[".concat(t.streamId,"] User has granted access to local media")),null===t._streamInitID){r.getTracks().forEach((function(e){e.stop()}));var i={type:"error",msg:"STREAM_IS_CLOSED",info:"stream is closed and cannot be initialized"};return c.default.error(t.streamId,i.info),void o(i)}if(t._streamInitID!==s)return r.getTracks().forEach((function(e){e.stop()})),i={type:"error",msg:"ABORT_OTHER_INIT",info:"stream initialization is aborted because of another stream.init"},c.default.error(t.streamId,i.info),void o(i);t.dispatchEvent({type:"accessAllowed"}),t.stream=r,t.initialized=!0,t.reloadDeviceName(),t.hasVideo()&&Object(g.vsResHack)(r,(function(e,n){t.videoWidth=e,t.videoHeight=n}),(function(e){c.default.warning("[".concat(t.streamId,"] vsResHack failed: "),e)})),e.screen&&t.stream&&t.stream.getVideoTracks()[0]&&(t.stream.getVideoTracks()[0].onended=function(){t.dispatchEvent({type:"stopScreenSharing"})}),t.stream&&t.stream.getTracks&&t.stream.getTracks().forEach((function(r){r&&!r.onended&&(r.onended=n),"video"===r.kind&&e.optimizationMode&&(r.contentHint=e.optimizationMode,r.contentHint===e.optimizationMode&&c.default.debug("[".concat(t.streamId,"] set content hint to"),e.optimizationMode))})),o()}),(function(e){var n={type:"error",info:null};switch(e&&(n.msg=e.name||e.code||e,e.message&&(n.info=e.message),e.code&&(n.info?n.info+=". "+e.code:n.info=" "+e.code),e.constraint&&(n.info?n.info+=". Constraint: "+e.constraint:n.info="constraint: "+e.constraint)),n.msg){case"Starting video failed":case"TrackStartError":if(t.videoConstraint&&(delete t.videoConstraint.width,delete t.videoConstraint.height),a>0)return void setTimeout((function(){t.init((function(e){return o(e)}),o,a-1)}),1);n.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":n.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":n.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":case"InvalidStateError":n.msg="PERMISSION_DENIED",t.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":case"NotAllowedError":t.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":n.msg="CONSTRAINT_NOT_SATISFIED";break;default:n.msg||(n.msg="UNDEFINED")}var r="Media access ".concat(n.msg).concat(n.info?": "+n.info:"");c.default.error("[".concat(t.streamId,"] "),r),o(n)}))}else o({type:"warning",msg:"STREAM_HAS_NO_MEDIA_ATTRIBUTES"})}catch(e){c.default.error("[".concat(t.streamId,"] Stream init: "),e),o({type:"error",msg:e.message||e})}},t.reloadDeviceName=function(){if(t.stream){if(t.stream.getVideoTracks){var e=t.stream.getVideoTracks()[0];e&&e.label&&(t.videoName=e.label)}if(t.stream.getAudioTracks){var n=t.stream.getAudioTracks()[0];n&&n.label&&(t.audioName=n.label)}}},t.close=function(){var e=h.report.reportApiInvoke(null,{name:"Stream.close",options:arguments,tag:"tracer"});if(c.default.debug("[".concat(t.streamId,"] Close stream with id"),t.streamId),t._originStream)try{t._originStream.getTracks().map((function(e){return e.stop()}))}catch(e){}if(void 0!==t.stream){var n=t.stream.getTracks();for(var r in n)n.hasOwnProperty(r)&&(n[r].stop(),n[r].onended=null);!t.isLowStream&&t.local?E.a.disableVideoEffect(t).then((function(){t.stream=void 0})):(t.stream&&t.stream.clean&&t.stream.clean(),t.stream=void 0)}if(t._originStream){for(var r in n=t._originStream.getTracks())n.hasOwnProperty(r)&&(n[r].stop(),n[r].onended=null);!t.isLowStream&&t.local?E.a.disableVideoEffect(t).then((function(){t._originStream=void 0})):(t._originStream&&t._originStream.clean&&t._originStream.clean(),t._originStream=void 0)}if(Object(o.isSafari)()&&t.pc&&t.pc.peerConnection&&t.pc.peerConnection.removeTrack&&t.pc.peerConnection.getSenders){var i=t.pc.peerConnection.getSenders();i.forEach((function(e){e&&(c.default.debug("[".concat(t.streamId,"] Remove Track"),e),t.pc.peerConnection.removeTrack(e))}))}t.local&&(t.initialized=!1),t._streamInitID=null,t._onAudioMute=void 0,t._onAudioUnmute=void 0,t._onVideoMute=void 0,t._onVideoUnmute=void 0,t.lowStream&&t.lowStream.close(),t.player&&t.player.video&&t.player.video.srcObject&&(t.player.video.srcObject=null),t.player&&t.player.audio&&t.player.audio.srcObject&&(t.player.audio.srcObject=null),e()},t.enableAudio=function(){var e,n=h.report.reportApiInvoke(t.sid,{name:"Stream.enableAudio",options:arguments,tag:"tracer"});return c.default.deprecate("[".concat(t.streamId,"] Stream.enableAudio is deprecated and will be removed in the future. Use Stream.unmuteAudio instead")),t.userMuteAudio||c.default.warning("[".concat(t.streamId,"] User already enableAudio")),t.userMuteAudio=!1,n(null,e=!t.peerMuteAudio&&t._unmuteAudio()),e},t.disableAudio=function(){var e=h.report.reportApiInvoke(t.sid,{name:"Stream.disableAudio",options:arguments,tag:"tracer"});c.default.deprecate("[".concat(t.streamId,"] Stream.disableAudio is deprecated and will be removed in the future. Use Stream.muteAudio instead")),t.userMuteAudio&&c.default.warning("[".concat(t.streamId,"] User already disableAudio")),t.userMuteAudio=!0;var n=t._muteAudio();return e(null,n),n},t.enableVideo=function(){var e,n=h.report.reportApiInvoke(t.sid,{name:"Stream.enableVideo",options:arguments,tag:"tracer"});return c.default.deprecate("[".concat(t.streamId,"] Stream.enableVideo is deprecated and will be removed in the future. Use Stream.unmuteVideo instead")),t.userMuteVideo||c.default.warning("[".concat(t.streamId,"] User already enableVideo")),t.userMuteVideo=!1,t.lowStream&&(t.lowStream.userMuteVideo=!1),n(null,e=!t.peerMuteVideo&&t._unmuteVideo()),e},t.disableVideo=function(){var e=h.report.reportApiInvoke(t.sid,{name:"Stream.disableVideo",options:arguments,tag:"tracer"});c.default.deprecate("[".concat(t.streamId,"] Stream.disableVideo is deprecated and will be removed in the future. Use Stream.muteVideo instead")),t.userMuteVideo&&c.default.warning("[".concat(t.streamId,"] User already disableVideo")),t.userMuteVideo=!0,t.lowStream&&(t.lowStream.userMuteVideo=!0);var n=t._muteVideo();return e(null,n),n},t.unmuteAudio=function(){var e,n=h.report.reportApiInvoke(t.sid,{name:"Stream.unmuteAudio",options:arguments,tag:"tracer"});return t.userMuteAudio||c.default.warning("[".concat(t.streamId,"] User already unmuteAudio")),t.userMuteAudio=!1,n(null,e=!t.peerMuteAudio&&t._unmuteAudio()),e},t.muteAudio=function(){var e=h.report.reportApiInvoke(t.sid,{name:"Stream.muteAudio",options:arguments,tag:"tracer"});t.userMuteAudio&&c.default.warning("[".concat(t.streamId,"] User already muteAudio")),t.userMuteAudio=!0;var n=t._muteAudio();return e(null,n),n},t.unmuteVideo=function(){var e,n=h.report.reportApiInvoke(t.sid,{name:"Stream.unmuteVideo",options:arguments,tag:"tracer"});return t.userMuteVideo||c.default.warning("[".concat(t.streamId,"] User already unmuteVideo")),t.userMuteVideo=!1,t.lowStream&&(t.lowStream.userMuteVideo=!1),n(null,e=!t.peerMuteVideo&&t._unmuteVideo()),e},t.muteVideo=function(){var e=h.report.reportApiInvoke(t.sid,{name:"Stream.muteVideo",options:arguments,tag:"tracer"});t.userMuteVideo&&c.default.warning("[".concat(t.streamId,"] User already muteVideo")),t.userMuteVideo=!0,t.lowStream&&(t.lowStream.userMuteVideo=!0);var n=t._muteVideo();return e(null,n),n},t._unmuteAudio=function(){return c.default.debug("[".concat(t.streamId,"] Unmuted audio stream with id "),t.streamId),t._flushAudioMixingMuteStatus(!1),!(!t.hasAudio()||!t.initialized||void 0===t.stream||!0===t.stream.getAudioTracks()[0].enabled||(t._onAudioUnmute&&t._onAudioUnmute(),t.pc&&(t.pc.isAudioMute=!1),t.stream.getAudioTracks()[0].enabled=!0,0))},t._isAudioMuted=function(){if(t.stream&&t.hasAudio()){var e=t.stream.getAudioTracks();return e.length>0&&!e[0].enabled}return!1},t._isVideoMuted=function(){if(t.stream&&t.hasVideo()){var e=t.stream.getVideoTracks();return e.length>0&&!e[0].enabled}return!1},t._muteAudio=function(){return c.default.debug("[".concat(t.streamId,"] Muted audio stream with id "),t.streamId),t._flushAudioMixingMuteStatus(!0),!!(t.hasAudio()&&t.initialized&&void 0!==t.stream&&t.stream.getAudioTracks()[0].enabled)&&(t._onAudioMute&&t._onAudioMute(),t.pc&&(t.pc.isAudioMute=!0),t.stream.getAudioTracks()[0].enabled=!1,t.sid&&h.report.audioSendingStopped(t.sid,{succ:!0,reason:"muteAudio"}),!0)},t._unmuteVideo=function(){return c.default.debug("[".concat(t.streamId,"] Unmuted video stream with id"),t.streamId),!(!t.initialized||void 0===t.stream||!t.stream.getVideoTracks().length||!0===t.stream.getVideoTracks()[0].enabled||(t._onVideoUnmute&&t._onVideoUnmute(),t.pc&&(t.pc.isVideoMute=!1),t.stream.getVideoTracks()[0].enabled=!0,t.lowStream&&t.lowStream._unmuteVideo(),0))},t._muteVideo=function(){return c.default.debug("[".concat(t.streamId,"] Muted video stream with id"),t.streamId),!!(t.initialized&&void 0!==t.stream&&t.stream.getVideoTracks().length&&t.stream.getVideoTracks()[0].enabled)&&(t._onVideoMute&&t._onVideoMute(),t.pc&&(t.pc.isVideoMute=!0),t.stream.getVideoTracks()[0].enabled=!1,t.lowStream&&t.lowStream._muteVideo(),t.sid&&h.report.videoSendingStopped(t.sid,{succ:!0,reason:"muteVideo"}),!0)},t.addTrack=function(r){if(t.audio&&"audio"===r.kind)c.default.warning("already added audio track");else if(t.video&&"video"===r.kind)c.default.warning("already added video track");else{var i=h.report.reportApiInvoke(t.sid,{name:"Stream.addTrack",options:arguments,tag:"tracer"});if(t.pc&&t.pc.addTrack(r,t.stream),"audio"==r.kind){t._cleanupAudioMixing();var o=new MediaStream;t.userMuteAudio&&(r.enabled=!1),o.addTrack(r);var a=t.stream.getVideoTracks()[0];a&&o.addTrack(a),t.audio=!0,e.audio=!0,t.stream=o,t.audioLevelHelper=null,t.player&&t.player.video&&(t.player.video.srcObject=t.stream)}else t.userMuteVideo&&(r.enabled=!1),t.stream.addTrack(r),t.video=!0,e.video=!0;r.onended||(r.onended=n),i()}},t.removeTrack=function(n){if(n)if(t.audio||"audio"!==n.kind)if(t.video||"video"!==n.kind){var r=h.report.reportApiInvoke(t.sid,{name:"Stream.removeTrack",options:arguments,tag:"tracer"});t.pc&&t.pc.removeTrack(n,t.stream),t.stream.removeTrack(n),t._cleanupAudioMixing(),"audio"===n.kind?(t.audio=!1,e.audio=!1):(t.video=!1,e.video=!1),t.audioLevelHelper=null,"live"==n.readyState&&(n.stop(),c.default.debug("[".concat(t.streamId,"] Track ").concat(n.kind," Stopped"))),r()}else c.default.warning("already removed video track");else c.default.warning("already removed audio track");else c.default.warning("track doesn't exist.")},t.setAudioOutput=function(e,n,r){var i=h.report.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return r&&r(e);n&&n(t)},name:"Stream.setAudioOutput",options:arguments,tag:"tracer"});return Object(b.isValidString)(e,1,255)?(t.audioOutput=e,t.player?void t.player.setAudioOutput(e,(function(){return i()}),i):i()):(c.default.error("[".concat(t.streamId,"] setAudioOutput Invalid Parameter"),e),i(l.default.INVALID_PARAMETER))},t.play=function(e,n,r){"function"==typeof n&&(r=n,n=null),c.default.debug("[".concat(t.streamId,"] play()."),e,n);var i=h.report.reportApiInvoke(t.sid,{name:"Stream.play",options:arguments,tag:"tracer",callback:r});if(Object(b.checkValidString)(e,"elementID"),Object(b.isEmpty)(n)||(Object(b.isEmpty)(n.fit)||Object(b.checkValidEnum)(n.fit,"fit",["cover","contain"]),Object(b.isEmpty)(n.muted)||Object(b.checkValidBoolean)(n.muted,"muted")),t.player)c.default.warning("[".concat(t.streamId,"] Stream.play(): Stream is already playing. Fallback to resume stream")),t.resume().then((function(){i(null)})).catch(i);else{t.elementID=e,t.playOptions=n,!t.local||t.video||t.screen?(t.player=new p({id:t.getId(),stream:t,elementID:e,options:n}),t.local&&E.a.applyEffectInPlayer(t)):t.hasAudio()&&(t.player=new p({id:t.getId(),stream:t,elementID:e,options:n}));var o={video:null,audio:null},a=function e(n){if(o[n.mediaType]=n,o.video&&o.audio)if(t.removeEventListener("player-status-change",e),o.video.isErrorState||o.audio.isErrorState){var r=o.video.isErrorState?o.video:o.audio;i({isErrorState:!0,status:r.status,reason:r.reason,video:o.video,audio:o.audio})}else"aborted"===o.video.status&&"aborted"===o.audio.status?i({status:"aborted",reason:"stop",video:o.video,audio:o.audio}):i(null)};t.on("player-status-change",a),t.audioOutput&&t.player.setAudioOutput(t.audioOutput),void 0!==t.audioLevel&&t.player.setAudioVolume(t.audioLevel),t._flushAudioMixingMuteStatus(!1)}},t.stop=function(){var e=h.report.reportApiInvoke(t.sid,{name:"Stream.stop",options:arguments,tag:"tracer"});c.default.debug("[".concat(t.streamId,"] Stop stream player with id "),t.streamId),t.player?(E.a.removeEffectFromLocalPlayer(t),t.player.destroy(),delete t.player):c.default.error("[".concat(t.streamId,"] Stream.stop(): Stream is not playing")),t._flushAudioMixingMuteStatus(!0),e()},t.isPlaying=function(){return!!t.player},t.isPaused=function(){return!!(t.player&&(t.player.video&&t.player.video.paused&&t.player.mediaElemExists(t.player.video)||t.player.audio&&t.player.audio.paused&&t.player.mediaElemExists(t.player.audio)))},t.resume=function(){var e,n;return t.player?(t.player.video&&t.player.video.play&&(e=t.player.video.play()),e=e||Promise.resolve(),t.player.audio&&t.player.audio.play&&(n=t.player.audio.play()),n=n||Promise.resolve(),Promise.all([e,n])):Promise.reject("NO_PLAYER_FOUND")},t.getVideoTrack=function(){var e=h.report.reportApiInvoke(t.sid,{name:"Stream.getVideoTrack",options:arguments,tag:"tracer"});if(t.stream&&t.stream.getVideoTracks){var n=t.stream.getVideoTracks()[0];if(n)return c.default.info("[".concat(t.streamId,"] getVideoTrack"),n),e(),n}c.default.info("[".concat(t.streamId,"] getVideoTrack None")),e(null,"getVideoTrack None")},t.getAudioTrack=function(){var e=h.report.reportApiInvoke(t.sid,{name:"Stream.getAudioTrack",options:arguments,tag:"tracer"});if(t.stream&&t.stream.getAudioTracks){var n=t.stream.getAudioTracks()[0];if(n)return c.default.info("[".concat(t.streamId,"] getAudioTracks"),n),e(),n}c.default.info("[".concat(t.streamId,"] getAudioTracks None")),e(null,"getAudioTracks None")},t._hasVideoTracks=function(){return!!(t.stream&&t.stream.getVideoTracks&&t.stream.getVideoTracks()[0])},t._hasAudioTracks=function(){return!!(t.stream&&t.stream.getAudioTracks&&t.stream.getAudioTracks()[0])},t._replaceMediaStreamTrack=function(e,n,r){if(t.stream){if("video"==e.kind){if(o=t.stream.getVideoTracks()[0])return t.userMuteVideo&&(e.enabled=!1),t.stream.removeTrack(o),t.stream.addTrack(e),c.default.debug("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(e.kind," SUCCESS")),"live"==o.readyState&&(o.stop(),c.default.debug("[".concat(t.streamId,"] Track ").concat(o.kind," Stopped"))),n&&n();var i="MEDIASTREAM_TRACK_NOT_FOUND";return c.default.error("[".concat(t.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(e.kind)),r(i)}if("audio"==e.kind){var o;if(o=t.stream.getAudioTracks()[0]){t.userMuteAudio&&(e.enabled=!1);var a=new MediaStream;a.addTrack(e);var s=t.stream&&t.stream.getVideoTracks()[0];return s&&a.addTrack(s),t.stream=a,t.audioLevelHelper=null,t.player&&t.player.video&&(t.player.video.srcObject=t.stream),c.default.debug("[".concat(t.streamId,"] _replaceMediaStreamTrack SUCCESS")),"live"==o.readyState&&(o.stop(),c.default.debug("[".concat(t.streamId,"] Track ").concat(o.kind," Stopped"))),n&&n()}return i="MEDIASTREAM_TRACK_NOT_FOUND",c.default.error("[".concat(t.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(e.kind)),r(i)}return i="INVALID_TRACK_TYPE",c.default.error("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(i," ").concat(e.kind)),r&&r(i)}return i="NO_STREAM_FOUND",c.default.error("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(i)),r&&r(i)},t.replaceTrack=function(e,r,i){var o=h.report.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return i&&i(e);r&&r(t)},name:"Stream.replaceTrack",options:arguments,tag:"tracer"});return e&&e.kind?(t._cleanupAudioMixing(),e.onended||(e.onended=n),t.pc&&t.pc.hasSender&&t.pc.hasSender(e.kind)?void t.pc.replaceTrack(e,(function(){return c.default.debug("[".concat(t.streamId,"] PeerConnection.replaceTrack ").concat(e.kind," SUCCESS")),t._replaceMediaStreamTrack(e,(function(e){return o(null,e)}),o)}),(function(n){return c.default.error("[".concat(t.streamId,"] PeerConnection.replaceTrack ").concat(e.kind," Failed ").concat(n)),o(n)})):t._replaceMediaStreamTrack(e,(function(e){return o(null,e)}),o)):o("INVALID_TRACK")},t.setAudioVolume=function(e){var n=h.report.reportApiInvoke(t.sid,{name:"Stream.setAudioVolume",options:arguments,tag:"tracer"});Object(b.checkValidNumber)(e,"level",0,100),t.audioLevel=e,t.player&&t.player.setAudioVolume(e),n()},t.getStats=function(e,n,r){var a=[];a.push(t._getPCStats(r)),a.push(new Promise((function(e){var n={};t.pc&&t.pc.isSubscriber?null!==window.navigator.userAgent.match("Firefox")&&(Object(v.b)(n,"videoReceiveResolutionHeight",t.videoHeight),Object(v.b)(n,"videoReceiveResolutionWidth",t.videoWidth)):t.pc&&!t.pc.isSubscriber&&((Object(o.isSafari)()||Object(o.isFireFox)())&&(Object(v.b)(n,"videoSendResolutionHeight",t.videoHeight),Object(v.b)(n,"videoSendResolutionWidth",t.videoWidth)),(Object(o.isSafari)()||Object(o.isFireFox)())&&t.uplinkStats&&Object(v.b)(n,"videoSendPacketsLost",t.uplinkStats.uplink_cumulative_lost)),e(n)}))),a.push(new Promise((function(e){var n={};return t.traffic_stats&&t.pc&&t.pc.isSubscriber?(Object(v.b)(n,"accessDelay",t.traffic_stats.access_delay),Object(v.b)(n,"endToEndDelay",t.traffic_stats.e2e_delay),Object(v.b)(n,"videoReceiveDelay",t.traffic_stats.video_delay),Object(v.b)(n,"audioReceiveDelay",t.traffic_stats.audio_delay)):t.traffic_stats&&t.pc&&!t.pc.isSubscriber&&Object(v.b)(n,"accessDelay",t.traffic_stats.access_delay),e(n)}))),Promise.all(a).then((function(n){for(var r={},o=n.length-1;o>=0;o--){var a=n[o];i()(r,a)}e&&setTimeout(e.bind(t,r),0)})).catch((function(e){n&&setTimeout(n.bind(t,e),0)}))},t._getPCStats=function(e){return new Promise((function(n,r){if(!t.pc||"established"!==t.pc.state||!t.pc.getStats)return r("PEER_CONNECTION_NOT_ESTABLISHED");t.pc.getStats((function(e){if(!t.pc||"established"!==t.pc.state||!t.pc.getStats)return r("PEER_CONNECTION_STATE_CHANGE");var i=t.pc.isSubscriber?Object(v.c)(e):Object(v.a)(e);return n(i)}),e)})).then((function(e){return t.pc.isSubscriber?(Object(o.isFireFox)()||Object(o.isSafari)())&&(e.videoReceiveResolutionHeight&&"0"!==e.videoReceiveResolutionHeight||e.videoReceiveResolutionWidth&&"0"!==e.videoReceiveResolutionWidth||(Object(v.b)(e,"videoReceiveResolutionHeight",t.videoHeight),Object(v.b)(e,"videoReceiveResolutionWidth",t.videoWidth))):((Object(o.isSafari)()||Object(o.isFireFox)())&&(e.videoSendResolutionHeight&&"0"!==e.videoSendResolutionHeight||e.videoSendResolutionWidth&&"0"!==e.videoSendResolutionWidth||(Object(v.b)(e,"videoSendResolutionHeight",t.videoHeight),Object(v.b)(e,"videoSendResolutionWidth",t.videoWidth))),(Object(o.isSafari)()||Object(o.isFireFox)())&&t.uplinkStats&&Object(v.b)(e,"videoSendPacketsLost",t.uplinkStats.uplink_cumulative_lost)),Promise.resolve(e)}))},t.getAudioLevel=function(){if(t.audioLevelHelper)return t.audioLevelHelper.getAudioLevel();if(t.stream){if(0!==t.stream.getAudioTracks().length)return t.audioLevelHelper=new g.audioLevelHelper(t.stream),t.audioLevelHelper.getAudioLevel();c.default.warning("[".concat(t.streamId,"] can't get audioLevel beacuse no audio trace in stream"))}else c.default.warning("[".concat(t.streamId,"] can't get audioLevel beacuse no stream exist"))},t.setVideoProfile("480p_1"),t._switchVideoDevice=function(e,n,r){if(e===t.cameraId)return n&&n();var o={video:i()({},t.videoConstraint,{deviceId:{exact:e}}),audio:!1};c.default.debug("[".concat(t.streamId,"] ").concat(o)),Object(m.b)(o,(function(i){try{var o=function(){t.isPlaying()&&(t.stop(),t.elementID&&t.play(t.elementID,t.playOptions)),t.cameraId=e,t.videoConstraint.deviceId={exact:e},t.userMuteVideo&&(t.stream.getVideoTracks()[0].enabled=!1),E.a.restoreVideoEffect(t).then((function(){n&&n()}))};E.a.disableVideoEffect(t).then((function(){var e=!1;window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack&&(e=!0),e?t.replaceTrack(i.getVideoTracks()[0],o,r):(t.removeTrack(t.stream.getVideoTracks()[0]),t.addTrack(i.getVideoTracks()[0]),o())}))}catch(e){return r&&r(e)}}),(function(e){return r&&r(e)}))},t._switchAudioDevice=function(e,n,r){if(e===t.microphoneId)return n&&n();var o={video:!1,audio:i()({},t.audioConstraint,{deviceId:{exact:e}})};c.default.debug("[".concat(t.streamId,"] "),o);var a=t.stream.getAudioTracks()[0];a&&a.stop(),Object(m.b)(o,(function(i){var o=function(){t._cleanupAudioMixing(),t.userMuteAudio&&(t.stream.getAudioTracks()[0].enabled=!1),t.isPlaying()&&(t.stop(),t.elementID&&t.play(t.elementID,t.playOptions)),t.microphoneId=e,t.audioConstraint.deviceId={exact:e},n&&n()};try{var a=!1;window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack&&(a=!0),a?t.replaceTrack(i.getAudioTracks()[0],o,r):(t.removeTrack(t.stream.getAudioTracks()[0]),t.addTrack(i.getAudioTracks()[0]),o())}catch(e){return r&&r(e)}}),(function(e){return r&&r(e)}))},t.switchDevice=function(e,n,r,i){var o=h.report.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return i&&i(e);r&&r(t)},name:"Stream.switchDevice",options:arguments,tag:"tracer"});Object(b.checkValidString)(n,"deviceId");var a=function(){return t.inSwitchDevice=!1,o()},s=function(e){t.inSwitchDevice=!1,c.default.error("[".concat(t.streamId,"] "),e),o(e)};if(t.inSwitchDevice)return o("Device switch is in process.");if(t.inSwitchDevice=!0,!t.local)return s("Only the local stream can switch the device.");if(t.screen&&"video"===e)return s("The device cannot be switched during screen-sharing.");if(!t.video&&"video"===e)return s("Video track not exist.");if(!t.audio&&"audio"===e)return s("Audio track not exist.");if(t.videoSource||t.audioSource)return s("The device cannot be switched when using videoSource or audioSource.");var u=!1;for(var l in t.audioMixing.sounds){var d=t.audioMixing.sounds[l];if(d.state!==t.audioMixing.states.IDLE){u=!0;break}}var f=t.audioMixing.audioContextInited;if(f&&u)return s("The device cannot be switched when using audio Mixing.");y.a.getDeviceById(n,(function(){if("video"===e)t._switchVideoDevice(n,a,s);else{if("audio"!==e)return s("Invalid type.");t._switchAudioDevice(n,a,s)}}),(function(){return s("The device does not exist.")}))},t},I=function(e){var t=h.report.reportApiInvoke(null,{name:"createStream",options:arguments,tag:"tracer",getStates:function(){return{audioTrackEnable:e&&e.audioSource?e.audioSource.enabled:null,videoTrackEnable:e&&e.videoSource?e.videoSource.enabled:null}}});Object(b.checkValidObject)(e,"StreamSpec");var n=e.streamID,r=e.audio,i=e.video,o=e.screen,a=e.screenAudio,s=(e.audioSource,e.videoSource,e.cameraId),u=e.facingMode,l=e.microphoneId,d=e.mirror,f=e.extensionId,p=e.mediaSource,m=e.audioProcessing,v=e.optimizationMode;if(!Object(b.isEmpty)(n)&&!Object(g.is32Uint)(n)&&!Object(b.isValidString)(n,1,255))throw new Error("[String streamID] Length of the string: [1,255]. ASCII characters only. [Number streamID] The value range is Uint32");if(Object(b.checkValidBoolean)(r,"audio"),Object(b.checkValidBoolean)(i,"video"),Object(b.isEmpty)(o)||Object(b.checkValidBoolean)(o,"screen"),Object(b.isEmpty)(a)||Object(b.checkValidBoolean)(a,"screenAudio"),Object(b.isEmpty)(s)||Object(b.checkValidString)(s,"cameraId",0,255,!1),Object(b.isEmpty)(u)||Object(b.checkValidEnum)(u,"facingMode",["user","environment","left","right"]),Object(b.isEmpty)(l)||Object(b.checkValidString)(l,"microphoneId",0,255,!1),Object(b.isEmpty)(f)||Object(b.checkValidString)(f,"extensionId"),Object(b.isEmpty)(p)||Object(b.checkValidEnum)(p,"mediaSource",["screen","application","window"]),Object(b.isEmpty)(d)||Object(b.checkValidBoolean)(d,"mirror"),!Object(b.isEmpty)(m)){var y=m.AGC,_=m.AEC,E=m.ANS;Object(b.isEmpty)(y)||Object(b.checkValidBoolean)(y,"AGC"),Object(b.isEmpty)(_)||Object(b.checkValidBoolean)(_,"AEC"),Object(b.isEmpty)(E)||Object(b.checkValidBoolean)(E,"ANS")}Object(b.isEmpty)(v)||Object(b.checkValidEnum)(v,"optimizationMode",["detail","motion"]),c.default.debug("Create stream"),!0===a&&!0===r&&c.default.warning("Do not set both 'screenAudio' and 'audio' to true at the same time"),e.screen&&!v&&(e.optimizationMode="detail");var S=x(e);return t(),S}},function(e,t,n){"use strict";n.d(t,"a",(function(){return E})),n.d(t,"b",(function(){return S}));var r=n(4),i=n(7),o=n.n(i),a=n(12),s=n.n(a),c=n(17),u=n.n(c),l=n(0),d=n(15),h=n(2);function f(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v=n(50),y=n.n(v),b=n(26),_=(n(5),103),E=function(e){var t={};if(t.clientId=e.clientId,e.session_id=_+=1,"undefined"==typeof window||!window.navigator)throw l.default.error("["+t.streamId+"]["+t.clientId+"]Publish/subscribe video/audio streams not supported yet"),new Error("NON_BROWSER_ENV_DETECTED");return null!==window.navigator.userAgent.match("Firefox")?(t.browser="mozilla",t=function(e){var t={},n=(mozRTCPeerConnection,mozRTCSessionDescription),r=!1;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isAudioMute=e.isAudioMute,t.isSubscriber=e.isSubscriber,t.clientId=e.clientId,t.filterStatsCache=[],t.originStatsCache=[],t.lastTimeGetStats=null,t.pc_config={iceServers:[]},e.iceServers instanceof Array?e.iceServers.map((function(e){0===e.url.indexOf("stun:")&&t.pc_config.iceServers.push({url:e.url})})):(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map((function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})})):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServers&&(e.turnServers instanceof Array?e.turnServers.map((function(e){e.udpport&&t.pc_config.iceServers.push({username:e.username,credential:e.credential,credentialType:"password",urls:(e.useTurns?"turns:":"turn:")+e.url+":"+e.udpport+"?transport=udp"}),"string"==typeof e.tcpport&&""!==e.tcpport&&t.pc_config.iceServers.push({username:e.username,credential:e.credential,credentialType:"password",urls:(e.useTurns?"turns:":"turn:")+e.url+":"+e.tcpport+"?transport=tcp"}),!0===e.forceturn&&(t.pc_config.iceTransportPolicy="relay")})):l.default.error("[".concat(t.clientId,"] turnServers is not a array")))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,mozDontOfferDataChannel:!0},t.roapSessionId=103,t.peerConnection=new d.RTCPeerConnection(t.pc_config),t.iceCandidateTimer=setTimeout((function(){t.iceCandidateTimer=null,l.default.debug("[".concat(t.clientId,"]Candidates collected: ").concat(t.iceCandidateCount)),t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),Object(h.getParameter)("CANDIDATE_TIMEOUT")),t.peerConnection.onicecandidate=function(e){var n,r,i,o;r=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),i=n.match(/a=candidate:.+typ\shost.+\r\n/),o=n.match(/a=candidate:.+typ\srelay.+\r\n/),null===r&&null===i&&null===o||void 0!==t.ice||!t.iceCandidateTimer||(clearTimeout(t.iceCandidateTimer),t.iceCandidateTimer=null,t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1},t.checkMLineReverseInSDP=function(e){return!(!~e.indexOf("m=audio")||!~e.indexOf("m=video"))&&e.indexOf("m=audio")>e.indexOf("m=video")},t.reverseMLineInSDP=function(e){var t=e.split("m=audio"),n=t[1].split("m=video"),r="m=video"+n[1],i="m=audio"+n[0];return t[0]+r+i},t.processSignalingMessage=function(r){var i,o=JSON.parse(r);t.incomingMessage=o,"new"===t.state?"OFFER"===o.messageType?(o.sdp=v(o.sdp),i={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new n(i),(function(){l.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){l.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)})),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===o.messageType?(o.sdp=v(o.sdp),o.sdp=o.sdp.replace(/ generation 0/g,""),o.sdp=o.sdp.replace(/ udp /g," UDP "),-1!==o.sdp.indexOf("a=group:BUNDLE")?(o.sdp=o.sdp.replace(/a=group:BUNDLE audio video/,"a=group:BUNDLE sdparta_0 sdparta_1"),o.sdp=o.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),o.sdp=o.sdp.replace(/a=mid:video/,"a=mid:sdparta_1")):(o.sdp=o.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),o.sdp=o.sdp.replace(/a=mid:video/,"a=mid:sdparta_0")),i={sdp:o.sdp,type:"answer"},e.screen&&"detail"===e.optimizationMode&&(l.default.debug("[".concat(t.client,"] remove screen share abs ext")),o.sdp=y(i.sdp)),t.peerConnection.setRemoteDescription(new n(i),(function(){l.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){l.default.info("["+t.clientId+"]setRemoteDescription failed: "+e)})),t.state="established"):"pr-answer"===o.messageType?(i={sdp:o.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new n(i),(function(){l.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){l.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)}))):"offer"===o.messageType?t.error("Not written yet"):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===o.messageType?(i={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new n(i),(function(){l.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){l.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)})),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state))},t.setRtpSenderParameters=function(){var e=u()(s.a.mark((function e(n){var r,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.peerConnection.getSenders(),i=r.find((function(e){return"video"===e.track.kind}))){e.next=4;break}return e.abrupt("return");case 4:return(o=i.getParameters()).degradationPreference=n,e.prev=6,l.default.debug("[".concat(t.clientId,"] setParameters"),o),e.next=10,i.setParameters(o);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),l.default.debug("[".concat(t.clientId,"] setParameters failed, ignore"));case 15:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}();var i={id:"",type:"",mediaType:"opus",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},o={id:"",type:"",mediaType:"",googCodecName:e.codec?e.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},a={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},c={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesDecoded:"0"},f=0,p=0,g=0;t.getVideoRelatedStats=function(e){t.peerConnection.getStats().then((function(n){var r,i=m(n.values());try{for(i.s();!(r=i.n()).done;){var o=r.value;if(t.isSubscriber){if(("inbound-rtp"===o.type||"inboundrtp"===o.type)&&"video"===o.mediaType){if(!t.lastReport)return void(t.lastReport=o);e&&e({browser:"firefox",mediaType:"video",peerId:t.uid,isVideoMute:t.isVideoMute,frameRateReceived:Math.round(o.framerateMean)+"",frameRateDecoded:o.framesDecoded-t.lastReport.framesDecoded+"",bytesReceived:o.bytesReceived+"",packetsReceived:o.packetsReceived+"",packetsLost:o.packetsLost+""}),t.lastReport=o}}else if(("outbound-rtp"===o.type||"outboundrtp"===o.type)&&"video"===o.mediaType){if(!t.lastReport)return void(t.lastReport=o);e&&e({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:Math.round(o.framerateMean)+"",frameRateSent:o.framesEncoded-t.lastReport.framesEncoded+""}),t.lastReport=o}}}catch(e){i.e(e)}finally{i.f()}}))},t.getAudioRelatedStats=function(e){t.peerConnection.getStats().then((function(n){var r,i=m(n.values());try{for(i.s();!(r=i.n()).done;){var o=r.value;t.isSubscriber&&("inbound-rtp"!==o.type&&"inboundrtp"!==o.type||"audio"!==o.mediaType||e&&e({browser:"firefox",mediaType:"audio",peerId:t.uid,isAudioMute:t.isAudioMute,frameDropped:o.packetsLost+"",frameReceived:o.packetsReceived+"",googJitterReceived:o.jitter+"",bytesReceived:o.bytesReceived+"",packetsReceived:o.packetsReceived+"",packetsLost:o.packetsLost+""}))}}catch(e){i.e(e)}finally{i.f()}}))},t.getStatsRate=function(e){t.getStats((function(t){t.forEach((function(e){})),e(t)}))},t.getStats=function(e,n){n=(n=n||500)>500?500:n,t.lastTimeGetStats&&Date.now()-t.lastTimeGetStats<n?e&&e(t.filterStatsCache,t.originStatsCache):this._getStats((function(n,r){t.filterStatsCache=n,t.originStatsCache=r,t.lastTimeGetStats=Date.now(),e&&e(n,r)}))},t._getStats=function(n){t.peerConnection.getStats().then((function(r){var s,u=[],l=m(r.values());try{for(l.s();!(s=l.n()).done;){var d=s.value;u.push(d),"outbound-rtp"!==d.type&&"outboundrtp"!==d.type||"video"!==d.mediaType||-1!==d.id.indexOf("rtcp")||(o.id=d.id,o.type=d.type,o.mediaType=d.mediaType,o.bytesSent=d.bytesSent?d.bytesSent+"":"0",o.packetsSent=d.packetsSent?d.packetsSent+"":"0",o.googPlisReceived=d.pliCount?d.pliCount+"":"0",o.googNacksReceived=d.nackCount?d.nackCount+"":"0",o.googFirsReceived=d.firCount?d.firCount+"":"0",o.googFrameRateSent=d.framerateMean?Math.round(d.framerateMean)+"":"0"),"outbound-rtp"!==d.type&&"outboundrtp"!==d.type||"audio"!==d.mediaType||-1!==d.id.indexOf("rtcp")||(i.id=d.id,i.type=d.type,i.mediaType=d.mediaType,i.bytesSent=d.bytesSent?d.bytesSent+"":"0",i.packetsSent=d.packetsSent?d.packetsSent+"":"0",e.agoraStream.local&&(i.audioInputLevel=Math.round(32767*e.agoraStream.getAudioLevel()).toString())),"inbound-rtp"!==d.type&&"inboundrtp"!==d.type||"audio"!==d.mediaType||d.isRemote||-1!==d.id.indexOf("rtcp")||(a.id=d.id,a.type=d.type,a.mediaType=d.mediaType,a.bytesReceived=d.bytesReceived?d.bytesReceived+"":"0",a.packetsLost=d.packetsLost?d.packetsLost+"":"0",a.packetsReceived=d.packetsReceived?d.packetsReceived+"":"0",a.googJitterReceived=d.jitter?d.jitter+"":"0",e.agoraStream.local||(a.audioOutputLevel=Math.round(32767*e.agoraStream.getAudioLevel()).toString())),"inbound-rtp"!==d.type&&"inboundrtp"!==d.type||"video"!==d.mediaType||d.isRemote||-1!==d.id.indexOf("rtcp")||(c.id=d.id,c.type=d.type,c.mediaType=d.mediaType,c.bytesReceived=d.bytesReceived?d.bytesReceived+"":"0",c.googFrameRateReceived=d.framerateMean?Math.round(d.framerateMean)+"":"0",c.googFramesDecoded=d.framesDecoded?d.framesDecoded+"":"0",Date.now()-g>=1e3?(c.googFrameRateDecoded=(d.framesDecoded-f)/((Date.now()-g)/1e3),c.googFrameRateDecoded=Math.round(Math.max(0,c.googFrameRateDecoded)),g=Date.now(),p=c.googFrameRateDecoded,f=d.framesDecoded,c.googFrameRateDecoded=c.googFrameRateDecoded.toString()):c.googFrameRateDecoded=p.toString(),c.packetsLost=d.packetsLost?d.packetsLost+"":"0",c.packetsReceived=d.packetsReceived?d.packetsReceived+"":"0",c.googJitterBufferMs=d.jitter?d.jitter+"":"0",c.googNacksSent=d.nackCount?d.nackCount+"":"0",c.googPlisSent=d.pliCount?d.pliCount+"":"0",c.googFirsSent=d.firCount?d.firCount+"":"0"),-1!==d.id.indexOf("outbound_rtcp_video")&&(o.packetsLost=d.packetsLost?d.packetsLost+"":"0")}}catch(e){l.e(e)}finally{l.f()}var h=[o,i,a,c];h.push({id:"time",startTime:t.connectedTime,timestamp:new Date}),n(h,u)}),(function(e){l.default.error("["+t.clientId+"]"+e)}))},t.addStream=function(e){r=!0,t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater((function(){t.onstablestate()}))},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){if(t.actionNeeded){if("new"===t.state||"established"===t.state)r&&(t.mediaConstraints=void 0),t.peerConnection.createOffer((function(e){if(e.sdp=v(e.sdp),e.sdp=e.sdp.replace(/a=extmap:1 http:\/\/www.webrtc.org\/experiments\/rtp-hdrext\/abs-send-time/,"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"),e.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(e),t.state="preparing-offer",void t.markActionNeeded();l.default.debug("["+t.clientId+"]Not sending a new offer")}),(function(e){l.default.debug("["+t.clientId+"]Ups! create offer failed ",e)}),t.mediaConstraints);else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.offerCandidates=t.prevOffer.match(/a=candidate.+\r\n/g)||[],t.offerCandidates.length||(e.isCloudProxy3&&e.onNoIceCandidate&&e.onNoIceCandidate(),l.default.warning("[".concat(t.clientId,"]No Ice Candidate generated")),Object(h.getParameter)("SHIM_CANDIDATE")?(l.default.debug("Shimming fake candidate"),t.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):l.default.error("[".concat(t.clientId,"]None Ice Candidate not allowed"))),t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer((function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;l.default.debug("["+t.clientId+"]"+n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}}),(function(){l.default.debug("["+t.clientId+"]Ups! Something went wrong")}));else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;var n=t.peerConnection.localDescription.sdp;t.sendMessage("ANSWER",n),t.state="established"}else t.debug("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendMessage=function(e,n){var r={};r.messageType=e,r.sdp=n,"OFFER"===e?(r.offererSessionId=t.sessionId,r.answererSessionId=t.otherSessionId,r.seq=t.sequenceNumber+=1,r.tiebreaker=Math.floor(429496723*Math.random()+1)):(r.offererSessionId=t.incomingMessage.offererSessionId,r.answererSessionId=t.sessionId,r.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(r))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find((function(t){return t.track.kind==e}));if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,r){var i=t._getSender(e.kind);if(!i)return r("NO_SENDER_FOUND");try{i.replaceTrack(e)}catch(e){return r&&r(e)}setTimeout((function(){return n&&n()}),50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&t.onaddstream(e,"ontrack")},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)};var v=function(t){var n;if(e.video&&e.maxVideoBW&&(null==(n=t.match(/m=video.*\r\n/))&&(n=t.match(/m=video.*\n/)),n&&n.length>0)){var r=n[0]+"b=TIAS:"+1e3*e.maxVideoBW+"\r\n";t=t.replace(n[0],r)}return e.audio&&e.maxAudioBW&&(null==(n=t.match(/m=audio.*\r\n/))&&(n=t.match(/m=audio.*\n/)),n&&n.length>0)&&(r=n[0]+"b=TIAS:"+1e3*e.maxAudioBW+"\r\n",t=t.replace(n[0],r)),t},y=function(e){return(e=e.replace(/a=.*abs-send-time\r\n/g,"")).replace(/a=.*goog-remb\r\n/g,"")};return t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t}(e)):"iOS"===r.getBrowserOS()||r.isSafari()?(l.default.debug("["+t.streamId+"]["+t.clientId+"]Safari"),(t=function(e){var t={},n=d.RTCPeerConnection;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isAudioMute=e.isAudioMute,t.isSubscriber=e.isSubscriber,t.clientId=e.clientId,t.filterStatsCache=[],t.originStatsCache=[],t.lastTimeGetStats=null,t.pc_config={iceServers:[],bundlePolicy:"max-bundle"},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array?t.pc_config.iceServers=e.iceServers:(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map((function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})})):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServers&&(e.turnServers instanceof Array?e.turnServers.map((function(e){e.udpport&&t.pc_config.iceServers.push({username:e.username,credential:e.credential,credentialType:"password",urls:(e.useTurns?"turns:":"turn:")+e.url+":"+e.udpport+"?transport=udp"}),"string"==typeof e.tcpport&&""!==e.tcpport&&t.pc_config.iceServers.push({username:e.username,credential:e.credential,credentialType:"password",urls:(e.useTurns?"turns:":"turn:")+e.url+":"+e.tcpport+"?transport=tcp"}),!0===e.forceturn&&(t.pc_config.iceTransportPolicy="relay")})):l.default.error("[".concat(t.clientId,"] turnServers is not a array")))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}},t.roapSessionId=103;try{t.pc_config.sdpSemantics=Object(h.getParameter)("PLAN"),t.peerConnection=new n(t.pc_config,t.con)}catch(e){delete t.pc_config.sdpSemantics,t.peerConnection=new n(t.pc_config,t.con)}t.iceCandidateTimer=setTimeout((function(){t.iceCandidateTimer=null,t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),Object(h.getParameter)("CANDIDATE_TIMEOUT")),t.peerConnection.onicecandidate=function(e){var n,r,i,o;r=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),i=n.match(/a=candidate:.+typ\shost.+\r\n/),o=n.match(/a=candidate:.+typ\srelay.+\r\n/),0===t.iceCandidateCount&&(t.timeout=setTimeout((function(){t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),1e3)),null===r&&null===i&&null===o||void 0!==t.ice||!t.iceCandidateTimer||(clearTimeout(t.iceCandidateTimer),t.iceCandidateTimer=null,t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1};var r=function(t){return e.screen&&(t=t.replace("a=x-google-flag:conference\r\n","")),t},i=function(n){var r,i;return(r=n.match(/m=video.*\r\n/))&&e.minVideoBW&&e.maxVideoBW&&(i=r[0]+"b=AS:"+e.maxVideoBW+"\r\n",n=n.replace(r[0],i),l.default.debug("["+t.clientId+"]Set Video Bitrate - min:"+e.minVideoBW+" max:"+e.maxVideoBW)),(r=n.match(/m=audio.*\r\n/))&&e.maxAudioBW&&(i=r[0]+"b=AS:"+e.maxAudioBW+"\r\n",n=n.replace(r[0],i)),n};t.processSignalingMessage=function(n){var o,a=JSON.parse(n);t.incomingMessage=a,"new"===t.state?"OFFER"===a.messageType?(o={sdp:a.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(o)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+a.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===a.messageType?((o={sdp:a.sdp,type:"answer"}).sdp=r(o.sdp),o.sdp=i(o.sdp),o.sdp=o.sdp.replace(/a=x-google-flag:conference\r\n/g,""),e.screen&&"detail"===e.optimizationMode&&(l.default.debug("[".concat(t.client,"] remove screen share abs ext")),o.sdp=o.sdp.replace(/a=.*abs-send-time\r\n/g,"").replace(/a=.*goog-remb\r\n/g,"")),t.peerConnection.setRemoteDescription(new RTCSessionDescription(o)),t.state="established"):"pr-answer"===a.messageType?(o={sdp:a.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(o))):"offer"===a.messageType?t.error("Not written yet"):t.error("Illegal message for this state: "+a.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===a.messageType?(o={sdp:a.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(o)),t.state="offer-received",t.markActionNeeded()):"ANSWER"===a.messageType?((o={sdp:a.sdp,type:"answer"}).sdp=r(o.sdp),o.sdp=i(o.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(o))):t.error("Illegal message for this state: "+a.messageType+" in state "+t.state))},t.setRtpSenderParameters=function(){var e=u()(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.degradation=n;case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t._setRtpSenderParameters=function(){var e=u()(s.a.mark((function e(n){var r,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.peerConnection.getSenders(),i=r.find((function(e){return e&&e.track&&"video"===e.track.kind}))){e.next=4;break}return e.abrupt("return");case 4:return(o=i.getParameters()).degradationPreference=n,e.prev=6,l.default.debug("[".concat(t.clientId,"] setParameters"),o),e.next=10,i.setParameters(o);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),l.default.debug("[".concat(t.clientId,"] setParameters failed, ignore"));case 15:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}();var o={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},a={id:"",type:"",mediaType:"",googCodecName:e.codec?e.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},c={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},f={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"},p={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"},m=0,g=0,v=0;return t.isRemoteVideoStats=function(e){return!!(e.frameHeight&&e.frameWidth&&e.remoteSource)},t.getVideoRelatedStats=function(n){t.peerConnection.getStats().then((function(r){r.forEach((function(r){if(t.isSubscriber){var i={peerId:t.uid,mediaType:"video",isVideoMute:t.isVideoMute};if("track"===r.type&&(~r.id.indexOf("video")||~r.trackIdentifier.indexOf("v")||t.isRemoteVideoStats(r))){if(!t.lastReport)return void(t.lastReport=r);i.frameRateReceived=r.framesReceived-t.lastReport.framesReceived+"",i.frameRateDecoded=r.framesDecoded-t.lastReport.framesDecoded+"",t.lastReport=r}"inbound-rtp"===r.type&&~r.id.indexOf("Video")&&(i.bytesReceived=r.bytesReceived+"",i.packetsReceived=r.packetsReceived+"",i.packetsLost=r.packetsLost+""),n&&n(i)}else if("outbound-rtp"===r.type&&~r.id.indexOf("Video")){if(!t.lastReport)return void(t.lastReport=r);n&&n({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:e.maxFrameRate+"",frameRateSent:r.framesEncoded-t.lastReport.framesEncoded+""}),t.lastReport=r}}))}))},t.getAudioRelatedStats=function(e){t.peerConnection.getStats().then((function(n){n.forEach((function(n){t.isSubscriber&&"inbound-rtp"===n.type&&~n.id.indexOf("Audio")&&e&&e({peerId:t.uid,mediaType:"audio",isAudioMute:t.isAudioMute,frameDropped:n.packetsLost+"",frameReceived:n.packetsReceived+"",googJitterReceived:n.jitter+"",bytesReceived:n.bytesReceived+"",packetsReceived:n.packetsReceived+"",packetsLost:n.packetsLost+""})}))}))},t.getStatsRate=function(e){t.getStats((function(t){t.forEach((function(e){"outbound-rtp"===e.type&&"video"===e.mediaType&&e.googFramesEncoded&&(e.googFrameRateSent=Math.ceil((e.googFramesEncoded-m)/3).toString(),m=e.googFramesEncoded),"inbound-rtp"===e.type&&-1!=e.id.indexOf("55543")&&(e.googFrameRateReceived&&(e.googFrameRateReceived=Math.ceil((e.googFrameReceived-v)/3).toString(),v=e.googFrameReceived),e.googFrameRateDecoded&&(e.googFrameRateDecoded=Math.ceil((e.googFramesDecoded-g)/3).toString(),g=e.googFramesDecoded))})),e(t)}))},t.getStats=function(e,n){n=(n=n||500)>500?500:n,t.lastTimeGetStats&&Date.now()-t.lastTimeGetStats<n?e&&e(t.filterStatsCache,t.originStatsCache):this._getStats((function(n,r){t.filterStatsCache=n,t.originStatsCache=r,t.lastTimeGetStats=Date.now(),e&&e(n,r)}))},t._getStats=function(n){var r=[];t.peerConnection.getStats().then((function(i){i.forEach((function(t){var n;r.push(t),"outbound-rtp"===t.type&&"audio"===t.mediaType&&(o.id=t.id,o.type=t.type,o.mediaType=t.mediaType,o.bytesSent=t.bytesSent?t.bytesSent+"":"0",o.packetsSent=t.packetsSent?t.packetsSent+"":"0",e.agoraStream.local&&(o.audioInputLevel=Math.round(32767*e.agoraStream.getAudioLevel()).toString())),"outbound-rtp"===t.type&&"video"===t.mediaType&&(a.id=t.id,a.type=t.type,a.mediaType=t.mediaType,a.bytesSent=t.bytesSent?t.bytesSent+"":"0",a.packetsSent=t.packetsSent?t.packetsSent+"":"0",a.googPlisReceived=t.pliCount?t.pliCount+"":"0",a.googNacksReceived=t.nackCount?t.nackCount+"":"0",a.googFirsReceived=t.firCount?t.firCount+"":"0",a.googFramesEncoded=t.framesEncoded?t.framesEncoded+"":"0",(n=i.get(t.trackId))&&(a.googFrameHeightSent=n.frameHeight&&n.frameHeight.toString(),a.googFrameWidthSent=n.frameWidth&&n.frameWidth.toString())),"inbound-rtp"!==t.type||-1==t.id.indexOf("44444")&&"audio"!==t.mediaType||(c.id=t.id,c.type=t.type,c.mediaType="audio",c.packetsReceived=t.packetsReceived?t.packetsReceived+"":"0",c.bytesReceived=t.bytesReceived?t.bytesReceived+"":"0",c.packetsLost=t.packetsLost?t.packetsLost+"":"0",c.packetsReceived=t.packetsReceived?t.packetsReceived+"":"0",c.googJitterReceived=t.jitter?t.jitter+"":"0",(n=i.get(t.trackId))&&(c.audioOutputLevel=n.audioLevel&&Math.round(32767*n.audioLevel).toString()),e.agoraStream.local||c.audioOutputLevel||(c.audioOutputLevel=Math.round(32767*e.agoraStream.getAudioLevel()).toString())),"inbound-rtp"!==t.type||-1==t.id.indexOf("55543")&&"video"!==t.mediaType||(f.id=t.id,f.type=t.type,f.mediaType="video",f.packetsReceived=t.packetsReceived?t.packetsReceived+"":"0",f.bytesReceived=t.bytesReceived?t.bytesReceived+"":"0",f.packetsLost=t.packetsLost?t.packetsLost+"":"0",f.googJitterBufferMs=t.jitter?t.jitter+"":"0",f.googNacksSent=t.nackCount?t.nackCount+"":"0",f.googPlisSent=t.pliCount?t.pliCount+"":"0",f.googFirsSent=t.firCount?t.firCount+"":"0",(n=i.get(t.trackId))&&(f.googFrameHeightReceived=n.frameHeight&&n.frameHeight.toString(),f.googFrameWidthReceived=n.frameWidth&&n.frameWidth.toString(),f.googFrameReceived=n.framesReceived&&n.framesReceived.toString(),f.googFramesDecoded=n.framesDecoded&&n.framesDecoded.toString())),"candidate-pair"===t.type&&(0==t.availableIncomingBitrate?p.googAvailableSendBandwidth=t.availableOutgoingBitrate+"":p.googAvailableReceiveBandwidth=t.availableIncomingBitrate+"")}));var s=[p,o,a,c,f];s.push({id:"time",startTime:t.connectedTime,timestamp:new Date}),n(s,r)})).catch((function(e){l.default.error("["+t.clientId+"] ",e)}))},t.addTrack=function(e,n){t.peerConnection.addTrack(e,n)},t.removeTrack=function(e,n){var r=t.peerConnection.getSenders().find((function(t){return t.track==e}));r.replaceTrack(null),t.peerConnection.removeTrack(r)},t.addStream=function(e){window.navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")?e.getTracks().forEach((function(n){return t.peerConnection.addTrack(n,e)})):t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater((function(){t.onstablestate()}))},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){var n;if(t.actionNeeded){if("new"===t.state||"established"===t.state)e.isSubscriber&&(t.peerConnection.addTransceiver("audio",{direction:"recvonly"}),t.peerConnection.addTransceiver("video",{direction:"recvonly"})),t.peerConnection.createOffer(t.mediaConstraints).then((function(n){if(n.sdp=i(n.sdp),e.isSubscriber||(n.sdp=n.sdp.replace(/a=.*video-orientation\r\n/g,"")),n.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(n),t.state="preparing-offer",void t.markActionNeeded();l.default.debug("["+t.clientId+"]Not sending a new offer")})).catch((function(e){l.default.debug("["+t.clientId+"]peer connection create offer failed ",e)}));else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.offerCandidates=t.prevOffer.match(/a=candidate.+\r\n/g)||[],t.offerCandidates.length||(l.default.warning("[".concat(t.clientId,"]No Ice Candidate generated")),e.isCloudProxy3&&e.onNoIceCandidate&&e.onNoIceCandidate(),Object(h.getParameter)("SHIM_CANDIDATE")?(l.default.debug("Shimming fake candidate"),t.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):l.default.error("[".concat(t.clientId,"]None Ice Candidate not allowed"))),t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer((function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;l.default.debug("["+t.clientId+"]"+n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}}),(function(e){l.default.debug("["+t.clientId+"]peer connection create answer failed ",e)}),t.mediaConstraints);else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;n=t.peerConnection.localDescription.sdp,t.sendMessage("ANSWER",n),t.state="established"}else t.debug("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendMessage=function(e,n){var r={};r.messageType=e,r.sdp=n,"OFFER"===e?(r.offererSessionId=t.sessionId,r.answererSessionId=t.otherSessionId,r.seq=t.sequenceNumber+=1,r.tiebreaker=Math.floor(429496723*Math.random()+1)):(r.offererSessionId=t.incomingMessage.offererSessionId,r.answererSessionId=t.sessionId,r.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(r))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find((function(t){return t.track.kind==e}));if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,r){var i=t._getSender(e.kind);if(!i)return r("NO_SENDER_FOUND");try{i.replaceTrack(e)}catch(e){return r&&r(e)}setTimeout((function(){return n&&n()}),50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&t.onaddstream(e,"ontrack")},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date,t._setRtpSenderParameters(t.degradation)),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},t.renegotiate=function(){t.isSubscriber||(l.default.debug("[".concat(t.uid,"]"),"renegotiating"),void 0!==t.prevOffer&&t.peerConnection.createOffer().then((function(e){return e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n"),e.sdp=r(e.sdp),e.sdp=i(e.sdp),t.peerConnection.setLocalDescription(e)})).then((function(){t.onnegotiationneeded&&t.onnegotiationneeded(t.peerConnection.localDescription.sdp)})).catch((function(e){l.default.error("createOffer error: ",e)})))},t.isSubscriber||(t.peerConnection.onnegotiationneeded=t.renegotiate),t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t}(e)).browser="safari"):~window.navigator.userAgent.indexOf("Edge")?t=new y.a(e):(t=function(e){var t={},n=d.RTCPeerConnection;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isAudioMute=e.isAudioMute,t.isSubscriber=e.isSubscriber,t.clientId=e.clientId,t.filterStatsCache=[],t.originStatsCache=[],t.lastTimeGetStats=null,t.pc_config={iceServers:[]};var i={id:"outbound_audio_ssrc_send",type:"ssrc",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},a={id:"outbound_video_ssrc_send",type:"ssrc",mediaType:"",googCodecName:e.codec?e.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},c={id:"inbound_audio_ssrc_recv",type:"ssrc",mediaType:"",googCodecName:"opus",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},p={id:"inbound_video_ssrc_recv",type:"ssrc",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesReceived:"0",googFramesDecoded:"0"},m={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"};t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array?t.pc_config.iceServers=e.iceServers:(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map((function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})})):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServers&&(e.turnServers instanceof Array?e.turnServers.map((function(e){e.udpport&&t.pc_config.iceServers.push({username:e.username,credential:e.credential,credentialType:"password",urls:(e.useTurns?"turns:":"turn:")+e.url+":"+e.udpport+"?transport=udp"}),"string"==typeof e.tcpport&&""!==e.tcpport&&t.pc_config.iceServers.push({username:e.username,credential:e.credential,credentialType:"password",urls:(e.useTurns?"turns:":"turn:")+e.url+":"+e.tcpport+"?transport=tcp"}),!0===e.forceturn&&(t.pc_config.iceTransportPolicy="relay")})):l.default.error("[".concat(t.clientId,"] turnServers is not a array")))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints=r.isChromeKernel()&&r.getChromeKernelVersion()<103?{mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}}:{offerToReceiveVideo:e.video,offerToReceiveAudio:e.audio},t.roapSessionId=103;try{t.pc_config.sdpSemantics=Object(h.getParameter)("PLAN"),t.peerConnection=new n(t.pc_config,t.con)}catch(e){delete t.pc_config.sdpSemantics,t.peerConnection=new n(t.pc_config,t.con);var g=t.peerConnection.getConfiguration();g.sdpSemantics&&Object(h.setParameter)("PLAN",g.sdpSemantics)}t.iceCandidateTimer=setTimeout((function(){t.iceCandidateTimer=null,l.default.debug("[".concat(t.clientId,"]Candidates collected: ").concat(t.iceCandidateCount)),t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),Object(h.getParameter)("CANDIDATE_TIMEOUT")),t.peerConnection.onicecandidate=function(e){var n,r,i,o;r=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),i=n.match(/a=candidate:.+typ\shost.+\r\n/),o=n.match(/a=candidate:.+typ\srelay.+\r\n/),null===r&&null===i&&null===o||void 0!==t.ice||!t.iceCandidateTimer||(clearTimeout(t.iceCandidateTimer),t.iceCandidateTimer=null,t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1};var v=function(e){return e.replace("a=x-google-flag:conference\r\n","")},y=function(n){var r,i;if((r=n.match(/m=video.*\r\n/))&&e.minVideoBW&&e.maxVideoBW){i=r[0]+"b=AS:"+e.maxVideoBW+"\r\n";var o=0,a=0;"h264"===e.codec?(o=n.search(/a=rtpmap:(\d+) H264\/90000\r\n/),a=n.search(/H264\/90000\r\n/)):"vp8"===e.codec?(o=n.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),a=n.search(/VP8\/90000\r\n/)):"vp9"===e.codec&&(o=n.search(/a=rtpmap:(\d+) VP9\/90000\r\n/),a=n.search(/VP9\/90000\r\n/)),-1!==o&&-1!==a&&a-o>10&&(i=i+"a=fmtp:"+n.slice(o+9,a-1)+" x-google-min-bitrate="+e.minVideoBW+"\r\n"),n=(n=(n=n.replace(r[0],i)).replace("a=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f","a=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f")).replace("a=fmtp:125 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f","a=fmtp:125 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f"),l.default.debug("["+t.clientId+"]Set Video Bitrate - min:"+e.minVideoBW+" max:"+e.maxVideoBW)}return(r=n.match(/m=audio.*\r\n/))&&e.maxAudioBW&&(i=r[0]+"b=AS:"+e.maxAudioBW+"\r\n",n=n.replace(r[0],i)),n};t.processSignalingMessage=function(n){var r,i=JSON.parse(n);t.incomingMessage=i,"new"===t.state?"OFFER"===i.messageType?(r={sdp:i.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch((function(e){})),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+i.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===i.messageType?((r={sdp:i.sdp,type:"answer"}).sdp=v(r.sdp),r.sdp=y(r.sdp),e.screen&&"detail"===e.optimizationMode&&(l.default.debug("[".concat(t.client,"] remove screen share abs ext")),r.sdp=r.sdp.replace(/a=.*abs-send-time\r\n/g,"").replace(/a=.*goog-remb\r\n/g,"")),e.isSubscriber&&(r.sdp=r.sdp.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")),t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch((function(e){})),t.state="established"):"pr-answer"===i.messageType?(r={sdp:i.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch((function(e){}))):"offer"===i.messageType?t.error("Not written yet"):t.error("Illegal message for this state: "+i.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===i.messageType?(r={sdp:i.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch((function(e){})),t.state="offer-received",t.markActionNeeded()):"ANSWER"===i.messageType?((r={sdp:i.sdp,type:"answer"}).sdp=v(r.sdp),r.sdp=y(r.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(r)).catch((function(e){}))):t.error("Illegal message for this state: "+i.messageType+" in state "+t.state))},t.setRtpSenderParameters=function(){var e=u()(s.a.mark((function e(n){var r,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.peerConnection.getSenders(),i=r.find((function(e){return"video"===e.track.kind}))){e.next=4;break}return e.abrupt("return");case 4:return(o=i.getParameters()).degradationPreference=n,e.prev=6,l.default.debug("[".concat(t.clientId,"] setParameters"),o),e.next=10,i.setParameters(o);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),l.default.debug("[".concat(t.clientId,"] setParameters failed, ignore"));case 15:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}();var b=0,_=0;return t.getVideoRelatedStats=function(e){t.getStats((function(n){n.forEach((function(n){if(t.isSubscriber){if("video"===n.mediaType&&n.id&&~n.id.indexOf("recv")){if(r.isChromeKernel()&&+r.getBrowserVersion()>=76){var i=+n.googFramesReceived-b,o=+n.googFramesDecoded-_;t._setStat(p,"googFrameRateReceived",i),t._setStat(p,"googFrameRateDecoded",o),t._setStat(p,"googFrameRateOutput",o),b=+n.googFramesReceived,_=+n.googFramesDecoded}e&&e({mediaType:"video",peerId:t.uid,isVideoMute:t.isVideoMute,frameRateReceived:n.googFrameRateReceived,frameRateDecoded:n.googFrameRateDecoded,bytesReceived:n.bytesReceived,packetsReceived:n.packetsReceived,packetsLost:n.packetsLost})}}else"video"===n.mediaType&&n.id&&~n.id.indexOf("send")&&e&&e({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:n.googFrameRateInput,frameRateSent:n.googFrameRateSent,googRtt:n.googRtt})}))}))},t.getAudioRelatedStats=function(e){t.getStats((function(n){n.forEach((function(n){t.isSubscriber&&"audio"===n.mediaType&&n.id&&~n.id.indexOf("recv")&&e&&e({mediaType:"audio",peerId:t.uid,isAudioMute:t.isAudioMute,frameDropped:parseInt(n.googDecodingPLC)+parseInt(n.googDecodingPLCCNG)+"",frameReceived:n.googDecodingCTN,googJitterReceived:n.googJitterReceived,bytesReceived:n.bytesReceived,packetsReceived:n.packetsReceived,packetsLost:n.packetsLost})}))}))},t.getStatsRate=function(e){t.getStats((function(t){e(t)}))},t.getStats=function(e,n){n=(n=n||500)>500?500:n,t.lastTimeGetStats&&Date.now()-t.lastTimeGetStats<n?e&&e(t.filterStatsCache,t.originStatsCache):(t.lastTimeGetStats=Date.now(),this._getStats((function(n,r){t.filterStatsCache=n,t.originStatsCache=r,e&&e(n,r)})))},t._setStat=function(e,t,n){e.hasOwnProperty(t)&&(null!=n&&n!==1/0&&n==n||(n=0),e[t]=n+"")},t._processGetStatsAfterChrome76=function(e){var n=this;t.lastStats||(t.lastStats=new Map),t.peerConnection.getStats().then((function(r){var s,u=[],l=[],d=new Map,h=new Date,g=f(r.values());try{for(g.s();!(s=g.n()).done;){var v=s.value;"codec"!=v.type?"candidate-pair"!=v.type?("inbound-rtp"===v.type&&"video"===v.mediaType&&d.set("inbound-video",v),"inbound-rtp"===v.type&&"audio"===v.mediaType&&d.set("inbound-audio",v),"outbound-rtp"===v.type&&"audio"===v.mediaType&&d.set("outbound-audio",v),"outbound-rtp"===v.type&&"video"===v.mediaType&&d.set("outbound-video",v),"track"===v.type&&"video"===v.kind&&v.remoteSource&&d.set("remote-video-track",v),"track"===v.type&&"audio"===v.kind&&v.remoteSource&&d.set("remote-audio-track",v),"remote-inbound-rtp"===v.type&&"video"===v.mediaType&&d.set("remote-inbound-video",v),"remote-inbound-rtp"===v.type&&"audio"===v.mediaType&&d.set("remote-inbound-audio",v),"track"!==v.type||"video"!==v.kind||v.remoteSource||d.set("local-video-track",v),"track"!==v.type||"audio"!==v.kind||v.remoteSource||d.set("local-audio-track",v),"media-source"===v.type&&"video"===v.kind&&d.set("media-source-video",v),"media-source"===v.type&&"audio"===v.kind&&d.set("media-source-audio",v)):l.push(v):u.push(v)}}catch(e){g.e(e)}finally{g.f()}d.set("codec",u),d.set("candidatePairs",l),d.set("timestamp",+h);var y=null,b=null;if(p.timestamp=h,c.timestamp=h,i.timestamp=h,i.timestamp=h,m.timestamp=h,n.isSubscriber)(y=d.get("inbound-video"))&&(t._setStat(p,"id","inbound_video_ssrc_recv"),t._setStat(p,"mediaType",y.mediaType),t._setStat(p,"packetsLost",y.packetsLost),t._setStat(p,"googDecodeMs",null),t._setStat(p,"googMaxDecodeMs",null),t._setStat(p,"googRenderDelayMs",null),t._setStat(p,"googMinPlayoutDelayMs",null),t._setStat(p,"googNacksSent",y.nackCount),t._setStat(p,"googPlisSent",y.pliCount),t._setStat(p,"googFirsSent",y.firCount),t._setStat(p,"bytesReceived",y.bytesReceived),t._setStat(p,"packetsReceived",y.packetsReceived)),(y=d.get("inbound-audio"))&&(t._setStat(c,"id","inbound_audio_ssrc_recv"),t._setStat(c,"mediaType",y.mediaType),t._setStat(c,"bytesReceived",y.bytesReceived),t._setStat(c,"packetsLost",y.packetsLost),t._setStat(c,"packetsReceived",y.packetsReceived),t._setStat(c,"googAccelerateRate",y.removedSamplesForAcceleration),t._setStat(c,"googCurrentDelayMs",y.jitterBufferDelay),t._setStat(c,"googDecodingCNG",null),t._setStat(c,"googDecodingCTN",null),t._setStat(c,"googDecodingCTSG",null),t._setStat(c,"googDecodingNormal",null),t._setStat(c,"googDecodingPLC",null),t._setStat(c,"googDecodingPLCCNG",null),t._setStat(c,"googJitterReceived",y.jitter),t._setStat(c,"googPreferredJitterBufferMs",null),t._setStat(c,"googSecondaryDecodedRate",null)),(y=d.get("remote-video-track"))&&(t._setStat(p,"googTargetDelayMs",y.jitterBufferDelay),t._setStat(p,"googFrameWidthReceived",y.frameWidth),t._setStat(p,"googFrameHeightReceived",y.frameHeight),t._setStat(p,"googJitterBufferMs",y.jitterBufferDelay/y.jitterBufferEmittedCount*1e3),t._setStat(p,"googCurrentDelayMs",y.jitterBufferDelay),t._setStat(p,"googFramesDecoded",y.framesDecoded),t._setStat(p,"googFramesReceived",y.framesReceived)),(y=d.get("remote-audio-track"))&&(t._setStat(c,"audioOutputLevel",32767*y.audioLevel),t._setStat(c,"googJitterBufferMs",y.jitterBufferDelay/y.jitterBufferEmittedCount*1e3),t._setStat(c,"googExpandRate",y.concealedSamples),t._setStat(c,"googPreemptiveExpandRate",y.insertedSamplesForDeceleration),t._setStat(c,"googSpeechExpandRate",y.silentConcealedSamples));else{var _=t.lastStats.get("timestamp"),E=t.lastStats.get("outbound-video");if((y=d.get("outbound-audio"))&&(t._setStat(i,"id","outbound_audio_ssrc_send"),t._setStat(i,"mediaType",y.mediaType),t._setStat(i,"aecDivergentFilterFraction",null),t._setStat(i,"bytesSent",y.bytesSent),t._setStat(i,"packetsSent",y.packetsSent),b=y.transportId),y=d.get("outbound-video")){if(t._setStat(a,"id","outbound_video_ssrc_send"),t._setStat(a,"mediaType",y.mediaType),t._setStat(a,"bytesSent",y.bytesSent),t._setStat(a,"packetsSent",y.packetsSent),t._setStat(a,"googAdaptationChanges",y.qualityLimitationDurations),t._setStat(a,"googAvgEncodeMs",null),t._setStat(a,"googEncodeUsagePercent",null),b=y.transportId,y.totalEncodedBytesTarget&&E&&E.totalEncodedBytesTarget){var S=(y.totalEncodedBytesTarget-E.totalEncodedBytesTarget)/(+new Date-_);t._setStat(m,"googTargetEncBitrate",Math.floor(8*S*1e3))}if(y.retransmittedBytesSent&&E&&E.retransmittedBytesSent){var w=(y.retransmittedBytesSent-E.retransmittedBytesSent)/(+new Date-_);t._setStat(m,"googRetransmitBitrate",Math.floor(8*w*1e3))}if(y.bytesSent&&E&&E.bytesSent){var T=(y.bytesSent-E.bytesSent)/(+new Date-_);t._setStat(m,"googTransmitBitrate",Math.floor(8*T*1e3)),t._setStat(m,"googActualEncBitrate",Math.floor(8*T*1e3))}if(y.totalPacketSendDelay&&E&&E.totalPacketSendDelay){var A=(y.totalPacketSendDelay-E.totalPacketSendDelay)/(+new Date-_);t._setStat(m,"googBucketDelay",Math.floor(1e3*A))}}if((y=d.get("remote-inbound-video"))&&(t._setStat(a,"packetsLost",y.packetsLost),t._setStat(a,"googRtt",y.roundTripTime)),(y=d.get("local-video-track"))&&(t._setStat(a,"googFrameHeightSent",y.frameHeight),t._setStat(a,"googFrameWidthSent",y.frameWidth),void 0!==y.framesPerSecond&&t._setStat(a,"googFrameRateSent",y.framesPerSecond)),(y=d.get("local-audio-track"))&&(t._setStat(i,"googEchoCancellationReturnLoss",y.echoReturnLoss),t._setStat(i,"googEchoCancellationReturnLossEnhancement",y.echoReturnLossEnhancement)),(y=d.get("media-source-video"))&&(t._setStat(a,"googFrameHeightInput",y.height),t._setStat(a,"googFrameWidthInput",y.width),t._setStat(a,"googFrameRateInput",y.framesPerSecond)),(y=d.get("media-source-audio"))&&t._setStat(i,"audioInputLevel",32767*y.totalAudioEnergy),(y=d.get("inbound-video"))&&(t._setStat(a,"googFirsReceived",y.firCount),t._setStat(a,"googNacksReceived",y.nackCount),t._setStat(a,"googPlisReceived",y.pliCount)),b)d.get("candidatePairs").map((function(e){b==e.transportId&&t._setStat(m,"googAvailableSendBandwidth",e.availableOutgoingBitrate)}));else{var R=d.get("candidatePairs")[0];R&&t._setStat(m,"googAvailableSendBandwidth",R.availableOutgoingBitrate)}}t.lastStats=d;var x=[o()({},a),o()({},i),o()({},p),o()({},c),o()({},m)];x.push({id:"time",startTime:t.connectedTime,timestamp:new Date}),e(x)}))},t._processGetStatsBeforeChrome76=function(e){t.peerConnection.getStats((function(n){var r=[],s=[],u=null;Object.keys(n).forEach((function(e){var t=n[e];t&&(s.push(t),u=t.timestamp,"VideoBwe"===t.type?m=t:t.id.indexOf("_send")>-1&&"video"===t.mediaType?a=t:t.id.indexOf("_send")>-1&&"audio"===t.mediaType?i=t:t.id.indexOf("_recv")>-1&&"video"===t.mediaType?p=t:t.id.indexOf("_recv")>-1&&"audio"===t.mediaType&&(c=t))})),(r=[o()({},a),o()({},i),o()({},p),o()({},c),o()({},m)]).push({id:"time",startTime:t.connectedTime,timestamp:u||new Date}),e(r,s)}))},t._getStats=function(e){Object(h.getParameter)("CHROME_NEW_STATS")&&r.isChromeKernel()&&+r.getBrowserVersion()>=76?t._processGetStatsAfterChrome76(e):t._processGetStatsBeforeChrome76(e)},t.addTrack=function(e,n){if("unified-plan"===Object(h.getParameter)("PLAN")){var r="audio"===e.kind?t._audioSender:t._videoSender;if(r){var i=t.peerConnection.getTransceivers().find((function(e){return e.sender===r}));r.replaceTrack(e).then((function(){i.direction="sendrecv",t.renegotiate()}))}else r=t.peerConnection.addTrack(e,n),"audio"===e.kind?t._audioSender=r:t._videoSender=r}else t.peerConnection.addTrack(e,n)},t.removeTrack=function(e,n){if("unified-plan"===Object(h.getParameter)("PLAN")){var r=t.peerConnection.getTransceivers().find((function(t){return t.sender.track===e}));r&&(r.direction="inactive",t.peerConnection.removeTrack(r.sender))}else t.peerConnection.removeTrack(t.peerConnection.getSenders().find((function(t){return t.track==e})))},t.addStream=function(e){"unified-plan"===Object(h.getParameter)("PLAN")?e.getTracks().forEach((function(n){var r=t.peerConnection.addTrack(n,e);"audio"===n.kind?t._audioSender=r:t._videoSender=r})):(t.peerConnection.addStream(e),t.markActionNeeded())},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater((function(){t.onstablestate()}))},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){var n;if(t.actionNeeded){if("new"===t.state||"established"===t.state)t.peerConnection.createOffer(t.mediaConstraints).then((function(n){return n?n.sdp!==t.prevOffer?(e.isSubscriber&&(n.sdp=n.sdp.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")),t.peerConnection.setLocalDescription(n),t.state="preparing-offer",void t.markActionNeeded()):void l.default.debug("["+t.clientId+"]Not sending a new offer"):(l.default.debug("["+t.clientId+"]sessionDescription is null"),void t.onsignalingmessage(null))})).catch((function(e){l.default.debug("["+t.clientId+"]peer connection create offer failed ",e)}));else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.offerCandidates=t.prevOffer.match(/a=candidate.+\r\n/g)||[],t.offerCandidates.length||(e.isCloudProxy3&&e.onNoIceCandidate&&e.onNoIceCandidate(),l.default.warning("[".concat(t.clientId,"]No Ice Candidate generated")),Object(h.getParameter)("SHIM_CANDIDATE")?(l.default.debug("Shimming fake candidate"),t.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):l.default.error("[".concat(t.clientId,"]None Ice Candidate not allowed"))),t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer((function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;l.default.debug("["+t.clientId+"]"+n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}}),(function(e){l.default.debug("["+t.clientId+"]peer connection create answer failed ",e)}),t.mediaConstraints);else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;n=t.peerConnection.localDescription.sdp,t.sendMessage("ANSWER",n),t.state="established"}else l.default.debug("[".concat(t.clientId,"] Dazed and confused in state ").concat(t.state,", stopping here'"));t.actionNeeded=!1}},t.sendMessage=function(e,n){var r={};r.messageType=e,r.sdp=n,"OFFER"===e?(r.offererSessionId=t.sessionId,r.answererSessionId=t.otherSessionId,r.seq=t.sequenceNumber+=1,r.tiebreaker=Math.floor(429496723*Math.random()+1)):(r.offererSessionId=t.incomingMessage.offererSessionId,r.answererSessionId=t.sessionId,r.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(r))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find((function(t){return t.track.kind==e}));if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,r){var i=t._getSender(e.kind);if(!i)return r("NO_SENDER_FOUND");try{i.replaceTrack(e)}catch(e){return r&&r(e)}setTimeout((function(){return n&&n()}),50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&(t.onaddstream(e,"ontrack"),t.peerConnection.onaddstream=null)},t.peerConnection.onaddstream=function(e){t.onaddstream&&(t.onaddstream(e,"onaddstream"),t.peerConnection.ontrack=null)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){l.default.debug(t.peerConnection.iceConnectionState),"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},t.renegotiate=function(){void 0!==t.prevOffer&&t.peerConnection.createOffer().then((function(e){return"unified-plan"!==Object(h.getParameter)("PLAN")&&(e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")),e.sdp=v(e.sdp),e.sdp=y(e.sdp),t.peerConnection.setLocalDescription(e)})).then((function(){t.onnegotiationneeded&&t.onnegotiationneeded(t.peerConnection.localDescription.sdp)})).catch((function(e){l.default.error("createOffer error: ",e.message||e)}))},t.peerConnection.onnegotiationneeded=t.renegotiate,t.onaddstream=null,t.onremovestream=null,t.onnegotiationneeded=null,t.state="new",t.markActionNeeded(),t}(e)).browser="chrome-stable",t},S=function(e,t,n){var i={};i.config=e,i.streamId=e.streamId,delete e.streamId,navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var o=0,a=1,s=!1,c=null,u=function(e){if(o++,c)if(c===e)l.default.debug("Using Video Source/ Audio Source");else{var n=c.getVideoTracks()[0],r=c.getAudioTracks()[0],i=e.getVideoTracks()[0],u=e.getAudioTracks()[0];i&&(n&&c.removeTrack(n),c.addTrack(i)),u&&(r&&c.removeTrack(r),c.addTrack(u))}else c=e;o!==a||s||(s=!0,setTimeout((function(){t(c)}),0))},d=function(e){l.default.error("Failed to GetUserMedia",e.name,e.code,e.message,e),o++,s||(s=!0,setTimeout((function(){n&&n(e)}),0))},h=function(){var t={video:e.video,audio:e.audio};if(l.default.debug("GetUserMedia",JSON.stringify(t)),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia(t).then(u).catch(d);else if("undefined"!=typeof navigator&&navigator.getMedia)navigator.getMedia(e,u,d);else{var r={name:"MEDIA_NOT_SUPPORT",message:"Video/audio streams not supported yet"};l.default.error("["+i.streamId+"]"+r.message),n&&n(r)}};if((e.videoSource||e.audioSource)&&(c=new MediaStream,e.videoSource&&c.addTrack(e.videoSource),e.audioSource&&c.addTrack(e.audioSource)),e.video||e.audio||e.screen||e.screenAudio){if(!e.screen&&e.screenAudio)return n&&n({code:"Set screen to true before sharing the audio"});if(e.screen){if(b.a.isElectron())return e.screen.sourceId?b.a.getScreenStream(e.screen.sourceId,e.screen,(function(t,n){t?d(t):(e.audio&&(a++,h()),u(n))})):b.a.shareScreen(e.screen,(function(t,n){t?d(t):(e.audio&&(a++,h()),u(n))}));if(r.isFireFox()){if(l.default.debug("["+i.streamId+"]Screen access requested"),!~["screen","window","application"].indexOf(e.screen.mediaSource))return n&&n({code:"Invalid mediaSource, mediaSource should be one of [screen, window, application]"});navigator.getMedia({video:e.screen},(function(t){e.audio&&(a++,h()),u(t)}),d)}else if(r.isChromeKernel()&&e.screen.extensionId){if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<34)return void n({code:"This browser does not support screen sharing"});l.default.debug("["+i.streamId+"]Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(e.screen.extensionId,{getStream:!0},(function(t){void 0===t?(l.default.error("["+i.streamId+"]No response from Chrome Plugin. Plugin not installed properly"),d({name:"PluginNotInstalledProperly",message:"No response from Chrome Plugin. Plugin not installed properly."})):(e.screen.mandatory.chromeMediaSourceId=t.streamId,navigator.getMedia({video:e.screen},(function(t){e.audio&&(a++,h()),u(t)}),d))}))}catch(e){return l.default.debug("["+i.streamId+"]AgoraRTC screensharing plugin is not accessible"),void n({code:"no_plugin_present"})}}else{if(window.navigator.mediaDevices.getDisplayMedia){var f={};return"number"==typeof e.screen.width&&"number"==typeof e.screen.height?f.video={width:{ideal:e.screen.width},height:{ideal:e.screen.height}}:f.video={width:e.screen.width,height:e.screen.height},e.screen.frameRate&&e.screen.frameRate.min?f.video.frameRate={ideal:e.screen.frameRate.max,max:e.screen.frameRate.max}:f.video.frameRate=e.screen.frameRate,e.screenAudio&&(f.audio=e.screenAudio),l.default.debug("use getDisplayMedia, constraints:",f),window.navigator.mediaDevices.getDisplayMedia(f).then((function(t){!e.screenAudio&&e.audio&&(a++,h()),u(t)})).catch(d)}l.default.error("["+i.streamId+"]This browser does not support screenSharing"),n({code:"This browser does not support screen sharing"})}}else h()}else u(c)}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),o=function(){function e(e,t,n){void 0===t&&(t=""),this.name="AgoraRTCException",this.code=e,this.message="AgoraRTCError "+this.code+": "+t,this.data=n}return e.prototype.toString=function(){return this.data?this.message+" data: "+JSON.stringify(this.data):this.message},e.prototype.throw=function(){throw i.default.error(this.toString()),this},e}();t.AgoraRTCError=o,function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_SUPPORT="NOT_SUPPORT",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORT="OPERATION_ABORT",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.STREAM_ALREADY_INITIALIZED="STREAM_ALREADY_INITIALIZED",e.STREAM_IS_CLOSED="STREAM_IS_CLOSED",e.ABORT_OTHER_INIT="ABORT_OTHER_INIT",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.CAN_NOT_AUTOPLAY="CAN_NOT_AUTOPLAY",e.HIGH_STREAM_NO_VIDEO_TRACK="HIGH_STREAM_NO_VIDEO_TRACK",e.SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM="SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.TOKEN_GENERATOR_FUNCTION_ERROR="TOKEN_GENERATOR_FUNCTION_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.SUBSCRIPTION_IS_IN_PROGRESS="SUBSCRIPTION_IS_IN_PROGRESS",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.EFFECT_ID_CONFLICTED="EFFECT_ID_CONFLICTED",e.EFFECT_SOUND_ID_NOT_FOUND="EFFECT_SOUND_ID_NOT_FOUND",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER="CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT="LIVE_STREAMING_TRANSCODING_NOT_SUPPORT",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"}(t.AgoraRTCErrorCode||(t.AgoraRTCErrorCode={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(0),i=window.AudioContext||window.webkitAudioContext,o=n(2),a=o.getParameter,s=o.setParameter,c=function(){return a("AUDIO_CONTEXT")||s("AUDIO_CONTEXT",function(){if(i){var e=new i;return window.ctx=e,new Promise((function(e){document.body?e():window.addEventListener("load",e)})).then((function(){var t=function t(){"suspended"==e.state?(r.default.debug("AudioContext is suspended, auto resume"),e.resume().then((function(){r.default.debug("AudioContext resume success"),document.body.removeEventListener("touchend",t,!0),document.body.removeEventListener("mousedown",t,!0)}))):(r.default.debug("AudioContext is running"),document.body.removeEventListener("touchend",t,!0),document.body.removeEventListener("mousedown",t,!0))};document.body.addEventListener("touchend",t,!0),document.body.addEventListener("mousedown",t,!0)})),e}throw new Error("AUDIO_CONTEXT_NOT_SUPPORTED")}()),a("AUDIO_CONTEXT")};c()},function(e,t,n){"use strict";var r=n(1),i=null,o=function(){try{i=window.require("electron")}catch(e){}return i},a=function(e){var t=r.report.reportApiInvoke(null,{callback:e,name:"getScreenSources",options:arguments,tag:"tracer"}),n=o();if(!n)return t&&t("electron is null");try{var i=n.desktopCapturer.getSources({types:["window","screen"]})}catch(e){console.log(e)}i instanceof Promise?i.then((function(e){return t&&t(null,e)})).catch((function(e){return t&&t(e)})):i=n.desktopCapturer.getSources({types:["window","screen"]},(function(e,n){t&&t(null,n)}))},s=function(e,t,n){var r=t.width;t={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:t.height,maxWidth:r,maxFrameRate:t.frameRate&&t.frameRate.max,minFrameRate:t.frameRate&&t.frameRate.min}}},navigator.webkitGetUserMedia(t,(function(e){n&&n(null,e)}),(function(e){n&&n(e)}))};t.a={isElectron:function(){return!!o()},getElectronInstance:o,getScreenSources:a,getScreenStream:s,shareScreen:function(e,t){a((function(n,r){if(n)return t&&t(n);!function(e,t){var n=document.createElement("div");n.innerText="share screen",n.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");var r=document.createElement("div");r.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");var i=document.createElement("div");i.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",i.setAttribute("style","height: 12%;");var o=document.createElement("div");o.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");var a=document.createElement("div");a.setAttribute("style","text-align: right; padding: 16px 0;");var s=document.createElement("button");s.innerHTML="cancel",s.setAttribute("style","width: 85px;"),s.onclick=function(){document.body.removeChild(c),t&&t("NotAllowedError")},a.appendChild(s),r.appendChild(i),r.appendChild(o),r.appendChild(a);var c=document.createElement("div");c.setAttribute("style","position: absolute; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),c.appendChild(n),c.appendChild(r),document.body.appendChild(c),e.map((function(e){if(e.id){var n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");var r=e.thumbnail;r.getSize().width>1920&&(r=r.resize({width:1920})),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",n.onclick=function(){document.body.removeChild(c),t&&t(null,e.id)},o.appendChild(n)}}))}(r,(function(n,r){if(n)return t&&t(n);s(r,e,t)}))}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3);!function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(t.LiveStreamingServiceMode||(t.LiveStreamingServiceMode={})),t.DEFAULT_LIVE_STREAMING_TRANSCODING_USER={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},t.DEFAULT_LIVE_STREAMING_TRANSCODING_WATERMARK={x:0,y:0,width:160,height:160,zOrder:255,alpha:1},t.isLiveStreamingTranscodingConfig=function(e){return r.isEmpty(e.width)||r.checkValidNumber(e.width,"config.width",0),r.isEmpty(e.height)||r.checkValidNumber(e.height,"config.height",0),r.isEmpty(e.videoBitrate)||r.checkValidNumber(e.videoBitrate,"config.videoBitrate",1,1e6),r.isEmpty(e.videoFramerate)||r.checkValidNumber(e.videoFramerate,"config.videoFramerate"),r.isEmpty(e.lowLatency)||r.checkValidBoolean(e.lowLatency,"config.lowLatency"),r.isEmpty(e.audioSampleRate)||r.checkValidEnum(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),r.isEmpty(e.audioBitrate)||r.checkValidNumber(e.audioBitrate,"config.audioBitrate",1,128),r.isEmpty(e.audioChannels)||r.checkValidEnum(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),r.isEmpty(e.videoGop)||r.checkValidNumber(e.videoGop,"config.videoGop"),r.isEmpty(e.videoCodecProfile)||r.checkValidEnum(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),r.isEmpty(e.userCount)||r.checkValidNumber(e.userCount,"config.userCount",0,17),r.isEmpty(e.backgroundColor)||r.checkValidNumber(e.backgroundColor,"config.backgroundColor",0,16777215),e.transcodingUsers&&!r.isEmpty(e.transcodingUsers)&&(r.checkValidArray(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach((function(e,t){r.checkValidUID(e.uid),r.isEmpty(e.x)||r.checkValidNumber(e.x,"transcodingUser["+t+"].x",0,1e4),r.isEmpty(e.y)||r.checkValidNumber(e.y,"transcodingUser["+t+"].y",0,1e4),r.isEmpty(e.width)||r.checkValidNumber(e.width,"transcodingUser["+t+"].width",0,1e4),r.isEmpty(e.height)||r.checkValidNumber(e.height,"transcodingUser["+t+"].height",0,1e4),r.isEmpty(e.zOrder)||r.checkValidNumber(e.zOrder-1,"transcodingUser["+t+"].zOrder",0,100),r.isEmpty(e.alpha)||r.checkValidFloatNumber(e.alpha,"transcodingUser["+t+"].alpha",0,1)}))),e.images&&!r.isEmpty(e.images)&&(r.checkValidArray(e.images,"config.images"),e.images.forEach((function(e,t){r.checkValidString(e.url,"images["+t+"].url",1,1e3,!1),r.isEmpty(e.x)||r.checkValidNumber(e.x,"images["+t+"].x",0,1e4),r.isEmpty(e.y)||r.checkValidNumber(e.y,"images["+t+"].y",0,1e4),r.isEmpty(e.width)||r.checkValidNumber(e.width,"images["+t+"].width",0,1e4),r.isEmpty(e.height)||r.checkValidNumber(e.height,"images["+t+"].height",0,1e4),r.isEmpty(e.zOrder)||r.checkValidNumber(e.zOrder,"images["+t+"].zOrder",0,255),r.isEmpty(e.alpha)||r.checkValidFloatNumber(e.alpha,"images["+t+"].alpha",0,1)}))),!0},t.DEFAULT_TRANSCODING_CONFIG={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFramerate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},t.isInjectStreamConfig=function(e){return r.isEmpty(e.audioVolume)||r.checkValidNumber(e.audioVolume,"config.audioVolume",0,1e3),r.isEmpty(e.audioBitrate)||r.checkValidNumber(e.audioBitrate,"config.audioBitrate",1,1e4),r.isEmpty(e.audioChannels)||r.checkValidEnum(e.audioChannels,"config.audioChannels",[1,2]),r.isEmpty(e.audioSampleRate)||r.checkValidEnum(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),r.isEmpty(e.width)||r.checkValidNumber(e.width,"config.width",0,1e4),r.isEmpty(e.height)||r.checkValidNumber(e.height,"config.height",0,1e4),r.isEmpty(e.videoBitrate)||r.checkValidNumber(e.videoBitrate,"config.videoBitrate",1,1e4),r.isEmpty(e.videoFramerate)||r.checkValidNumber(e.videoFramerate,"config.videoFramerate",1,1e4),r.isEmpty(e.videoGop)||r.checkValidNumber(e.videoGop,"config.videoGop",1,1e4),!0},t.DEFAULT_INJECT_CONFIG={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30},function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(t.LiveStreamingUapSignalEvents||(t.LiveStreamingUapSignalEvents={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(t.LiveStreamingInternalEvents||(t.LiveStreamingInternalEvents={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.LIVE_STREAM_RESPONSE_INGNORE_MESSAGE=505]="LIVE_STREAM_RESPONSE_INGNORE_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(t.LIVE_STREAM_ERROR_CODE||(t.LIVE_STREAM_ERROR_CODE={})),function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls"}(t.WebSocketManagerEvents||(t.WebSocketManagerEvents={}))},function(e,t,n){var r=n(57),i=n(58);e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},function(e,t,n){var r;e.exports=(r=n(73),function(e){var t=r,n=t.lib,i=n.WordArray,o=n.Hasher,a=t.algo,s=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(s[i]=n(e.pow(r,.5))),c[i]=n(e.pow(r,1/3)),i++),r++}();var u=[],l=a.SHA256=o.extend({_doReset:function(){this._hash=new i.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],d=n[6],h=n[7],f=0;f<64;f++){if(f<16)u[f]=0|e[t+f];else{var p=u[f-15],m=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,g=u[f-2],v=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;u[f]=m+u[f-7]+v+u[f-16]}var y=r&i^r&o^i&o,b=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),_=h+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&d)+c[f]+u[f];h=d,d=l,l=s,s=a+_|0,a=o,o=i,i=r,r=_+(b+y)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(l),t.HmacSHA256=o._createHmacHelper(l)}(Math),r.SHA256)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomString=function(e){void 0===e&&(e=8);for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length,r="",i=0;i<e;i++)r+=t.charAt(Math.floor(Math.random()*n));return r}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),c=a(n(37)),u=n(24),l=a(n(0)),d=n(1);function h(e){return new Promise((function(t){window.setTimeout(t,e)}))}function f(e,t){return new Promise((function(n,r){t.timeout=t.timeout||s.getParameter("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&(t.data=JSON.stringify(t.data)),t.headers=t.headers||{},t.headers["Content-Type"]="application/json",t.method="POST",t.url=e,c.default.request(t).then((function(e){n(e.data)})).catch((function(e){c.default.isCancel(e)?r(new u.AgoraRTCError(u.AgoraRTCErrorCode.OPERATION_ABORT,"cancel token canceled")):"ECONNABORTED"===e.code?r(new u.AgoraRTCError(u.AgoraRTCErrorCode.NETWORK_TIMEOUT,e.message)):e.response?r(new u.AgoraRTCError(u.AgoraRTCErrorCode.NETWORK_RESPONSE_ERROR,e.response.status)):r(new u.AgoraRTCError(u.AgoraRTCErrorCode.NETWORK_ERROR,e.message))}))}))}function p(e,n,r,a){var s=this,c=Object.assign({},t.DEFAULT_RETRY_CONFIG,a),l=c.timeout,d=function(){return i(s,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,h(l)];case 1:return e.sent(),l*=c.timeoutFactor,l=Math.min(c.maxRetryTimeout,l),[2]}}))}))},f=!1,p=new Promise((function(t,a){return i(s,void 0,void 0,(function(){var i,s,l;return o(this,(function(o){switch(o.label){case 0:n=n||function(){return!1},r=r||function(){return!0},i=0,o.label=1;case 1:if(!(i<c.maxRetryCount))return[3,12];if(f)return[2,a(new u.AgoraRTCError(u.AgoraRTCErrorCode.OPERATION_ABORT))];o.label=2;case 2:return o.trys.push([2,7,,11]),[4,e()];case 3:return s=o.sent(),n(s,i)?i+1===c.maxRetryCount?[2,t(s)]:[4,d()]:[3,5];case 4:return o.sent(),[3,6];case 5:return[2,t(s)];case 6:return[3,11];case 7:return l=o.sent(),r(l,i)?i+1===c.maxRetryCount?[2,a(l)]:[4,d()]:[3,9];case 8:return o.sent(),[3,10];case 9:return[2,a(l)];case 10:return[3,11];case 11:return i+=1,[3,1];case 12:return[2]}}))}))}));return p.cancel=function(){return f=!0},p}function m(e,t){return{addressList:e.servers.map((function(e,n){return"wss://"+e.address.replace(/\./g,"-")+".edge.agora.io:"+e.wss+"?serviceName="+encodeURIComponent(t)})),workerToken:e.workerToken,vid:e.vid}}t.wait=h,t.post=f,t.DEFAULT_RETRY_CONFIG={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4},t.getRetryWaitTime=function(e,t){var n=t.timeout*Math.pow(t.timeoutFactor,e);return Math.min(t.maxRetryTimeout,n)},t.retryable=p,t.liveStreamingServerResponseToResult=m;var g=1;function v(e,n,a,c,h){var v=this;void 0===h&&(h=t.DEFAULT_RETRY_CONFIG),g+=1;var y,b,_={sid:a.sid,command:"convergeAllocateEdge",uid:"666",appId:a.appId,ts:Math.floor(Date.now()/1e3),seq:g,requestId:g,version:s.VERSION,cname:a.cname},E={service_name:n,json_body:JSON.stringify(_)},S=e[0];return p((function(){return i(v,void 0,void 0,(function(){var e,t,i,a,d;return o(this,(function(o){switch(o.label){case 0:return y=Date.now(),[4,f(S,{data:E,cancelToken:c,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}})];case 1:if(e=o.sent(),b=Date.now()-y,0!==e.code)throw i=new u.AgoraRTCError(u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0}),l.default.error(i.toString()),i;if(200!==(t=JSON.parse(e.json_body)).code)throw i=new u.AgoraRTCError(u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming app center error, code: "+t.code+", reason: "+t.reason),l.default.error(i.toString()),i;if(!t.servers||0===t.servers.length)throw i=new u.AgoraRTCError(u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming app center empty server"),l.default.error(i.toString()),i;if(a=m(t,n),s.getParameter("LIVE_STREAMING_ADDRESS"))try{d=JSON.parse(s.getParameter("LIVE_STREAMING_ADDRESS")),a.addressList=d}catch(e){a.addressList=[s.getParameter("LIVE_STREAMING_ADDRESS")]}return[2,r(r({},a),{responseTime:b})]}}))}))}),(function(t,r){return d.report.requestApWorkerEvent(a.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===r,responseTime:b,serverIp:e[r%e.length]}),!1}),(function(t,r){return d.report.requestApWorkerEvent(a.sid,{success:!1,sc:t.data&&t.data.code||200,serviceName:n,responseTime:b,serverIp:e[r%e.length]}),!!(t.code!==u.AgoraRTCErrorCode.OPERATION_ABORT&&t.code!==u.AgoraRTCErrorCode.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(S=e[(r+1)%e.length],!0)}),h)}t.requestLiveStreamingWorkerManager=v,t.getLiveStreamingWorkerMangerResult=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:r=s.getParameter("UAP_AP").map((function(e){return t.proxyServer?"https://"+t.proxyServer+"/ap/?url="+e+"/api/v1?action=uap":"https://"+e+"/api/v1?action=uap"})),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,v(r,e,t,n)];case 2:return[2,o.sent()];case 3:throw i=o.sent(),d.report.requestApWorkerEvent(t.sid,{success:!1,sc:i.data&&i.data.code||200,serviceName:e,responseTime:i.data&&i.data.responseTime}),i;case 4:return[2]}}))}))}},function(e,t,n){var r=n(70),i=n(71),o=n(34),a=n(72);e.exports=function(e){return r(e)||i(e)||o(e)||a()}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(35);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};Object.defineProperty(t,"__esModule",{value:!0});var i=n(24),o=function(){function e(){this._events={},this.addListener=this.on}return e.prototype.getListeners=function(e){return this._events[e]?this._events[e].map((function(e){return e.listener})):[]},e.prototype.on=function(e,t){this._events[e]||(this._events[e]=[]);var n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})},e.prototype.once=function(e,t){this._events[e]||(this._events[e]=[]);var n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})},e.prototype.off=function(e,t){if(this._events[e]){var n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}},e.prototype.removeAllListeners=function(e){e?delete this._events[e]:this._events={}},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this._events[e]||(this._events[e]=[]);for(var r=this._events[e].map((function(e){return e})),i=0;i<r.length;i+=1){var o=r[i];o.once&&this.off(e,o.listener),o.listener.apply(this,t||[])}},e.prototype._indexOfListener=function(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1},e}();function a(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var a=null,s=null;if(e.emit.apply(e,r([t],n,[function(e){a=e},function(e){s=e}])),null!==s)throw s;if(null===a)throw new i.AgoraRTCError(i.AgoraRTCErrorCode.UNEXPECTED_ERROR,"handler is not sync");return a}t.EventEmitter=o,t.emitAsPromise=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return 0===e.getListeners(t).length?Promise.reject(new i.AgoraRTCError(i.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not emit promise")):new Promise((function(i,o){e.emit.apply(e,r([t],n,[i,o]))}))},t.emitAsInvokerNoResponse=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return 0===e.getListeners(t).length?null:a.apply(void 0,r([e,t],n))},t.emitAsInvoker=a},function(e,t,n){e.exports=n(78)},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},function(e,t,n){"use strict";var r=n(18);function i(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(r.isURLSearchParams(t))o=t.toString();else{var a=[];r.forEach(t,(function(e,t){null!=e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),a.push(i(t)+"="+i(e))})))})),o=a.join("&")}if(o){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";(function(t){var r=n(18),i=n(84),o={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var s,c={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(s=n(42)),s),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)?(a(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){c.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){c.headers[e]=r.merge(o)})),e.exports=c}).call(this,n(83))},function(e,t,n){"use strict";var r=n(18),i=n(85),o=n(39),a=n(87),s=n(90),c=n(91),u=n(43);e.exports=function(e){return new Promise((function(t,l){var d=e.data,h=e.headers;r.isFormData(d)&&delete h["Content-Type"];var f=new XMLHttpRequest;if(e.auth){var p=e.auth.username||"",m=e.auth.password||"";h.Authorization="Basic "+btoa(p+":"+m)}var g=a(e.baseURL,e.url);if(f.open(e.method.toUpperCase(),o(g,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,f.onreadystatechange=function(){if(f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in f?s(f.getAllResponseHeaders()):null,r={data:e.responseType&&"text"!==e.responseType?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f};i(t,l,r),f=null}},f.onabort=function(){f&&(l(u("Request aborted",e,"ECONNABORTED",f)),f=null)},f.onerror=function(){l(u("Network Error",e,null,f)),f=null},f.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),l(u(t,e,"ECONNABORTED",f)),f=null},r.isStandardBrowserEnv()){var v=n(92),y=(e.withCredentials||c(g))&&e.xsrfCookieName?v.read(e.xsrfCookieName):void 0;y&&(h[e.xsrfHeaderName]=y)}if("setRequestHeader"in f&&r.forEach(h,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete h[t]:f.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(f.withCredentials=!!e.withCredentials),e.responseType)try{f.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){f&&(f.abort(),l(e),f=null)})),void 0===d&&(d=null),f.send(d)}))}},function(e,t,n){"use strict";var r=n(86);e.exports=function(e,t,n,i,o){var a=new Error(e);return r(a,t,n,i,o)}},function(e,t,n){"use strict";var r=n(18);e.exports=function(e,t){t=t||{};var n={},i=["url","method","params","data"],o=["headers","auth","proxy"],a=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];r.forEach(i,(function(e){void 0!==t[e]&&(n[e]=t[e])})),r.forEach(o,(function(i){r.isObject(t[i])?n[i]=r.deepMerge(e[i],t[i]):void 0!==t[i]?n[i]=t[i]:r.isObject(e[i])?n[i]=r.deepMerge(e[i]):void 0!==e[i]&&(n[i]=e[i])})),r.forEach(a,(function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])}));var s=i.concat(o).concat(a),c=Object.keys(t).filter((function(e){return-1===s.indexOf(e)}));return r.forEach(c,(function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])})),n}},function(e,t,n){"use strict";function r(e){this.message=e}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,e.exports=r},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var s=o(n(59)),c=a(n(62)),u=a(n(63)),l=o(n(0)),d=n(2),h=s.default.Root.fromJSON(u),f=function(){function e(){this.requestArray=[],this.retryBackoffCount=0,this.state=0}return e.prototype.setProxy=function(e){this.proxyServer=e},e.prototype.sendReportList=function(e,t){var n=this,r=this._dataConvert("ProtoRaws",{vid:t,sendTs:Math.round(Date.now()/1e3),payloads:e.map((function(e){return{id:c[e.type],msg:n._dataConvert(e.type,e.data)}}))});this.send(r)},e.prototype._dataConvert=function(e,t){var n;try{n=h.lookupType("protobuf."+e)}catch(t){l.default.error("[send-proto] invalid proto name "+e)}var r=n.create(t);return n.encode(r).finish()},e.prototype.send=function(e){0==this.state?this._send(e):this.requestArray.push(e)},e.prototype._send=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,4]),this.state=1,[4,this.request(e)];case 1:return t.sent(),this.retryBackoffCount=0,0!==this.requestArray.length?this._send(this.requestArray.shift()):this.state=0,[3,4];case 2:return t.sent(),[4,p(this.retryBackoffCount++<2?200:1e4)];case 3:return t.sent(),this._send(e),[3,4];case 4:return[2]}}))}))},e.prototype.request=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:t=this._getAddress(),n=this._getBackupAddress(),r.label=1;case 1:return r.trys.push([1,3,,5]),[4,this._request(t,e)];case 2:return r.sent(),[3,5];case 3:return r.sent(),[4,this._request(n,e)];case 4:return r.sent(),[3,5];case 5:return[2]}}))}))},e.prototype._request=function(e,t){return this._post(e,t)},e.prototype._post=function(e,t){var n=this;return new Promise((function(r,i){var o=new XMLHttpRequest;o.timeout=d.getParameter("HTTP_CONNECT_TIMEOUT"),o.open("POST",e,!0),o.setRequestHeader("Content-type","application/octet-stream"),n.proxyServer||(o.setRequestHeader("Cache-Control","no-cache, no-store"),o.setRequestHeader("Pragma","no-cache"),o.setRequestHeader("Expires","0")),o.onload=function(e){r(o.responseText)},o.onerror=function(e){i(e)},o.ontimeout=function(e){i(e)},o.send(t)}))},e.prototype._getAddress=function(){return this.proxyServer?"https://"+this.proxyServer+"/rs/?h="+d.getParameter("EVENT_REPORT_DOMAIN")+"&p=6443&d=events/proto-raws":"https://"+d.getParameter("EVENT_REPORT_DOMAIN")+":6443/events/proto-raws"},e.prototype._getBackupAddress=function(){return this.proxyServer?"https://"+this.proxyServer+"/rs/?h="+d.getParameter("EVENT_REPORT_BACKUP_DOMAIN")+"&p=6443&d=events/proto-raws":"https://"+d.getParameter("EVENT_REPORT_BACKUP_DOMAIN")+":6443/events/proto-raws"},e}();t.default=f;var p=function(e){return new Promise((function(t){window.setTimeout(t,e)}))}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a,s=o(n(0)),c=n(15);!function(e){e.NEW="new",e.PREPARING_OFFER="preparing-offer",e.OFFER_SENT="offer-sent",e.ESTABLISHED="established",e.CLOSED="closed"}(a||(a={}));var u=function(){function e(e){this.candidate=null,this.state=a.NEW,this.config=e,this.isSubscriber=this.config.isSubscriber,this.peerConnection=this.initPeecConnection(e),this.peerConnection.onicecandidate=this._onicecandidate.bind(this),this.peerConnection.oniceconnectionstatechange=this._oniceconnectionstatechange.bind(this),this.peerConnection.onaddstream=this._onaddstream.bind(this),this.peerConnection.ontrack=this._ontrack.bind(this),this.processSignalingMessage=this.setAnswer.bind(this),this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.setLocalSDP.bind(this)),this.sendVideoStats={id:"",type:"",mediaType:"",googCodecName:this.config.codec.toUpperCase(),bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},this.sendAudioStats={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},this.receiveAudioStats={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},this.receiveVideoStats={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"}}return e.prototype.addStream=function(e){this.peerConnection.addStream(e)},e.prototype.setRtpSenderParameters=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2]}))}))},e.prototype.setAnswer=function(e){var t=JSON.parse(e);this.peerConnection.setRemoteDescription(new RTCSessionDescription({sdp:t.sdp,type:"answer"})),this.onsignalingmessage&&this.onsignalingmessage("")},e.prototype.close=function(){this.peerConnection.close()},e.prototype.getStats=function(e,t){if(void 0===t&&(t=500),t=t>500?500:t,Date.now()-this.lastTimeGetStats<t){var n=[];this.config.isSubscriber?(n.push(this.receiveVideoStats),n.push(this.receiveAudioStats)):(n.push(this.sendAudioStats),n.push(this.sendVideoStats)),n.push({id:"time",startTime:this.connectedTime,timestamp:Date.now()}),e&&e(n)}else this._getStats(e)},e.prototype._getStats=function(e){var t=this,n=[];this.peerConnection.getStats(null).then((function(r){t.lastTimeGetStats=Date.now(),Object.keys(r).map((function(e){var n=r[e];t.config.isSubscriber?n.type&&"inboundrtp"===n.type&&n.mediaType&&"audio"===n.mediaType?(t.receiveAudioStats.id=n.id+"recv",t.receiveAudioStats.type=n.type+"",t.receiveAudioStats.mediaType=n.mediaType+"",t.receiveAudioStats.packetsReceived=n.packetsReceived+"",t.receiveAudioStats.bytesReceived=n.bytesReceived+"",t.receiveAudioStats.packetsLost=n.packetsLost+"",t.receiveAudioStats.googJitterReceived=n.jitter+""):n.type&&"inboundrtp"===n.type&&n.mediaType&&"video"===n.mediaType?(t.receiveVideoStats.id=n.id+"recv",t.receiveVideoStats.type=n.type+"",t.receiveVideoStats.mediaType=n.mediaType+"",t.receiveVideoStats.packetsReceived=n.packetsReceived+"",t.receiveVideoStats.bytesReceived=n.bytesReceived+"",t.receiveVideoStats.packetsLost=n.packetsLost+"",t.receiveVideoStats.googJitterBufferMs=n.jitter+"",t.receiveVideoStats.googPlisSent=n.pliCount+"",t.receiveVideoStats.googFirsSent=n.firCount+"",t.receiveVideoStats.googNacksSent=n.nackCount+""):n.remoteSource&&n.type&&"track"===n.type&&n.trackIdentifier&&-1!==n.trackIdentifier.indexOf("v")?(t.receiveVideoStats.googFrameHeightReceived=n.frameHeight+"",t.receiveVideoStats.googFrameWidthReceived=n.frameWidth+"",t.receiveVideoStats.googFrameRateDecoded=n.framesPerSecond+"",t.receiveVideoStats.googFrameRateOutput=n.framesPerSecond+"",t.receiveVideoStats.googFrameRateReceived=n.framesPerSecond+"",t.receiveVideoStats.googFramesDecoded=n.framesDecoded+"",t.receiveVideoStats.googFrameReceived=n.framesReceived+""):n.remoteSource&&n.type&&"track"===n.type&&n.trackIdentifier&&-1!==n.trackIdentifier.indexOf("a")&&(t.receiveAudioStats.audioOutputLevel=n.audioLevel+""):!n.isRemote&&n.type&&"outboundrtp"===n.type&&n.mediaType&&"audio"===n.mediaType?(t.sendAudioStats.id=n.id+"send",t.sendAudioStats.type=n.type+"",t.sendAudioStats.mediaType=n.mediaType+"",t.sendAudioStats.packetsSent=n.packetsSent+"",t.sendAudioStats.bytesSent=n.bytesSent+""):!n.isRemote&&n.type&&"outboundrtp"===n.type&&n.mediaType&&"video"===n.mediaType?(t.sendVideoStats.id=n.id+"send",t.sendVideoStats.type=n.type+"",t.sendVideoStats.mediaType=n.mediaType+"",t.sendVideoStats.packetsSent=n.packetsSent+"",t.sendVideoStats.bytesSent=n.bytesSent+"",t.sendVideoStats.googRtt=n.roundTripTime+"",t.sendVideoStats.googPlisReceived=n.pliCount+"",t.sendVideoStats.googFirsReceived=n.firCount+"",t.sendVideoStats.googNacksReceived=n.nackCount+""):!n.remoteSource&&n.type&&"track"===n.type&&n.framesSent&&0!==n.framesSent&&(t.sendVideoStats.googFrameHeightSent=n.frameHeight+"",t.sendVideoStats.googFrameHeightInput=n.frameHeight+"",t.sendVideoStats.googFrameWidthSent=n.frameWidth+"",t.sendVideoStats.googFrameWidthInput=n.frameWidth+"",t.sendVideoStats.googFramesEncoded=n.framesSent+"",t.sendVideoStats.googFrameRateSent=n.framesPerSecond+"")})),t.config.isSubscriber?(n.push(t.receiveVideoStats),n.push(t.receiveAudioStats)):(n.push(t.sendAudioStats),n.push(t.sendVideoStats)),n.push({id:"time",startTime:t.connectedTime,timestamp:Date.now()}),e&&e(n)}))},e.prototype.getStatsRate=function(e){this.getStats(e)},e.prototype.initPeecConnection=function(e){var t=e.stunServerUrl,n=e.turnServer,r=e.iceServers;return this.pcConfig={iceServers:[]},r instanceof Array?this.pcConfig.iceServers=e.iceServers:t&&(t instanceof Array?t.map((function(e){"string"==typeof e&&""!==e&&this.pcConfig.iceServers.push({urls:e})})):"string"==typeof t&&""!==t&&this.pcConfig.iceServers.push({urls:t})),n&&(n instanceof Array?n.map((function(e){"string"==typeof e.url&&""!==e.url&&this.pcConfig.iceServers.push({username:e.username,credential:e.credential,url:e.url})})):"auto"!==n.mode&&"manual"!==n.mode||(n.udpport&&this.pcConfig.iceServers.push({username:n.username,credential:n.credential,credentialType:"password",urls:"turn:"+n.url+":"+n.udpport+"?transport=udp"}),"string"==typeof n.tcpport&&""!==n.tcpport&&this.pcConfig.iceServers.push({username:n.username,credential:n.credential,credentialType:"password",urls:"turn:"+n.url+":"+n.tcpport+"?transport=tcp"}),!0===n.forceturn&&(this.pcConfig.iceTransportPolicy="relay"))),new c.RTCPeerConnection(this.pcConfig)},e.prototype._ontrack=function(e){this.onaddstream&&this.onaddstream(e,"ontrack")},e.prototype._onaddstream=function(e){this.onaddstream&&this.onaddstream(e,"onaddstream")},e.prototype._oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(this.state=a.ESTABLISHED,this.connectedTime=Date.now()),this.oniceconnectionstatechange&&this.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},e.prototype._onicecandidate=function(e){!this.candidate&&e&&(this.candidate=e.candidate,this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.editLocalSDP.bind(this)).then(this.setLocalSDP.bind(this)).then(this.sendOffer.bind(this)).catch())},e.prototype.setLocalSDP=function(e){return this.peerConnection.setLocalDescription(new RTCSessionDescription({sdp:e.sdp,type:"offer"})),this.state=a.PREPARING_OFFER,e},e.prototype.editLocalSDP=function(e){return e.sdp=this.setBandWidth(e.sdp),e.sdp=this.reviseOpus(e.sdp),e.sdp=this.addCandidate(e.sdp),e},e.prototype.setSendRecv=function(e){return(e=(e=e.replace(/a=recvonly\r\n/g,"a=sendrecv\r\n")).replace(/a=sendonly\r\n/g,"a=sendrecv\r\n")).replace(/a=inactive\r\n/g,"a=sendrecv\r\n")},e.prototype.setBandWidth=function(e){var t,n,r=this.config,i=r.codec,o=r.minVideoBW,a=r.maxVideoBW,c=r.maxAudioBW,u=r.clientId;if((t=e.match(/m=video.*\r\n/))&&o&&a){n=t[0]+"b=AS:"+a+"\r\n";var l=0,d=0;"h264"===i?(l=e.search(/a=rtpmap:(\d+) H264\/90000\r\n/),d=e.search(/H264\/90000\r\n/)):"vp8"===i?(l=e.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),d=e.search(/VP8\/90000\r\n/)):"vp9"===i&&(l=e.search(/a=rtpmap:(\d+) VP9\/90000\r\n/),d=e.search(/VP9\/90000\r\n/)),-1!==l&&-1!==d&&d-l>10&&(n=n+"a=fmtp:"+e.slice(l+9,d-1)+" x-google-min-bitrate="+o+"\r\n"),e=e.replace(t[0],n),s.default.debug("["+u+"]Set Video Bitrate - min:"+o+" max:"+a)}return(t=e.match(/m=audio.*\r\n/))&&c&&(n=t[0]+"b=AS:"+c+"\r\n",e=e.replace(t[0],n)),e},e.prototype.reviseOpus=function(e){return(e=e.replace(/a=rtpmap:102 opus\/48000\/2/g,"a=rtpmap:111 opus/48000/2")).replace(/m=audio 9 UDP\/TLS\/RTP\/SAVPF 102 0 8 97 13 118 101/g,"m=audio 9 UDP/TLS/RTP/SAVPF 111 0 8 97 13 118 101")},e.prototype.addCandidate=function(e){return e+"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"},e.prototype.sendOffer=function(e){this.config.callback(JSON.stringify({sdp:e.sdp,messageType:"OFFER",tiebreaker:Math.floor(429496723*Math.random()+1)})),this.state=a.OFFER_SENT},e}();t.default=u},function(e,t,n){var r=n(65),i=n(66),o=n(34),a=n(67);e.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||a()}},function(e,t,n){var r,i,o;i=this,o=function(){"use strict";var e,t=this;function n(e){t.console&&(t.console.error?t.console.error(e):t.console.log&&t.console.log(e))}function r(e,t,r,i){var o=i||n,a=e.createShader(r);return e.shaderSource(a,t),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)?a:(o("*** Error compiling shader '"+a+"':"+e.getShaderInfoLog(a)),e.deleteShader(a),null)}function i(e,t,r,i,o){var a=o||n,s=e.createProgram();return t.forEach((function(t){e.attachShader(s,t)})),r&&r.forEach((function(t,n){e.bindAttribLocation(s,i?i[n]:n,t)})),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)?s:(a("Error in program linking:"+e.getProgramInfoLog(s)),e.deleteProgram(s),null)}(e=e||t)===e.top&&(console.log("%c%s","color:blue;font-weight:bold;","for more about webgl-utils.js see:"),console.log("%c%s","color:blue;font-weight:bold;","http://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html"));var o,a=["VERTEX_SHADER","FRAGMENT_SHADER"];return!document.documentMode&&!!window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(o=HTMLCanvasElement.prototype.getContext,function(){var e=arguments,t=e[0];return"webgl"===t&&((e=[].slice.call(arguments))[0]="experimental-webgl"),o.apply(this,e)})),{createProgram:i,createProgramFromSources:function(e,t,n,o,s){for(var c=[],u=0;u<t.length;++u)c.push(r(e,t[u],e[a[u]],s));return i(e,c,n,o,s)}}},void 0===(r=function(){return o.call(i)}.apply(t,[]))||(e.exports=r)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(68),s=n(4),c=o(n(0));t.getSupportedCodec=function(e){return r(void 0,void 0,void 0,(function(){var t,n,r,o,l;return i(this,(function(i){switch(i.label){case 0:return t={video:[],audio:[]},"undefined"!=typeof window?[3,1]:(c.default.error("getSupportedCodec: NOT_BROWSER_ENV"),[2,Promise.reject("NOT_BROWSER_ENV")]);case 1:try{n=a.createRTCPeerConnection({iceServers:[]})}catch(e){return c.default.error("Failed to init RTCPeerConnection",e),[2,Promise.reject(e)]}return n?[3,2]:(c.default.warning("getSupportedCodec: no RTCPeerConnection constructor is detected"),[2,Promise.resolve(t)]);case 2:return e&&e.stream?[3,7]:(r={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},o=void 0,(s.isSafari()||s.isFireFox()||s.isWeChatBrowser())&&n.addTransceiver?(n.addTransceiver("audio"),n.addTransceiver("video"),[4,n.createOffer()]):[3,4]);case 3:return o=i.sent(),[3,6];case 4:return[4,new Promise((function(e,t){var i=setTimeout((function(){t("CREATEOFFER_TIMEOUT")}),3e3);n.createOffer((function(t){clearTimeout(i),e(t)}),(function(e){clearTimeout(i),t(e)}),r)}))];case 5:o=i.sent(),i.label=6;case 6:return n.close(),l=o.sdp,[2,u(l)];case 7:return e.stream.getTracks&&n.addTrack?e.stream.getTracks().forEach((function(t){n.addTrack(t,e.stream)})):n.addStream(e.stream),o=void 0,s.isSafari()||s.isFireFox()?[4,n.createOffer()]:[3,9];case 8:return o=i.sent(),[3,11];case 9:return[4,new Promise((function(e,t){n.createOffer(e,t)}))];case 10:o=i.sent(),i.label=11;case 11:return n.close(),l=o.sdp,[2,u(l)]}}))}))};var u=function(e){var t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ opus/i)&&t.audio.push("OPUS"),Promise.resolve(t)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(10);function a(e){for(var t="",n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}t.encryptRSA=function(e){return r(void 0,void 0,void 0,(function(){var t,n,r,s;return i(this,(function(i){switch(i.label){case 0:return t=o.base64ToUint8Array("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),[4,window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"])];case 1:return n=i.sent(),c=e,r=(new TextEncoder).encode(c),[4,window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r)];case 2:return s=i.sent(),[2,a(new Uint8Array(s))]}var c}))}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(0)),s=n(75),c=n(24),u=n(1),l=n(27);t.addLiveStreamingCapability=function(e,t){var n=this,o=function(t){var n=t.type;if(!e.joinInfo)return new c.AgoraRTCError(c.AgoraRTCErrorCode.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();switch(n){case l.LiveStreamingServiceMode.INJECT:return e._injectStreamingClient||(e._injectStreamingClient=new s.AgoraRTCLiveStreamingClient(e.joinInfo),e._injectStreamingClient.onInjectStatusChange=function(t,n,r){e.gatewayClient.dispatchEvent({type:"streamInjectedStatus",url:r,status:t})}),e._injectStreamingClient;case l.LiveStreamingServiceMode.RAW:return e._liveRawStreamingClient||(e._liveRawStreamingClient=new s.AgoraRTCLiveStreamingClient(e.joinInfo),e._liveRawStreamingClient.setGatewayConnectionState(e.getConnectionState()),e.on("connection-state-change",(function(t){e._liveRawStreamingClient.setGatewayConnectionState(t.curState),"CONNECTING"===t.prevState&&"CONNECTED"===t.curState&&e._liveRawStreamingClient&&e._liveRawStreamingClient.resetAllTask()})),e._liveRawStreamingClient.onLiveStreamError=function(t,n){a.default.error("LIVE_STREAMING_ERROR",n.toString()),e.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:t,reason:n.code})},e._liveRawStreamingClient.onLiveStreamWarning=function(t,n){a.default.warning("LIVE_STREAMING_WARNING",n.toString()),e.gatewayClient.dispatchEvent({type:"liveStreamingWarning",url:t,reason:n.code})}),e._liveRawStreamingClient;case l.LiveStreamingServiceMode.TRANSCODE:return e._liveTranscodeStreamingClient||(e._liveTranscodeStreamingClient=new s.AgoraRTCLiveStreamingClient(e.joinInfo),e._liveTranscodeStreamingClient.setGatewayConnectionState(e.getConnectionState()),e.on("connection-state-change",(function(t){e._liveTranscodeStreamingClient.setGatewayConnectionState(t.curState),"CONNECTING"===t.prevState&&"CONNECTED"===t.curState&&e._liveTranscodeStreamingClient&&e._liveTranscodeStreamingClient.resetAllTask()})),e._liveTranscodeStreamingClient.onLiveStreamError=function(t,n){a.default.error("LIVE_STREAMING_ERROR",n.toString()),e.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:t,reason:n.code})},e._liveTranscodeStreamingClient.onLiveStreamWarning=function(t,n){a.default.warning("LIVE_STREAMING_WARNING",n.toString()),e.gatewayClient.dispatchEvent({type:"liveStreamingWarning",url:t,reason:n})}),e._liveTranscodeStreamingClient}};e.gatewayClient.addEventListener("join",(function(t){e._injectStreamingClient&&e._injectStreamingClient.resetAllTask()})),e.gatewayClient.addEventListener("stream-unpublished",(function(t){t.options&&0===t.options.streamType&&(e._liveRawStreamingClient&&e._liveRawStreamingClient.resetAllTask(),e._liveTranscodeStreamingClient&&e._liveTranscodeStreamingClient.resetAllTask())})),e.gatewayClient.addEventListener("stream-published",(function(e){})),e.startLiveStreaming=function(n,r){a.default.debug("startLiveStreaming");var i=u.report.reportApiInvoke(t.sessionId,{name:"Client.startLiveStreaming",options:arguments,tag:"tracer"});if(e.gatewayClient&&"audience"===e.gatewayClient.role){var o={code:403,reason:"AUDIENCE_STREAMING_FORBIDDEN"};throw i(o),o}var s=e._startLiveStreaming(n,r);return s.then((function(e){i(null,e)})).catch((function(t){a.default.error("LIVE_STREAMING_ERROR",t.toString()),e.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:n,reason:t.code}),i(t)})),s},e._startLiveStreaming=function(s,u){return r(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return u||("vp8"===t.codec&&a.default.warning("VP8 is not supported by raw_streaming. Subscriber side will suffer"),"vp9"===t.codec&&a.default.warning("VP9 is not supported by raw_streaming. Subscriber side will suffer"),"rtc"===t.mode&&a.default.warning("RTC mode is not supported by raw_streaming. Subscriber side will suffer")),(e._liveRawStreamingClient&&e._liveRawStreamingClient.haveUrl(s)||e._liveTranscodeStreamingClient&&e._liveTranscodeStreamingClient.haveUrl(s))&&new c.AgoraRTCError(c.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT).throw(),n=u?l.LiveStreamingServiceMode.TRANSCODE:l.LiveStreamingServiceMode.RAW,[4,o({type:n}).startLiveStreamingTask(s,n)];case 1:return r.sent(),e.gatewayClient.dispatchEvent({type:"liveStreamingStarted",url:s}),[2]}}))}))},e.setLiveTranscoding=function(n){a.default.debug("setLiveTranscoding: "+JSON.stringify(n));var r=u.report.reportApiInvoke(t.sessionId,{name:"Client.setLiveTranscoding",options:arguments,tag:"tracer"}),i=o({type:l.LiveStreamingServiceMode.TRANSCODE});return i.setTranscodingConfig(n).then((function(){e.gatewayClient.dispatchEvent({type:"liveTranscodingUpdated"}),r(null)})).catch((function(t){a.default.error("SET_LIVE_TRANSCODING_ERROR",t.toString()),e.gatewayClient.dispatchEvent({type:"liveStreamingFailed",reason:t.code}),r(t)}))},e.stopLiveStreaming=function(n){var r=u.report.reportApiInvoke(t.sessionId,{name:"Client.stopLiveStreaming",options:arguments,tag:"tracer"}),i=e._stopLiveStreaming(n);return i.then((function(e){r(null,e)})).catch((function(t){a.default.error("STOP_LIVE_STREAMING_ERROR",t.toString()),e.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:n,reason:t.code}),r(t)})),i},e._stopLiveStreaming=function(t){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return a.default.debug("stopLiveStreaming: "+JSON.stringify(t)),n=[e._liveRawStreamingClient,e._liveTranscodeStreamingClient],[4,Promise.all(n.map((function(e){return e&&e.haveUrl(t)&&e.stopLiveStreamingTask(t)})))];case 1:return r.sent(),a.default.debug("stopLiveStreaming sucess: "+JSON.stringify(t)),e.gatewayClient.dispatchEvent({type:"liveStreamingStopped",url:t}),[2]}}))}))},e.addInjectStreamUrl=function(n,r){var i=u.report.reportApiInvoke(t.sessionId,{name:"Client.addInjectStreamUrl",options:[n,r],tag:"tracer"});if("audience"===e.gatewayClient.role){var o={code:403,reason:"AUDIENCE_INJECTING_FORBIDDEN"};throw i(o),o}var s=e._addInjectStreamUrl(n,r);return s.then((function(e){i(null,e)})).catch((function(e){a.default.error("ADD_INJECT_STREAM_ERROR",e.toString()),i(e)})),s},e._addInjectStreamUrl=function(e,t){return r(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return(n=o({type:l.LiveStreamingServiceMode.INJECT})).setInjectStreamConfig(t,0),[4,n.startLiveStreamingTask(e,l.LiveStreamingServiceMode.INJECT)];case 1:return r.sent(),[2]}}))}))},e.removeInjectStreamUrl=function(n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){return r=u.report.reportApiInvoke(t.sessionId,{name:"Client.removeInjectStreamUrl",options:[n],tag:"tracer"}),(o=e._removeInjectStreamUrl(n)).then((function(e){r(null,e)})).catch((function(e){a.default.error("REMOVE_INJECT_STREAM_ERROR",e.toString()),r(e)})),[2,o]}))}))},e._removeInjectStreamUrl=function(e){return r(n,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,o({type:l.LiveStreamingServiceMode.INJECT}).stopLiveStreamingTask(e)];case 1:return t.sent(),[2]}}))}))},e._terminateLiveStreaming=function(){return r(n,void 0,void 0,(function(){return i(this,(function(t){return[e._injectStreamingClient,e._liveRawStreamingClient,e._liveTranscodeStreamingClient].forEach((function(e){e&&e.terminate()})),[2]}))}))}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(5)),o=r(n(0)),a=n(10);t.default=function(e,t){void 0===t&&(t={width:160,height:120,framerate:15});var n=t.width,r=t.height,s=t.framerate,c=e.stream;if(!c)throw i.default.INVALID_LOCAL_STREAM;if(!c.getVideoTracks()[0])throw i.default.HIGH_STREAM_NOT_VIDEO_TRACE;var u=c.getVideoTracks()[0];o.default.debug("Start getLowStream");var l=document.createElement("video"),d=document.createElement("canvas");l.setAttribute("style","display:none"),l.setAttribute("muted",""),l.muted=!0,l.setAttribute("autoplay",""),l.autoplay=!0,l.setAttribute("playsinline",""),d.setAttribute("style","display:none"),d.setAttribute("width",n.toString()),d.setAttribute("height",r.toString());var h=d.getContext("2d");if(!h)throw new Error("not get canvas context");l.srcObject=c,document.body.append(l),document.body.append(d),l.play(),o.default.debug("Start render lowStream");var f=a.audioTimerLoop((function(){return function(){if(l.paused&&l.play(),l.videoHeight>2&&l.videoWidth>2){var t=l.videoWidth,n=l.videoHeight/t,r=d.width*n;Math.abs(r-d.height)>=2&&(o.default.debug("adjust low stream resolution",d.width+"x"+d.height+" -> "+d.width+"x"+r),d.height=r)}h.drawImage(l,0,0,d.width,d.height);var i=e.stream;if(i){var a=i.getVideoTracks()[0];u!==a&&(o.default.debug("adjust low stream track"),l.srcObject=i,u=a)}}()}),s),p=d.captureStream(s),m=p.getVideoTracks()[0];return m.requestFrame&&m.requestFrame(),p.clean=function(){o.default.debug("Start clean lowStream"),f(),(l||l.parentNode||l.parentNode.removeChild)&&l.parentNode.removeChild(l),(d||d.parentNode||d.parentNode.removeChild)&&d.parentNode.removeChild(d),o.default.debug("Clean lowStream")},p}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},function(module,exports,__webpack_require__){(function(global,module){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*!
 * protobuf.js v6.10.0 (c) 2016, daniel wirtz
 * compiled wed, 15 jul 2020 23:34:13 utc
 * licensed under the bsd-3-clause license
 * see: https://github.com/dcodeio/protobuf.js for details
 */!function(undefined){"use strict";!function(e,t,n){var r=function n(r){var i=t[r];return i||e[r][0].call(i=t[r]={exports:{}},n,i,i.exports),i.exports}(16);r.util.global.protobuf=r,__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(61)],(__WEBPACK_AMD_DEFINE_RESULT__=function(e){return e&&e.isLong&&(r.util.Long=e,r.configure()),r}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))===undefined||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),module&&module.exports&&(module.exports=r)}({1:[function(e,t,n){t.exports=function(e,t){for(var n=new Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,a){n[r]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,a(e))}}))}},{}],2:[function(e,t,n){var r=n;r.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var i=new Array(64),o=new Array(123),a=0;a<64;)o[i[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;r.encode=function(e,t,n){for(var r,o=null,a=[],s=0,c=0;t<n;){var u=e[t++];switch(c){case 0:a[s++]=i[u>>2],r=(3&u)<<4,c=1;break;case 1:a[s++]=i[r|u>>4],r=(15&u)<<2,c=2;break;case 2:a[s++]=i[r|u>>6],a[s++]=i[63&u],c=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return c&&(a[s++]=i[r],a[s++]=61,1===c&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))},r.decode=function(e,t,n){for(var r,i=n,a=0,s=0;s<e.length;){var c=e.charCodeAt(s++);if(61===c&&a>1)break;if((c=o[c])===undefined)throw Error("invalid encoding");switch(a){case 0:r=c,a=1;break;case 1:t[n++]=r<<2|(48&c)>>4,r=c,a=2;break;case 2:t[n++]=(15&r)<<4|(60&c)>>2,r=c,a=3;break;case 3:t[n++]=(3&r)<<6|c,a=0}}if(1===a)throw Error("invalid encoding");return n-i},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{}],3:[function(e,t,n){function r(e,t){"string"==typeof e&&(t=e,e=undefined);var n=[];function i(e){if("string"!=typeof e){var t=o();if(r.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var a=Object.keys(e),s=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)s[u]=a[u],c[u]=e[a[u++]];return s[u]=t,Function.apply(null,s).apply(null,c)}return Function(t)()}for(var l=new Array(arguments.length-1),d=0;d<l.length;)l[d]=arguments[++d];if(d=0,e=e.replace(/%([%dfijs])/g,(function(e,t){var n=l[d++];switch(t){case"d":case"f":return String(Number(n));case"i":return String(Math.floor(n));case"j":return JSON.stringify(n);case"s":return String(n)}return"%"})),d!==l.length)throw Error("parameter count mismatch");return n.push(e),i}function o(r){return"function "+(r||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+n.join("\n  ")+"\n}"}return i.toString=o,i}t.exports=r,r.verbose=!1},{}],4:[function(e,t,n){function r(){this._listeners={}}t.exports=r,r.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},r.prototype.off=function(e,t){if(e===undefined)this._listeners={};else if(t===undefined)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},r.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},{}],5:[function(e,t,n){t.exports=o;var r=e(1),i=e(7)("fs");function o(e,t,n){return"function"==typeof t?(n=t,t={}):t||(t={}),n?!t.xhr&&i&&i.readFile?i.readFile(e,(function(r,i){return r&&"undefined"!=typeof XMLHttpRequest?o.xhr(e,t,n):r?n(r):n(null,t.binary?i:i.toString("utf8"))})):o.xhr(e,t,n):r(o,this,e,t)}o.xhr=function(e,t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4!==r.readyState)return undefined;if(0!==r.status&&200!==r.status)return n(Error("status "+r.status));if(t.binary){var e=r.response;if(!e){e=[];for(var i=0;i<r.responseText.length;++i)e.push(255&r.responseText.charCodeAt(i))}return n(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return n(null,r.responseText)},t.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",e),r.send()}},{1:1,7:7}],6:[function(e,t,n){function r(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function o(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function s(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:o,e.writeFloatBE=r?o:i,e.readFloatLE=r?a:s,e.readFloatBE=r?s:a}():function(){function t(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){var r=e(t,n),i=2*(r>>31)+1,o=r>>>23&255,a=8388607&r;return 255===o?a?NaN:i*(1/0):0===o?1401298464324817e-60*i*a:i*Math.pow(2,o-150)*(a+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,o),e.readFloatLE=n.bind(null,a),e.readFloatBE=n.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function o(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function s(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:o,e.writeDoubleBE=r?o:i,e.readDoubleLE=r?a:s,e.readDoubleBE=r?s:a}():function(){function t(e,t,n,r,i,o){var a=r<0?1:0;if(a&&(r=-r),0===r)e(0,i,o+t),e(1/r>0?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(r>17976931348623157e292)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+n);else{var s;if(r<22250738585072014e-324)e((s=r/5e-324)>>>0,i,o+t),e((a<<31|s/4294967296)>>>0,i,o+n);else{var c=Math.floor(Math.log(r)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(s=r*Math.pow(2,-c))>>>0,i,o+t),e((a<<31|c+1023<<20|1048576*s&1048575)>>>0,i,o+n)}}}function n(e,t,n,r,i){var o=e(r,i+t),a=e(r,i+n),s=2*(a>>31)+1,c=a>>>20&2047,u=4294967296*(1048575&a)+o;return 2047===c?u?NaN:s*(1/0):0===c?5e-324*s*u:s*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=n.bind(null,a,0,4),e.readDoubleBE=n.bind(null,s,4,0)}(),e}function i(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function o(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=r(r)},{}],7:[function(require,module,exports){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},{}],8:[function(e,t,n){var r=n,i=r.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},o=r.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),n=i(e),r="";n&&(r=t.shift()+"/");for(var o=0;o<t.length;)".."===t[o]?o>0&&".."!==t[o-1]?t.splice(--o,2):n?t.splice(o,1):++o:"."===t[o]?t.splice(o,1):++o;return r+t.join("/")};r.resolve=function(e,t,n){return n||(t=o(t)),i(t)?t:(n||(e=o(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?o(e+"/"+t):t)}},{}],9:[function(e,t,n){t.exports=function(e,t,n){var r=n||8192,i=r>>>1,o=null,a=r;return function(n){if(n<1||n>i)return e(n);a+n>r&&(o=e(r),a=0);var s=t.call(o,a,a+=n);return 7&a&&(a=1+(7|a)),s}}},{}],10:[function(e,t,n){var r=n;r.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},r.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,o=[],a=0;t<n;)(r=e[t++])<128?o[a++]=r:r>191&&r<224?o[a++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(r>>10),o[a++]=56320+(1023&r)):o[a++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},r.write=function(e,t,n){for(var r,i,o=n,a=0;a<e.length;++a)(r=e.charCodeAt(a))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(a+1)))?(r=65536+((1023&r)<<10)+(1023&i),++a,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-o}},{}],11:[function(e,t,n){var r=n,i=e(14),o=e(33);function a(e,t,n,r){if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",r);for(var o=t.resolvedType.values,a=Object.keys(o),s=0;s<a.length;++s)t.repeated&&o[a[s]]===t.typeDefault&&e("default:"),e("case%j:",a[s])("case %i:",o[a[s]])("m%s=%j",r,o[a[s]])("break");e("}")}else e('if(typeof d%s!=="object")',r)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,n,r);else{var c=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",r,r);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,c)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,c?"true":"");break;case"bytes":e('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length)",r)("m%s=d%s",r,r);break;case"string":e("m%s=String(d%s)",r,r);break;case"bool":e("m%s=Boolean(d%s)",r,r)}}return e}function s(e,t,n,r){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?types[%i].values[m%s]:m%s",r,n,r,r):e("d%s=types[%i].toObject(m%s,o)",r,n,r);else{var o=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":o=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,o?"true":"",r);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:e("d%s=m%s",r,r)}}return e}r.fromObject=function(e){var t=e.fieldsArray,n=o.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return n("return new this.ctor");n("var m=new this.ctor");for(var r=0;r<t.length;++r){var s=t[r].resolve(),c=o.safeProp(s.name);s.map?(n("if(d%s){",c)('if(typeof d%s!=="object")',c)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",c)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",c),a(n,s,r,c+"[ks[i]]")("}")("}")):s.repeated?(n("if(d%s){",c)("if(!Array.isArray(d%s))",c)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",c)("for(var i=0;i<d%s.length;++i){",c),a(n,s,r,c+"[i]")("}")("}")):(s.resolvedType instanceof i||n("if(d%s!=null){",c),a(n,s,r,c),s.resolvedType instanceof i||n("}"))}return n("return m")},r.toObject=function(e){var t=e.fieldsArray.slice().sort(o.compareFieldsById);if(!t.length)return o.codegen()("return {}");for(var n=o.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],a=[],c=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?r:t[u].map?a:c).push(t[u]);if(r.length){for(n("if(o.arrays||o.defaults){"),u=0;u<r.length;++u)n("d%s=[]",o.safeProp(r[u].name));n("}")}if(a.length){for(n("if(o.objects||o.defaults){"),u=0;u<a.length;++u)n("d%s={}",o.safeProp(a[u].name));n("}")}if(c.length){for(n("if(o.defaults){"),u=0;u<c.length;++u){var l=c[u],d=o.safeProp(l.name);if(l.resolvedType instanceof i)n("d%s=o.enums===String?%j:%j",d,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",d)("}else")("d%s=o.longs===String?%j:%i",d,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var h="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";n("if(o.bytes===String)d%s=%j",d,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",d,h)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",d,d)("}")}else n("d%s=%j",d,l.typeDefault)}n("}")}var f=!1;for(u=0;u<t.length;++u){l=t[u];var p=e._fieldsArray.indexOf(l);d=o.safeProp(l.name),l.map?(f||(f=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",d,d)("d%s={}",d)("for(var j=0;j<ks2.length;++j){"),s(n,l,p,d+"[ks2[j]]")("}")):l.repeated?(n("if(m%s&&m%s.length){",d,d)("d%s=[]",d)("for(var j=0;j<m%s.length;++j){",d),s(n,l,p,d+"[j]")("}")):(n("if(m%s!=null&&m.hasOwnProperty(%j)){",d,l.name),s(n,l,p,d),l.partOf&&n("if(o.oneofs)")("d%s=%j",o.safeProp(l.partOf.name),l.name)),n("}")}return n("return d")}},{14:14,33:33}],12:[function(e,t,n){t.exports=function(e){var t=o.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter((function(e){return e.map})).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var n=0;n<e.fieldsArray.length;++n){var s=e._fieldsArray[n].resolve(),c=s.resolvedType instanceof r?"int32":s.type,u="m"+o.safeProp(s.name);t("case %i:",s.id),s.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),i.defaults[s.keyType]!==undefined?t("k=%j",i.defaults[s.keyType]):t("k=null"),i.defaults[c]!==undefined?t("value=%j",i.defaults[c]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",s.keyType)("case 2:"),i.basic[c]===undefined?t("value=types[%i].decode(r,r.uint32())",n):t("value=r.%s()",c),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),i.long[s.keyType]!==undefined?t('%s[typeof k==="object"?util.longToHash(k):k]=value',u):t("%s[k]=value",u)):s.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),i.packed[c]!==undefined&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,c)("}else"),i.basic[c]===undefined?t(s.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,n):t("%s.push(r.%s())",u,c)):i.basic[c]===undefined?t(s.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,n):t("%s=r.%s()",u,c),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var l=e._fieldsArray[n];l.required&&t("if(!m.hasOwnProperty(%j))",l.name)("throw util.ProtocolError(%j,{instance:m})",a(l))}return t("return m")};var r=e(14),i=e(32),o=e(33);function a(e){return"missing required '"+e.name+"'"}},{14:14,32:32,33:33}],13:[function(e,t,n){t.exports=function(e){for(var t,n=o.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),s=e.fieldsArray.slice().sort(o.compareFieldsById),c=0;c<s.length;++c){var u=s[c].resolve(),l=e._fieldsArray.indexOf(u),d=u.resolvedType instanceof r?"int32":u.type,h=i.basic[d];t="m"+o.safeProp(u.name),u.map?(n("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",t,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),h===undefined?n("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",l,t):n(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|h,d,t),n("}")("}")):u.repeated?(n("if(%s!=null&&%s.length){",t,t),u.packed&&i.packed[d]!==undefined?n("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",t)("w.%s(%s[i])",d,t)("w.ldelim()"):(n("for(var i=0;i<%s.length;++i)",t),h===undefined?a(n,u,l,t+"[i]"):n("w.uint32(%i).%s(%s[i])",(u.id<<3|h)>>>0,d,t)),n("}")):(u.optional&&n("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",t,u.name),h===undefined?a(n,u,l,t):n("w.uint32(%i).%s(%s)",(u.id<<3|h)>>>0,d,t))}return n("return w")};var r=e(14),i=e(32),o=e(33);function a(e,t,n,r){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,r,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,r,(t.id<<3|2)>>>0)}},{14:14,32:32,33:33}],14:[function(e,t,n){t.exports=a;var r=e(22);((a.prototype=Object.create(r.prototype)).constructor=a).className="Enum";var i=e(21),o=e(33);function a(e,t,n,i,o){if(r.call(this,e,n),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=o||{},this.reserved=undefined,t)for(var a=Object.keys(t),s=0;s<a.length;++s)"number"==typeof t[a[s]]&&(this.valuesById[this.values[a[s]]=t[a[s]]]=a[s])}a.fromJSON=function(e,t){var n=new a(e,t.values,t.options,t.comment,t.comments);return n.reserved=t.reserved,n},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined,"comment",t?this.comment:undefined,"comments",t?this.comments:undefined])},a.prototype.add=function(e,t,n){if(!o.isString(e))throw TypeError("name must be a string");if(!o.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==undefined)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==undefined){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return this.comments[e]=n||null,this},a.prototype.remove=function(e){if(!o.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},{21:21,22:22,33:33}],15:[function(e,t,n){t.exports=u;var r=e(22);((u.prototype=Object.create(r.prototype)).constructor=u).className="Field";var i,o=e(14),a=e(32),s=e(33),c=/^required|optional|repeated$/;function u(e,t,n,i,o,u,l){if(s.isObject(i)?(l=o,u=i,i=o=undefined):s.isObject(o)&&(l=u,u=o,o=undefined),r.call(this,e,u),!s.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!s.isString(n))throw TypeError("type must be a string");if(i!==undefined&&!c.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(o!==undefined&&!s.isString(o))throw TypeError("extend must be a string");this.rule=i&&"optional"!==i?i:undefined,this.type=n,this.id=t,this.extend=o||undefined,this.required="required"===i,this.optional=!this.required,this.repeated="repeated"===i,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!s.Long&&a.long[n]!==undefined,this.bytes="bytes"===n,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=l}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(e,t,n){return"packed"===e&&(this._packed=null),r.prototype.setOption.call(this,e,t,n)},u.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return s.toObject(["rule","optional"!==this.rule&&this.rule||undefined,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:undefined])},u.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=a.defaults[this.type])===undefined&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof o&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(this.options.packed===undefined||!this.resolvedType||this.resolvedType instanceof o)||delete this.options.packed,Object.keys(this.options).length||(this.options=undefined)),this.long)this.typeDefault=s.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;s.base64.test(this.typeDefault)?s.base64.decode(this.typeDefault,e=s.newBuffer(s.base64.length(this.typeDefault)),0):s.utf8.write(this.typeDefault,e=s.newBuffer(s.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=s.emptyObject:this.repeated?this.defaultValue=s.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),r.prototype.resolve.call(this)},u.d=function(e,t,n,r){return"function"==typeof t?t=s.decorateType(t).name:t&&"object"==typeof t&&(t=s.decorateEnum(t).name),function(i,o){s.decorateType(i.constructor).add(new u(o,e,t,n,{default:r}))}},u._configure=function(e){i=e}},{14:14,22:22,32:32,33:33}],16:[function(e,t,n){var r=t.exports=e(17);r.build="light",r.load=function(e,t,n){return"function"==typeof t?(n=t,t=new r.Root):t||(t=new r.Root),t.load(e,n)},r.loadSync=function(e,t){return t||(t=new r.Root),t.loadSync(e)},r.encoder=e(13),r.decoder=e(12),r.verifier=e(36),r.converter=e(11),r.ReflectionObject=e(22),r.Namespace=e(21),r.Root=e(26),r.Enum=e(14),r.Type=e(31),r.Field=e(15),r.OneOf=e(23),r.MapField=e(18),r.Service=e(30),r.Method=e(20),r.Message=e(19),r.wrappers=e(37),r.types=e(32),r.util=e(33),r.ReflectionObject._configure(r.Root),r.Namespace._configure(r.Type,r.Service,r.Enum),r.Root._configure(r.Type),r.Field._configure(r.Type)},{11:11,12:12,13:13,14:14,15:15,17:17,18:18,19:19,20:20,21:21,22:22,23:23,26:26,30:30,31:31,32:32,33:33,36:36,37:37}],17:[function(e,t,n){var r=n;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=e(38),r.BufferWriter=e(39),r.Reader=e(24),r.BufferReader=e(25),r.util=e(35),r.rpc=e(28),r.roots=e(27),r.configure=i,i()},{24:24,25:25,27:27,28:28,35:35,38:38,39:39}],18:[function(e,t,n){t.exports=a;var r=e(15);((a.prototype=Object.create(r.prototype)).constructor=a).className="MapField";var i=e(32),o=e(33);function a(e,t,n,i,a,s){if(r.call(this,e,t,i,undefined,undefined,a,s),!o.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:undefined])},a.prototype.resolve=function(){if(this.resolved)return this;if(i.mapKey[this.keyType]===undefined)throw Error("invalid key type: "+this.keyType);return r.prototype.resolve.call(this)},a.d=function(e,t,n){return"function"==typeof n?n=o.decorateType(n).name:n&&"object"==typeof n&&(n=o.decorateEnum(n).name),function(r,i){o.decorateType(r.constructor).add(new a(i,e,t,n))}}},{15:15,32:32,33:33}],19:[function(e,t,n){t.exports=i;var r=e(35);function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)this[t[n]]=e[t[n]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}},{35:35}],20:[function(e,t,n){t.exports=o;var r=e(22);((o.prototype=Object.create(r.prototype)).constructor=o).className="Method";var i=e(33);function o(e,t,n,o,a,s,c,u){if(i.isObject(a)?(c=a,a=s=undefined):i.isObject(s)&&(c=s,s=undefined),t!==undefined&&!i.isString(t))throw TypeError("type must be a string");if(!i.isString(n))throw TypeError("requestType must be a string");if(!i.isString(o))throw TypeError("responseType must be a string");r.call(this,e,c),this.type=t||"rpc",this.requestType=n,this.requestStream=!!a||undefined,this.responseType=o,this.responseStream=!!s||undefined,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u}o.fromJSON=function(e,t){return new o(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment)},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return i.toObject(["type","rpc"!==this.type&&this.type||undefined,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:undefined])},o.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),r.prototype.resolve.call(this))}},{22:22,33:33}],21:[function(e,t,n){t.exports=l;var r=e(22);((l.prototype=Object.create(r.prototype)).constructor=l).className="Namespace";var i,o,a,s=e(15),c=e(33);function u(e,t){if(!e||!e.length)return undefined;for(var n={},r=0;r<e.length;++r)n[e[r].name]=e[r].toJSON(t);return n}function l(e,t){r.call(this,e,t),this.nested=undefined,this._nestedArray=null}function d(e){return e._nestedArray=null,e}l.fromJSON=function(e,t){return new l(e,t.options).addJSON(t.nested)},l.arrayToJSON=u,l.isReservedId=function(e,t){if(e)for(var n=0;n<e.length;++n)if("string"!=typeof e[n]&&e[n][0]<=t&&e[n][1]>t)return!0;return!1},l.isReservedName=function(e,t){if(e)for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1},Object.defineProperty(l.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=c.toArray(this.nested))}}),l.prototype.toJSON=function(e){return c.toObject(["options",this.options,"nested",u(this.nestedArray,e)])},l.prototype.addJSON=function(e){if(e)for(var t,n=Object.keys(e),r=0;r<n.length;++r)t=e[n[r]],this.add((t.fields!==undefined?i.fromJSON:t.values!==undefined?a.fromJSON:t.methods!==undefined?o.fromJSON:t.id!==undefined?s.fromJSON:l.fromJSON)(n[r],t));return this},l.prototype.get=function(e){return this.nested&&this.nested[e]||null},l.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof a)return this.nested[e].values;throw Error("no such enum: "+e)},l.prototype.add=function(e){if(!(e instanceof s&&e.extend!==undefined||e instanceof i||e instanceof a||e instanceof o||e instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(!(t instanceof l&&e instanceof l)||t instanceof i||t instanceof o)throw Error("duplicate name '"+e.name+"' in "+this);for(var n=t.nestedArray,r=0;r<n.length;++r)e.add(n[r]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),d(this)},l.prototype.remove=function(e){if(!(e instanceof r))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=undefined),e.onRemove(this),d(this)},l.prototype.define=function(e,t){if(c.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var n=this;e.length>0;){var r=e.shift();if(n.nested&&n.nested[r]){if(!((n=n.nested[r])instanceof l))throw Error("path conflicts with non-namespace objects")}else n.add(n=new l(r))}return t&&n.addJSON(t),n},l.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof l?e[t++].resolveAll():e[t++].resolve();return this.resolve()},l.prototype.lookup=function(e,t,n){if("boolean"==typeof t?(n=t,t=undefined):t&&!Array.isArray(t)&&(t=[t]),c.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var r=this.get(e[0]);if(r){if(1===e.length){if(!t||t.indexOf(r.constructor)>-1)return r}else if(r instanceof l&&(r=r.lookup(e.slice(1),t,!0)))return r}else for(var i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof l&&(r=this._nestedArray[i].lookup(e,t,!0)))return r;return null===this.parent||n?null:this.parent.lookup(e,t)},l.prototype.lookupType=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such type: "+e);return t},l.prototype.lookupEnum=function(e){var t=this.lookup(e,[a]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},l.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[i,a]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},l.prototype.lookupService=function(e){var t=this.lookup(e,[o]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},l._configure=function(e,t,n){i=e,o=t,a=n}},{15:15,22:22,33:33}],22:[function(e,t,n){t.exports=o,o.className="ReflectionObject";var r,i=e(33);function o(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(o.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),o.prototype.toJSON=function(){throw Error()},o.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof r&&t._handleAdd(this)},o.prototype.onRemove=function(e){var t=e.root;t instanceof r&&t._handleRemove(this),this.parent=null,this.resolved=!1},o.prototype.resolve=function(){return this.resolved||this.root instanceof r&&(this.resolved=!0),this},o.prototype.getOption=function(e){return this.options?this.options[e]:undefined},o.prototype.setOption=function(e,t,n){return n&&this.options&&this.options[e]!==undefined||((this.options||(this.options={}))[e]=t),this},o.prototype.setParsedOption=function(e,t,n){this.parsedOptions||(this.parsedOptions=[]);var r=this.parsedOptions;if(n){var o=r.find((function(t){return Object.prototype.hasOwnProperty.call(t,e)}));if(o){var a=o[e];i.setProperty(a,n,t)}else(o={})[e]=i.setProperty({},n,t),r.push(o)}else{var s={};s[e]=t,r.push(s)}return this},o.prototype.setOptions=function(e,t){if(e)for(var n=Object.keys(e),r=0;r<n.length;++r)this.setOption(n[r],e[n[r]],t);return this},o.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},o._configure=function(e){r=e}},{33:33}],23:[function(e,t,n){t.exports=a;var r=e(22);((a.prototype=Object.create(r.prototype)).constructor=a).className="OneOf";var i=e(15),o=e(33);function a(e,t,n,i){if(Array.isArray(t)||(n=t,t=undefined),r.call(this,e,n),t!==undefined&&!Array.isArray(t))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function s(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:undefined])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,s(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){r.prototype.onAdd.call(this,e);for(var t=0;t<this.oneof.length;++t){var n=e.get(this.oneof[t]);n&&!n.partOf&&(n.partOf=this,this.fieldsArray.push(n))}s(this)},a.prototype.onRemove=function(e){for(var t,n=0;n<this.fieldsArray.length;++n)(t=this.fieldsArray[n]).parent&&t.parent.remove(t);r.prototype.onRemove.call(this,e)},a.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,n){o.decorateType(t.constructor).add(new a(n,e)),Object.defineProperty(t,n,{get:o.oneOfGetter(e),set:o.oneOfSetter(e)})}}},{15:15,22:22,33:33}],24:[function(e,t,n){t.exports=c;var r,i=e(35),o=i.LongBits,a=i.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},d=function(){return i.Buffer?function(e){return(c.create=function(e){return i.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function h(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function f(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw s(this,8);return new o(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}c.create=d(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return f(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|f(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=d(),r._configure();var t=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},{35:35}],25:[function(e,t,n){t.exports=o;var r=e(24);(o.prototype=Object.create(r.prototype)).constructor=o;var i=e(35);function o(e){r.call(this,e)}o._configure=function(){i.Buffer&&(o.prototype._slice=i.Buffer.prototype.slice)},o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},o._configure()},{24:24,35:35}],26:[function(e,t,n){t.exports=d;var r=e(21);((d.prototype=Object.create(r.prototype)).constructor=d).className="Root";var i,o,a,s=e(15),c=e(14),u=e(23),l=e(33);function d(e){r.call(this,"",e),this.deferred=[],this.files=[]}function h(){}d.fromJSON=function(e,t){return t||(t=new d),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},d.prototype.resolvePath=l.path.resolve,d.prototype.fetch=l.fetch,d.prototype.load=function e(t,n,r){"function"==typeof n&&(r=n,n=undefined);var i=this;if(!r)return l.asPromise(e,i,t,n);var s=r===h;function c(e,t){if(r){var n=r;if(r=null,s)throw e;n(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var n=e.substring(t);if(n in a)return n}return null}function d(e,t){try{if(l.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),l.isString(t)){o.filename=e;var r,a=o(t,i,n),d=0;if(a.imports)for(;d<a.imports.length;++d)(r=u(a.imports[d])||i.resolvePath(e,a.imports[d]))&&f(r);if(a.weakImports)for(d=0;d<a.weakImports.length;++d)(r=u(a.weakImports[d])||i.resolvePath(e,a.weakImports[d]))&&f(r,!0)}else i.setOptions(t.options).addJSON(t.nested)}catch(e){c(e)}s||p||c(null,i)}function f(e,t){if(!(i.files.indexOf(e)>-1))if(i.files.push(e),e in a)s?d(e,a[e]):(++p,setTimeout((function(){--p,d(e,a[e])})));else if(s){var n;try{n=l.fs.readFileSync(e).toString("utf8")}catch(e){return void(t||c(e))}d(e,n)}else++p,i.fetch(e,(function(n,o){--p,r&&(n?t?p||c(null,i):c(n):d(e,o))}))}var p=0;l.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=i.resolvePath("",t[g]))&&f(m);return s?i:(p||c(null,i),undefined)},d.prototype.loadSync=function(e,t){if(!l.isNode)throw Error("not supported");return this.load(e,t,h)},d.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(e){return"'extend "+e.extend+"' in "+e.parent.fullName})).join(", "));return r.prototype.resolveAll.call(this)};var f=/^[A-Z]/;function p(e,t){var n=t.parent.lookup(t.extend);if(n){var r=new s(t.fullName,t.id,t.type,t.rule,undefined,t.options);return r.declaringField=t,t.extensionField=r,n.add(r),!0}return!1}d.prototype._handleAdd=function(e){if(e instanceof s)e.extend===undefined||e.extensionField||p(0,e)||this.deferred.push(e);else if(e instanceof c)f.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof i)for(var t=0;t<this.deferred.length;)p(0,this.deferred[t])?this.deferred.splice(t,1):++t;for(var n=0;n<e.nestedArray.length;++n)this._handleAdd(e._nestedArray[n]);f.test(e.name)&&(e.parent[e.name]=e)}},d.prototype._handleRemove=function(e){if(e instanceof s){if(e.extend!==undefined)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof c)f.test(e.name)&&delete e.parent[e.name];else if(e instanceof r){for(var n=0;n<e.nestedArray.length;++n)this._handleRemove(e._nestedArray[n]);f.test(e.name)&&delete e.parent[e.name]}},d._configure=function(e,t,n){i=e,o=t,a=n}},{14:14,15:15,21:21,23:23,33:33}],27:[function(e,t,n){t.exports={}},{}],28:[function(e,t,n){n.Service=e(29)},{29:29}],29:[function(e,t,n){t.exports=i;var r=e(35);function i(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,n,i,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return r.asPromise(e,s,t,n,i,o);if(!s.rpcImpl)return setTimeout((function(){a(Error("already ended"))}),0),undefined;try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,n){if(e)return s.emit("error",e,t),a(e);if(null===n)return s.end(!0),undefined;if(!(n instanceof i))try{n=i[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),a(e)}return s.emit("data",n,t),a(null,n)}))}catch(e){return s.emit("error",e,t),setTimeout((function(){a(e)}),0),undefined}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{35:35}],30:[function(e,t,n){t.exports=s;var r=e(21);((s.prototype=Object.create(r.prototype)).constructor=s).className="Service";var i=e(20),o=e(33),a=e(28);function s(e,t){r.call(this,e,t),this.methods={},this._methodsArray=null}function c(e){return e._methodsArray=null,e}s.fromJSON=function(e,t){var n=new s(e,t.options);if(t.methods)for(var r=Object.keys(t.methods),o=0;o<r.length;++o)n.add(i.fromJSON(r[o],t.methods[r[o]]));return t.nested&&n.addJSON(t.nested),n.comment=t.comment,n},s.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&Boolean(e.keepComments);return o.toObject(["options",t&&t.options||undefined,"methods",r.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||undefined,"comment",n?this.comment:undefined])},Object.defineProperty(s.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=o.toArray(this.methods))}}),s.prototype.get=function(e){return this.methods[e]||r.prototype.get.call(this,e)},s.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return r.prototype.resolve.call(this)},s.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,c(this)):r.prototype.add.call(this,e)},s.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,c(this)}return r.prototype.remove.call(this,e)},s.prototype.create=function(e,t,n){for(var r,i=new a.Service(e,t,n),s=0;s<this.methodsArray.length;++s){var c=o.lcFirst((r=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[c]=o.codegen(["r","c"],o.isReserved(c)?c+"_":c)("return this.rpcCall(m,q,s,r,c)")({m:r,q:r.resolvedRequestType.ctor,s:r.resolvedResponseType.ctor})}return i}},{20:20,21:21,28:28,33:33}],31:[function(e,t,n){t.exports=y;var r=e(21);((y.prototype=Object.create(r.prototype)).constructor=y).className="Type";var i=e(14),o=e(23),a=e(15),s=e(18),c=e(30),u=e(19),l=e(24),d=e(38),h=e(33),f=e(13),p=e(12),m=e(36),g=e(11),v=e(37);function y(e,t){r.call(this,e,t),this.fields={},this.oneofs=undefined,this.extensions=undefined,this.reserved=undefined,this.group=undefined,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(y.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var n=this.fields[e[t]],r=n.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=n}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=h.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=h.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=y.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,h.merge(e.prototype,t)),e.$type=e.prototype.$type=this,h.merge(e,u,!0),this._ctor=e;for(var n=0;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();var r={};for(n=0;n<this.oneofsArray.length;++n)r[this._oneofsArray[n].resolve().name]={get:h.oneOfGetter(this._oneofsArray[n].oneof),set:h.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(e.prototype,r)}}}),y.generateConstructor=function(e){for(var t,n=h.codegen(["p"],e.name),r=0;r<e.fieldsArray.length;++r)(t=e._fieldsArray[r]).map?n("this%s={}",h.safeProp(t.name)):t.repeated&&n("this%s=[]",h.safeProp(t.name));return n("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},y.fromJSON=function(e,t){var n=new y(e,t.options);n.extensions=t.extensions,n.reserved=t.reserved;for(var u=Object.keys(t.fields),l=0;l<u.length;++l)n.add((void 0!==t.fields[u[l]].keyType?s.fromJSON:a.fromJSON)(u[l],t.fields[u[l]]));if(t.oneofs)for(u=Object.keys(t.oneofs),l=0;l<u.length;++l)n.add(o.fromJSON(u[l],t.oneofs[u[l]]));if(t.nested)for(u=Object.keys(t.nested),l=0;l<u.length;++l){var d=t.nested[u[l]];n.add((d.id!==undefined?a.fromJSON:d.fields!==undefined?y.fromJSON:d.values!==undefined?i.fromJSON:d.methods!==undefined?c.fromJSON:r.fromJSON)(u[l],d))}return t.extensions&&t.extensions.length&&(n.extensions=t.extensions),t.reserved&&t.reserved.length&&(n.reserved=t.reserved),t.group&&(n.group=!0),t.comment&&(n.comment=t.comment),n},y.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),n=!!e&&Boolean(e.keepComments);return h.toObject(["options",t&&t.options||undefined,"oneofs",r.arrayToJSON(this.oneofsArray,e),"fields",r.arrayToJSON(this.fieldsArray.filter((function(e){return!e.declaringField})),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:undefined,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined,"group",this.group||undefined,"nested",t&&t.nested||undefined,"comment",n?this.comment:undefined])},y.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var n=this.oneofsArray;for(t=0;t<n.length;)n[t++].resolve();return r.prototype.resolveAll.call(this)},y.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},y.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&e.extend===undefined){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof o?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):r.prototype.add.call(this,e)},y.prototype.remove=function(e){if(e instanceof a&&e.extend===undefined){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof o){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return r.prototype.remove.call(this,e)},y.prototype.isReservedId=function(e){return r.isReservedId(this.reserved,e)},y.prototype.isReservedName=function(e){return r.isReservedName(this.reserved,e)},y.prototype.create=function(e){return new this.ctor(e)},y.prototype.setup=function(){for(var e=this.fullName,t=[],n=0;n<this.fieldsArray.length;++n)t.push(this._fieldsArray[n].resolve().resolvedType);this.encode=f(this)({Writer:d,types:t,util:h}),this.decode=p(this)({Reader:l,types:t,util:h}),this.verify=m(this)({types:t,util:h}),this.fromObject=g.fromObject(this)({types:t,util:h}),this.toObject=g.toObject(this)({types:t,util:h});var r=v[e];if(r){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=r.fromObject.bind(i),i.toObject=this.toObject,this.toObject=r.toObject.bind(i)}return this},y.prototype.encode=function(e,t){return this.setup().encode(e,t)},y.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},y.prototype.decode=function(e,t){return this.setup().decode(e,t)},y.prototype.decodeDelimited=function(e){return e instanceof l||(e=l.create(e)),this.decode(e,e.uint32())},y.prototype.verify=function(e){return this.setup().verify(e)},y.prototype.fromObject=function(e){return this.setup().fromObject(e)},y.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},y.d=function(e){return function(t){h.decorateType(t,e)}}},{11:11,12:12,13:13,14:14,15:15,18:18,19:19,21:21,23:23,24:24,30:30,33:33,36:36,37:37,38:38}],32:[function(e,t,n){var r=n,i=e(33),o=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var n=0,r={};for(t|=0;n<e.length;)r[o[n+t]]=e[n++];return r}r.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),r.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),r.long=a([0,0,0,1,1],7),r.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),r.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},{33:33}],33:[function(e,t,n){var r,i,o=t.exports=e(35),a=e(27);o.codegen=e(3),o.fetch=e(5),o.path=e(8),o.fs=o.inquire("fs"),o.toArray=function(e){if(e){for(var t=Object.keys(e),n=new Array(t.length),r=0;r<t.length;)n[r]=e[t[r++]];return n}return[]},o.toObject=function(e){for(var t={},n=0;n<e.length;){var r=e[n++],i=e[n++];i!==undefined&&(t[r]=i)}return t};var s=/\\/g,c=/"/g;o.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},o.safeProp=function(e){return!/^[$\w_]+$/.test(e)||o.isReserved(e)?'["'+e.replace(s,"\\\\").replace(c,'\\"')+'"]':"."+e},o.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;o.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,(function(e,t){return t.toUpperCase()}))},o.compareFieldsById=function(e,t){return e.id-t.id},o.decorateType=function(t,n){if(t.$type)return n&&t.$type.name!==n&&(o.decorateRoot.remove(t.$type),t.$type.name=n,o.decorateRoot.add(t.$type)),t.$type;r||(r=e(31));var i=new r(n||t.name);return o.decorateRoot.add(i),i.ctor=t,Object.defineProperty(t,"$type",{value:i,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:i,enumerable:!1}),i};var l=0;o.decorateEnum=function(t){if(t.$type)return t.$type;i||(i=e(14));var n=new i("Enum"+l++,t);return o.decorateRoot.add(n),Object.defineProperty(t,"$type",{value:n,enumerable:!1}),n},o.setProperty=function(e,t,n){if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return function e(t,n,r){var i=n.shift();if(n.length>0)t[i]=e(t[i]||{},n,r);else{var o=t[i];o&&(r=[].concat(o).concat(r)),t[i]=r}return t}(e,t=t.split("."),n)},Object.defineProperty(o,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(e(26)))}})},{14:14,26:26,27:27,3:3,31:31,35:35,5:5,8:8}],34:[function(e,t,n){t.exports=i;var r=e(35);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):o},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?o:new i((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},{35:35}],35:[function(e,t,n){var r=n;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)e[r[i]]!==undefined&&n||(e[r[i]]=t[r[i]]);return e}function o(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&i(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=e(1),r.base64=e(2),r.EventEmitter=e(4),r.float=e(6),r.inquire=e(7),r.utf8=e(10),r.pool=e(9),r.LongBits=e(34),r.isNode=Boolean(void 0!==global&&global&&global.process&&global.process.versions&&global.process.versions.node),r.global=r.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=o,r.ProtocolError=o("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&this[e[n]]!==undefined&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},{1:1,10:10,2:2,34:34,4:4,6:6,7:7,9:9}],36:[function(e,t,n){t.exports=function(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),n={};e.oneofsArray.length&&t("var p={}");for(var r=0;r<e.fieldsArray.length;++r){var c=e._fieldsArray[r].resolve(),u="m"+i.safeProp(c.name);if(c.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",u,c.name),c.map)t("if(!util.isObject(%s))",u)("return%j",o(c,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),s(t,c,"k[i]"),a(t,c,r,u+"[k[i]]")("}");else if(c.repeated)t("if(!Array.isArray(%s))",u)("return%j",o(c,"array"))("for(var i=0;i<%s.length;++i){",u),a(t,c,r,u+"[i]")("}");else{if(c.partOf){var l=i.safeProp(c.partOf.name);1===n[c.partOf.name]&&t("if(p%s===1)",l)("return%j",c.partOf.name+": multiple values"),n[c.partOf.name]=1,t("p%s=1",l)}a(t,c,r,u)}c.optional&&t("}")}return t("return null")};var r=e(14),i=e(33);function o(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,n,i){if(t.resolvedType)if(t.resolvedType instanceof r){e("switch(%s){",i)("default:")("return%j",o(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),s=0;s<a.length;++s)e("case %i:",t.resolvedType.values[a[s]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",n,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",o(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",o(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",o(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",o(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",o(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",o(t,"buffer"))}return e}function s(e,t,n){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",n)("return%j",o(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",n)("return%j",o(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",n)("return%j",o(t,"boolean key"))}return e}},{14:14,33:33}],37:[function(e,t,n){var r=n,i=e(19);r[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),n=this.lookup(t);if(n){var r="."===e["@type"].charAt(0)?e["@type"].substr(1):e["@type"];return-1===r.indexOf("/")&&(r="/"+r),this.create({type_url:r,value:n.encode(n.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var n="",r="";if(t&&t.json&&e.type_url&&e.value){r=e.type_url.substring(e.type_url.lastIndexOf("/")+1),n=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var o=this.lookup(r);o&&(e=o.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var a=e.$type.toObject(e,t);return""===n&&(n="type.googleapis.com/"),r=n+("."===e.$type.fullName[0]?e.$type.fullName.substr(1):e.$type.fullName),a["@type"]=r,a}return this.toObject(e,t)}}},{19:19}],38:[function(e,t,n){t.exports=d;var r,i=e(35),o=i.LongBits,a=i.base64,s=i.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=undefined,this.val=n}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function d(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var h=function(){return i.Buffer?function(){return(d.create=function(){return new r})()}:function(){return new d}};function f(e,t,n){t[n]=255&e}function p(e,t){this.len=e,this.next=undefined,this.val=t}function m(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}d.create=h(),d.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(d.alloc=i.pool(d.alloc,i.Array.prototype.subarray)),d.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},p.prototype=Object.create(c.prototype),p.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},d.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},d.prototype.int32=function(e){return e<0?this._push(m,10,o.fromNumber(e)):this.uint32(e)},d.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},d.prototype.uint64=function(e){var t=o.from(e);return this._push(m,t.length(),t)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(m,t.length(),t)},d.prototype.bool=function(e){return this._push(f,1,e?1:0)},d.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(e){var t=o.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},d.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};d.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(i.isString(e)){var n=d.alloc(t=a.length(e));a.decode(e,n,0),e=n}return this.uint32(t)._push(v,t,e)},d.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(f,1,0)},d.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},d.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},d.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},d._configure=function(e){r=e,d.create=h(),r._configure()}},{35:35}],39:[function(e,t,n){t.exports=o;var r=e(38);(o.prototype=Object.create(r.prototype)).constructor=o;var i=e(35);function o(){r.call(this)}function a(e,t,n){e.length<40?i.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}o._configure=function(){o.alloc=i._Buffer_allocUnsafe,o.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},o.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(o.writeBytesBuffer,t,e),this},o.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},o._configure()},{35:35,38:38}]},{})}()}).call(this,__webpack_require__(33),__webpack_require__(60)(module))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function r(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function i(e){return!0===(e&&e.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=i;var o={},a={};function s(e,t){var n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=a[e])?r:(n=u(e,(0|e)<0?-1:0,!0),i&&(a[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=o[e])?r:(n=u(e,e<0?-1:0,!1),i&&(o[e]=n),n)}function c(e,t){if(isNaN(e))return t?y:v;if(t){if(e<0)return y;if(e>=p)return w}else{if(e<=-m)return T;if(e+1>=m)return S}return e<0?c(-e,t).neg():u(e%f|0,e/f|0,t)}function u(e,t,n){return new r(e,t,n)}r.fromInt=s,r.fromNumber=c,r.fromBits=u;var l=Math.pow;function d(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return v;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return d(e.substring(1),t,n).neg();for(var i=c(l(n,8)),o=v,a=0;a<e.length;a+=8){var s=Math.min(8,e.length-a),u=parseInt(e.substring(a,a+s),n);if(s<8){var h=c(l(n,s));o=o.mul(h).add(c(u))}else o=(o=o.mul(i)).add(c(u))}return o.unsigned=t,o}function h(e,t){return"number"==typeof e?c(e,t):"string"==typeof e?d(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=d,r.fromValue=h;var f=4294967296,p=f*f,m=p/2,g=s(1<<24),v=s(0);r.ZERO=v;var y=s(0,!0);r.UZERO=y;var b=s(1);r.ONE=b;var _=s(1,!0);r.UONE=_;var E=s(-1);r.NEG_ONE=E;var S=u(-1,2147483647,!1);r.MAX_VALUE=S;var w=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=w;var T=u(0,-2147483648,!1);r.MIN_VALUE=T;var A=r.prototype;A.toInt=function(){return this.unsigned?this.low>>>0:this.low},A.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},A.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(T)){var t=c(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=c(l(e,6),this.unsigned),o=this,a="";;){var s=o.div(i),u=(o.sub(s.mul(i)).toInt()>>>0).toString(e);if((o=s).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},A.getHighBits=function(){return this.high},A.getHighBitsUnsigned=function(){return this.high>>>0},A.getLowBits=function(){return this.low},A.getLowBitsUnsigned=function(){return this.low>>>0},A.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},A.isZero=function(){return 0===this.high&&0===this.low},A.eqz=A.isZero,A.isNegative=function(){return!this.unsigned&&this.high<0},A.isPositive=function(){return this.unsigned||this.high>=0},A.isOdd=function(){return 1==(1&this.low)},A.isEven=function(){return 0==(1&this.low)},A.equals=function(e){return i(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},A.eq=A.equals,A.notEquals=function(e){return!this.eq(e)},A.neq=A.notEquals,A.ne=A.notEquals,A.lessThan=function(e){return this.comp(e)<0},A.lt=A.lessThan,A.lessThanOrEqual=function(e){return this.comp(e)<=0},A.lte=A.lessThanOrEqual,A.le=A.lessThanOrEqual,A.greaterThan=function(e){return this.comp(e)>0},A.gt=A.greaterThan,A.greaterThanOrEqual=function(e){return this.comp(e)>=0},A.gte=A.greaterThanOrEqual,A.ge=A.greaterThanOrEqual,A.compare=function(e){if(i(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},A.comp=A.compare,A.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(b)},A.neg=A.negate,A.add=function(e){i(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,o=65535&this.low,a=e.high>>>16,s=65535&e.high,c=e.low>>>16,l=0,d=0,f=0,p=0;return f+=(p+=o+(65535&e.low))>>>16,d+=(f+=r+c)>>>16,l+=(d+=n+s)>>>16,l+=t+a,u((f&=65535)<<16|(p&=65535),(l&=65535)<<16|(d&=65535),this.unsigned)},A.subtract=function(e){return i(e)||(e=h(e)),this.add(e.neg())},A.sub=A.subtract,A.multiply=function(e){if(this.isZero())return v;if(i(e)||(e=h(e)),n)return u(n.mul(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned);if(e.isZero())return v;if(this.eq(T))return e.isOdd()?T:v;if(e.eq(T))return this.isOdd()?T:v;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return c(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,o=this.low>>>16,a=65535&this.low,s=e.high>>>16,l=65535&e.high,d=e.low>>>16,f=65535&e.low,p=0,m=0,y=0,b=0;return y+=(b+=a*f)>>>16,m+=(y+=o*f)>>>16,y&=65535,m+=(y+=a*d)>>>16,p+=(m+=r*f)>>>16,m&=65535,p+=(m+=o*d)>>>16,m&=65535,p+=(m+=a*l)>>>16,p+=t*f+r*d+o*l+a*s,u((y&=65535)<<16|(b&=65535),(p&=65535)<<16|(m&=65535),this.unsigned)},A.mul=A.multiply,A.divide=function(e){if(i(e)||(e=h(e)),e.isZero())throw Error("division by zero");var t,r,o;if(n)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?n.div_u:n.div_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:v;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return _;o=y}else{if(this.eq(T))return e.eq(b)||e.eq(E)?T:e.eq(T)?b:(t=this.shr(1).div(e).shl(1)).eq(v)?e.isNegative()?b:E:(r=this.sub(e.mul(t)),o=t.add(r.div(e)));if(e.eq(T))return this.unsigned?y:v;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=v}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),s=a<=48?1:l(2,a-48),d=c(t),f=d.mul(e);f.isNegative()||f.gt(r);)f=(d=c(t-=s,this.unsigned)).mul(e);d.isZero()&&(d=b),o=o.add(d),r=r.sub(f)}return o},A.div=A.divide,A.modulo=function(e){return i(e)||(e=h(e)),n?u((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},A.mod=A.modulo,A.rem=A.modulo,A.not=function(){return u(~this.low,~this.high,this.unsigned)},A.and=function(e){return i(e)||(e=h(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},A.or=function(e){return i(e)||(e=h(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},A.xor=function(e){return i(e)||(e=h(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},A.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},A.shl=A.shiftLeft,A.shiftRight=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},A.shr=A.shiftRight,A.shiftRightUnsigned=function(e){if(i(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},A.shru=A.shiftRightUnsigned,A.shr_u=A.shiftRightUnsigned,A.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},A.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},A.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},A.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},A.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e){e.exports=JSON.parse('{"PeerPublishStatus":408,"JoinChannelTimeout":407,"OnUpdateStream":356,"OnRemoveStream":355,"OnAddVideoStream":353,"OnAddAudioStream":352,"FirstAudioDecode":351,"FirstVideoDecode":350,"FirstAudioReceived":349,"FirstVideoReceived":348,"ReqUserAccount":196,"ApiInvoke":41,"RequestProxyWorkerManager":36,"RequestProxyAppCenter":35,"VideoSendingStopped":34,"AudioSendingStopped":33,"StreamSwitch":32,"FirstFrame":31,"Publish":30,"Subscribe":29,"JoinGateway":28,"JoinChooseServer":27,"Session":26,"APWorkerEvent":160,"WorkerEvent":156,"JoinWebProxyAP":700,"WebSocketQuit":671}')},function(e){e.exports=JSON.parse('{"nested":{"protobuf":{"nested":{"Session":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"version":{"type":"string","id":11},"browser":{"type":"string","id":12},"appid":{"type":"string","id":13},"mode":{"type":"string","id":14},"extend":{"type":"string","id":15},"process":{"type":"string","id":16},"build":{"type":"string","id":17},"ipv6":{"type":"string","id":18},"sourceHost":{"type":"string","id":19},"sourcePath":{"type":"string","id":20},"collectorHost":{"type":"string","id":21},"collectorName":{"type":"string","id":22}}},"JoinChooseServer":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"chooseServerAddr":{"type":"string","id":11},"chooseServerAddrList":{"type":"string","id":12},"errorCode":{"type":"string","id":13},"eventElapse":{"type":"int64","id":14},"chooseServerIp":{"type":"string","id":15}}},"JoinGateway":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"gatewayAddr":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"eventElapse":{"type":"int64","id":13},"firstSuccess":{"type":"bool","id":14}}},"Subscribe":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"localSdp":{"type":"string","id":11},"remoteSdp":{"type":"string","id":12},"extend":{"type":"string","id":13},"errorCode":{"type":"string","id":14},"eventElapse":{"type":"int64","id":15},"video":{"type":"bool","id":16},"audio":{"type":"bool","id":17},"subscribeRequestid":{"type":"int32","id":18},"p2pid":{"type":"int32","id":19}}},"Publish":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"localSdp":{"type":"string","id":11},"remoteSdp":{"type":"string","id":12},"extend":{"type":"string","id":13},"errorCode":{"type":"string","id":14},"eventElapse":{"type":"int64","id":15},"videoName":{"type":"string","id":16},"audioName":{"type":"string","id":17},"screenName":{"type":"string","id":18},"video":{"type":"bool","id":19},"audio":{"type":"bool","id":20},"publishRequestid":{"type":"int32","id":21},"p2pid":{"type":"int32","id":22},"screenshare":{"type":"bool","id":23}}},"FirstFrame":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"extend":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"width":{"type":"int64","id":13},"height":{"type":"int64","id":14}}},"StreamSwitch":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"isDual":{"type":"bool","id":11}}},"AudioSendingStopped":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"reason":{"type":"string","id":10},"eventType":{"type":"string","id":11}}},"VideoSendingStopped":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"reason":{"type":"string","id":10},"eventType":{"type":"string","id":11}}},"RequestProxyAppCenter":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"APAddr":{"type":"string","id":11},"workerManagerList":{"type":"string","id":12},"errorCode":{"type":"string","id":13},"eventElapse":{"type":"int64","id":14},"extend":{"type":"string","id":15},"response":{"type":"string","id":16}}},"RequestProxyWorkerManager":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"workerManagerAddr":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"eventElapse":{"type":"int64","id":13},"extend":{"type":"string","id":14},"response":{"type":"string","id":15}}},"ApiInvoke":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"apiName":{"type":"string","id":9},"errorCode":{"type":"string","id":10},"options":{"type":"string","id":11},"execElapse":{"type":"int64","id":12},"execStates":{"type":"string","id":13},"execResult":{"type":"string","id":14},"invokeId":{"type":"int64","id":15}}},"ReqUserAccount":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"eventType":{"type":"string","id":9},"serverAddress":{"type":"string","id":10},"stringUid":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"extend":{"type":"string","id":13}}},"FirstVideoReceived":{"fields":{"lts":{"type":"int64","id":1},"peer":{"type":"int64","id":2},"elapse":{"type":"int64","id":3},"sid":{"type":"string","id":4},"cname":{"type":"string","id":5},"cid":{"type":"int64","id":6},"uid":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"FirstAudioReceived":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"FirstVideoDecode":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"videowidth":{"type":"int32","id":9},"videoheight":{"type":"int32","id":10},"subscribeRequestid":{"type":"int32","id":11},"p2pid":{"type":"int32","id":12},"subscribeElapse":{"type":"int64","id":13}}},"FirstAudioDecode":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"OnAddAudioStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnAddVideoStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnRemoveStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnUpdateStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"audio":{"type":"bool","id":8},"video":{"type":"bool","id":9}}},"JoinChannelTimeout":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"elapse":{"type":"int64","id":6},"timeout":{"type":"int32","id":7}}},"PeerPublishStatus":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"peer":{"type":"int64","id":6},"elapse":{"type":"int64","id":7},"peerPublishDuration":{"type":"int64","id":8},"joinChannelSuccessElapse":{"type":"int64","id":9},"subscribeElapse":{"type":"int64","id":10},"audiotag":{"type":"int32","id":11},"videotag":{"type":"int32","id":12},"screensharetag":{"type":"int32","id":13},"firsttimetag":{"type":"int32","id":14}}},"WebSocketQuit":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"elapse":{"type":"int64","id":6},"succ":{"type":"int32","id":7},"errorCode":{"type":"string","id":8},"ip":{"type":"string","id":9}}},"Message":{"fields":{"id":{"type":"int64","id":1},"msg":{"type":"bytes","id":2}}},"ProtoRaws":{"fields":{"sendTs":{"type":"int64","id":1},"payloads":{"rule":"repeated","type":"Message","id":2},"vid":{"type":"int32","id":3}}},"APWorkerEvent":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"ec":{"type":"int32","id":10},"sc":{"type":"int32","id":11},"serverIp":{"type":"string","id":12},"firstSuccess":{"type":"bool","id":13},"responseTime":{"type":"int32","id":14},"serviceName":{"type":"string","id":15},"responseDetail":{"type":"string","id":16}}},"WorkerEvent":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"command":{"type":"string","id":10},"actionType":{"type":"string","id":11},"url":{"type":"string","id":12},"payload":{"type":"string","id":13},"serverCode":{"type":"int32","id":14},"code":{"type":"int32","id":15},"traceId":{"type":"string","id":16},"workerType":{"type":"int32","id":17},"responseTime":{"type":"int32","id":18},"requestId":{"type":"int64","id":19},"packIndex":{"type":"int32","id":20},"requestByUser":{"type":"bool","id":21},"tid":{"type":"string","id":22}}},"JoinWebProxyAP":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"sucess":{"type":"int32","id":7},"elapse":{"type":"int64","id":8},"eventType":{"type":"string","id":9},"apServerAddr":{"type":"string","id":10},"turnServerAddrList":{"type":"string","id":11},"errorCode":{"type":"string","id":12}}}}}}}')},function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n,r){var i=t&&t.prototype instanceof l?t:l,o=Object.create(i.prototype),a=new S(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=c(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,a),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var u={};function l(){}function d(){}function h(){}var f={};f[i]=function(){return this};var p=Object.getPrototypeOf,m=p&&p(p(w([])));m&&m!==t&&n.call(m,i)&&(f=m);var g=h.prototype=l.prototype=Object.create(f);function v(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function y(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,s){var u=c(e[i],e,o);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,s)}))}s(u.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function w(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return d.prototype=g.constructor=h,h.constructor=d,h[a]=d.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},v(y.prototype),y.prototype[o]=function(){return this},e.AsyncIterator=y,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new y(s(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},v(g),g[a]="Generator",g[i]=function(){return this},g.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=w,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:w(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="object"==typeof window&&window.RTCPeerConnection,i="object"==typeof window&&window.webkitRTCPeerConnection,o="object"==typeof window&&window.mozRTCPeerConnection;t.createRTCPeerConnection=function(e){var t=r||i||o;return t?new t(e):null}},function(e,t,n){var r;
/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */!function(t){"use strict";function i(){}var o=i.prototype,a=t.EventEmitter;function s(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function c(e){return function(){return this[e].apply(this,arguments)}}o.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp)for(n in t={},r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n]);else t=r[e]||(r[e]=[]);return t},o.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},o.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&((t={})[e]=n),t||n},o.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var n,r=this.getListenersAsObject(e),i="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&-1===s(r[n],t)&&r[n].push(i?t:{listener:t,once:!1});return this},o.on=c("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=c("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var n,r,i=this.getListenersAsObject(e);for(r in i)i.hasOwnProperty(r)&&-1!==(n=s(i[r],t))&&i[r].splice(n,1);return this},o.off=c("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,n){var r,i,o=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)o.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?o.call(this,r,i):a.call(this,r,i));return this},o.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},o.removeAllListeners=c("removeEvent"),o.emitEvent=function(e,t){var n,r,i,o,a=this.getListenersAsObject(e);for(o in a)if(a.hasOwnProperty(o))for(n=a[o].slice(0),i=0;i<n.length;i++)!0===(r=n[i]).once&&this.removeListener(e,r.listener),r.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},o.trigger=c("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},o._getEvents=function(){return this._events||(this._events={})},i.noConflict=function(){return t.EventEmitter=a,i},void 0===(r=function(){return i}.call(t,n,t,e))||(e.exports=r)}("undefined"!=typeof window?window:this||{})},function(e,t,n){var r=n(35);e.exports=function(e){if(Array.isArray(e))return r(e)}},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,n){(function(t){var r;e.exports=(r=r||function(e,r){var i;if("undefined"!=typeof window&&window.crypto&&(i=window.crypto),"undefined"!=typeof self&&self.crypto&&(i=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(i=globalThis.crypto),!i&&"undefined"!=typeof window&&window.msCrypto&&(i=window.msCrypto),!i&&void 0!==t&&t.crypto&&(i=t.crypto),!i)try{i=n(74)}catch(e){}var o=function(){if(i){if("function"==typeof i.getRandomValues)try{return i.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof i.randomBytes)try{return i.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),s={},c=s.lib={},u=c.Base={extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=c.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||h).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var a=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=a<<24-(r+o)%4*8}else for(var s=0;s<i;s+=4)t[r+s>>>2]=n[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(o());return new l.init(t,e)}}),d=s.enc={},h=d.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new l.init(n,t/2)}},f=d.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new l.init(n,t)}},p=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},m=c.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,o=r.sigBytes,a=this.blockSize,s=o/(4*a),c=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,u=e.min(4*c,o);if(c){for(var d=0;d<c;d+=a)this._doProcessBlock(i,d);n=i.splice(0,c),r.sigBytes-=u}return new l.init(n,u)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),g=(c.Hasher=m.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new g.HMAC.init(e,n).finalize(t)}}}),s.algo={});return s}(Math),r)}).call(this,n(33))},function(e,t){},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(76),c=n(27),u=n(95),l=n(20),d=n(24),h=n(31),f=a(n(0)),p=a(n(37)),m=function(){function e(e){this.retryTimeout=1e4,this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.taskMutex=new u.PromiseMutex("LS"),this.cancelToken=p.default.CancelToken.source(),this.injectConfig=r({},c.DEFAULT_INJECT_CONFIG),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new Map,this.spec=e}return Object.defineProperty(e.prototype,"isNeedReset",{get:function(){for(var e=this,t=0,n=Array.from(this.streamingTasks.values());t<n.length;t++){var r=n[t];if(r.mode===c.LiveStreamingServiceMode.INJECT)return!0;if(r.mode===c.LiveStreamingServiceMode.TRANSCODE&&(this.transcodingConfig&&(this.transcodingConfig.userConfigs||this.transcodingConfig.transcodingUsers)||[]).find((function(t){return t.uid===e.spec.uid})))return!0}return!1},enumerable:!0,configurable:!0}),e.prototype.setTranscodingConfig=function(e){return i(this,void 0,void 0,(function(){var t,n,i,a,s,u=this;return o(this,(function(o){switch(o.label){case 0:(t=r(r({},c.DEFAULT_TRANSCODING_CONFIG),e)).transcodingUsers||(t.transcodingUsers=t.userConfigs),66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(f.default.debug("["+this.spec.clientId+"] set transcoding config, fix video codec profile: "+t.videoCodecProfile+" -> 100"),t.videoCodecProfile=100),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map((function(e){return r(r(r({},c.DEFAULT_LIVE_STREAMING_TRANSCODING_USER),e),{zOrder:e.zOrder?e.zOrder+1:1})}))),t.images&&(t.images=t.images.map((function(e){return r(r({},c.DEFAULT_LIVE_STREAMING_TRANSCODING_WATERMARK),e)})));try{c.isLiveStreamingTranscodingConfig(t)}catch(e){throw e}return t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map((function(e){return r({},e)})),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers),n=(t.userConfigs||[]).map((function(e){return"number"==typeof e.uid?Promise.resolve(e.uid):l.getUserAccount(u.spec,null,e.uid)})),[4,this.taskMutex.lock()];case 1:return i=o.sent(),[4,Promise.all(n)];case 2:if(o.sent().forEach((function(e,n){t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e&&e.uid||e)})),this.transcodingConfig=t,!this.connection)return i(),[2];o.label=3;case 3:return o.trys.push([3,5,,6]),[4,this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(this.streamingTasks.values()).map((function(e){return e.taskId})).join("#")})];case 4:return a=o.sent(),i(),f.default.debug("["+this.spec.clientId+"] update live transcoding config success, code: "+a.code+", config:",JSON.stringify(this.transcodingConfig)),[3,6];case 5:if(s=o.sent(),i(),!s.data||!s.data.retry)throw s;return s.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((function(e){f.default.warning("["+u.spec.clientId+"] live streaming receive error",s.toString(),"try to republish",e.url),u.startLiveStreamingTask(e.url,e.mode,s).then((function(){f.default.debug("["+u.spec.clientId+"] live streaming republish "+e.url+" success")})).catch((function(t){f.default.error("["+u.spec.clientId+"] live streaming republish failed",e.url,t.toString()),u.onLiveStreamError&&u.onLiveStreamError(e.url,t)}))})),[3,6];case 6:return[2]}}))}))},e.prototype.setInjectStreamConfig=function(e,t){this.injectConfig=Object.assign({},this.injectConfig,e),this.injectLoopTimes=t},e.prototype.startLiveStreamingTask=function(e,t,n){return i(this,void 0,void 0,(function(){var i,a,s,u,l,p,m,g,v=this;return o(this,(function(o){switch(o.label){case 0:return Array.from(this.streamingTasks.values()).find((function(e){return e.mode===c.LiveStreamingServiceMode.INJECT}))&&t===c.LiveStreamingServiceMode.INJECT?[2,new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw()]:(i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:30},f.default.debug("["+this.spec.clientId+"] start live streaming "+e+", mode: "+t),[4,this.taskMutex.lock()]);case 1:if(a=o.sent(),!this.transcodingConfig&&t===c.LiveStreamingServiceMode.TRANSCODE)throw a(),new d.AgoraRTCError(d.AgoraRTCErrorCode.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");if(!this.connection&&n)return a(),[2];if(this.streamingTasks.get(e)&&!n)return a(),[2,new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT).throw()];if(!this.transcodingConfig&&t===c.LiveStreamingServiceMode.TRANSCODE)throw a(),new d.AgoraRTCError(d.AgoraRTCErrorCode.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");o.label=2;case 2:return o.trys.push([2,5,,6]),this.connection?[3,4]:(s=this,[4,this.connect(t)]);case 3:s.connection=o.sent(),o.label=4;case 4:return[3,6];case 5:throw u=o.sent(),a(),u;case 6:switch(t){case c.LiveStreamingServiceMode.TRANSCODE:i.transcodingConfig=r({},this.transcodingConfig);break;case c.LiveStreamingServiceMode.RAW:break;case c.LiveStreamingServiceMode.INJECT:i={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,l=this.lastTaskId++,o.label=7;case 7:return o.trys.push([7,9,,14]),p=new Promise((function(t,r){h.wait(v.retryTimeout).then((function(){if(n)return r(n);var t=v.statusError.get(e);return t?(v.statusError.delete(e),r(t)):void 0}))})),[4,Promise.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:t===c.LiveStreamingServiceMode.TRANSCODE?1:2,requestByUser:!n,tid:l.toString()}),p])];case 8:return m=o.sent(),this.isStartingStreamingTask=!1,f.default.debug("["+this.spec.clientId+"] live streaming started, code: "+m.code),this.streamingTasks.set(e,{clientRequest:i,mode:t,url:e,taskId:l}),a(),[3,14];case 9:if(g=o.sent(),a(),this.isStartingStreamingTask=!1,!g.data||!g.data.retry||n)throw g;return g.data.changeAddress?[3,11]:[4,this.startLiveStreamingTask(e,t,g)];case 10:return[2,o.sent()];case 11:return this.connection.tryNextAddress(),[4,this.startLiveStreamingTask(e,t,g)];case 12:return[2,o.sent()];case 13:return[3,14];case 14:return[2]}}))}))},e.prototype.stopLiveStreamingTask=function(e){var t=this;return new Promise((function(n,r){var i=t.streamingTasks.get(e);if(!i||!t.connection)return new d.AgoraRTCError(d.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();var o=i.mode;i.abortTask=function(){f.default.debug("["+t.spec.clientId+"] stop live streaming success(worker exception)"),t.streamingTasks.delete(e),n()},f.default.debug("stop live streaming task request: "+JSON.stringify(e)),t.connection.request("request",{clientRequest:{command:o===c.LiveStreamingServiceMode.INJECT?"UninjectStream":"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:o===c.LiveStreamingServiceMode.TRANSCODE?1:2,requestByUser:!0,tid:(t.lastTaskId++).toString()}).then((function(r){f.default.debug("["+t.spec.clientId+"] stop live streaming success, code: "+r.code),t.streamingTasks.delete(e),0===t.streamingTasks.size&&o!==c.LiveStreamingServiceMode.INJECT&&(t.connection.close(),t.connection=void 0),n()})).catch(r)}))},e.prototype.controlInjectStream=function(e,t,n,r){return i(this,void 0,void 0,(function(){var i;return o(this,(function(o){switch(o.label){case 0:if(!(i=this.streamingTasks.get(e))||!this.connection||i.mode!==c.LiveStreamingServiceMode.INJECT)throw new d.AgoraRTCError(d.AgoraRTCErrorCode.INVALID_OPERATION,"can not find inject stream task to control");return[4,this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:t,audioVolume:n,position:r}})];case 1:return[2,o.sent().serverResponse]}}))}))},e.prototype.resetAllTask=function(){var e=this,t=Array.from(this.streamingTasks.values());this.terminate();for(var n=function(t){r.startLiveStreamingTask(t.url,t.mode).catch((function(n){e.onLiveStreamError&&e.onLiveStreamError(t.url,n)}))},r=this,i=0,o=t;i<o.length;i++)n(o[i])},e.prototype.setGatewayConnectionState=function(e){this.connection&&(this.connection.gatewayConnectionState=e)},e.prototype.terminate=function(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=p.default.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0},e.prototype.connect=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return o(this,(function(r){switch(r.label){case 0:if(this.connection)throw new d.AgoraRTCError(d.AgoraRTCErrorCode.UNEXPECTED_ERROR,"live streaming connection has already connected");return[4,h.getLiveStreamingWorkerMangerResult(e,this.spec,this.cancelToken.token)];case 1:return t=r.sent(),this.uapResponse=t,this.connection=new s.AgoraLiveStreamingUapSignal(t.workerToken,this.spec,e),this.connection.on(c.LiveStreamingUapSignalEvents.WARNING,(function(e,t){return n.onLiveStreamWarning&&n.onLiveStreamWarning(t,e)})),this.connection.on(c.LiveStreamingUapSignalEvents.PUBLISH_STREAM_STATUS,(function(e){return n.handlePublishStreamServer(e)})),this.connection.on(c.LiveStreamingUapSignalEvents.INJECT_STREAM_STATUS,(function(e){return n.handleInjectStreamServerStatus(e)})),this.connection.on(c.LiveStreamingUapSignalEvents.REQUEST_NEW_ADDRESS,(function(t,r){if(!n.connection)return r(new d.AgoraRTCError(d.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not get new live streaming address list"));h.getLiveStreamingWorkerMangerResult(e,n.spec,n.cancelToken.token).then((function(e){n.uapResponse=e,t(e.addressList)})).catch(r)})),[4,this.connection.init(t.addressList)];case 2:return r.sent(),[2,this.connection]}}))}))},e.prototype.handlePublishStreamServer=function(e){var t=this,n=e.serverStatus&&e.serverStatus.url;if(!n)throw new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"empty url",{code:e.code});var r=this.streamingTasks.get(n);switch(e.code){case c.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case c.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case c.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case c.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:var i=new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(r)return f.default.error(i.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,i);if(!this.isStartingStreamingTask)return;this.statusError.set(n,i);case c.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_LOST:case c.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(!this.connection||0===this.streamingTasks.size)return;this.connection.tryNextAddress();for(var o=Array.from(this.streamingTasks.values()),a=function(n){if(n.abortTask)return n.abortTask(),"continue";f.default.warning("["+s.spec.clientId+"] publish stream status code",e.code,"try to republish",n.url),s.startLiveStreamingTask(n.url,n.mode,new d.AgoraRTCError(d.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((function(){f.default.debug("["+t.spec.clientId+"] republish live stream success",n.url)})).catch((function(e){f.default.error(e.toString()),t.onLiveStreamError&&t.onLiveStreamError(n.url,e)}))},s=this,u=0,l=o;u<l.length;u++)a(l[u]);return}},e.prototype.handleInjectStreamServerStatus=function(e){var t=Number(e.uid),n=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,t,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,t,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,t,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,t,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,t,n),void this.streamingTasks.delete(n);default:return void f.default.debug("inject stream server status",e)}},e.prototype.haveUrl=function(e){return this.streamingTasks.has(e)||void 0},e}();t.AgoraRTCLiveStreamingClient=m},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(27),l=n(77),d=n(36),h=n(24),f=n(2),p=c(n(0)),m=n(1),g=n(31),v=function(e){function t(t,n,r){var i=e.call(this)||this;return i._gatewayConnectionState="CONNECTED",i.reconnectMode="retry",i.reqId=0,i.commandReqId=0,i.waitingResponseList=[],i.handleWebSocketOpen=function(){i.reconnectMode="retry",i.startPingPong()},i.handleWebSocketMessage=function(e){if(e.data){var t=JSON.parse(e.data);if(t.requestId)i.emit("@"+t.requestId,t);else if(i.serviceMode===u.LiveStreamingServiceMode.INJECT)i.emit(u.LiveStreamingUapSignalEvents.INJECT_STREAM_STATUS,t);else{m.report.requestWorkerEvent(i.spec.sid,{actionType:"status",serverCode:t.code,workerType:i.serviceMode===u.LiveStreamingServiceMode.TRANSCODE?1:2});var n=t.serverStatus&&t.serverStatus.url;n&&i.waitingResponseList.includes(n)&&200===t.code&&i.emit(n),i.emit(u.LiveStreamingUapSignalEvents.PUBLISH_STREAM_STATUS,t)}}},i.spec=n,i.token=t,i.serviceMode=r,i.websocket=new l.AgoraWebSocketManager("live-streaming"),i.websocket.on(u.WebSocketManagerEvents.CONNECTED,i.handleWebSocketOpen),i.websocket.on(u.WebSocketManagerEvents.ON_MESSAGE,i.handleWebSocketMessage),i.websocket.on(u.WebSocketManagerEvents.REQUEST_NEW_URLS,(function(e,t){d.emitAsPromise(i,u.LiveStreamingUapSignalEvents.REQUEST_NEW_ADDRESS).then(e).catch(t)})),i.websocket.on(u.WebSocketManagerEvents.RECONNECTING,(function(){i.websocket.reconnectMode=i.reconnectMode})),i}return i(t,e),Object.defineProperty(t.prototype,"gatewayConnectionState",{get:function(){return this._gatewayConnectionState},set:function(e){this._gatewayConnectionState=e,"CONNECTED"===e&&this.emit("gateway-connected",e)},enumerable:!0,configurable:!0}),t.prototype.init=function(e){return this.websocket.init(e)},t.prototype.request=function(e,t,n,r){return a(this,void 0,void 0,(function(){var i,a,c,l,d,p,v,y,b,_,E=this;return s(this,(function(s){switch(s.label){case 0:if(this.reqId+=1,i=this.reqId,"request"===e&&(this.commandReqId+=1),a=this.commandReqId,!i||!this.websocket)throw new h.AgoraRTCError(h.AgoraRTCErrorCode.UNEXPECTED_ERROR);if(c=f.VERSION,"closed"===this.websocket.state)throw new h.AgoraRTCError(h.AgoraRTCErrorCode.WS_DISCONNECT);return l=function(){return new Promise((function(e,t){var n=function(){"CONNECTED"===E.gatewayConnectionState&&"connected"===E.websocket.state&&(E.off("gateway-connected",n),E.websocket.off(u.WebSocketManagerEvents.CONNECTED,n),e(void 0))};E.on("gateway-connected",n),E.websocket.once(u.WebSocketManagerEvents.CLOSED,(function(){return t(new h.AgoraRTCError(h.AgoraRTCErrorCode.WS_ABORT))})),E.websocket.on(u.WebSocketManagerEvents.CONNECTED,n)}))},"connected"===this.websocket.state&&"CONNECTED"===this.gatewayConnectionState?[3,2]:[4,l()];case 1:s.sent(),s.label=2;case 2:d=Promise.race([new Promise((function(e,t){var n=function(){t(new h.AgoraRTCError(h.AgoraRTCErrorCode.WS_ABORT))};E.websocket.once(u.WebSocketManagerEvents.RECONNECTING,n),E.websocket.once(u.WebSocketManagerEvents.CLOSED,n),E.once("@"+i,(function(t){e(t)}))})),g.wait(f.getParameter("LIVE_STREAMING_TIMEOUT")).then((function(){return!1}))]),(p=o({command:e,sdkVersion:c,seq:i,requestId:i,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t)).clientRequest&&(p.clientRequest.workerToken=this.token),r&&m.report.requestWorkerEvent(this.spec.sid,o(o({},r),{requestId:a,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0})),v=Date.now(),this.websocket.sendMessage(p),y=null,s.label=3;case 3:return s.trys.push([3,5,,8]),[4,d];case 4:return y=s.sent(),[3,8];case 5:if(b=s.sent(),"closed"===this.websocket.state)throw b;return[4,l()];case 6:return s.sent(),[4,this.request(e,t,n,r)];case 7:return[2,s.sent()];case 8:if(!1===y)throw _=new h.AgoraRTCError(h.AgoraRTCErrorCode.NETWORK_TIMEOUT,(t&&t.clientRequest&&t.clientRequest.command)+" timeout",{changeAddress:!0,retry:!0}),this.emit(u.LiveStreamingUapSignalEvents.WARNING,_,r&&r.url||"unknown url"),r&&m.report.requestWorkerEvent(this.spec.sid,o(o({},r),{requestId:a,actionType:"response",payload:"TIMEOUT",serverCode:0,success:0,responseTime:Date.now()-v})),_;return r&&m.report.requestWorkerEvent(this.spec.sid,o(o({},r),{requestId:a,actionType:"response",payload:JSON.stringify(y.serverResponse),serverCode:y.code,success:200===y.code,responseTime:Date.now()-v})),200===y.code?[3,10]:[4,this.handleResponseError(y)];case 9:s.sent(),s.label=10;case 10:return[2,y]}}))}))},t.prototype.tryNextAddress=function(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")},t.prototype.close=function(){var e="__VERSION__"===f.VERSION?"0.0.1":f.VERSION;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)},t.prototype.handleResponseError=function(e){return a(this,void 0,void 0,(function(){var t,n,r,i,o=this;return s(this,(function(a){switch(p.default.debug("[live-streaming] receive response error "+e.code),e.code){case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return p.default.warning("live stream response already exists stream"),t=e.serverResponse.url,this.emit(u.LiveStreamingUapSignalEvents.WARNING,"live stream response already exists stream, code 454",t),this.waitingResponseList.includes(t)||this.waitingResponseList.push(t),[2,new Promise((function(n,r){o.once(t,(function(){o.waitingResponseList.splice(o.waitingResponseList.indexOf(t),1),n()})),setTimeout((function(){o.waitingResponseList.splice(o.waitingResponseList.indexOf(t),1),r(new h.AgoraRTCError(h.AgoraRTCErrorCode.TIMEOUT,"live stream timeout waiting 454",{code:e.code}))}),1e4)}))];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_BAD_STREAM:case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return[2,new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_INGNORE_MESSAGE:throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INVALID_ARGUMENT,"",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return[2];throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return[2,new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:return n=new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE),[2,this.emit(u.LiveStreamingUapSignalEvents.WARNING,n,e.serverResponse.url)];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:return n=new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_WARN_FREQUENT_REQUEST),[2,this.emit(u.LiveStreamingUapSignalEvents.WARNING,n,e.serverResponse.url)];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return[2,new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT,"",{code:e.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:return n=new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT),[2,this.emit(u.LiveStreamingUapSignalEvents.WARNING,n,e.serverResponse.url)];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return[2,new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw()];case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_LOST:case u.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return[2];throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return[2];if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return[2,new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw()];throw new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case u.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return r=e.serverResponse.url,this.waitingResponseList.includes(r)||this.waitingResponseList.push(r),i=new h.AgoraRTCError(h.AgoraRTCErrorCode.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}),this.emit(u.LiveStreamingUapSignalEvents.WARNING,i,r),[2,new Promise((function(e,t){o.once(r,(function(){o.waitingResponseList.splice(o.waitingResponseList.indexOf(r),1),e()})),setTimeout((function(){o.waitingResponseList.splice(o.waitingResponseList.indexOf(r),1),t(i)}),1e4)}))]}return[2]}))}))},t.prototype.startPingPong=function(){var e=this;this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((function(){"connected"===e.websocket.state&&e.request("ping",{}).catch((function(){}))}),6e3)},t}(d.EventEmitter);t.AgoraLiveStreamingUapSignal=v},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(24),u=n(36),l=n(31),d=n(27),h=s(n(0)),f=function(e){function t(t){var n=e.call(this)||this;return n.connectionID=0,n.currentURLIndex=0,n.reconnectMode="tryNext",n._state="closed",n.retryConfig=l.DEFAULT_RETRY_CONFIG,n.reconnectCount=0,n.name=t,n}return i(t,e),Object.defineProperty(t.prototype,"url",{get:function(){return this.websocket?this.websocket.url:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(d.WebSocketManagerEvents.RECONNECTING,this.reconnectMode):"connected"===this._state?this.emit(d.WebSocketManagerEvents.CONNECTED):"closed"===this._state?this.emit(d.WebSocketManagerEvents.CLOSED):"failed"===this._state&&this.emit(d.WebSocketManagerEvents.FAILED))},enumerable:!0,configurable:!0}),t.prototype.init=function(e){var t=this;return new Promise((function(n,r){t.urls=e;var i=t.urls[t.currentURLIndex];t.state="connecting",t.createWebSocketConnection(i).then(n).catch(r),t.once(d.WebSocketManagerEvents.CLOSED,(function(){return r(new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_DISCONNECT))})),t.once(d.WebSocketManagerEvents.CONNECTED,(function(){return n()}))}))},t.prototype.close=function(e,t){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;var n=this.websocket;t?setTimeout((function(){return n.close()}),500):n.close(),this.websocket=void 0}this.state=e?"failed":"closed"},t.prototype.reconnect=function(e){if(this.websocket){void 0!==e&&(this.reconnectMode=e);var t=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),t&&t.bind(this.websocket)({code:9999})}else h.default.warning("["+this.name+"] can not reconnect, no websocket")},t.prototype.sendMessage=function(e){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_ABORT,"websocket is not ready");var t=JSON.stringify(e);try{this.websocket.send(t)}catch(e){throw new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_ERR,"send websocket message error"+e.toString())}},t.prototype.createWebSocketConnection=function(e){return o(this,void 0,void 0,(function(){var t,n=this;return a(this,(function(r){return this.connectionID+=1,t=this.connectionID,[2,new Promise((function(r,i){n.websocket&&(n.websocket.onclose=null,n.websocket.close()),h.default.debug("["+n.name+"] start connect, url: "+e);try{n.websocket=new WebSocket(e),n.websocket.binaryType="arraybuffer"}catch(e){var s=new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_ERR,"init websocket failed! Error: "+e.toString());return h.default.error("["+n.name+"]"+s),void i(s)}l.wait(5e3).then((function(){t===n.connectionID&&n.websocket&&n.websocket.readyState!==WebSocket.OPEN&&n.websocket&&n.websocket.close()})),n.websocket.onopen=function(){h.default.debug("["+n.name+"] websockect opened:",e),n.reconnectMode="retry",n.state="connected",n.reconnectCount=0,r()},n.websocket.onclose=function(e){return o(n,void 0,void 0,(function(){var t,n;return a(this,(function(o){switch(o.label){case 0:return h.default.debug("["+this.name+"] websocket close "+(this.websocket&&this.websocket.url)+", code: "+e.code+", reason: "+e.reason+", current mode: "+this.reconnectMode),this.reconnectCount<this.retryConfig.maxRetryCount?("connected"===this.state&&(this.state="reconnecting"),t=u.emitAsInvokerNoResponse(this,d.WebSocketManagerEvents.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,[4,this.reconnectWithAction(t)]):[3,2];case 1:return n=o.sent(),"closed"===this.state?(h.default.debug("["+this.connectionID+"] ws is closed, no need to reconnect"),[2]):n?(r(),[3,3]):(i(new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_DISCONNECT,"websocket reconnect failed: "+e.code)),this.close(!0),[2]);case 2:i(new c.AgoraRTCError(c.AgoraRTCErrorCode.WS_DISCONNECT,"websocket close: "+e.code)),this.close(),o.label=3;case 3:return[2]}}))}))},n.websocket.onmessage=function(e){n.emit(d.WebSocketManagerEvents.ON_MESSAGE,e)}}))]}))}))},t.prototype.reconnectWithAction=function(e,t){return o(this,void 0,void 0,(function(){var n,r,i,o;return a(this,(function(a){switch(a.label){case 0:return!t&&this.reconnectCount>=this.retryConfig.maxRetryCount?[2,!1]:this.urls?"closed"===this.state?[2,!1]:(n=l.getRetryWaitTime(this.reconnectCount,this.retryConfig),h.default.debug("["+this.name+"] wait "+n+"ms to reconnect websocket, mode: "+e),[4,l.wait(n)]):[2,!1];case 1:if(a.sent(),"closed"===this.state)return[2,!1];this.reconnectCount+=1,a.label=2;case 2:return a.trys.push([2,12,,14]),"retry"!==e?[3,4]:(i=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(i)]);case 3:return a.sent(),[3,11];case 4:return"tryNext"!==e?[3,8]:(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length?[4,this.reconnectWithAction("recover")]:[3,6]);case 5:return[2,a.sent()];case 6:return h.default.debug("["+this.name+"] websocket url length: "+this.urls.length+" current index: "+this.currentURLIndex),i=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(i)];case 7:return a.sent(),[3,11];case 8:return"recover"!==e?[3,11]:(h.default.debug("["+this.name+"] request new urls"),r=this,[4,u.emitAsPromise(this,d.WebSocketManagerEvents.REQUEST_NEW_URLS)]);case 9:return r.urls=a.sent(),this.currentURLIndex=0,i=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(i)];case 10:a.sent(),a.label=11;case 11:return[2,!0];case 12:return o=a.sent(),h.default.error("["+this.name+"] reconnect failed",o.toString()),[4,this.reconnectWithAction(e)];case 13:return[2,a.sent()];case 14:return[2]}}))}))},t}(u.EventEmitter);t.AgoraWebSocketManager=f},function(e,t,n){"use strict";var r=n(18),i=n(38),o=n(79),a=n(44);function s(e){var t=new o(e),n=i(o.prototype.request,t);return r.extend(n,o.prototype,t),r.extend(n,t),n}var c=s(n(41));c.Axios=o,c.create=function(e){return s(a(c.defaults,e))},c.Cancel=n(45),c.CancelToken=n(93),c.isCancel=n(40),c.all=function(e){return Promise.all(e)},c.spread=n(94),e.exports=c,e.exports.default=c},function(e,t,n){"use strict";var r=n(18),i=n(39),o=n(80),a=n(81),s=n(44);function c(e){this.defaults=e,this.interceptors={request:new o,response:new o}}c.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[a,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)n=n.then(t.shift(),t.shift());return n},c.prototype.getUri=function(e){return e=s(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(e){c.prototype[e]=function(t,n){return this.request(r.merge(n||{},{method:e,url:t}))}})),r.forEach(["post","put","patch"],(function(e){c.prototype[e]=function(t,n,i){return this.request(r.merge(i||{},{method:e,url:t,data:n}))}})),e.exports=c},function(e,t,n){"use strict";var r=n(18);function i(){this.handlers=[]}i.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},function(e,t,n){"use strict";var r=n(18),i=n(82),o=n(40),a=n(41);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=i(e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return s(e),t.data=i(t.data,t.headers,e.transformResponse),t}),(function(t){return o(t)||(s(e),t&&t.response&&(t.response.data=i(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,n){"use strict";var r=n(18);e.exports=function(e,t,n){return r.forEach(n,(function(n){e=n(e,t)})),e}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,u=[],l=!1,d=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&f())}function f(){if(!l){var e=s(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||l||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";var r=n(18);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},function(e,t,n){"use strict";var r=n(43);e.exports=function(e,t,n){var i=n.config.validateStatus;!i||i(n.status)?e(n):t(r("Request failed with status code "+n.status,n.config,null,n.request,n))}},function(e,t,n){"use strict";e.exports=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){"use strict";var r=n(88),i=n(89);e.exports=function(e,t){return e&&!r(t)?i(e,t):t}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";var r=n(18),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,o,a={};return e?(r.forEach(e.split("\n"),(function(e){if(o=e.indexOf(":"),t=r.trim(e.substr(0,o)).toLowerCase(),n=r.trim(e.substr(o+1)),t){if(a[t]&&i.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}})),a):a}},function(e,t,n){"use strict";var r=n(18);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=r.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){"use strict";var r=n(18);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,i,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(i)&&s.push("path="+i),r.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){"use strict";var r=n(45);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),o=1,a=function(){function e(e){this.lockingPromise=Promise.resolve(),this.locks=0,this.name="",this.lockId=o++,e&&(this.name=e),i.default.debug("[lock-"+this.name+"-"+this.lockId+"] is created.")}return Object.defineProperty(e.prototype,"isLocked",{get:function(){return this.locks>0},enumerable:!0,configurable:!0}),e.prototype.lock=function(){var e,t=this;this.locks+=1,i.default.debug("[lock-"+this.name+"-"+this.lockId+"] is locked, current queue "+this.locks+".");var n=new Promise((function(n){e=function(){t.locks-=1,i.default.debug("[lock-"+t.name+"-"+t.lockId+"] is not locked, current queue "+t.locks+"."),n()}})),r=this.lockingPromise.then((function(){return e}));return this.lockingPromise=this.lockingPromise.then((function(){return n})),r},e}();t.PromiseMutex=a},function(e,t,n){"use strict";n.r(t);var r=n(2),i=n(0),o=n(1),a=n(8),s=n(4),c=function(){};c.prototype.set=function(e,t){["BatteryLevel"].indexOf(e)>-1&&(this[e]=t)};var u=function(){var e=o.report.reportApiInvoke(null,{name:"checkSystemRequirements",options:arguments,tag:"tracer"}),t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket,i=!!t&&!!n&&!!r,a=!1;s.isChrome()&&s.getBrowserVersion()>=58&&"iOS"!==s.getBrowserOS()&&(a=!0),s.isFireFox()&&s.getBrowserVersion()>=56&&(a=!0),s.isOpera()&&s.getBrowserVersion()>=45&&(a=!0),s.isSafari()&&s.getBrowserVersion()>=11&&(a=!0),s.isEdge()&&(a=!0),(s.isWeChatBrowser()||s.isQQBrowser())&&"iOS"!==s.getBrowserOS()&&(a=!0),s.isSupportedPC()||s.isSupportedMobile()||(a=!1);var c=i&&a;return e(null,c),c},l=new function(){var e=Object(a.b)();return e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.batteryManager=null,e._init=function(t,n){e.state=e.states.INITING,navigator.getBattery?navigator.getBattery().then((function(n){e.batteryManager=n,t&&setTimeout((function(){t()}),0)})).catch((function(e){i.default.debug("navigator.getBattery is disabled",e),t&&t()})):(e.state=e.states.INITED,t&&t())},e._getBatteryStats=function(){var t={};return e.batteryManager&&e.batteryManager.level?t.BatteryLevel=Math.floor(100*e.batteryManager.level):t.BatteryLevel="UNSUPPORTED",t},e.getStats=function(t,n){var r=new c,i=e._getBatteryStats();i&&i.BatteryLevel&&r.set("BatteryLevel",i.BatteryLevel),t&&t(r)},e._init(),e},d=n(22),h=n(19),f=n(26),p=n(53),m=n(9),g=["live","rtc","web","interop","h264_interop","web-only"],v=["vp8","vp9","h264"],y=["aes-128-gcm","aes-256-gcm","aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-256-gcm2","aes-128-gcm2"],b=n(11),_=n.n(b),E=n(7),S=n.n(E),w=n(13),T=n(5),A=n(10),R=n(20),x=n(6),I=n(14),O={1001:"FRAMERATE_INPUT_TOO_LOW",1002:"FRAMERATE_SENT_TOO_LOW",1003:"SEND_VIDEO_BITRATE_TOO_LOW",1005:"RECV_VIDEO_DECODE_FAILED",2001:"AUDIO_INPUT_LEVEL_TOO_LOW",2002:"AUDIO_OUTPUT_LEVEL_TOO_LOW",2003:"SEND_AUDIO_BITRATE_TOO_LOW",2005:"RECV_AUDIO_DECODE_FAILED",3001:"FRAMERATE_INPUT_TOO_LOW_RECOVER",3002:"FRAMERATE_SENT_TOO_LOW_RECOVER",3003:"SEND_VIDEO_BITRATE_TOO_LOW_RECOVER",3005:"RECV_VIDEO_DECODE_FAILED_RECOVER",4001:"AUDIO_INPUT_LEVEL_TOO_LOW_RECOVER",4002:"AUDIO_OUTPUT_LEVEL_TOO_LOW_RECOVER",4003:"SEND_AUDIO_BITRATE_TOO_LOW_RECOVER",4005:"RECV_AUDIO_DECODE_FAILED_RECOVER"},C={FramerateInput:1001,FramerateSent:1002,SendVideoBitrate:1003,VideoDecode:1005,AudioIntputLevel:2001,AudioOutputLevel:2002,SendAudioBitrate:2003,AudioDecode:2005},M=function(e){var t={remoteStreamStorage:{},localStreamStorage:{}};return t.gatewayClient=e,t.checkAudioOutputLevel=function(e){return!(e&&parseInt(e.audioRecvBytesDelta)>0&&parseInt(e.audioDecodingNormalDelta)>0&&0===parseInt(e.audioOutputLevel))},t.checkAudioIntputLevel=function(e){return!e||0!==parseInt(e.audioInputLevel)},t.checkFramerateInput=function(e,t){if(!e||!t.attributes)return!0;var n=parseInt(t.attributes.maxFrameRate),r=parseInt(e.googFrameRateInput);return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)},t.checkFramerateSent=function(e){return!(e&&parseInt(e.googFrameRateInput)>5&&parseInt(e.googFrameRateSent)<=1)},t.checkSendVideoBitrate=function(e){return!e||0!==parseInt(e.videoSendBytesDelta)},t.checkSendAudioBitrate=function(e){return!e||0!==parseInt(e.audioSendBytesDelta)},t.checkVideoDecode=function(e){return!e||0===parseInt(e.videoRecvBytesDelta)||0!==parseInt(e.googFrameRateDecoded)},t.checkAudioDecode=function(e){return!e||0===parseInt(e.audioRecvBytesDelta)||0!==parseInt(e.audioDecodingNormalDelta)},t.record=function(e,n,r,i,o){r[e]||(r[e]={isPrevNormal:!0,record:[]});var a=r[e],s=t["check"+e](n,o);if(a.record.push(s),a.record.length>=5){a.isCurNormal=-1!==a.record.indexOf(!0);var c=C[e];a.isPrevNormal&&!a.isCurNormal&&t.gatewayClient.dispatchEvent({type:"exception",code:c,msg:O[c],uid:i}),!a.isPrevNormal&&a.isCurNormal&&t.gatewayClient.dispatchEvent({type:"exception",code:c+2e3,msg:O[c+2e3],uid:i}),a.isPrevNormal=a.isCurNormal,a.record=[]}},t.setLocalStats=function(e){var n={};Object.keys(e).map((function(r){var i=e[r],o=t.gatewayClient.localStreams[parseInt(r)],a=t.localStreamStorage[r]||{};o&&o.hasVideo()&&(t.record("SendVideoBitrate",i.videoStats,a,r),t.record("FramerateInput",i.videoStats,a,r,o),t.record("FramerateSent",i.videoStats,a,r)),o&&o.hasAudio()&&(t.record("AudioIntputLevel",i.audioStats,a,r),t.record("SendAudioBitrate",i.audioStats,a,r)),n[r]=a})),t.localStreamStorage=n},t.setRemoteStats=function(n){var r={};Object.keys(n).map((function(i){var o=n[i],a=e.remoteStreams[i],s=t.remoteStreamStorage[i]||{};a&&a.hasVideo()&&a.isPlaying()&&t.record("VideoDecode",o.videoStats,s,i),a&&a.hasAudio()&&a.isPlaying()&&(t.record("AudioOutputLevel",o.audioStats,s,i),t.record("AudioDecode",o.audioStats,s,i)),r[i]=s})),t.remoteStreamStorage=r},t};function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var L,k=n(3),P=new function(){var e=Object(a.b)();return e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.type=null,e.lastConnectedAt=null,e.lastDisconnectedAt=null,e.lastTypeChangedAt=null,e.networkChangeTimer=null,e._init=function(t,n){if(e.state=e.states.INITING,navigator.connection&&navigator.connection.addEventListener){var r=e._getNetworkInfo();e.type=r&&r.type,e.state=e.states.INITED,t&&t()}else e.state=e.states.UNINIT,n&&n("DO_NOT_SUPPORT")},e._getNetworkInfo=function(){return navigator.connection},e._reloadNetworkInfo=function(){var t=e._getNetworkInfo(),n=t&&t.type||"UNSUPPORTED",r=Date.now();if(n!==e.type){e.lastTypeChangedAt=r,"none"==n?e.lastDisconnectedAt=r:"none"==e.type&&(e.lastConnectedAt=r),e.type=n;var i={type:"networkTypeChanged",networkType:n};e.dispatchEvent(i)}},e.getStats=function(t,n){var r={},i=e._getNetworkInfo();i&&(r.NetworkType=i.type||"UNSUPPORTED"),setTimeout((function(){t(r)}),0)},e._init((function(){navigator.connection.addEventListener("change",(function(){e._reloadNetworkInfo()})),e.networkChangeTimer=setInterval((function(){e._reloadNetworkInfo()}),5e3)}),(function(e){})),e},D=n(55),U=n(16),F=n(56),j=n.n(F),B=n(21),V=function(){return"HTTPS"===(L||L||(L=(window.location.protocol.split(":")[0]||"").toUpperCase()))},G=function(){return void 0!==window.isSecureContext},H="host",z=function(e){var t={key:void 0,highStream:null,lowStream:null,lowStreamParameter:null,isDualStream:!1,highStreamState:2,lowStreamState:2,proxyServer:null,turnServers:[],useProxyServer:!1,useLocalAccessPoint:!1};if(t.mode=e.mode,t.codec=e.codec,t.clientId=Object(A.generateSessionId)().slice(0,5),t.uintUid=null,t.customReportCount=0,e=S()({},e),t.aespassword=null,t.aesmode="none",t.hasPublished=!1,t.getSessionId=function(){return e.sessionId},t.startChannelMediaRelay=function(n,r){var i=o.report.reportApiInvoke(e.sessionId,{callback:function(e){if(e)return r&&r(e);r&&r()},name:"Client.startChannelMediaRelay",options:arguments,tag:"tracer"});if(!(n instanceof m.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var a=n.getSrcChannelMediaInfo(),s=n.getDestChannelMediaInfos();if(Object(k.isEmpty)(a))throw"srcChannelMediaInfo should not be empty";if(Object(k.isEmpty)(s)||0===s.length)throw"destChannelMediaInfos should not be empty";if(!Object(A.is32Uint)(a.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(k.isValidChannelName)(a.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(a.token&&!Object(k.isValidToken)(a.token))throw"Invalid token in srcChannelMediaInfo";if(s.forEach((function(e){if(!Object(A.is32Uint)(e.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(k.isValidChannelName)(e.channelName))throw"Invalid channelName in destChannelMediaInfo";if(e.token&&!Object(k.isValidToken)(e.token))throw"Invalid token in destChannelMediaInfo"})),t.gatewayClient.state!==w.a.CONNECTED)throw"startChannelMediaRelay should be used after join";t.gatewayClient.startChannelMediaRelay(n).then((function(){i&&i()})).catch((function(e){i&&i(e)}))},t.updateChannelMediaRelay=function(n,r){var i=o.report.reportApiInvoke(e.sessionId,{callback:function(e){if(e)return r&&r(e);r&&r()},name:"Client.updateChannelMediaRelay",options:arguments,tag:"tracer"});if(!(n instanceof m.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var a=n.getSrcChannelMediaInfo(),s=n.getDestChannelMediaInfos();if(Object(k.isEmpty)(a))throw"srcChannelMediaInfo should not be empty";if(Object(k.isEmpty)(s)||0===s.length)throw"destChannelMediaInfos should not be empty";if(!Object(A.is32Uint)(a.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(k.isValidChannelName)(a.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(a.token&&!Object(k.isValidToken)(a.token))throw"Invalid token in srcChannelMediaInfo";if(s.forEach((function(e){if(!Object(A.is32Uint)(e.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(k.isValidChannelName)(e.channelName))throw"Invalid channelName in destChannelMediaInfo";if(e.token&&!Object(k.isValidToken)(e.token))throw"Invalid token in destChannelMediaInfo"})),t.gatewayClient.state!==w.a.CONNECTED)throw"updateChannelMediaRelay should be used after join";t.gatewayClient.updateChannelMediaRelay(n).then((function(){i&&i()})).catch((function(e){i&&i(e)}))},t.stopChannelMediaRelay=function(n){var r=o.report.reportApiInvoke(e.sessionId,{callback:function(e){if(e)return n&&n(e);n&&n()},name:"Client.stopChannelMediaRelay",options:arguments,tag:"tracer"});t.gatewayClient.stopChannelMediaRelay().then((function(){r&&r()})).catch((function(e){r&&r(e)}))},t.getConnectionState=function(){var n=o.report.reportApiInvoke(e.sessionId,{name:"Client.getConnectionState",options:arguments,tag:"tracer"}),r=w.a.connetionStateMap[t.gatewayClient.state];return n(),r},t.setClientRole=function(n,r){var a=o.report.reportApiInvoke(e.sessionId,{callback:r,name:"Client.setClientRole",options:arguments,tag:"tracer"});if(Object(k.checkValidEnum)(n,"setClientRole",[H,"audience"]),"rtc"===t.mode){var s="RTC mode can not use setClientRole";return i.default.warning("[".concat(t.clientId,"] ").concat(s)),a&&a(s)}t.gatewayClient&&t.gatewayClient.state===w.a.CONNECTED?("audience"===n&&(0===this.highStreamState?this._unpublish(this.highStream,(function(){a&&a(null,{role:n})}),(function(e){a&&a(e)})):t.gatewayClient.setClientRole("audience",a)),n===H&&t.gatewayClient.setClientRole(H,a)):(t.gatewayClient.role=n,a&&a(null,{role:n}))},t.getGatewayInfo=function(e){if(t.gatewayClient.state!==w.a.CONNECTED){var n="Client is not in connected state";return i.default.error("[".concat(t.clientId,"] ").concat(n)),void e(n)}t.gatewayClient.getGatewayInfo((function(t){e(null,t)}),e)},t.renewToken=function(n,r,a){var s=o.report.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i.default.error("Failed to renew token ".concat(e),t),a&&a(e);r&&r(t)},name:"Client.renewToken",options:arguments,tag:"tracer"});if(!Object(k.isValidToken)(n))throw new Error("Invalid token: Token is of the string type .Length of the string: [1,255]. ASCII characters only.");return t.gatewayClient?t.key?(t.key=n,void t.gatewayClient.renewToken(n,(function(e){return s(null,e)}),s)):(i.default.error("[".concat(t.clientId,"] renewToken should not be called before user join")),s(T.default.INVALID_OPERATION)):(i.default.error("[".concat(t.clientId,"] renewToken Failed. GatewayClient not Exist")),s(T.default.INVALID_OPERATION))},t.setLowStreamParameter=function(n){var r=o.report.reportApiInvoke(e.sessionId,{name:"Client.setLowStreamParameter",options:arguments,tag:"tracer"});Object(k.checkValidObject)(n,"param");var a=n.width,s=n.height,c=n.framerate,u=n.bitrate;Object(k.isEmpty)(a)||Object(k.checkValidNumber)(a,"width"),Object(k.isEmpty)(s)||Object(k.checkValidNumber)(s,"height"),Object(k.isEmpty)(c)||Object(k.checkValidNumber)(c,"framerate"),Object(k.isEmpty)(u)||Object(k.checkValidNumber)(u,"bitrate",1,1e7),(!a&&s||a&&!s)&&i.default.warning("[".concat(t.clientId,"] The width and height parameters take effect only when both are set")),t.lowStreamParameter=n,r()},t.init=function(t,n,r){var i=o.report.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return r&&r(e);n&&n(t)},name:"Client.init",options:arguments,tag:"tracer"});Object(k.checkValidString)(t),Object(s.isChromeKernel)()&&Object(s.getChromeKernelVersion)()<=48?r?i(T.default.BAD_ENVIRONMENT):Object(A.popBanTip)():(e.appId=t,e.sessionId=Object(A.generateSessionId)(),i())},t.setTurnServer=function(n){var r=o.report.reportApiInvoke(e.sessionId,{name:"Client.setTurnServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==w.a.DISCONNECTED)throw new Error("Set turn server before join channel");if(t.useProxyServer)throw new Error("You have already set the proxy");if(t.useLocalAccessPoint)throw new Error("You have already set the local proxy");n instanceof Array||(n=[n]);var a=[];n.map((function(e,n){Object(k.checkValidObject)(e,"turnServer");var r=e.turnServerURL,o=e.username,s=e.password,c=e.udpport,u=e.forceturn,l=e.tcpport;if(Object(k.checkValidString)(r,"turnServerURL"),Object(k.checkValidString)(o,"username"),Object(k.checkValidString)(s,"password"),Object(k.checkValidString)(c,"udpport"),0===parseInt(c))throw new Error("udpport should not be ".concat(c));Object(k.isEmpty)(u)||Object(k.checkValidBoolean)(u,"forceturn");var d={mode:"manual"};if(d.url=r,d.udpport=c,d.username=o,d.credential=s,d.forceturn=u||!1,!Object(k.isEmpty)(l)){if(Object(k.checkValidString)(l,"tcpport"),0===parseInt(l))throw new Error("tcpport should not be ".concat(l));d.tcpport=l,i.default.info("[".concat(t.clientId,"] Set turnserver[").concat(n,"] tcpurl. ").concat(d.url,":").concat(d.tcpport))}i.default.info("[".concat(t.clientId,"] Set turnserver[").concat(n,"] udpurl. ").concat(d.url,":").concat(d.udpport,",username: ").concat(d.username)),a.push(d)})),t.turnServers=a,r()},t.setProxyServer=function(n){var r=o.report.reportApiInvoke(e.sessionId,{name:"Client.setProxyServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==w.a.DISCONNECTED)throw new Error("Set proxy server before join channel");if(!n)throw new Error("Do not set the proxyServer parameter as empty");if(t.useProxyServer)throw new Error("You have already set the proxy");if(t.useLocalAccessPoint)throw new Error("You have already set the local proxy");Object(k.checkValidString)(n,"proxyServer"),t.proxyServer=n,o.report.setProxyServer(n),i.default.setProxyServer(n),r()},t.startProxyServer=function(n){var r=o.report.reportApiInvoke(e.sessionId,{name:"Client.startProxyServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==w.a.DISCONNECTED)throw new Error("Start proxy server before join channel");if(t.proxyServer)throw new Error("You have already set the proxy");if(t.useLocalAccessPoint)throw new Error("You have already set the local proxy");t.useProxyServer=!0,t.proxyServerType=n||1,r()},t.stopProxyServer=function(){var n=o.report.reportApiInvoke(e.sessionId,{name:"Client.stopProxyServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==w.a.DISCONNECTED)throw new Error("Stop proxy server after leave channel");o.report.setProxyServer(),i.default.setProxyServer(),t.turnServers=[],t.proxyServer=null,t.useProxyServer=!1,t.proxyServerType=null,n()},t.setEncryptionSecret=function(n){var r=o.report.reportApiInvoke(e.sessionId,{name:"Client.setEncryptionSecret",options:arguments,tag:"tracer"});Object(k.checkValidString)(n,"password");var a=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})");a.test(n)||i.default.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer,\n      "),t.aespassword=n,r()},t.setEncryptionMode=function(n,r){var i=o.report.reportApiInvoke(e.sessionId,{name:"Client.setEncryptionMode",options:arguments,tag:"tracer"});if(Object(k.checkValidString)(n,"encryptionMode"),-1===y.indexOf(n))throw new Error('Invalid encryptionMode: encryptionMode should be "aes-128-xts" | "aes-256-xts" | "aes-128-ecb" | "sm4-128-ecb" | "aes-128-gcm" | "aes-256-gcm" | "aes-128-gcm2" | "aes-256-gcm2"');var a=["aes-128-gcm2","aes-256-gcm2"];if(-1!==a.indexOf(n)){if(!r||!(r instanceof Uint8Array&&32===r.length))throw Error("salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new Error("Only ".concat("aes-128-gcm2"," and ").concat("aes-256-gcm2"," support use salt"));r&&(t.aesSalt=Object(A.uint8ArrayToBase64)(r)),t.aesmode=n,i()},t.configPublisher=function(n){var r=o.report.reportApiInvoke(e.sessionId,{name:"Client.configPublisher",options:arguments,tag:"tracer"});Object(k.checkValidObject)(n,"config");var i=n.width,a=n.height,s=n.framerate,c=n.bitrate,u=n.publisherUrl;Object(k.checkValidNumber)(i,"width"),Object(k.checkValidNumber)(a,"height"),Object(k.checkValidNumber)(s,"framerate"),Object(k.checkValidNumber)(c,"bitrate",1,1e7),u&&Object(k.checkValidString)(u,"publisherUrl"),t.gatewayClient.configPublisher(n),r()},t.enableDualStream=function(n,r){var a=o.report.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return r&&r(e);n&&n(t)},name:"Client.enableDualStream",options:arguments,tag:"tracer"});return"iOS"===Object(s.getBrowserOS)()?(o.report.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),a(T.default.IOS_NOT_SUPPORT)):Object(s.isWeChatBrowser)()?(o.report.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),a(T.default.WECHAT_NOT_SUPPORT)):(o.report.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!0}),t.isDualStream=!0,t.highStream&&(t.highStream.isDualStream=!0),void(0===t.highStreamState?t._publishLowStream((function(e){return a(null,e)}),(function(e){i.default.warning("[".concat(t.clientId,"]"),e),a(T.default.ENABLE_DUALSTREAM_FAILED)})):1===t.highStreamState?a(T.default.STILL_ON_PUBLISHING):a(null)))},t.disableDualStream=function(n,r){var a=o.report.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return r&&r(e);n&&n(t)},name:"Client.disableDualStream",options:arguments,tag:"tracer"});o.report.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!1,succ:!0}),t.isDualStream=!1,t.highStream&&(t.highStream.isDualStream=!1),0===t.highStreamState?t._unpublishLowStream((function(){t.highStream.lowStream=null,a()}),(function(e){i.default.warning("[".concat(t.clientId,"]"),e),a(T.default.DISABLE_DUALSTREAM_FAILED)})):1===t.highStreamState?a(T.default.STILL_ON_PUBLISHING):a()},t._getLowStream=function(e,n){t.lowStream?e(t.lowStream):t._createLowStream((function(n){t.lowStream=n,e(t.lowStream)}),n)},t._createLowStream=function(e,n){if(t.highStream&&t.highStream.stream){var r=S()({},t.highStream.params);if(r.streamID+=1,r.audio=!1,r.video)if(t.highStream.stream.getVideoTracks()[0]){var i=new d.a(r);i.isLowStream=!0,i.streamId=t.highStream.getId()+1;var o={};t.lowStreamParameter&&(o=S()({},t.lowStreamParameter)),o.width&&o.height||(o.width=160,o.height=120),o.framerate=o.framerate||15,o.bitrate=o.bitrate||50,i.setVideoProfileCustomPlus(o);try{var a=j()(t.highStream,{width:i.videoConstraint.width.ideal,height:i.videoConstraint.height.ideal,framerate:i.videoConstraint.frameRate});return i.stream=a,t.highStream.lowStream=i,t.highStream.userMuteVideo&&i.muteVideo(),e&&e(i)}catch(e){return n&&n(e)}}else n&&n(T.default.HIGH_STREAM_NOT_VIDEO_TRACE);else n&&n(T.default.HIGH_STREAM_NOT_VIDEO_TRACE)}else n&&n(T.default.HIGH_STREAM_NOT_VIDEO_TRACE)},t._publishLowStream=function(e,n){return 2!==t.lowStreamState?n&&n(T.default.LOW_STREAM_ALREADY_PUBLISHED):t.highStream&&t.highStream.hasScreen()?n&&n(T.default.SHARING_SCREEN_NOT_SUPPORT):void t._getLowStream((function(r){t.lowStreamState=1,t.gatewayClient.publish(r,{streamType:1},(function(){t.lowStreamState=0,e&&e()}),(function(e){1===t.lowStreamState&&(t.lowStreamState=2),i.default.debug("[".concat(t.clientId,"] publish low stream failed")),n&&n(e)}))}),n)},t._unpublishLowStream=function(e,n){if(0!==t.lowStreamState)return n&&n(T.default.LOW_STREAM_NOT_YET_PUBLISHED);t.lowStream&&(t.gatewayClient.unpublish(t.lowStream,{streamType:1},(function(){}),(function(e){i.default.debug("[".concat(t.clientId,"] unpublish low stream failed")),n&&n(e)})),t.lowStream.close(),t.lowStream=null,t.lowStreamState=2,e&&e())},t.join=function(n,r,a,c,l,d){c&&"function"==typeof c&&(d=l,l=c,c=null);var h=u(),f=Object(s.getBrowserInfo)();i.default.debug(f,",Support: "+h);var p=V(),m="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser",g=G()?window.isSecureContext:"Browser Not Support",v=function(){i.default.warning(m)};G()?window.isSecureContext||v():p||v();var y=o.report.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return d&&d(e);l&&l(t)},name:"Client.join",options:arguments,getStates:function(){return{isHttps:p,isSecureContext:g}},tag:"tracer"});if(n&&!Object(k.isValidToken)(n))return i.default.warning("[".concat(t.clientId,"] Param channelKey should be string")),y(T.default.INVALID_PARAMETER);if(!Object(k.isValidChannelName)(r))return i.default.error("Invalid Channel Name ".concat(r)),i.default.warning("[".concat(t.clientId,"] The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")),y(T.default.INVALID_PARAMETER);if("string"==typeof r&&""===r)return i.default.warning("[".concat(t.clientId,"] Param channel should not be empty")),y(T.default.INVALID_PARAMETER);if(c&&!Object(k.isValidString)(c))return i.default.warning("[".concat(t.clientId,"] optionalInfo should be string")),y(T.default.INVALID_PARAMETER);if(a&&!Object(A.is32Uint)(a)&&!Object(k.isValidString)(a,1,255))return i.default.error("Invalid UID ".concat(a," ").concat(_()(a))),i.default.warning("[".concat(t.clientId,"] [String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is 32Uint")),y(T.default.INVALID_PARAMETER);if("string"==typeof a&&0==a.length)return i.default.warning("[".concat(t.clientId,"] String uid should not be empty")),y(T.default.INVALID_PARAMETER);if("string"==typeof a&&a.length>256)return i.default.warning("[".concat(t.clientId,"] Length of string uid should be less than 255")),y(T.default.INVALID_PARAMETER);i.default.stopWaitJoin(),t.highStream=null,t.lowStream=null,t.lowStreamParameter=null,t.isDualStream=!1,t.highStreamState=2,t.lowStreamState=2;var b=Date.now(),E=setTimeout((function(){if(1!=t.gatewayClient.hasJoined){i.default.debug("[".concat(t.clientId,"] The time to join the channel is greater than 5 seconds "));var n=Date.now();o.report.joinChannelTimeOut({lts:n,sid:e.sessionId,cname:r,cid:x&&x.cid,uid:x.uid||("string"==typeof a?void 0:a),elapse:n-b,timeout:5})}}),5e3),x={clientId:t.clientId,appId:e.appId,sid:e.sessionId,cname:r,uid:a,turnServers:t.turnServers.concat(),proxyServer:t.proxyServer,token:n||e.appId,useProxyServer:t.useProxyServer,useLocalAccessPoint:t.useLocalAccessPoint,proxyServerType:t.proxyServerType,optionalInfo:c};if("string"==typeof a&&(x.stringUid=a,t.uintUid?(x.uid=t.uintUid,delete t.uintUid):x.uid=0),t.aespassword&&"none"!==t.aesmode&&S()(x,{aespassword:t.aespassword,aesmode:t.aesmode}),t.aesSalt&&(x.aes_salt=t.aesSalt),o.report.sessionInit(e.sessionId,{lts:(new Date).getTime(),cname:r,appid:e.appId,mode:e.mode,succ:!0}),t.onSuccess=function(e){clearTimeout(E),t.rtcStatsCollector.startNetworkQualityTimer(),t.onSuccess=null,y(null,e)},t.onFailure=function(e){return y(e)},t.channel=r,t.gatewayClient.state!==w.a.DISCONNECTED)return i.default.error("[".concat(t.clientId,"] Client already in connecting/connected state")),y(T.default.INVALID_OPERATION),void o.report.joinGateway(e.sessionId,{lts:Date.now(),succ:!1,ec:T.default.INVALID_OPERATION,addr:null});t.gatewayClient.state=w.a.CONNECTING;var I=function(o,a){i.default.info("[".concat(t.clientId,"] Joining channel: ").concat(r)),t.gatewayClient.dispatchEvent({type:"config-distribute",config:a,joinInfo:x}),t.key=n||e.appId,x.cid=o.cid,x.uid||(x.uid=o.uid),x.vid=o.vid,x.clientId=t.clientId,x.apResponse=o.res,o.uni_lbs_ip&&o.uni_lbs_ip[1]&&(x.uni_lbs_ip=o.uni_lbs_ip[1]),x.gatewayAddr=o.gateway_addr,t.joinInfo=x,t.gatewayClient.join(x,t.key,(function(e){i.default.info("[".concat(t.clientId,"] Join channel ").concat(r," success, join with uid: ").concat(e,".")),t.onSuccess=null,t.rtcStatsCollector.startNetworkQualityTimer(),y(null,e)}),(function(e){return y(e)}))};x.stringUid&&!x.uid?(t.userAccountReq&&!t.userAccountReq.isFinished()&&t.userAccountReq.cancel(),t.userAccountReq=Object(R.getUserAccount)(x,t.gatewayClient),t.userAccountReq.then((function(e){i.default.debug("getUserAccount Success ".concat(e.url," ").concat(x.stringUid," => ").concat(e.uid)),x.uid=e.uid,Object(R.getGatewayList)(x,I,(function(e){return y(e)}))})).catch((function(e){i.default.error("getUserAccount rejected",e),y(e)}))):Object(R.getGatewayList)(x,I,(function(e){return y(e)}))},t.renewChannelKey=function(n,r,a){var s=o.report.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return a&&a(e);r&&r(t)},name:"Client.renewChannelKey",options:arguments,tag:"tracer"});Object(k.checkValidString)(n,"key",1,2047),void 0===t.key?(i.default.error("[".concat(t.clientId,"] renewChannelKey should not be called before user join")),s(T.default.INVALID_OPERATION)):(t.key=n,t.gatewayClient.joinInfo.token=n,t.gatewayClient.key=n,t.gatewayClient.recover(),s())},t.leave=function(n,a){t.gatewayClient.isFirstSuccess=!0,t.gatewayClient.hasInvokeLeave=!0;var s=!1,c=o.report.reportApiInvoke(e.sessionId,{callback:function(e,r){if(e)return a&&a(e);t.gatewayClient.reconnectingCS=!1,t.gatewayClient.state=w.a.DISCONNECTED,clearTimeout(Object(R._getReconnectCSTimer)(t.clientId)),t._renewSession(),t.rtcStatsCollector.clearNetworkQualityTimer(),n&&n(r)},name:"Client.leave",options:arguments,tag:"tracer"});i.default.info("[".concat(t.clientId,"] Leaving channel")),t.userAccountReq&&!t.userAccountReq.isFinished()&&(t.userAccountReq.cancel(),t.gatewayClient.state===w.a.CONNECTING&&(t.gatewayClient.state=w.a.DISCONNECTED)),t._terminateLiveStreaming(),t.gatewayClient.leave((function(e){s=!0,c(null,e)}),c),setTimeout((function(){s||(t.gatewayClient.socket&&(t.gatewayClient.socket.close(),t.gatewayClient.socket=null),t.gatewayClient.state=w.a.DISCONNECTED,c(null,"LEAVE_MSG_TIMEOUT"))}),Object(r.getParameter)("LEAVE_MSG_TIMEOUT"))},t._renewSession=function(){var n=Object(A.generateSessionId)();if(i.default.debug("renewSession ".concat(e.sessionId," => ").concat(n)),e.sessionId=n,t.gatewayClient.peerPublishDurationMap.clear(),t.joinInfo&&(t.joinInfo.sid=n),t.gatewayClient&&(t.gatewayClient.joinInfo&&(t.gatewayClient.joinInfo.sid=n),t.gatewayClient.localStreams))for(var r in t.gatewayClient.localStreams){var o=t.gatewayClient.localStreams[r];o&&(o.sid=n)}},t._publish=function(n,o,a,s){if(2!==t.highStreamState)return i.default.warning("[".concat(t.clientId,"] Can't publish stream when stream already publish ").concat(n.getId())),a&&a(T.default.STREAM_ALREADY_PUBLISHED);if(0===t.turnServers.length&&Object(r.getParameter)("FORCE_TURN")&&!Object(r.getParameter)("TURN_ENABLE_TCP")&&!Object(r.getParameter)("TURN_ENABLE_UDP"))throw new Error("force TURN With No TURN Configuration");i.default.info("[".concat(t.clientId,"] Publishing stream, uid ").concat(n.getId())),t.highStream=n,t.highStreamState=1,t.highStream.streamId=t.joinInfo.stringUid||t.joinInfo.uid,t.hasPublished=!1;var c=function(n,r,o){t.gatewayClient.publish(n,{streamType:0},(function(){n.sid=e.sessionId,t.highStreamState=0,i.default.info("[".concat(t.clientId,"] Publish success, uid: ").concat(n.getId())),t.highStream&&(t.highStream.isDualStream=t.isDualStream),t.isDualStream?t._publishLowStream((function(){r&&r()}),(function(e){i.default.warning("[".concat(t.clientId,"] "),e),U.a.replaceWithCanvasTrack(n).then((function(){r&&r()}))})):U.a.replaceWithCanvasTrack(n).then((function(){r&&r()}))}),o)};"audience"!==t.gatewayClient.role||"live"!==t.mode||s?c(n,o,a):t.gatewayClient.setClientRole(H,(function(e){if(e)return a&&a(e);c(n,o,a)}))},t._unpublish=function(e,n,r,o){if(0!==t.highStreamState)return i.default.warning("[".concat(t.clientId,"] Can't unpublish stream when stream not publish")),r&&r(T.default.STREAM_NOT_YET_PUBLISHED);i.default.info("[".concat(t.clientId,"] Unpublish stream, uid ").concat(e.getId()));var a=function(e,n,r){t.isDualStream&&t.lowStream&&t._unpublishLowStream(null,r),t.gatewayClient.unpublish(e,{streamType:0},(function(){t.highStreamState=2,i.default.info("[".concat(t.clientId,"] Unpublish stream success, uid: ").concat(e.getId())),t.gatewayClient.dispatchEvent({type:"stream-unpublished",stream:e}),n&&n()}),(function(n){i.default.info("[".concat(t.clientId,"] Unpublish stream fail, uid: ").concat(e.getId())),r&&r(n)}))};t.gatewayClient.role!==H||"live"!==t.mode||o?a(e,n,r):t.gatewayClient.setClientRole("audience",(function(t){if(t)return r&&r(t);a(e,n,r)}))},t.publish=function(n,r){var i=o.report.reportApiInvoke(e.sessionId,{callback:function(e,n){if(e)return 1===t.highStreamState&&"REQUEST_ABORT"!==e&&(t.highStreamState=2),r&&r(e)},name:"Client.publish",tag:"tracer",options:{stream:"too long to show",onFailure:!!r}});2===t.highStreamState?n._hasVideoTracks()||n._hasAudioTracks()?(t.gatewayClient.publishRequestId=Object(A.generateId)(),t._publish(n,(function(e){return i(null,e)}),(function(e){return i(e)}))):i(T.default.NO_TRACK_IN_STREAM):i(T.default.STREAM_ALREADY_PUBLISHED)},t.unpublish=function(n,r,i){var a=o.report.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return r&&r(e);i&&i(t)},name:"Client.unpublish",tag:"tracer",options:{stream:"too long to show",onFailure:!!r}});0===t.highStreamState?(t.gatewayClient.publishRequestId=null,t._unpublish(n,(function(e){return a(null,e)}),(function(e){return a(e)}))):a(T.default.STREAM_NOT_YET_PUBLISHED)},t.subscribe=function(n,r,a){var c=o.report.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return a&&a(e)},name:"Client.subscribe",tag:"tracer",options:{stream:"too long to show",options:r,onFailure:!!a}});"function"==typeof r&&(a=r,r=null),Object(k.checkValidObject)(n,"stream"),Object(k.isEmpty)(r)||(Object(k.checkValidObject)(r,"options"),Object(k.isEmpty)(r.video)||Object(k.checkValidBoolean)(r.video,"options.video"),Object(k.isEmpty)(r.audio)||Object(k.checkValidBoolean)(r.audio,"options.audio"));var u={video:!0,audio:!0};if(!Object(k.isEmpty)(r)){if(Object(s.isSafari)()&&(!r.video||!r.audio)){var l="SAFARI_NOT_SUPPORTED_FOR_TRACK_SUBSCRIPTION";return i.default.error("[".concat(t.clientId,"] "),l),void c(l)}if(!Object(k.isEmpty)(r.video)&&!Object(k.isValidBoolean)(r.video)||!Object(k.isEmpty)(r.audio)&&!Object(k.isValidBoolean)(r.audio)||!1===r.audio&&!1===r.video)return l="INVALID_PARAMETER ".concat(JSON.stringify(r)),i.default.error("[".concat(t.clientId,"] "),l),void c(l)}n.subscribeOptions?(S()(n.subscribeOptions,u,r),t.gatewayClient.subscribeChange(n,(function(e){return c(null,e)}),c)):(t.gatewayClient.subscribeRequestId.set(n.getId(),Object(A.generateId)()),n.subscribeOptions=S()({},u,r),t.gatewayClient.subscribe(n,(function(e){return c(null,e)}),c))},t.unsubscribe=function(n,r){var a=o.report.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return r&&r(e)},name:"Client.unsubscribe",tag:"tracer",options:{stream:"too long to show",onFailure:!!r}});i.default.info("[".concat(t.clientId,"] Unsubscribe stream, uid: ").concat(n.getId())),t.gatewayClient.subscribeRequestId.delete(n.getId()),t.gatewayClient.unsubscribe(n,(function(e){return a(null,e)}),a)},t.setRemoteVideoStreamType=function(n,r){var i=o.report.reportApiInvoke(e.sessionId,{name:"Client.setRemoteVideoStreamType",tag:"tracer",options:{stream:"too long to show",streamType:r}});Object(k.checkValidEnum)(r,"streamType",[0,1]),t.gatewayClient.setRemoteVideoStreamType(n,r),i()},t.setStreamFallbackOption=function(n,r){var i=o.report.reportApiInvoke(e.sessionId,{name:"Client.setStreamFallbackOption",tag:"tracer",options:{stream:"too long to show",fallbackType:r}});Object(k.checkValidEnum)(r,"fallbackType",[0,1,2]),t.gatewayClient.setStreamFallbackOption(n,r),i()},t.enableAudioVolumeIndicator=function(n,r){var a=o.report.reportApiInvoke(e.sessionId,{name:"Client.enableAudioVolumeIndicator",options:arguments,tag:"tracer"});n=n||2e3,r=r||3,Object(k.checkValidNumber)(r,"smooth",1,100),Object(k.checkValidNumber)(n,"interval",50,1e5),t.audioVolumeIndication=t.audioVolumeIndication||{enabled:!0},t.audioVolumeIndication.interval=n,t.audioVolumeIndication.smooth=r,t.audioVolumeIndication={interval:n,smooth:r},i.default.info("[".concat(t.clientId,"] enableAudioVolumeIndicator interval ").concat(n," smooth ").concat(r)),t.gatewayClient.enableAudioVolumeIndicator(n,r),a()},t.getNetworkStats=function(e,n){return i.default.deprecate("[".concat(t.clientId,"] client.getNetworkStats is deprecated. Use client.getTransportStats instead.")),P.getStats(e,n)},t.getSystemStats=function(e,t){return l.getStats(e,t)},t.getRecordingDevices=function(e,t){return h.a.getRecordingDevices(e,t)},t.getPlayoutDevices=function(e,t){return h.a.getPlayoutDevices(e,t)},t.getCameras=function(e,t){return h.a.getCameras(e,t)},t.getRemoteAudioStats=function(e,n){return t.rtcStatsCollector.getRemoteAudioStats(e,n)},t.getLocalAudioStats=function(e,n){return t.rtcStatsCollector.getLocalAudioStats(e,n)},t.getRemoteVideoStats=function(e,n){return t.rtcStatsCollector.getRemoteVideoStats(e,n)},t.getLocalVideoStats=function(e,n){return t.rtcStatsCollector.getLocalVideoStats(e,n)},t._getRemoteVideoQualityStats=function(e,n){return t.rtcStatsCollector.getRemoteVideoQualityStats(e,n)},t._getRemoteAudioQualityStats=function(e,n){return t.rtcStatsCollector.getRemoteAudioQualityStats(e,n)},t.getTransportStats=function(e,n){return t.rtcStatsCollector.getTransportStats((function(t){return P.getStats((function(n){var r=S()({},t,n);e&&e(r)}),n)}),n)},t.getSessionStats=function(e,n){return t.rtcStatsCollector.getSessionStats(e,n)},t.onNetworkQuality=function(){return t.rtcStatsCollector.onNetworkQuality(onSuccess,onFailure)},t.sendMetadata=function(n,r){var i=o.report.reportApiInvoke(e.sessionId,{name:"Client.sendMetadata",tag:"tracer",callback:function(e){if(e)return r&&r(e);r&&r()}});t.gatewayClient.sendMetadata(n,i)},t.sendCustomReportMessage=function(n,a,s,c,u,l){Object(r.getParameter)("CR")?t.customReportCount>Object(r.getParameter)("CRL")?l&&l("REPORT_LIMITED"):(t.gatewayClient.hasJoined||(i.default.WARNING("Should invoke Client.sendCustomReportMessage after join"),l&&l("REPORT_BEFORE_JOINED")),t.customReportTimer||(t.customReportTimer=setInterval((function(){t.customReportCount=0}),Object(r.getParameter)("CRI"))),Object(k.checkValidString)(n,"reportId",0,100,!1),Object(k.checkValidString)(a,"category",0,100,!1),Object(k.checkValidString)(s,"event",0,100,!1),Object(k.checkValidString)(c,"label",0,100,!1),Object(k.checkValidNumber)(u,"value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),t.customReportCount++,o.report.sendCustomReportMessage(e.sessionId,{reportId:n,category:a,event:s,label:c,value:u,lts:Date.now()},(function(e){e?l&&l("REPORT_FAILED"):l&&l()}))):l&&l("REPORT_FORBIDDEN")},t.setLocalAccessPoints=function(n,i){var a=o.report.reportApiInvoke(e.sessionId,{name:"Client.setLocalAccessPoints",tag:"tracer"});if(Object(k.checkValidArray)(n,"serverList"),Object(k.checkValidString)(i,"domain"),t.useProxyServer)throw new Error("You have already set the proxy");var s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=n.map((function(e){return s.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e})),t.useLocalAccessPoint=!0,Object(r.setParameter)("WEBCS_DOMAIN",n),Object(r.setParameter)("WEBCS_DOMAIN_BACKUP_LIST",n),Object(r.setParameter)("GATEWAY_DOMAINS",[i]),Object(r.setParameter)("EVENT_REPORT_DOMAIN",n[Math.floor(Math.random()*n.length)]),Object(r.setParameter)("EVENT_REPORT_BACKUP_DOMAIN",n[Math.floor(Math.random()*n.length)]),Object(r.setParameter)("LOG_UPLOAD_SERVER","".concat(n[Math.floor(Math.random()*n.length)],":6444")),a()},e.clientId=t.clientId,t.gatewayClient=Object(w.a)(e),t.listenerLoggerTimer=null,t.listenerLoggerCache=[],t.on=function(e,n){t.gatewayClient.on(e,n),t.listenerLoggerCache.push("".concat(e).concat(n.name?":"+n.name:"")),t.listenerLoggerTimer?clearTimeout(t.listenerLoggerTimer):i.default.info("[".concat(t.clientId,"] Adding event handler on ").concat(e)),t.listenerLoggerTimer=setTimeout((function(){t.listenerLoggerCache.length&&(t.listenerLoggerTimer=null,i.default.info("[".concat(t.clientId,"] Added event handler on ").concat(t.listenerLoggerCache.join(", "))),t.listenerLoggerCache=[])}),0)},t.off=function(e,n){i.default.info("remove event handler from [".concat(e,"]")),t.gatewayClient.removeEventListener(e,n)},t.rtcStatsCollector=function(e){var t=Object(a.b)();return t.gatewayClient=e,t.exceptionMonitor=new M(e),t.localStats={},t.remoteStats={},t.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0},t.getRemoteAudioStats=function(e){var n=t.gatewayClient.traffic_stats,r={};for(var i in t.remoteStats){var o={},a=t.remoteStats[i];if(Object(x.b)(o,"End2EndDelay",a.peer_delay&&a.peer_delay.audio_delay),Object(x.b)(o,"TransportDelay",a.peer_delay&&a.peer_delay.e2e_delay),Object(x.b)(o,"PacketLossRate",a.peer_delay&&a.peer_delay.e2e_audio_lost_ratio_400ms),Object(x.b)(o,"RecvLevel",a.audioStats&&a.audioStats.audioOutputLevel),Object(x.b)(o,"RecvBitrate",a.audioRecvBitrate),Object(x.b)(o,"CodecType",a.audioStats&&a.audioStats.googCodecName),Object(x.b)(o,"MuteState",a.audioDisabled),Object(x.b)(o,"TotalFreezeTime",a.audioStats&&a.audioStats.audioTotalFreezeTime),Object(x.b)(o,"TotalPlayDuration",a.audioStats&&a.audioStats.audioTotalPlayDuration),n&&n.peer_delay){var s=n.peer_delay.find((function(e){return e.peer_uid==i}));if(s){var c=s.peer_publish_audio_duration+(Date.now()-n.timestamp);Object(x.b)(o,"AudioPublishDuration",c)}else Object(x.b)(o,"AudioPublishDuration",-1)}r[i]=o}e&&e(r)},t.getLocalAudioStats=function(e){var n={};for(var r in t.localStats){var i={},o=t.localStats[r];Object(x.b)(i,"RecordingLevel",o.audioStats&&o.audioStats.audioInputLevel),Object(x.b)(i,"SendLevel",o.audioStats&&o.audioStats.totalAudioEnergy),Object(x.b)(i,"SamplingRate",o.audioStats&&o.audioStats.totalSamplesDuration),Object(x.b)(i,"SendBitrate",o.audioSendBitrate),Object(x.b)(i,"CodecType",o.audioStats&&o.audioStats.googCodecName),Object(x.b)(i,"MuteState",o.audioDisabled),Object(x.b)(i,"audioSendPacketsLost",o.audioStats&&o.audioStats.packetsLost);var a=t.gatewayClient.localStreams[r];a&&a.isPlaying()&&Object(x.b)(i,"MuteState",a.userMuteAudio?"1":"0"),n[r]=i}e&&e(n)},t.getRemoteVideoStats=function(e){var n=t.gatewayClient.traffic_stats,r={};for(var i in t.remoteStats){var o={},a=t.remoteStats[i];if(Object(x.b)(o,"End2EndDelay",a.peer_delay&&a.peer_delay.video_delay),Object(x.b)(o,"TransportDelay",a.peer_delay&&a.peer_delay.e2e_delay),Object(x.b)(o,"PacketLossRate",a.peer_delay&&a.peer_delay.e2e_video_lost_ratio_400ms),Object(x.b)(o,"RecvBitrate",a.videoRecvBitrate),Object(x.b)(o,"RecvResolutionWidth",a.videoStats&&a.videoStats.googFrameWidthReceived),Object(x.b)(o,"RecvResolutionHeight",a.videoStats&&a.videoStats.googFrameHeightReceived),Object(x.b)(o,"RenderResolutionWidth",a.videoStats&&a.videoStats.renderRemoteWidth),Object(x.b)(o,"RenderResolutionHeight",a.videoStats&&a.videoStats.renderRemoteHeight),Object(x.b)(o,"RenderFrameRate",a.videoStats&&a.videoStats.googFrameRateOutput),Object(x.b)(o,"MuteState",a.videoDisabled),Object(x.b)(o,"TotalFreezeTime",a.videoStats&&a.videoStats.videoTotalFreezeTime),Object(x.b)(o,"TotalPlayDuration",a.videoStats&&a.videoStats.videoTotalPlayDuration),n&&n.peer_delay){var s=n.peer_delay.find((function(e){return e.peer_uid==i}));if(s){var c=s.peer_publish_video_duration+(Date.now()-n.timestamp);Object(x.b)(o,"VideoPublishDuration",c)}else Object(x.b)(o,"VideoPublishDuration",-1)}r[i]=o}e&&e(r)},t.getLocalVideoStats=function(e){var n={};for(var r in t.localStats){var i={},o=t.localStats[r];Object(x.b)(i,"TargetSendBitrate",o.videoTargetSendBitrate),Object(x.b)(i,"SendFrameRate",o.videoStats&&o.videoStats.googFrameRateSent),Object(x.b)(i,"SendBitrate",o.videoSendBitrate),Object(x.b)(i,"SendResolutionWidth",o.videoStats&&o.videoStats.googFrameWidthSent),Object(x.b)(i,"SendResolutionHeight",o.videoStats&&o.videoStats.googFrameHeightSent),Object(x.b)(i,"CaptureResolutionWidth",o.videoStats&&o.videoStats.googFrameWidthInput),Object(x.b)(i,"CaptureResolutionHeight",o.videoStats&&o.videoStats.googFrameHeightInput),Object(x.b)(i,"EncodeDelay",o.videoStats&&o.videoStats.googAvgEncodeMs),Object(x.b)(i,"MuteState",o.videoDisabled),Object(x.b)(i,"TotalFreezeTime",o.videoStats&&o.videoStats.videoTotalFreezeTime),Object(x.b)(i,"TotalDuration",o.videoStats&&o.videoStats.videoTotalPlayDuration),Object(x.b)(i,"CaptureFrameRate",o.videoStats&&o.videoStats.googFrameRateSent),Object(x.b)(i,"videoSendPacketsLost",o.videoStats&&o.videoStats.packetsLost),o.videoStats&&!o.videoStats.googFrameWidthInput&&Object(x.b)(i,"CaptureResolutionWidth",o.videoStats&&o.videoStats.renderLocalWidth),o.videoStats&&!o.videoStats.googFrameHeightInput&&Object(x.b)(i,"CaptureResolutionHeight",o.videoStats&&o.videoStats.renderLocalHeight),n[r]=i}e&&e(n)},t.getRemoteVideoQualityStats=function(e){var n={};for(var r in t.remoteStats){var i={},o=t.remoteStats[r];Object(x.b)(i,"videoReceiveDelay",o.videoStats&&o.videoStats.googCurrentDelayMs),Object(x.b)(i,"VideoFreezeRate",o.videoStats&&o.videoStats.videoFreezeRate),Object(x.b)(i,"FirstFrameTime",o.firstFrameTime),n[r]=i}e&&e(n)},t.getRemoteAudioQualityStats=function(e){var n={};for(var r in t.remoteStats){var i={},o=t.remoteStats[r];Object(x.b)(i,"audioReceiveDelay",o.audioStats&&o.audioStats.googCurrentDelayMs),Object(x.b)(i,"AudioFreezeRate",o.videoStats&&o.videoStats.videoFreezeRate),n[r]=i}e&&e(n)},t.getTransportStats=function(e){var n={},r={},i=t.gatewayClient.traffic_stats,o=i.peer_delay;if(Object(x.b)(n,"OutgoingAvailableBandwidth",t.gatewayClient.OutgoingAvailableBandwidth/1e3),Object(x.b)(n,"RTT",i&&2*i.access_delay),o){var a,s=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(e){if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(e,t):void 0}}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}(o);try{for(s.s();!(a=s.n()).done;){var c=a.value;c.downlink_estimate_bandwidth&&(r[c.peer_uid]=c.downlink_estimate_bandwidth/1e3+"")}}catch(e){s.e(e)}finally{s.f()}}n.IncomingAvailableBandwidth=r,e&&e(n)},t.getSessionStats=function(e){var n={},r=t.gatewayClient.traffic_stats,i=t.gatewayClient.socket,o=0,a=0;for(var s in t.remoteStats)(c=t.remoteStats[s])&&c.videoStats&&c.videoStats.videoRecvBytesDelta&&(a+=parseInt(c.videoStats.videoRecvBytesDelta)),c&&c.audioStats&&c.audioStats.audioRecvBytesDelta&&(a+=parseInt(c.audioStats.audioRecvBytesDelta));for(var s in t.localStats){var c;(c=t.localStats[s])&&c.videoStats&&c.videoStats.videoSendBytesDelta&&(o+=parseInt(c.videoStats.videoSendBytesDelta)),c&&c.audioStats&&c.audioStats.audioSendBytesDelta&&(o+=parseInt(c.audioStats.audioSendBytesDelta))}var u=o+t.session.WSSendBytesDelta+t.session.HTTPSendBytesDelta,l=a+t.session.WSRecvBytesDelta+t.session.HTTPRecvBytesDelta,d=t.session.sendBytes+Object(I.getHTTPSendBytes)(),h=t.session.recvBytes+Object(I.getHTTPRecvBytes)();t.gatewayClient.socket&&t.gatewayClient.socket.state===t.gatewayClient.CONNECTED&&(d+=i.getSendBytes(),h+=i.getRecvBytes());var f=1;r.peer_delay&&(f=r.peer_delay.length,f+=1),i?Object(x.b)(n,"Duration",i.getDuration()):Object(x.b)(n,"Duration",0),Object(x.b)(n,"UserCount",f),Object(x.b)(n,"SendBytes",d),Object(x.b)(n,"RecvBytes",h),Object(x.b)(n,"SendBitrate",8*u/1e3),Object(x.b)(n,"RecvBitrate",8*l/1e3),e&&e(n)},t.isLocalVideoFreeze=function(e,t){var n=0,r=0;if(!e||!t)return!1;if(Object(s.isChrome)()||Object(s.isOpera)())n=e.googFrameRateInput,r=e.googFrameRateSent;else if(Object(s.isSafari)())n=parseInt(e.framerateMean),r=parseInt(e.framesEncoded)-parseInt(t.framesEncoded);else{if(!Object(s.isFireFox)())return!1;n=parseInt(e.framerateMean),r=parseInt(e.framesEncoded)-parseInt(t.framesEncoded)}return n>5&&r<3},t.isRemoteVideoFreeze=function(e,t){var n=0,r=0;if(!e||!t)return!1;if(Object(s.isChrome)()||Object(s.isOpera)())n=e.googFrameRateReceived,r=e.googFrameRateDecoded;else if(Object(s.isSafari)())n=e.framerateMean,r=parseInt(e.framesDecoded)-parseInt(t.framesDecoded);else{if(!Object(s.isFireFox)())return!1;n=parseInt(e.framesReceived)-parseInt(t.framesReceived),r=parseInt(e.framesDecoded)-parseInt(t.framesDecoded)}return n>5&&n<10&&r<3||n>10&&n<20&&r<4||n>20&&r<5},t.isAudioFreeze=function(e){if(Object(s.isChrome)()&&e){if(e.googDecodingPLC&&e.googDecodingPLCCNG&&e.googDecodingCTN)return(parseInt(e.googDecodingPLC)+parseInt(e.googDecodingPLCCNG))/parseInt(e.googDecodingCTN)>.2}else if((Object(s.isSafari)()||Object(s.isFireFox)())&&e.packetsLost&&e.packetsReceived)return parseInt(e.packetsLost)/(parseInt(e.packetsLost)+parseInt(e.packetsReceived))>.2;return!1},t.isAudioDecodeFailed=function(e){return!!((Object(s.isChrome)()||Object(s.isOpera)())&&e&&parseInt(e.bytesReceived)>0&&0===parseInt(e.googDecodingNormal))},t.startNetworkQualityTimer=function(){t.clearNetworkQualityTimer(),t.networkQualityTimer=setInterval((function(){if(t.gatewayClient.state===w.a.CONNECTED&&navigator.onLine){var e=t.gatewayClient.traffic_stats;t.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:t.networkQualityTrans(e.uplink_network_quality),downlinkNetworkQuality:t.networkQualityTrans(e.downlink_network_quality)})}else t.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3)},t.clearNetworkQualityTimer=function(){t.networkQualityTimer&&clearInterval(t.networkQualityTimer)},t.networkQualityTrans=function(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0},t.getStatsTimer=setInterval((function(){var e=t.gatewayClient.traffic_stats,n=Date.now();t.gatewayClient.dispatchEvent({type:"_testException"}),Object.keys(t.localStats).length&&t.exceptionMonitor.setLocalStats(t.localStats),Object.keys(t.remoteStats).length&&t.exceptionMonitor.setRemoteStats(t.remoteStats);var r={};Object.keys(t.gatewayClient.remoteStreams).forEach((function(i){var o=t.gatewayClient.remoteStreams[i],a=t.remoteStats[i],s={id:i,updatedAt:n};r[i]=s,s.firstFrameTime=o.firstFrameTime,a?(s.audioTotalPlayDuration=a.audioTotalPlayDuration+1,s.audioTotalFreezeTime=a.audioTotalFreezeTime,s.isAudioFreeze=!1,s.isAudioDecodeFailed=!1,s.videoTotalPlayDuration=a.videoTotalPlayDuration+1,s.videoTotalFreezeTime=a.videoTotalFreezeTime,s.isVideoFreeze=!1):(s.audioTotalPlayDuration=1,s.audioTotalFreezeTime=0,s.videoTotalPlayDuration=1,s.videoTotalFreezeTime=0);var c=e&&e.peer_delay&&e.peer_delay.find((function(e){return e.peer_uid==i}));c&&(s.peer_delay=c),o&&(o.isPlaying()&&(s.audioDisabled=o.userMuteAudio||o.peerMuteAudio?"1":"0",s.videoDisabled=o.userMuteVideo||o.peerMuteVideo?"1":"0"),a&&a.peer_delay&&c&&a.peer_delay.stream_type!==c.stream_type&&t.gatewayClient.dispatchEvent({type:"streamTypeChange",uid:i,streamType:c.stream_type}),o.pc&&"established"==o.pc.state&&o.pc.getStats((function(e){if(s.pcStats=e,s.audioStats=e.find((function(e){return"audio"==e.mediaType&&(e.id.indexOf("_recv")>-1||e.id.toLowerCase().indexOf("inbound")>-1)})),s.videoStats=e.find((function(e){return"video"==e.mediaType&&(e.id.indexOf("_recv")>-1||e.id.toLowerCase().indexOf("inbound")>-1)})),a&&a.audioStats&&s.audioStats){var n=parseInt(s.audioStats.bytesReceived)-parseInt(a.audioStats.bytesReceived),r=parseInt(s.audioStats.googDecodingNormal)-parseInt(a.audioStats.googDecodingNormal);if(s.audioStats.audioRecvBytesDelta=n,s.audioStats.audioDecodingNormalDelta=r,t.session.recvBytes+=n,isFinite(n)&&s.audioStats.timestamp){var i=s.audioStats.timestamp.getTime()-a.audioStats.timestamp.getTime();s.audioRecvBitrate=Math.floor(8*n/i)}t.isAudioFreeze(s.audioStats)&&s.audioTotalPlayDuration>10&&(s.audioTotalFreezeTime++,s.isAudioFreeze=!0),t.isAudioDecodeFailed(s.audioStats)&&s.audioTotalPlayDuration>10&&(s.isAudioDecodeFailed=!0),s.audioStats.audioTotalFreezeTime=s.audioTotalFreezeTime,s.audioStats.audioTotalPlayDuration=s.audioTotalPlayDuration,s.audioStats.audioFreezeRate=Math.ceil(100*s.audioTotalFreezeTime/s.audioTotalPlayDuration)}if(a&&a.videoStats&&s.videoStats){var c=parseInt(s.videoStats.bytesReceived)-parseInt(a.videoStats.bytesReceived);s.videoStats.videoRecvBytesDelta=c,t.session.recvBytes+=c,isFinite(c)&&s.videoStats.timestamp&&(i=s.videoStats.timestamp.getTime()-a.videoStats.timestamp.getTime(),s.videoRecvBitrate=Math.floor(8*c/i)),t.isRemoteVideoFreeze(s.videoStats,a.videoStats)&&(s.videoTotalFreezeTime++,s.isVideoFreeze=!0),s.videoStats.videoTotalFreezeTime=s.videoTotalFreezeTime,s.videoStats.videoTotalPlayDuration=s.videoTotalPlayDuration,s.videoStats.videoFreezeRate=Math.ceil(100*s.videoTotalFreezeTime/s.videoTotalPlayDuration),o.player&&o.player.video&&o.player.video.videoWidth&&o.player.video.videoHeight?(s.videoStats.renderRemoteWidth=o.player.video.videoWidth,s.videoStats.renderRemoteHeight=o.player.video.videoHeight):(s.videoStats.renderRemoteWidth=o.videoWidth||s.videoStats.googFrameWidthReceived,s.videoStats.renderRemoteHeight=o.videoHeight||s.videoStats.googFrameHeightReceived)}})))})),t.remoteStats=r;var i={};if(Object.keys(t.gatewayClient.localStreams).forEach((function(e){var r=t.gatewayClient.localStreams[e],o=t.localStats[e],a={id:e,updatedAt:n};i[e]=a,o?(a.videoTotalPlayDuration=o.videoTotalPlayDuration+1,a.videoTotalFreezeTime=o.videoTotalFreezeTime,a.isVideoFreeze=!1):(a.videoTotalPlayDuration=1,a.videoTotalFreezeTime=0),r&&(r.isPlaying()&&(a.audioDisabled=r.userMuteAudio?"1":"0",a.videoDisabled=r.userMuteVideo?"1":"0"),r.video&&r.attributes.maxVideoBW?a.videoTargetSendBitrate=r.attributes.maxVideoBW:r.video&&r.screenAttributes&&(a.videoTargetSendBitrate=r.screenAttributes.maxVideoBW),r.pc&&"established"==r.pc.state&&r.pc.getStats((function(e){if(a.pcStats=e.reverse(),a.audioStats=e.find((function(e){return"audio"==e.mediaType&&(e.id.indexOf("_send")>-1||e.id.toLowerCase().indexOf("outbound")>-1)})),a.videoStats=e.find((function(e){return"video"==e.mediaType&&(e.id.indexOf("_send")>-1||e.id.toLowerCase().indexOf("outbound")>-1)})),a.audioStats&&o&&o.audioStats){var n=parseInt(a.audioStats.bytesSent)-parseInt(o.audioStats.bytesSent);if(a.audioStats.audioSendBytesDelta=n,t.session.sendBytes+=n,isFinite(n)&&a.audioStats.timestamp){var i=a.audioStats.timestamp.getTime()-o.audioStats.timestamp.getTime();a.audioSendBitrate=Math.floor(8*n/i)}}if(a.videoStats&&o&&o.videoStats){var s=parseInt(a.videoStats.bytesSent)-parseInt(o.videoStats.bytesSent);a.videoStats.videoSendBytesDelta=s,t.session.sendBytes+=s,isFinite(s)&&a.videoStats.timestamp&&(i=a.videoStats.timestamp.getTime()-o.videoStats.timestamp.getTime(),a.videoSendBitrate=Math.floor(8*s/i)),t.isLocalVideoFreeze(a.videoStats,o.videoStats)&&(a.videoTotalFreezeTime++,a.isVideoFreeze=!0),a.videoStats.videoTotalFreezeTime=a.videoTotalFreezeTime,a.videoStats.videoTotalPlayDuration=a.videoTotalPlayDuration,a.videoStats.videoFreezeRate=Math.ceil(100*a.videoTotalFreezeTime/a.videoTotalPlayDuration),a.videoStats.renderLocalWidth=r.videoWidth||a.videoStats.googFrameWidthSent,a.videoStats.renderLocalHeight=r.videoHeight||a.videoStats.googFrameHeightSent}})))})),t.localStats=i,t.session.HTTPSendBytesDelta=Object(I.getHTTPSendBytes)()-t.session.HTTPSendBytes,t.session.HTTPSendBytes=Object(I.getHTTPSendBytes)(),t.session.HTTPRecvBytesDelta=Object(I.getHTTPRecvBytes)()-t.session.HTTPRecvBytes,t.session.HTTPRecvBytes=Object(I.getHTTPRecvBytes)(),t.gatewayClient.socket&&t.gatewayClient.socket.state===t.gatewayClient.CONNECTED){var o=t.gatewayClient.socket;t.session.WSSendBytesDelta=o.getSendBytes()-t.session.WSSendBytes,t.session.WSSendBytes=o.getSendBytes(),t.session.WSRecvBytesDelta=o.getRecvBytes()-t.session.WSRecvBytes,t.session.WSRecvBytes=o.getRecvBytes()}}),1e3),t.gatewayClient.on("join",(function(){t.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0}})),t}(t.gatewayClient),t.configDistributManager=function(e){var t={};return t.client=e,t.client.gatewayClient&&t.client.gatewayClient.on("config-distribute",(function(n){var a=n.joinInfo,s=n.config;if(s){Object(k.isEmpty)(s.uploadLog)||(Object(r.setParameter)("UPLOAD_LOG",s.uploadLog),o.report.reportApiInvoke(a.sid,{name:"_configDistribute",options:{feature:"uploadLog",value:s.uploadLog}})()),Object(k.isEmpty)(s.dualStream)||(e.isDualStream=s.dualStream,o.report.reportApiInvoke(a.sid,{name:"_configDistribute",options:{feature:"dualStream",value:s.dualStream}})()),Object(k.isEmpty)(s.streamFallbackOption)||t.client.gatewayClient&&t.client.gatewayClient.on("stream-subscribed",(function(e){var n=e.stream;n?(t.client.gatewayClient.setStreamFallbackOption(n,s.streamFallbackOption),o.report.reportApiInvoke(a.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:s.streamFallbackOption,streamId:n.getId()}})()):o.report.reportApiInvoke(a.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:s.streamFallbackOption,streamId:n.getId(),err:"invalid stream"}})()}));try{i.default.debug("[".concat(e.clientId,"] setParameter in distribution: ").concat(JSON.stringify(s))),Object.keys(s).map((function(e){return Object(r.setParameter)(e,s[e])}))}catch(t){i.default.debug("[".concat(e.clientId,"] setParameter in distribution failed: ").concat(JSON.stringify(s)))}}})),t}(t),Object(D.addLiveStreamingCapability)(t,e),e.areaCode){var n=e,c=n.areaCode,f=n.excludedArea,p=Object(B.getAreaCodeByConfig)({areaCode:c,excludedArea:f});Object(r.setParameter)("AREA_SETTING",p);var g=Object(B.getAreaDomainConfig)(p);Object.keys(g).map((function(e){var t=g[e];"LOG_UPLOAD_SERVER"==e||"EVENT_REPORT_DOMAIN"==e||"EVENT_REPORT_BACKUP_DOMAIN"==e||"NGINX"==e?Object(r.setParameter)(e,t[0]):Object(r.setParameter)(e,t)}))}return Object(k.isEmpty)(e.turnServer)||t.setTurnServer(e.turnServer),Object(k.isEmpty)(e.proxyServer)||t.setProxyServer(e.proxyServer),"live"===t.mode&&(t.gatewayClient.role="audience"),"rtc"===t.mode&&(t.gatewayClient.role=H),t.gatewayClient.on("onMultiIP",(function(e){t.gatewayClient.closeGateway(),t.gatewayClient.socket=void 0,t.gatewayClient.hasChangeBGPAddress=!0,t.joinInfo.multiIP=e.option,t.gatewayClient.state=w.a.CONNECTING;var n=function(e){i.default.info("[".concat(t.clientId,"] Joining channel: ").concat(t.channel)),t.joinInfo.cid=e.cid,t.joinInfo.uid||(t.joinInfo.uid=e.uid),t.joinInfo.uni_lbs_ip=e.uni_lbs_ip,t.joinInfo.gatewayAddr=e.gateway_addr,t.onSuccess?t.gatewayClient.join(t.joinInfo,t.key,(function(e){i.default.info("[".concat(t.clientId,"] Join channel ").concat(t.channel," success"));var n=t.onSuccess;t.onSuccess=null,t.onFailure=null,n(e)}),t.onFailure):(t.gatewayClient.joinInfo=S()({},t.joinInfo),t.gatewayClient.rejoin())};t.joinInfo.stringUid&&!t.joinInfo.uid?(t.userAccountReq&&!t.userAccountReq.isFinished()&&t.userAccountReq.cancel(),t.userAccountReq=Object(R.getUserAccount)(joinInfo,t.gatewayClient),t.userAccountReq.then((function(e){i.default.error("getUserAccount Success ".concat(e.url," ").concat(joinInfo.stringUid," => ").concat(e.uid)),t.joinInfo.uid=e.uid,Object(R.getGatewayList)(t.joinInfo,n,t.onFailure)})).catch((function(e){i.default.error("getUserAccount rejected",e),t.onFailure(e)}))):Object(R.getGatewayList)(t.joinInfo,n,t.onFailure)})),t.gatewayClient.on("rejoin-start",(function(){t._renewSession(),o.report.sessionInit(e.sessionId,{lts:(new Date).getTime(),extend:{rejoin:!0},cname:t.channel,appid:e.appId,mode:e.mode,succ:!0})})),t.gatewayClient.on("recover",(function(){t._renewSession(),i.default.debug("[".concat(t.clientId,"]"),"recover",e.sessionId),o.report.sessionInit(e.sessionId,{lts:(new Date).getTime(),extend:{recover:!0},cname:t.channel,appid:e.appId,mode:e.mode,succ:!0})})),t.gatewayClient.on("rejoin",(function(){var e=t.highStreamState;if(i.default.debug("[".concat(t.clientId,"] Client local stream preState: ").concat(e)),t.onSuccess){var n=t.onSuccess;t.onSuccess=null,t.onFailure=null,n(t.joinInfo.uid)}!t.highStream||0!==e&&1!==e||(i.default.info("[".concat(t.clientId,"] publish after rejoin")),t.highStreamState=2,t.lowStreamState=2,t.publish(t.highStream,(function(e){e&&i.default.info("[".concat(t.clientId,"] "),e)})))})),t.gatewayClient.on("streamPublished",(function(e){t.hasPublished||(t.hasPublished=!0,t.gatewayClient.dispatchEvent({type:"stream-published",stream:e.stream,proxy:e.proxy}))})),t.gatewayClient.on("pubP2PLost",(function(e){i.default.debug("[".concat(t.clientId,"] Start reconnect local peerConnection: ").concat(t.highStream.getId())),t.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:t.highStream.getId()}),1===t.highStreamState&&(t.highStreamState=0,t.lowStreamState=0),t._unpublish(t.highStream,(function(){t._publish(t.highStream,(function(){i.default.debug("[".concat(t.clientId,"] Reconnect local peerConnection success: ").concat(t.highStream.getId())),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.highStream.getId(),success:!0,reason:""})}),(function(e){i.default.debug("[".concat(t.clientId,"] Reconnect local peerConnection failed: ").concat(e)),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.highStream.getId(),success:!1,reason:e})}),!0)}),(function(e){i.default.debug("[".concat(t.clientId,"] Reconnect local peerConnection failed: ").concat(e)),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.highStream.getId(),success:!1,reason:e})}),!0)})),t.gatewayClient.on("subP2PLost",(function(e){i.default.debug("[".concat(t.clientId,"] Start reconnect remote peerConnection: ").concat(e.stream.getId()," ").concat(e.stream.subscribeOptions)),t.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:e.stream.getId()});var n=e.stream.subscribeOptions;i.default.debug("[".concat(t.clientId,"]"),"Re-subscribe stream",JSON.stringify(n)),t.gatewayClient.unsubscribe(e.stream,(function(){e.stream.subscribeOptions=n,t.gatewayClient.subscribe(e.stream,(function(){i.default.debug("[".concat(t.clientId,"] Reconnect remote peerConnection success: ").concat(e.stream.getId())),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.stream.getId(),success:!0,reason:""})}),(function(n){i.default.debug("[".concat(t.clientId,"] Reconnect remote peerConnection failed: "),n),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.stream.getId(),success:!1,reason:n})}))}),(function(n){i.default.debug("[".concat(t.clientId,"] Reconnect remote peerConnection failed: "),n),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.stream.getId(),success:!1,reason:n})}))})),P.on("networkTypeChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=S()({},e,{type:"network-type-changed"});t.gatewayClient.dispatchEvent(n)})),h.a.on("recordingDeviceChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=S()({},e,{type:"recording-device-changed"});t.gatewayClient.dispatchEvent(n)})),h.a.on("playoutDeviceChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=S()({},e,{type:"playout-device-changed"});t.gatewayClient.dispatchEvent(n)})),h.a.on("cameraChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=S()({},e,{type:"camera-changed"});t.gatewayClient.dispatchEvent(n)})),t.gatewayClient.on("streamTypeChange",(function(n){var r=S()({},n,{type:"stream-type-changed"});t.gatewayClient.dispatchEvent(r),o.report.reportApiInvoke(e.sessionId,{name:"streamTypeChange"})(null,JSON.stringify(n))})),t},W=function(e){return"h264_interop"===e?"h264":"vp8"},q=function(e){return-1===g.indexOf(e.mode)?T.default.INVALID_CLIENT_MODE:-1===v.indexOf(e.codec)?T.default.INVALID_CLIENT_CODEC:"h264_interop"==e.mode&&"h264"!==e.codec&&T.default.CLIENT_MODE_CODEC_MISMATCH},X=function(e){switch(e.mode){case"interop":case"h264_interop":e.mode="live";break;case"web-only":e.mode="rtc"}},J=h.a.getDevices,Y=f.a.getScreenSources,K=JSON.parse(JSON.stringify(r.SUPPORT_RESOLUTION_LIST));t.default={TranscodingUser:{uid:0,x:0,y:0,width:0,height:0,zOrder:0,alpha:1},LiveTranscoding:{width:640,height:360,videoBitrate:400,videoFramerate:15,lowLatency:!1,audioSampleRate:48e3,audioBitrate:48,audioChannels:1,videoGop:30,videoCodecProfile:100,userCount:0,userConfigExtraInfo:{},backgroundColor:0,transcodingUsers:[]},createClient:function(e){var t=o.report.reportApiInvoke(null,{name:"createClient",options:arguments,tag:"tracer"});(e=S()({},e||{})).codec||(e.codec=W(e.mode));var n=q(e);if(n)throw i.default.error("Invalid parameter setting MODE: ".concat(e.mode," CODEC: ").concat(e.codec," ERROR ").concat(n)),t(n),new Error(n);return i.default.info("Creating client, MODE: ".concat(e.mode," CODEC: ").concat(e.codec)),X(e),t(null,e),z(e)},createStream:d.b,Logger:i.default,report:o.report,getDevices:J,getScreenSources:Y,getParameter:r.getParameter,setParameter:r.setParameter,checkSystemRequirements:u,getSupportedCodec:p.getSupportedCodec,ChannelMediaRelayConfiguration:m.ChannelMediaRelayConfiguration,VERSION:r.VERSION,BUILD:r.BUILD,PROFILE_TABLE:K,AUDIO_SAMPLE_RATE_32000:32e3,AUDIO_SAMPLE_RATE_44100:44100,AUDIO_SAMPLE_RATE_48000:48e3,VIDEO_CODEC_PROFILE_BASELINE:66,VIDEO_CODEC_PROFILE_MAIN:77,VIDEO_CODEC_PROFILE_HIGH:100,REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2,AREAS:B.AREAS,AREA_VERSION:"global"}}]).default})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AgoraRTM=t()}(this,(function(){function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function um(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function J(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){function o(e){um(s,r,i,o,a,"next",e)}function a(e){um(s,r,i,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)}))}}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vm(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ia(e,t,n){return t&&vm(e.prototype,t),n&&vm(e,n),e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ja(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wf(e,t)}function Fd(e){return(Fd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wf(e,t){return(wf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function wm(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function wi(e,t,n){return(wi=wm()?Reflect.construct:function(e,t,n){var r=[null];return r.push.apply(r,t),e=new(Function.bind.apply(e,r)),n&&wf(e,n.prototype),e}).apply(null,arguments)}function xf(e){var t="function"==typeof Map?new Map:void 0;return(xf=function(e){function n(){return wi(e,arguments,Fd(this).constructor)}if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),wf(n,e)})(e)}function yf(e,t){if(null==e)return{};if(null==e)var n={};else{n={};var r,i=Object.keys(e);for(r=0;r<i.length;r++){var o=i[r];0<=t.indexOf(o)||(n[o]=e[o])}}if(Object.getOwnPropertySymbols)for(r=Object.getOwnPropertySymbols(e),o=0;o<r.length;o++)i=r[o],0<=t.indexOf(i)||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i]);return n}function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ka(e){var t=wm();return function(){var r=Fd(e);if(t){var i=Fd(this).constructor;r=Reflect.construct(r,arguments,i)}else r=r.apply(this,arguments);return!r||"object"!=typeof r&&"function"!=typeof r?n(this):r}}function xi(e,t,n){return(xi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Fd(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}function ua(e,t){var n=Array.isArray(e)?e:void 0;if(!n)if(null==(n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"])))n=void 0;else{var r,i=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){a=!0;var s=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw s}}n=i}if(!(e=n||xm(e,t)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function G(e){var t=Array.isArray(e)?yi(e):void 0;if(t||(t="undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"]?Array.from(e):void 0),!(e=t||xm(e)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function xm(e,t){if(e){if("string"==typeof e)return yi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yi(e,t)}}function yi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function la(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function cb(e){var t={exports:{}};return e(t,t.exports),t.exports}function pe(e){e||(e={});var t=e.ua;if(t||"undefined"==typeof navigator||(t=navigator.userAgent),t&&t.headers&&"string"==typeof t.headers["user-agent"]&&(t=t.headers["user-agent"]),"string"!=typeof t)return!1;var n=iu.test(t)&&!ju.test(t)||!!e.tablet&&ku.test(t);return!n&&e.tablet&&e.featureDetect&&navigator&&1<navigator.maxTouchPoints&&-1!==t.indexOf("Macintosh")&&-1!==t.indexOf("Safari")&&(n=!0),n}function ym(e,t){var n,r=3>arguments.length?e:arguments[2];return sa(e)===r?e[t]:(n=Jb.f(e,t))?Q(n,"value")?n.value:void 0===n.get?void 0:n.get.call(r):ha(n=ac(e))?ym(n,t,r):void 0}function lu(e){var t=e.charCodeAt(0)<<24,n=0|mu(~t),r=0,i=0|e.length,o="";if(5>n&&i>=n){for(t=t<<n>>>24+n,r=1;r<n;r=r+1|0)t=t<<6|63&e.charCodeAt(r);65535>=t?o+=Gd(t):1114111>=t?o+=Gd(55296+((t=t-65536|0)>>10)|0,56320+(1023&t)|0):r=0}for(;r<i;r=r+1|0)o+="";return o}function zm(){}function nu(e){var t=0|e.charCodeAt(0);if(55296<=t&&56319>=t){var n=0|e.charCodeAt(1);if(!(n==n&&56320<=n&&57343>=n))return Gd(239,191,189);if(65535<(t=(t-55296<<10)+n-56320+65536|0))return Gd(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}return 127>=t?e:2047>=t?Gd(192|t>>>6,128|63&t):Gd(224|t>>>12,128|t>>>6&63,128|63&t)}function Am(){}function ia(){ia.init.call(this)}function Kg(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+V(e))}function Bm(e,t,n,r){Kg(n);var i=e._events;if(void 0===i)i=e._events=Object.create(null),e._eventsCount=0;else{void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events);var o=i[t]}return void 0===o?(i[t]=n,++e._eventsCount):("function"==typeof o?o=i[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),0<(n=void 0===e._maxListeners?ia.defaultMaxListeners:e._maxListeners)&&o.length>n&&!o.warned&&(o.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=o.length,console&&console.warn&&console.warn(n))),e}function ou(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Cm(e,t,n){return e={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},(t=ou.bind(e)).listener=n,e.wrapFn=t}function Dm(e,t,n){if(void 0===(e=e._events))return[];if(void 0===(t=e[t]))return[];if("function"==typeof t)return n?[t.listener||t]:[t];if(n)for(n=Array(t.length),e=0;e<n.length;++e)n[e]=t[e].listener||t[e];else n=Em(t,t.length);return n}function Fm(e){var t=this._events;if(void 0!==t){if("function"==typeof(e=t[e]))return 1;if(void 0!==e)return e.length}return 0}function Em(e,t){for(var n=Array(t),r=0;r<t;++r)n[r]=e[r];return n}function pu(e,t,n){"function"==typeof e.on&&Gm(e,"error",t,n)}function Gm(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+V(e));e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}function qu(e){return e?G(e):ru((function(){return[]}),(function(e,t){return e.push(t),e}))}function Hm(e,t){var n,r,i,o;return x.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=Im(e)([Jm,Jm,function(e,t){return t}])[2],r=0;case 2:if(!(r<t.length)){a.next=17;break}if(i=t[r],!((o=n(zi,i))instanceof Lg)){a.next=11;break}if((o=Ai(o.deref()))===zi){a.next=10;break}return a.next=10,o;case 10:return a.abrupt("return");case 11:if(o===zi){a.next=14;break}return a.next=14,o;case 14:r++,a.next=2;break;case 17:case"end":return a.stop()}}),su)}function Mg(e,t){return null!=t&&"function"==typeof t[Symbol.iterator]?Hm(Mg(e),t):function(t){var n=t[2];return tu(t,(function(t,r){return n(t,e(r))}))}}function Jc(e){return Object.prototype.toString.call(e).slice(8,-1)}function Hd(e){return"Object"===Jc(e)&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Km(e){var t;return(t="Boolean"===Jc(e)||"Null"===Jc(e)||"Undefined"===Jc(e))||(t="Number"===Jc(e)&&!isNaN(e)),t||"String"===Jc(e)||"Symbol"===Jc(e)}function Id(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function qe(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function re(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function zf(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Ng;++t<n;)this.add(e[t])}function se(e){this.size=(this.__data__=new Og(e)).size}function te(e,t,n,r,i,o){var a,s=1&t,c=2&t,u=4&t;if(n&&(a=i?n(e,r,i,o):n(e)),void 0!==a)return a;if(!ob(e))return e;if(r=Za(e)){if(a=uu(e),!s)return Bi(e,a)}else{var l=Af(e),d="[object Function]"==l||"[object GeneratorFunction]"==l;if(Bf(e))return Lm(e,s);if("[object Object]"==l||"[object Arguments]"==l||d&&!i){if(a=c||d?{}:Mm(e),!s)return c?vu(e,wu(a,e)):xu(e,yu(a,e))}else{if(!xa[l])return i?e:{};a=zu(e,l,s)}}if(o||(o=new ue),i=o.get(e))return i;o.set(e,a),Au(e)?e.forEach((function(r){a.add(te(r,t,n,r,e,o))})):Bu(e)&&e.forEach((function(r,i){a.set(i,te(r,t,n,i,e,o))})),c=u?c?Nm:Ci:c?Cf:Jd;var h=r?void 0:c(e);return Cu(h||e,(function(r,i){h&&(r=e[i=r]),Om(a,i,te(r,t,n,i,e,o))})),a}function Di(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;return o.has(i)?o.get(i):(r=e.apply(this,r),n.cache=o.set(i,r)||o,r)};return n.cache=new(Di.Cache||Ng),n}function Pm(e){if("string"==typeof e)return e;if(Za(e))return ve(e,Pm)+"";if(we(e))return Qm?Qm.call(e):"";var t=e+"";return"0"==t&&1/e==-Du?"-0":t}function Ei(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=Eu),i||(i=[]);++o<a;){var s=e[o];0<t&&n(s)?1<t?Ei(s,t-1,n,r,i):Fi(i,s):r||(i[i.length]=s)}return i}function xe(e,t,n,r,i){if(e===t)t=!0;else if(null==e||null==t||!oc(e)&&!oc(t))t=e!=e&&t!=t;else e:{var o=Za(e),a=Za(t),s=o?"[object Array]":Af(e),c=a?"[object Array]":Af(t),u="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s);if(a="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),(c=s==c)&&Bf(e)){if(!Bf(t)){t=!1;break e}o=!0,u=!1}if(c&&!u)i||(i=new ue),t=o||Gi(e)?Rm(e,t,n,r,xe,i):Fu(e,t,s,n,r,xe,i);else{if(!(1&n)&&(o=u&&Sm.call(e,"__wrapped__"),s=a&&Sm.call(t,"__wrapped__"),o||s)){e=o?e.value():e,t=s?t.value():t,i||(i=new ue),t=xe(e,t,n,r,i);break e}if(c)t:if(i||(i=new ue),o=1&n,s=Ci(e),a=s.length,c=Ci(t).length,a==c||o){for(c=a;c--;){var l=s[c];if(!(o?l in t:Gu.call(t,l))){t=!1;break t}}if(u=i.get(e),l=i.get(t),u&&l)t=u==t&&l==e;else{u=!0,i.set(e,t),i.set(t,e);for(var d=o;++c<a;){var h=e[l=s[c]],f=t[l];if(r)var p=o?r(f,h,l,t,e,i):r(h,f,l,e,t,i);if(void 0===p?h!==f&&!xe(h,f,n,r,i):!p){u=!1;break}d||(d="constructor"==l)}u&&!d&&(n=e.constructor)!=(r=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(u=!1),i.delete(e),i.delete(t),t=u}}else t=!1;else t=!1}}return t}function ya(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function pb(e){return!0===(e&&e.__isLong__)}function Kd(e,t){var n;if(t){if((t=0<=(e>>>=0)&&256>e)&&(n=Tm[e]))return n;n=za(e,0>(0|e)?-1:0,!0),t&&(Tm[e]=n)}else{if((t=-128<=(e|=0)&&128>e)&&(n=Um[e]))return n;n=za(e,0>e?-1:0,!1),t&&(Um[e]=n)}return n}function Kb(e,t){if(isNaN(e))return t?Ld:Lb;if(t){if(0>e)return Ld;if(e>=Vm)return Wm}else{if(e<=-Xm)return qb;if(e+1>=Xm)return Ym}return 0>e?Kb(-e,t).neg():za(e%ye|0,e/ye|0,t)}function za(e,t,n){return new ya(e,t,n)}function Hi(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return Lb;if("number"==typeof t?(n=t,t=!1):t=!!t,2>(n=n||10)||36<n)throw RangeError("radix");var r;if(0<(r=e.indexOf("-")))throw Error("interior hyphen");if(0===r)return Hi(e.substring(1),t,n).neg();r=Kb(Pg(n,8));for(var i=Lb,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),s=parseInt(e.substring(o,o+a),n);8>a?(a=Kb(Pg(n,a)),i=i.mul(a).add(Kb(s))):i=(i=i.mul(r)).add(Kb(s))}return i.unsigned=t,i}function bc(e,t){return"number"==typeof e?Kb(e,t):"string"==typeof e?Hi(e,t):za(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}function O(e,t){function n(){this.constructor=e}Ii(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function ze(e){return"function"==typeof e}function Ae(e){setTimeout((function(){throw e}),0)}function Ji(e){return null!==e&&"object"===V(e)}function Zm(e){return e.reduce((function(e,t){return e.concat(t instanceof Df?t.errors:t)}),[])}function Ki(e){for(;e;){var t=e.destination,n=e.isStopped;if(e.closed||n)return!1;e=t&&t instanceof ma?t:null}return!0}function ed(e){return e}function Li(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $m(e)}function $m(e){return 0===e.length?ed:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}function an(e){if(e||(e=Mb.Promise||Promise),!e)throw Error("no Promise impl found");return e}function bn(){return function(e){return e.lift(new Hu(e))}}function Ef(e){return e?Iu(e):yb}function Iu(e){return new Y((function(t){return e.schedule((function(){return t.complete()}))}))}function fd(e){return e&&"function"==typeof e.schedule}function Mi(e,t){return new Y((function(n){var r=new Ta,i=0;return r.add(t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||r.add(this.schedule()))}))),r}))}function Ff(e,t){return t?Mi(e,t):new Y(cn(e))}function eb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return fd(t=e[e.length-1])?(e.pop(),Mi(e,t)):Ff(e)}function Z(e,t){return new Y(t?function(n){return t.schedule(Ju,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function Ju(e){e.subscriber.error(e.error)}function Ku(e,t){return void 0===t&&(t=0),function(n){return n.lift(new Lu(e,t))}}function dn(e){return e in Ni&&(delete Ni[e],!0)}function pc(){}function ea(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Mu(e,t))}}function en(e,t,n){if(t){if(!fd(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return en(e,n).apply(void 0,r).pipe(ea((function(e){return Nb(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i,o=this,a={context:o,subject:i,callbackFunc:e,scheduler:n};return new Y((function(r){if(n)return n.schedule(Nu,0,{args:t,subscriber:r,params:a});if(!i){i=new Gf;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.next(1>=e.length?e[0]:e),i.complete()}]))}catch(e){Ki(i)?i.error(e):console.warn(e)}}return i.subscribe(r)}))}}function Nu(e){var t=this,n=e.args,r=e.subscriber,i=e.params;e=i.callbackFunc;var o=i.context,a=i.scheduler,s=i.subject;if(!s){s=i.subject=new Gf,i=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.add(a.schedule(Ou,0,{value:1>=e.length?e[0]:e,subject:s}))};try{e.apply(o,n.concat([i]))}catch(e){s.error(e)}}this.add(s.subscribe(r))}function Ou(e){var t=e.subject;t.next(e.value),t.complete()}function fn(e,t,n){if(t){if(!fd(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return fn(e,n).apply(void 0,r).pipe(ea((function(e){return Nb(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new Y((function(r){var o=i.context,a=i.subject;if(n)return n.schedule(Pu,0,{params:i,subscriber:r,context:o});if(!a){a=i.subject=new Gf;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(t=e.shift())?a.error(t):(a.next(1>=e.length?e[0]:e),a.complete())}]))}catch(e){Ki(a)?a.error(e):console.warn(e)}}return a.subscribe(r)}))}}function Pu(e){var t=this,n=e.params,r=e.subscriber;e=e.context;var i=n.callbackFunc,o=n.args,a=n.scheduler,s=n.subject;if(!s){s=n.subject=new Gf,n=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(n=e.shift())?t.add(a.schedule(gn,0,{err:n,subject:s})):t.add(a.schedule(Qu,0,{value:1>=e.length?e[0]:e,subject:s}))};try{i.apply(e,o.concat([n]))}catch(e){this.add(a.schedule(gn,0,{err:e,subject:s}))}}this.add(s.subscribe(r))}function Qu(e){var t=e.subject;t.next(e.value),t.complete()}function gn(e){e.subject.error(e.err)}function hn(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}function Oi(e,t,n,r,i){if(void 0===i&&(i=new Ru(e,n,r)),!i.closed)return t instanceof Y?t.subscribe(i):Hf(t)(i)}function Su(e,t){return new Y((function(n){var r=new Ta;return r.add(t.schedule((function(){var i=e[Be]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}function Tu(e,t){return new Y((function(n){var r=new Ta;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}function Uu(e,t){if(!e)throw Error("Iterable cannot be null");return new Y((function(n){var r,i=new Ta;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[gd](),i.add(t.schedule((function(){if(!n.closed){try{var e=r.next(),t=e.value,i=e.done}catch(e){return void n.error(e)}i?n.complete():(n.next(t),this.schedule())}})))}))),i}))}function jn(e,t){if(null!=e){if(e&&"function"==typeof e[Be])return Su(e,t);if(hn(e))return Tu(e,t);if(kn(e))return Mi(e,t);if(e&&"function"==typeof e[gd]||"string"==typeof e)return Uu(e,t)}throw new TypeError((null!==e&&V(e)||e)+" is not observable")}function Ob(e,t){return t?jn(e,t):e instanceof Y?e:new Y(Hf(e))}function qc(e,t){if(!t.closed){if(e instanceof Y)return e.subscribe(t);try{var n=Hf(e)(t)}catch(e){t.error(e)}return n}}function fb(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(fb((function(n,r){return Ob(e(n,r)).pipe(ea((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new Vu(e,n))})}function Qg(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),fb(ed,e)}function ln(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Qg(1)(eb.apply(void 0,e))}function hd(e){return new Y((function(t){try{var n=e()}catch(e){return void t.error(e)}return(n?Ob(n):Ef()).subscribe(t)}))}function mn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(Nb(n))return Rg(n,null);if(Ji(n)&&Object.getPrototypeOf(n)===Object.prototype)return Rg((e=Object.keys(n)).map((function(e){return n[e]})),e)}if("function"==typeof e[e.length-1]){var r=e.pop();return Rg(e=1===e.length&&Nb(e[0])?e[0]:e,null).pipe(ea((function(e){return r.apply(void 0,e)})))}return Rg(e,null)}function Rg(e,t){return new Y((function(n){var r=e.length;if(0===r)n.complete();else for(var i=Array(r),o=0,a=0,s=function(s){var c=Ob(e[s]),u=!1;n.add(c.subscribe({next:function(e){u||(u=!0,a++),i[s]=e},error:function(e){return n.error(e)},complete:function(){++o!==r&&u||(a===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=i[n],e}),{}):i),n.complete())}}))},c=0;c<r;c++)s(c)}))}function jb(e,t,n,r){return ze(n)&&(r=n,n=void 0),r?jb(e,t,n).pipe(ea((function(e){return Nb(e)?r.apply(void 0,e):r(e)}))):new Y((function(r){nn(e,t,(function(e){1<arguments.length?r.next(Array.prototype.slice.call(arguments)):r.next(e)}),r,n)}))}function nn(e,t,n,r,i){if(e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener){e.addEventListener(t,n,i);var o=function(){return e.removeEventListener(t,n,i)}}else if(e&&"function"==typeof e.on&&"function"==typeof e.off)e.on(t,n),o=function(){return e.off(t,n)};else if(e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener)e.addListener(t,n),o=function(){return e.removeListener(t,n)};else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var a=0,s=e.length;a<s;a++)nn(e[a],t,n,r,i)}r.add(o)}function on(e,t,n){return n?on(e,t).pipe(ea((function(e){return Nb(e)?n.apply(void 0,e):n(e)}))):new Y((function(n){var r=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{var i=e(r)}catch(e){return void n.error(e)}if(ze(t))return function(){return t(r,i)}}))}function Wu(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}try{var i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function Pi(e){return!Nb(e)&&0<=e-parseFloat(e)+1}function pn(e,t){return void 0===e&&(e=0),void 0===t&&(t=id),(!Pi(e)||0>e)&&(e=0),t&&"function"==typeof t.schedule||(t=id),new Y((function(n){return n.add(t.schedule(Xu,e,{subscriber:n,counter:0,period:e})),n}))}function Xu(e){var t=e.subscriber,n=e.counter;e=e.period,t.next(n),this.schedule({subscriber:t,counter:n+1,period:e},e)}function cc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];t=Number.POSITIVE_INFINITY;var n=null,r=e[e.length-1];return fd(r)?(n=e.pop(),1<e.length&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof r&&(t=e.pop()),null===n&&1===e.length&&e[0]instanceof Y?e[0]:Qg(t)(Ff(e,n))}function Qi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return yb;var n=e[0],r=e.slice(1);return 1===e.length&&Nb(n)?Qi.apply(void 0,n):new Y((function(e){var t=function(){return e.add(Qi.apply(void 0,r).subscribe(e))};return Ob(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})}))}function Yu(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription;if(e=e.obj,!r.closed)if(n<t.length){var o=t[n];r.next([o,e[o]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:e}))}else r.complete()}function Zu(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}function zb(e,t){return function(n){return n.lift(new $u(e,t))}}function Da(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!Nb(e[0]))return e[0];e=e[0]}return Ff(e,void 0).lift(new av)}function bv(e){var t=e.start,n=e.index,r=e.subscriber;n>=e.count?r.complete():(r.next(t),r.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}function Kc(e,t,n){void 0===e&&(e=0);var r=-1;return Pi(t)?r=1>Number(t)?1:Number(t):fd(t)&&(n=t),fd(n)||(n=id),new Y((function(t){var i=Pi(e)?e:+e-n.now();return n.schedule(cv,i,{index:0,period:r,subscriber:t})}))}function cv(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function Ri(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"function"==typeof(t=e[e.length-1])&&e.pop(),Ff(e,void 0).lift(new dv(t))}function Ja(e){return function(t){var n=new ev(e);return t=t.lift(n),n.caught=t}}function Si(e,t){return fb(e,t,1)}function qn(e){return void 0===e&&(e=null),function(t){return t.lift(new fv(e))}}function jd(e,t){void 0===t&&(t=id);var n=e instanceof Date&&!isNaN(+e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new gv(n,t))}}function rn(e,t){return function(n){return n.lift(new hv(e,t))}}function Md(e){return void 0===e&&(e=iv),function(t){return t.lift(new jv(e))}}function iv(){return new Sg}function Pa(e){return function(t){return 0===e?Ef():t.lift(new kv(e))}}function sn(e,t){return t?function(n){return n.pipe(sn((function(n,r){return Ob(e(n,r)).pipe(ea((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new lv(e))}}function Tg(e){return function(t){return t.lift(new mv(e))}}function aa(e,t){var n=2<=arguments.length;return function(r){return r.pipe(e?zb((function(t,n){return e(t,n,r)})):ed,Pa(1),n?qn(t):Md((function(){return new Sg})))}}function nv(){return function(e){return e.lift(new ov)}}function tn(e){return function(t){return 0===e?Ef():t.lift(new pv(e))}}function If(e){return function(t){return t.lift(new qv(e))}}function Ug(e,t){var n=!1;return 2<=arguments.length&&(n=!0),function(r){return r.lift(new rv(e,t,n))}}function un(e,t){return 2<=arguments.length?function(n){return Li(Ug(e,t),tn(1),qn(t))(n)}:function(t){return Li(Ug((function(t,n,r){return e(t,n,r+1)})),tn(1))(t)}}function sv(e,t){return function(n){var r="function"==typeof e?e:function(){return e};if("function"==typeof t)return n.lift(new tv(r,t));var i=Object.create(n,uv);return i.source=n,i.subjectFactory=r,i}}function Ce(e){return function(t){return t.lift(new vv(e,t))}}function wv(){return new Ua}function De(){return function(e){return bn()(sv(wv)(e))}}function vn(e,t,n){var r=e&&"object"===V(e)?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n};return function(e){return e.lift(xv(r))}}function xv(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=void 0===(r=e.windowTime)?Number.POSITIVE_INFINITY:r,a=e.refCount,s=e.scheduler,c=0,u=!1,l=!1;return function(e){if(c++,!t||u){u=!1;var r=(t=new Ee(i,o,s)).subscribe(this);n=e.subscribe({next:function(e){t.next(e)},error:function(e){u=!0,t.error(e)},complete:function(){l=!0,n=void 0,t.complete()}}),l&&(n=void 0)}else r=t.subscribe(this);this.add((function(){c--,r.unsubscribe(),r=void 0,n&&!l&&a&&0===c&&(n.unsubscribe(),t=n=void 0)}))}}function Lc(e,t){return"function"==typeof t?function(n){return n.pipe(Lc((function(n,r){return Ob(e(n,r)).pipe(ea((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new yv(e))}}function rb(e){return function(t){return t.lift(new zv(e))}}function Av(e,t){return void 0===t&&(t=!1),function(n){return n.lift(new Bv(e,t))}}function ba(e,t,n){return function(r){return r.lift(new Cv(e,t,n))}}function Dv(e,t,n){return void 0===t&&(t=id),void 0===n&&(n=Ev),function(r){return r.lift(new Fv(e,t,n.leading,n.trailing))}}function Gv(e){e.subscriber.clearThrottle()}function Hv(e,t,n){return void 0===n&&(n=id),function(r){var i=e instanceof Date&&!isNaN(+e),o=i?+e-n.now():Math.abs(e);return r.lift(new Iv(o,i,t,n))}}function kb(e,t){return void 0===t&&(t=id),Hv(e,Z(new sb),t)}function Jv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;return"function"==typeof e[e.length-1]&&(n=e.pop()),t.lift(new Kv(e,n))}}function wn(e){(Ti||e)&&(xn.abort(),e&&(xn=new AbortController),Ti=e)}function yn(e,t,n,r,i){e!==t&&zn(t,(function(o,a){if(i||(i=new ue),ob(o)){o=i;var s=Ui(e,a),c=Ui(t,a),u=o.get(c);if(u)Vi(e,a,u);else{var l=void 0===(u=r?r(s,c,a+"",e,t,o):void 0);if(l){var d=Za(c),h=!d&&Bf(c),f=!d&&!h&&Gi(c);u=c,d||h||f?Za(s)?u=s:oc(s)&&Nd(s)?u=Bi(s):h?(l=!1,u=Lm(c,!0)):f?(l=!1,u=An(c,!0)):u=[]:Bn(c)||Jf(c)?(u=s,Jf(s)?u=Fe(s,Cf(s)):ob(s)&&!Wi(s)||(u=Mm(c))):l=!1}l&&(o.set(c,u),yn(u,c,n,r,o),o.delete(c)),Vi(e,a,u)}}else void 0===(s=r?r(Ui(e,a),o,a+"",e,t,i):void 0)&&(s=o),Vi(e,a,s)}),Cf)}function Lv(e){var t=1,n=Xi;1==(1>=arguments.length?0:arguments.length-1)?"number"==typeof(1>=arguments.length?void 0:arguments[1])?t=1>=arguments.length?void 0:arguments[1]:n=1>=arguments.length?void 0:arguments[1]:2==(1>=arguments.length?0:arguments.length-1)&&(t=1>=arguments.length?void 0:arguments[1],n=2>=arguments.length?void 0:arguments[2]);var r=t||1;return function(t){return t.pipe(Ug((function(t,i){var o=n.now(),a=o-e;if((t=t.filter((function(e){return e.until>a}))).length>=r){var s=t[t.length-1],c=t[0].until+e*Math.floor(t.length/r);t.push({delay:s.until<o?c-o:c-s.until,until:c,value:i})}else t.push({delay:0,until:o,value:i});return t}),[]),ea((function(e){return e[e.length-1]})),Si((function(e){var t=eb(e.value);return e.delay?t.pipe(jd(e.delay,n)):t})))}}function Mv(e,t){var n=(t=void 0===t?{protocols:Cn,makeWebSocket:Dn}:t).protocols,r=void 0===n?Cn:n,i=void 0===(t=t.makeWebSocket)?Dn:t;return new Y((function(t){var n,o=new Ua,a=i(e,r),s=!1,c=!1,u=!1,l=function(e){if(n)throw s=!0,e=Error("Web socket message factory function called more than once"),t.error(e),e;return n=e.subscribe((function(e){a.send(e)})),o};return a.onopen=function(){u=!0,c?(s=!0,a.close()):t.next(l)},a.onmessage=function(e){o.next(e.data)},a.onerror=function(e){s=!0,t.error(Error(e.message))},a.onclose=function(e){s||(s=!0,c?(t.complete(),o.complete()):t.error(Error(1e3===e.code?"Normal closure":e.reason)))},function(){c=!0,n&&n.unsubscribe(),s||(s=!0,u&&a.close())}}))}function Vg(){this._listeners={}}function En(e){return"undefined"!=typeof Float32Array?function(){function t(e,t,n){o[0]=e,t[n]=a[0],t[n+1]=a[1],t[n+2]=a[2],t[n+3]=a[3]}function n(e,t,n){o[0]=e,t[n]=a[3],t[n+1]=a[2],t[n+2]=a[1],t[n+3]=a[0]}function r(e,t){return a[0]=e[t],a[1]=e[t+1],a[2]=e[t+2],a[3]=e[t+3],o[0]}function i(e,t){return a[3]=e[t],a[2]=e[t+1],a[1]=e[t+2],a[0]=e[t+3],o[0]}var o=new Float32Array([-0]),a=new Uint8Array(o.buffer),s=128===a[3];e.writeFloatLE=s?t:n,e.writeFloatBE=s?n:t,e.readFloatLE=s?r:i,e.readFloatBE=s?i:r}():function(){function t(e,t,n,r){var i=0>t?1:0;if(i&&(t=-t),0===t)e(0<1/t?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(34028234663852886e22<t)e((i<<31|2139095040)>>>0,n,r);else if(11754943508222875e-54>t)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){return n=e(t,n),e=2*(n>>31)+1,t=n>>>23&255,n&=8388607,255===t?n?NaN:1/0*e:0===t?1401298464324817e-60*e*n:e*Math.pow(2,t-150)*(n+8388608)}e.writeFloatLE=t.bind(null,Fn),e.writeFloatBE=t.bind(null,Gn),e.readFloatLE=n.bind(null,Hn),e.readFloatBE=n.bind(null,In)}(),"undefined"!=typeof Float64Array?function(){function t(e,t,n){o[0]=e,t[n]=a[0],t[n+1]=a[1],t[n+2]=a[2],t[n+3]=a[3],t[n+4]=a[4],t[n+5]=a[5],t[n+6]=a[6],t[n+7]=a[7]}function n(e,t,n){o[0]=e,t[n]=a[7],t[n+1]=a[6],t[n+2]=a[5],t[n+3]=a[4],t[n+4]=a[3],t[n+5]=a[2],t[n+6]=a[1],t[n+7]=a[0]}function r(e,t){return a[0]=e[t],a[1]=e[t+1],a[2]=e[t+2],a[3]=e[t+3],a[4]=e[t+4],a[5]=e[t+5],a[6]=e[t+6],a[7]=e[t+7],o[0]}function i(e,t){return a[7]=e[t],a[6]=e[t+1],a[5]=e[t+2],a[4]=e[t+3],a[3]=e[t+4],a[2]=e[t+5],a[1]=e[t+6],a[0]=e[t+7],o[0]}var o=new Float64Array([-0]),a=new Uint8Array(o.buffer),s=128===a[7];e.writeDoubleLE=s?t:n,e.writeDoubleBE=s?n:t,e.readDoubleLE=s?r:i,e.readDoubleBE=s?i:r}():function(){function t(e,t,n,r,i,o){var a=0>r?1:0;if(a&&(r=-r),0===r)e(0,i,o+t),e(0<1/r?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(17976931348623157e292<r)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+n);else if(22250738585072014e-324>r)e((r/=5e-324)>>>0,i,o+t),e((a<<31|r/4294967296)>>>0,i,o+n);else{var s=Math.floor(Math.log(r)/Math.LN2);1024===s&&(s=1023),e(4503599627370496*(r*=Math.pow(2,-s))>>>0,i,o+t),e((a<<31|s+1023<<20|1048576*r&1048575)>>>0,i,o+n)}}function n(e,t,n,r,i){return t=e(r,i+t),r=e(r,i+n),e=2*(r>>31)+1,t=4294967296*(1048575&r)+t,2047==(n=r>>>20&2047)?t?NaN:1/0*e:0===n?5e-324*e*t:e*Math.pow(2,n-1075)*(t+4503599627370496)}e.writeDoubleLE=t.bind(null,Fn,0,4),e.writeDoubleBE=t.bind(null,Gn,4,0),e.readDoubleLE=n.bind(null,Hn,0,4),e.readDoubleBE=n.bind(null,In,4,0)}(),e}function Fn(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function Gn(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function Hn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function In(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function $a(e,t){this.lo=e>>>0,this.hi=t>>>0}function Kf(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function Yi(){}function Nv(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function na(){this.len=0,this.tail=this.head=new Kf(Yi,0,0),this.states=null}function Zi(e,t,n){t[n]=255&e}function $i(e,t){this.len=e,this.next=void 0,this.val=t}function aj(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[n++]=127&e.lo|128,e.lo>>>=7;t[n++]=e.lo}function bj(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function rc(){cj.call(this)}function Ov(e,t,n){40>e.length?W.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}function dc(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Qa(e){this.buf=e,this.pos=0,this.len=e.length}function dj(){var e=new Jn(0,0),t=0;if(!(4<this.len-this.pos)){for(;3>t;++t){if(this.pos>=this.len)throw dc(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;4>t;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(t=0,4<this.len-this.pos){for(;5>t;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>t;++t){if(this.pos>=this.len)throw dc(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function Wg(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Kn(){if(this.pos+8>this.len)throw dc(this,8);return new Jn(Wg(this.buf,this.pos+=4),Wg(this.buf,this.pos+=4))}function Od(e){ej.call(this,e)}function Lf(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");W.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}function Aa(e){return"string"==typeof e&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&"null"!==e}function Ln(e){try{var t=e.split(".").map((function(e){return Number(e)}))}catch(e){return!1}if(4!==t.length||0===t[0])return!1;for(e=0;e<t.length;e++){var n=t[e];if(!Number.isInteger(n)||0>n||255<n)return!1}return!0}function Mn(e,t){if(!Array.isArray(t)||0===t.length||32<t.length||t.some((function(e){return 0===e.length||32<e.length})))throw new H("arguments is not valid",Oa);if(!Aa(e))throw new H("ID is invalid",Oa)}function Mf(e){var t=e.attributes,n=e.attrSizeMap,r=e.maxAttrsCount,i=e.maxAttrValueSize;if(e=e.maxTotalSize,!Hd(t))throw new H("attributes must be an object",Oa);if(Object.keys(t).length>r)throw new lb("Exceed the limit of ".concat(r," attributes"),Ge);if(0===Object.keys(t).length)throw new H("The attributes is an empty object",Oa);var o=0,a=0;for(t=Object.entries(t);a<t.length;a++){var s=ua(t[a],2),c=s[1];s=new Blob([s[0]]).size;var u=new Blob([c]).size;if(0===s||32<s)throw new H("Invalid attribute key",Oa);if(u>i)throw new lb("Invalid attribute value, over the limit of ".concat(i," bytes"),Ge);if("string"!=typeof c||0===c.length)throw new H("Invalid attribute value",Oa);o+=s,o+=u}if(o>e)throw new lb("The attributes size overflow",Ge);if(void 0!==n){if(Object.keys(n).length>r)throw new lb("Exceed the limit of ".concat(r," attributes"),Ge);for(o=r=0,n=Object.entries(n);o<n.length;o++){if(a=(t=ua(n[o],2))[1],0===(t=new Blob([t[0]]).size))throw new H("Invalid attribute key",Oa);if(a>i)throw new lb("Invalid attribute value, over the limit of ".concat(i," bytes"),Ge);r+=t,r+=a}if(r>e)throw new lb("The attributes size overflow",Ge)}}function Xg(e,t){return Math.floor(Math.random()*(Math.floor(t)-Math.ceil(e)+1))+e}function Yg(){var e=Xg(0,4294967295),t=Xg(1,4294967295);return new U(e,t,!0)}function ab(e){return e.toString().padEnd(32,"0")}function Nn(e,t){return new TypeError("Unexpected ".concat(e,": ").concat(t))}function On(e,t){return e=e.split(".").map((function(e){return Number(e)})),t=t.split(".").map((function(e){return Number(e)})),Math.sqrt(1e3*Math.pow(e[0]-t[0],2)+100*Math.pow(e[1]-t[1],2)+10*Math.pow(e[2]-t[2],2)+1*Math.pow(e[3]-t[3],2))}function Pn(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}function fj(e,t){t="".concat(e).concat(t||"");var n=Qn.get(t)||1;return Qn.set(t,n+1),"".concat(e).concat(n)}function Rn(e,t){var n="number"==typeof t?t:void 0!==t&&"string"!=typeof t?t.code:void 0;return t="number"!=typeof t&&"string"!=typeof t&&void 0!==t&&void 0!==t.serverCode?t.serverCode:void 0,n="".concat(void 0!==n?" Error Code ".concat(n):"").concat(void 0!==t?", server Code ".concat(t):""),e="string"==typeof e&&e?Zg(e):Array.isArray(e)&&"string"==typeof e[0]&&e[0]?Zg(Sn.apply(void 0,[e[0]].concat(G(e.slice(1))))):"","".concat(""===n?"":"".concat(n," - ")).concat(e)}function gj(e,t){return hj.apply(this,arguments)}function hj(){return(hj=J(x.mark((function e(t,n){return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||!n.aborted){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){setTimeout(e,t),null==n||n.addEventListener("abort",e)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tn(e){return e instanceof Blob||"[object Blob]"===Object.prototype.toString.call(e)}function $g(e){var t=255&e,n=e>>8&255,r=e>>16&255;return"".concat(e>>24&255,".").concat(r,".").concat(n,".").concat(t)}function He(e,t,n){return ij.apply(this,arguments)}function ij(){return(ij=J(x.mark((function e(t,n,r){var i,o,a,s,c,u,l,d,h,f,p,m,g,v,y,b,_,E,S,w,T,A,R,I,O,C;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.body,o=n.headers,a=void 0===o?{}:o,s=n.timeout,c=void 0===s?1e4:s,u=n.signal,l=n.withCredentials,d=void 0!==l&&l,h=(r||{}).useBinaryResponse,f=void 0!==h&&h,(p=new XMLHttpRequest).open("POST",t,!0),p.responseType=f?"arraybuffer":"text",p.withCredentials=d,p.timeout=c,m=i instanceof FormData,g=i instanceof Uint8Array,!(1<(v=Object.keys(a).filter((function(e){return"content-type"===e.toLowerCase()}))).length)){e.next=14;break}throw new RangeError("multiple content-type");case 14:0===v.length&&(g?a["Content-Type"]="application/octet-stream":m||(a["Content-Type"]="application/json"));case 15:if("setRequestHeader"in p){e.next=46;break}return p.abort(),e.next=19,fetch(t,{body:m||g?i:JSON.stringify(i),cache:"no-cache",credentials:d?"include":"same-origin",headers:a,method:"POST",mode:"cors",referrer:"no-referrer",signal:u});case 19:if(y=e.sent,!(200<=(b=y.status)&&300>b||304===b)){e.next=31;break}if(!f){e.next=27;break}return e.next=25,y.arrayBuffer();case 25:return _=e.sent,e.abrupt("return",{status:b,responseData:_});case 27:return e.next=29,y.text();case 29:return E=e.sent,e.abrupt("return",{status:b,responseText:E});case 31:return S=new da(["Post XHR failure, status %d",b]),e.prev=32,e.next=35,y.text();case 35:throw w=e.sent,S.statusCode=b,S.message=w||"Request failed, status ".concat(b),S;case 41:throw e.prev=41,e.t0=e.catch(32),S.statusCode=b,S.message="Request failed, status ".concat(b),S;case 46:if(0!==Object.keys(a).length)for(T=0,A=Object.entries(a);T<A.length;T++)R=ua(A[T],2),I=R[0],O=R[1],p.setRequestHeader(I,O);return void 0!==u&&(C=function e(){p.abort(),u.removeEventListener("abort",e)},u.addEventListener("abort",C)),m||g?p.send(i):p.send(JSON.stringify(i)),e.abrupt("return",new Promise((function(e,t){p.onload=function(){var n=p.status;if(200<=n&&300>n||304===n)e(f?{status:n,responseData:p.response}:{status:n,responseText:p.responseText});else{var r=new da(["Post XHR failure, status %d",n]);r.statusCode=n,r.message=p.response||"Request failed, status ".concat(p.status),t(r)}},p.ontimeout=function(e){t(new gb(["XHR request timed out after %d ms",c],{originalError:e}))},p.onerror=function(){var e=new da(["Post XHR failure, status %d",p.status]);e.statusCode=p.status,e.message=p.response||"Request failed, status ".concat(p.status),t(e)},p.onabort=function(){try{t(new DOMException("The request aborted.","AbortError"))}catch(n){var e=Error("The request aborted.");e.name="AbortError",t(e)}}})));case 50:case"end":return e.stop()}}),e,null,[[32,41]])})))).apply(this,arguments)}function Un(e){return nj.apply(this,arguments)}function nj(){return(nj=J(x.mark((function e(t){var n;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Image).src=t,e.abrupt("return",new Promise((function(e,t){n.onload=function(){e({width:n.width,height:n.height})},n.onerror=t})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Sv(e,t){return oj.apply(this,arguments)}function oj(){return(oj=J(x.mark((function e(t,n){var r,i,o,a,s,c,u,l,d,h;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.thumbnailHeight,i=void 0===r?0:r,o=t.thumbnailWidth,a=void 0===o?0:o,s=t.width,c=void 0===s?0:s,u=t.height,l=void 0===u?0:u,d=t.thumbnail,h=[],"number"==typeof i&&"number"==typeof a&&"number"==typeof c&&"number"==typeof l){e.next=5;break}throw new H("Invalid message params",Of);case 5:return 0>=c&&0>=l&&h.push(Un(Vn(n)).then((function(e){c=e.width,l=e.height}))),0>=a&&0>=i&&void 0!==d&&h.push(pj(d).then(function(){var e=J(x.mark((function e(t){var n;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Un(Vn(t));case 2:n=e.sent,a=n.width,i=n.height;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),e.next=9,Promise.all(h).catch((function(){}));case 9:return e.abrupt("return",{width:c,height:l,thumbnailWidth:a,thumbnailHeight:i});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wn(e,t){if(!Hd(e))throw new H("message object is not a plain object",t);if(void 0===e.messageType)if(e.rawMessage instanceof Uint8Array){if(e.messageType="RAW",void 0!==e.text)throw new H("Raw messages cannot have text property. Use description instead",t)}else{if("string"!=typeof e.text)throw new H("messageType is undefined",t);if(e.messageType="TEXT",void 0!==e.rawMessage)throw new H("Text messages cannot have rawMessage property",t)}}function dh(e){return qj.apply(this,arguments)}function qj(){return(qj=J(x.mark((function e(t){var n,r,i,o,a,s,c,u,l,d,h,f,p,m,g,v,y,b,_,E,S;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.message,r=t.peerId,i=t.toPeer,o=t.session,a=t.errorCodes,s=t.diff,c=t.logger,u=t.options,void 0!==o){e.next=3;break}throw new L("The client is not logged in. Cannot do the operation",a.NOT_LOGGED_IN);case 3:if(l=!1,"TEXT"!==n.messageType||!n.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!i){e.next=11;break}if(d=n.text.split("_"),h=ua(d,3),f=h[0],p=h[1],void 0!==h[2]&&Aa(p)&&"AgoraRTMLegacyEndcallCompatibleMessagePrefix"===f){e.next=10;break}throw new H("Message is not valid",Ie);case 10:l=!0;case 11:if(m=Date.now(),g=o.messageSentTimes.length-1,!((v=o.messageSentTimes[g])&&v+3e3<m)){e.next=18;break}o.messageSentTimes=[m],e.next=29;break;case 18:y=g;case 19:if(!(0<=y)){e.next=28;break}if(!(o.messageSentTimes[y]+3e3<m)){e.next=23;break}return o.messageSentTimes=o.messageSentTimes.slice(y+1,g+1),e.abrupt("break",28);case 23:if(!(180<=g-y+1)){e.next=25;break}throw new lb("Message sent failed, exceeded the 180 message in 3 seconds",a.TOO_OFTEN);case 25:y--,e.next=19;break;case 28:o.messageSentTimes.push(m);case 29:e.t0=n.messageType,e.next="TEXT"===e.t0?32:"RAW"===e.t0?37:"FILE"===e.t0||"IMAGE"===e.t0?39:40;break;case 32:if(!l){e.next=36;break}return b=n.text.split("_"),_=ua(b,3),E=_[1],S=_[2],c.info("[rtm-API] EndCall message send api is called"),e.abrupt("return",o.sendInvitationMessage({peerId:r,type:"CallCancel",extra:S,channelId:E,callId:"0"}));case 36:return e.abrupt("return",o.sendTextMessage(n.text,r,i,u,1e4-s));case 37:return void 0===n.description&&(n.description=""),e.abrupt("return",o.sendRawMessage(n.rawMessage,n.description,r,i,u,1e4-s));case 39:return e.abrupt("return",o.sendMediaMessage(n.messageType,n,r,i,u,1e4-s));case 40:throw new H("Invalid message type",Ie);case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tv(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=e.replace(/(https?:\/\/)?(www.)?/i,"");return t||(n=n.split(".").slice(e.length-2).join(".")),-1!==n.indexOf("/")?n.split("/")[0]:n}function pa(e){if("string"!=typeof e)return"[Sensitive Info]";var t=Math.floor(.7*e.length),n=e.length;return Xn(e,t,n,"*".repeat(n-t))}function Yn(e,t,n){function r(i){if(void 0===e)return e;if(Km(i))return i;if(Array.isArray(i))return i.map(r);var o={},a=0;for(i=eh(i);a<i.length;a++){var s=ua(i[a],2),c=s[0];if("string"==typeof(s=s[1])&&n.includes(c)){o[c]="string"==typeof s?pa(s):"[Sensitive Info]";break}t.includes(c)?o[c]="[Hidden Info]":o[c]=null==s?s:n.includes(c)?"[Sensitive Info]":r(s)}return o}return Array.isArray(e)?e.map(r):r(e)}function Zn(e){return Object.getOwnPropertyNames(e).forEach((function(t){"object"==V(t=e[t])&&null!==t&&Zn(t)})),Object.freeze(e)}function ra(e){return new TextDecoder("utf-8").decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function fh(e){return(new TextEncoder).encode(e).length}function $n(){for(var e=0,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e+=n[t].length;for(e=new Uint8Array(e),r=t=0;r<n.length;r++){var i=n[r];e.set(i,t),t+=i.length}return e}function Je(e,t,n){var r=e.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e=null==r?void 0:r[1],r=null==r?void 0:r[2]){var i;for(r=r.substr(1).split("&"),i=0;i<r.length;i++)if(r[i].split("=")[0]==t){r[i]=t+"="+encodeURIComponent(n);break}return i==r.length&&r.push(t+"="+encodeURIComponent(n)),e+"?"+r.join("&")}return e+"?"+t+"="+encodeURIComponent(n)}function pj(e){return new Promise((function(t,n){var r=new FileReader;r.onloadend=function(){var e=r.result||new ArrayBuffer(0);t(e)},r.onerror=n,r.readAsArrayBuffer(e)}))}function Uv(e,t){e=e=[e],"string"==typeof(t=t||{})&&(t={type:t});try{var n=new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder);for(var r=0;r<e.length;r+=1)n.append(e[r]);n=n.getBlob(t.type)}return n}function Xn(e,t,n,r){return"string"!=typeof e?"[Sensitive Info]":e.substring(0,t)+r+e.substring(n)}function Pd(e){return"string"==typeof e&&0!==e.length&&"false"!==e&&"null"!==e&&"undefined"!==e}function ao(e){var t=[];return function e(n){if(null===n||"object"!==V(n))return n;if(-1!==t.indexOf(n))return"[Circular]";if(t.push(n),"function"==typeof n.toJSON)try{var r=e(n.toJSON());return t.pop(),r}catch(e){return"[Throws: "+(e?e.message:"?")+"]"}return Array.isArray(n)?(r=n.map(e),t.pop(),r):(r=Object.keys(n).reduce((function(t,r){e:{if(Vv.call(n,r))try{var i=n[r];break e}catch(e){i="[Throws: "+(e?e.message:"?")+"]";break e}i=n[r]}return t[r]=e(i),t}),{}),t.pop(),r)}(e)}function Wv(e){if(!(100<(e=String(e)).length)&&(e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e))){var t=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*t;case"weeks":case"week":case"w":return 6048e5*t;case"days":case"day":case"d":return 864e5*t;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*t;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*t;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t}}}function gh(e,t,n,r){return Math.round(e/n)+" "+r+(t>=1.5*n?"s":"")}function Xv(e){var t=e.areas,n=e.excludedArea;if(1===t.length&&t[0]===D.GLOBAL&&n===D.CHINA)return Ke([D.OVERSEA]);if(t.includes(D.GLOBAL)){if(e=Pf(hh).filter((function(e){return e!==D.GLOBAL&&e!==D.OVERSEA})),n in Qf){t=Qf[n];var r=[].concat(G(null!=t?t:[]),[n]);return Ke(e.filter((function(e){return!r.includes(e)})))}if(bo(n)){var i=Yv(n);return Ke(e.filter((function(e){return e!==n&&e!==i})))}}if(bo(n)||n in Qf)return Ke(t);throw new H("Invalid excludedArea area config")}function Ra(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(G(i.map(Le))));try{var a=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(G(i.map(Le)))),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var s=Date.now();return J(x.mark((function n(){var r,o;return x.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,a;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(G(i.map(Le)))),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==a?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-s):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-s,Le(r)):"Object"!==Jc(r)||Hd(r)?e.resultTracker("%s result is %o",t,Le(r)):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),a},n}function Qb(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(i));try{var a=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var s=Date.now();return J(x.mark((function n(){var r,o;return x.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,a;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==a?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-s):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-s,r):"Object"!==Jc(r)||Hd(r)?e.resultTracker("%s result is %o",t,r):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),a},n}function Zv(e,t){var n="".concat(e,"Uri");if("number"!=typeof(n=rj[n])||0===n)throw new TypeError("Got Unknown URI Name");return t=new(e=co[e])(t),t=e.encode(t).finish(),new $v({uri:n,data:t})}function eo(e,t){var n=Pd(null);return"".concat(e.split(".").join("-"),".edge.").concat(n?null:t?"sd-rtn.com":"agora.io")}function hb(e,t,n){return sj.apply(this,arguments)}function sj(){return(sj=J(x.mark((function e(t,n,r){var i,o,a,s=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=3<s.length&&void 0!==s[3]&&s[3],o=aw[t].encode(n).finish(),a=function(){var e=J(x.mark((function e(n){var s,c,u,l=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(3<(c=1<l.length&&void 0!==l[1]?l[1]:0))){e.next=3;break}return e.abrupt("return");case 3:if(u=Je(u=r?"https://".concat(null!==(s=null==P?void 0:P.PROXY_NGINX[0])&&void 0!==s?s:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(n,"&p=443&d=events/proto-raw"):"https://".concat(n,"/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),u=Je(u,"id",bw[t].toString()),!i){e.next=9;break}return e.next=9,gj(1e4);case 9:return e.next=11,He(u,{body:o,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch((function(e){return a(n,c+1)}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=3,e.next=6,a((null==P?void 0:P.EVENT_REPORT_DOMAIN[0])||Pd(null)&&null||"webcollector-rtm.agora.io");case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),e.next=12,a(P&&fo(1<(null==P?void 0:P.EVENT_REPORT_DOMAIN.length)?null==P?void 0:P.EVENT_REPORT_DOMAIN.slice(1):null==P?void 0:P.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 12:case"end":return e.stop()}}),e,null,[[3,8]])})))).apply(this,arguments)}function ib(e){return void 0===e?U.fromNumber(0):U.fromNumber(Date.now()-e)}function cw(e){return btoa(String.fromCharCode.apply({},e.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map((function(e){return parseInt(e,16)})))).replace(/={1,2}$/,"")}function ih(e,t){return U.fromValue(e).eq(t)}function jh(e,t){var n=void 0===t?e.val:t,r=e.isBoolean;t=e.isNumber;var i=e.oneof,o=e.len;if(2!==[r,t,i].filter((function(e){return!e})).length)throw new TypeError("invalid field type");if(void 0!==n&&(e=!1,void 0!==i&&(i=tj(i),dw(i,ih).length===i.length&&void 0!==ew(i,(function(e){return ih(n,e)}))&&(e=!0)),r=void 0!==r&&(0===n||1===n)&&1===o,t=void 0!==t&&n.toString(2).length<=o,!(e||r||t)))throw Error("invalid field value")}function go(e){return e.reduce((function(e,t){return e.concat(t instanceof kh.UnsubscriptionError?t.errors:t)}),[])}function fw(e,t){do{2147483647==Rf?Rf=0:Rf++}while(Me.hasOwnProperty(Rf));var n=Rf;return Me[n]={callback:e,parameters:Array.prototype.slice.call(arguments,2)},uj.postMessage({name:"setInterval",fakeId:n,time:t}),n}function ho(e){return function(){var t=e();if(!t)throw new L("Client is not logged in. Cannot do the operation");return t}}var Ka="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},lh=function(e){return e&&e.Math==Math&&e},C=lh("object"==typeof globalThis&&globalThis)||lh("object"==typeof window&&window)||lh("object"==typeof self&&self)||lh("object"==typeof Ka&&Ka)||function(){return this}()||Function("return this")(),R=function(e){try{return!!e()}catch(e){return!0}},fa=!R((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),io={}.propertyIsEnumerable,jo=Object.getOwnPropertyDescriptor,Sf=jo&&!io.call({1:2},1)?function(e){return!!(e=jo(this,e))&&e.enumerable}:io,sc=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},gw={}.toString,ec=function(e){return gw.call(e).slice(8,-1)},hw="".split,Tf=R((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==ec(e)?hw.call(e,""):Object(e)}:Object,mb=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},tb=function(e){return Tf(mb(e))},ha=function(e){return"object"==typeof e?null!==e:"function"==typeof e},tc=function(e,t){if(!ha(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!ha(r=n.call(e))||"function"==typeof(n=e.valueOf)&&!ha(r=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!ha(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},Va=function(e){return Object(mb(e))},iw={}.hasOwnProperty,Q=function(e,t){return iw.call(Va(e),t)},Ne=C.document,mh=ha(Ne)&&ha(Ne.createElement),ko=!fa&&!R((function(){return 7!=Object.defineProperty(mh?Ne.createElement("div"):{},"a",{get:function(){return 7}}).a})),lo=Object.getOwnPropertyDescriptor,Jb={f:fa?lo:function(e,t){if(e=tb(e),t=tc(t,!0),ko)try{return lo(e,t)}catch(e){}if(Q(e,t))return sc(!Sf.call(e,t),e[t])}},sa=function(e){if(!ha(e))throw TypeError(String(e)+" is not an object");return e},mo=Object.defineProperty,Wa={f:fa?mo:function(e,t,n){if(sa(e),t=tc(t,!0),sa(n),ko)try{return mo(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},Sa=fa?function(e,t,n){return Wa.f(e,t,sc(1,n))}:function(e,t,n){return e[t]=n,e},vj=function(e,t){try{Sa(C,e,t)}catch(n){C[e]=t}return t},kd=C["__core-js_shared__"]||vj("__core-js_shared__",{}),jw=Function.toString;"function"!=typeof kd.inspectSource&&(kd.inspectSource=function(e){return jw.call(e)});var wj=kd.inspectSource,no=C.WeakMap,kw="function"==typeof no&&/native code/.test(wj(no)),ld=cb((function(e){(e.exports=function(e,t){return kd[e]||(kd[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:" 2021 Denis Pushkarev (zloirock.ru)"})})),lw=0,mw=Math.random(),Oe=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++lw+mw).toString(36)},oo=ld("keys"),nh=function(e){return oo[e]||(oo[e]=Oe(e))},Pe={},nw=C.WeakMap;if(kw||kd.state)var Qd=kd.state||(kd.state=new nw),ow=Qd.get,po=Qd.has,pw=Qd.set,xj=function(e,t){if(po.call(Qd,e))throw new TypeError("Object already initialized");return t.facade=e,pw.call(Qd,e,t),t},oh=function(e){return ow.call(Qd,e)||{}},yj=function(e){return po.call(Qd,e)};else{var Qe=nh("state");Pe[Qe]=!0,xj=function(e,t){if(Q(e,Qe))throw new TypeError("Object already initialized");return t.facade=e,Sa(e,Qe,t),t},oh=function(e){return Q(e,Qe)?e[Qe]:{}},yj=function(e){return Q(e,Qe)}}var La={set:xj,get:oh,has:yj,enforce:function(e){return yj(e)?oh(e):xj(e,{})},getterFor:function(e){return function(t){var n;if(!ha(t)||(n=oh(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Ea=cb((function(e){var t=La.get,n=La.enforce,r=String(String).split("String");(e.exports=function(e,t,i,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable;if(o=!!o&&!!o.noTargetGet,"function"==typeof i){"string"!=typeof t||Q(i,"name")||Sa(i,"name",t);var c=n(i);c.source||(c.source=r.join("string"==typeof t?t:""))}e===C?s?e[t]=i:vj(t,i):(a?!o&&e[t]&&(s=!0):delete e[t],s?e[t]=i:Sa(e,t,i))})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||wj(this)}))})),qo=function(e){return"function"==typeof e?e:void 0},Rb=function(e,t){return 2>arguments.length?qo(C[e])||qo(C[e]):C[e]&&C[e][t]||C[e]&&C[e][t]},qw=Math.ceil,rw=Math.floor,fc=function(e){return isNaN(e=+e)?0:(0<e?rw:qw)(e)},sw=Math.min,va=function(e){return 0<e?sw(fc(e),9007199254740991):0},tw=Math.max,uw=Math.min,Ab=function(e,t){return 0>(e=fc(e))?tw(e+t,0):uw(e,t)},ro=function(e){return function(t,n,r){t=tb(t);var i=va(t.length);if(r=Ab(r,i),e&&n!=n){for(;i>r;)if((n=t[r++])!=n)return!0}else for(;i>r;r++)if((e||r in t)&&t[r]===n)return e||r||0;return!e&&-1}},so=ro(!0),zj=ro(!1),to=function(e,t){e=tb(e);var n,r=0,i=[];for(n in e)!Q(Pe,n)&&Q(e,n)&&i.push(n);for(;t.length>r;)Q(e,n=t[r++])&&(~zj(i,n)||i.push(n));return i},ph="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),vw=ph.concat("length","prototype"),Rd={f:Object.getOwnPropertyNames||function(e){return to(e,vw)}},Uf={f:Object.getOwnPropertySymbols},uo=Rb("Reflect","ownKeys")||function(e){var t=Rd.f(sa(e)),n=Uf.f;return n?t.concat(n(e)):t},vo=function(e,t){for(var n=uo(t),r=Wa.f,i=Jb.f,o=0;o<n.length;o++){var a=n[o];Q(e,a)||r(e,a,i(t,a))}},ww=/#|\.prototype\./,uc=function(e,t){return(e=xw[yw(e)])==zw||e!=Aw&&("function"==typeof t?R(t):!!t)},yw=uc.normalize=function(e){return String(e).replace(ww,".").toLowerCase()},xw=uc.data={},Aw=uc.NATIVE="N",zw=uc.POLYFILL="P",Bw=Jb.f,M=function(e,t){var n,r,i,o=e.target,a=e.global,s=e.stat;if(r=a?C:s?C[o]||vj(o,{}):(C[o]||{}).prototype)for(i in t){var c=t[i],u=e.noTargetGet?(n=Bw(r,i))&&n.value:r[i];if(!(n=uc(a?i:o+(s?".":"#")+i,e.forced))&&void 0!==u){if(typeof c==typeof u)continue;vo(c,u)}(e.sham||u&&u.sham)&&Sa(c,"sham",!0);try{Ea(r,i,c,e)}catch(e){}}},Aj=function(){var e=sa(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},vc=R((function(){var e=RegExp("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),Cw=R((function(){var e=RegExp("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),qh=RegExp.prototype.exec,Dw=ld("native-string-replace",String.prototype.replace),wo=qh,Bj=(c=/a/,a=/b*/g,qh.call(c,"a"),qh.call(a,"a"),0!==c.lastIndex||0!==a.lastIndex),xo=vc||Cw,Cj=void 0!==/()??/.exec("")[1],c,a;(Bj||Cj||xo)&&(wo=function(e){var t,n=xo&&this.sticky,r=Aj.call(this),i=this.source,o=0,a=e;if(n){-1===(r=r.replace("y","")).indexOf("g")&&(r+="g"),a=String(e).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&"\n"!==e[this.lastIndex-1])&&(i="(?: "+i+")",a=" "+a,o++);var s=new RegExp("^(?:"+i+")",r)}if(Cj&&(s=new RegExp("^"+i+"$(?!\\s)",r)),Bj)var c=this.lastIndex;var u=qh.call(n?s:this,a);return n?u?(u.input=u.input.slice(o),u[0]=u[0].slice(o),u.index=this.lastIndex,this.lastIndex+=u[0].length):this.lastIndex=0:Bj&&u&&(this.lastIndex=this.global?u.index+u[0].length:c),Cj&&u&&1<u.length&&Dw.call(u[0],s,(function(){for(t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(u[t]=void 0)})),u});var Vf=wo;M({target:"RegExp",proto:!0,forced:/./.exec!==Vf},{exec:Vf});var Re=Rb("navigator","userAgent")||"",yo=C.process,zo=yo&&yo.versions,Ao=zo&&zo.v8;if(Ao)var md=Ao.split("."),Dj=4>md[0]?1:md[0]+md[1];else Re&&(md=Re.match(/Edge\/(\d+)/),(!md||74<=md[1])&&(md=Re.match(/Chrome\/(\d+)/))&&(Dj=md[1]));var nd=Dj&&+Dj,wc=!!Object.getOwnPropertySymbols&&!R((function(){return!String(Symbol())||!Symbol.sham&&nd&&41>nd})),Bo=wc&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Wf=ld("wks"),Xf=C.Symbol,Ew=Bo?Xf:Xf&&Xf.withoutSetter||Oe,qa=function(e){return Q(Wf,e)&&(wc||"string"==typeof Wf[e])||(wc&&Q(Xf,e)?Wf[e]=Xf[e]:Wf[e]=Ew("Symbol."+e)),Wf[e]},Fw=qa("species"),Ej=RegExp.prototype,Gw=!R((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),Co="$0"==="a".replace(/./,"$0"),Do=qa("replace"),Eo=!!/./[Do]&&""===/./[Do]("a","$0"),Hw=!R((function(){var e=/(?:)/,t=e.exec;return e.exec=function(){return t.apply(this,arguments)},2!==(e="ab".split(e)).length||"a"!==e[0]||"b"!==e[1]})),rh=function(e,t,n,r){var i=qa(e),o=!R((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),a=o&&!R((function(){var t=!1,n=/a/;return"split"===e&&((n={constructor:{}}).constructor[Fw]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!a||"replace"===e&&(!Gw||!Co||Eo)||"split"===e&&!Hw){var s=/./[i],c=(n=n(i,""[e],(function(e,t,n,r,i){var a=t.exec;return a===Vf||a===Ej.exec?o&&!i?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:Co,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Eo}))[1];Ea(String.prototype,e,n[0]),Ea(Ej,i,2==t?function(e,t){return c.call(e,this,t)}:function(e){return c.call(e,this)})}r&&Sa(Ej[i],"sham",!0)},Iw=qa("match"),Fj=function(e){var t;return ha(e)&&(void 0!==(t=e[Iw])?!!t:"RegExp"==ec(e))},Bb=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Jw=qa("species"),od=function(e,t){var n;return void 0===(e=sa(e).constructor)||null==(n=sa(e)[Jw])?t:Bb(n)},Fo=function(e){return function(t,n){t=String(mb(t)),n=fc(n);var r,i=t.length;if(0>n||n>=i)return e?"":void 0;var o=t.charCodeAt(n);return 55296>o||56319<o||n+1===i||56320>(r=t.charCodeAt(n+1))||57343<r?e?t.charAt(n):o:e?t.slice(n,n+2):r-56320+(o-55296<<10)+65536}},Kw=Fo(!1),Go=Fo(!0),Gj=function(e,t,n){return t+(n?Go(e,t).length:1)},Se=function(e,t){var n=e.exec;if("function"==typeof n){if("object"!=typeof(e=n.call(e,t)))throw TypeError("RegExp exec method returned something other than an Object or null");return e}if("RegExp"!==ec(e))throw TypeError("RegExp#exec called on incompatible receiver");return Vf.call(e,t)},Lw=[].push,Mw=Math.min;rh("split",2,(function(e,t,n){var r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(e,n){var r=String(mb(this));if(0==(n=void 0===n?4294967295:n>>>0))return[];if(void 0===e)return[r];if(!Fj(e))return t.call(r,e,n);var i,o,a,s=[],c=0;for(e=new RegExp(e.source,(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":"")+"g");(i=Vf.call(e,r))&&!((o=e.lastIndex)>c&&(s.push(r.slice(c,i.index)),1<i.length&&i.index<r.length&&Lw.apply(s,i.slice(1)),a=i[0].length,c=o,s.length>=n));)e.lastIndex===i.index&&e.lastIndex++;return c===r.length?(a||!e.test(""))&&s.push(""):s.push(r.slice(c)),s.length>n?s.slice(0,n):s}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t;return[function(t,n){var i=mb(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var a=sa(e);e=String(this);var s=od(a,RegExp);if(o=a.unicode,a=new s(vc?"^(?:"+a.source+")":a,(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(vc?"g":"y")),0==(i=void 0===i?4294967295:i>>>0))return[];if(0===e.length)return null===Se(a,e)?[e]:[];var c=0,u=0;for(s=[];u<e.length;){a.lastIndex=vc?0:u;var l,d=Se(a,vc?e.slice(u):e);if(null===d||(l=Mw(va(a.lastIndex+(vc?u:0)),e.length))===c)u=Gj(e,u,o);else{if(s.push(e.slice(c,u)),s.length===i)return s;for(c=1;c<=d.length-1;c++)if(s.push(d[c]),s.length===i)return s;u=c=l}}return s.push(e.slice(c)),s}]}),vc);var Nw=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,Ow=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,Hj=function(e){return function(t){return t=String(mb(t)),1&e&&(t=t.replace(Nw,"")),2&e&&(t=t.replace(Ow,"")),t}};Hj(1),Hj(2);var Ij=Hj(3),sh=C.parseInt,Pw=/^[+-]?0[Xx]/,Ho=8!==sh("\t\n\v\f\r \u2028\u2029\ufeff08")||22!==sh("\t\n\v\f\r \u2028\u2029\ufeff0x16")?function(e,t){return e=Ij(String(e)),sh(e,t>>>0||(Pw.test(e)?16:10))}:sh;M({global:!0,forced:parseInt!=Ho},{parseInt:Ho});var pd=function(e,t,n){if(Bb(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},qd=Array.isArray||function(e){return"Array"==ec(e)},Qw=qa("species"),th=function(e,t){if(qd(e)){var n=e.constructor;"function"!=typeof n||n!==Array&&!qd(n.prototype)?ha(n)&&null===(n=n[Qw])&&(n=void 0):n=void 0}return new(void 0===n?Array:n)(0===t?0:t)},Io=[].push,rd=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,l,d){var h=Va(c),f=Tf(h);u=pd(u,l,3),l=va(f.length);var p,m=0;for(d=d||th,c=t?d(c,l):n||a?d(c,0):void 0;l>m;m++)if((s||m in f)&&(p=u(d=f[m],m,h),e))if(t)c[m]=p;else if(p)switch(e){case 3:return!0;case 5:return d;case 6:return m;case 2:Io.call(c,d)}else switch(e){case 4:return!1;case 7:Io.call(c,d)}return o?-1:r||i?i:c}},Sd=rd(0),Jo=rd(1),Ko=rd(2),Rw=rd(3),Sw=rd(4),Lo=rd(5),Mo=rd(6);rd(7);var Tw=qa("species"),Yf=function(e){return 51<=nd||!R((function(){var t=[];return(t.constructor={})[Tw]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Uw=Yf("filter");M({target:"Array",proto:!0,forced:!Uw},{filter:function(e){return Ko(this,e,1<arguments.length?arguments[1]:void 0)}});var Mc=Object.keys||function(e){return to(e,ph)},Vw=R((function(){Mc(1)}));M({target:"Object",stat:!0,forced:Vw},{keys:function(e){return Mc(Va(e))}});var Te=function(e,t){var n=[][e];return!!n&&R((function(){n.call(null,t||function(){throw 1},1)}))},Ww=[].join,Xw=Tf!=Object,Yw=Te("join",",");M({target:"Array",proto:!0,forced:Xw||!Yw},{join:function(e){return Ww.call(tb(this),void 0===e?",":e)}});var Zw=Yf("map");M({target:"Array",proto:!0,forced:!Zw},{map:function(e){return Jo(this,e,1<arguments.length?arguments[1]:void 0)}});var Jj=function(e){var t=e.return;if(void 0!==t)return sa(t.call(e)).value},Ue={},$w=qa("iterator"),ax=Array.prototype,Kj=function(e){return void 0!==e&&(Ue.Array===e||ax[$w]===e)},Ve=function(e,t,n){(t=tc(t))in e?Wa.f(e,t,sc(0,n)):e[t]=n},bx=qa("toStringTag"),No={};No[bx]="z";var Lj="[object z]"===String(No),cx=qa("toStringTag"),dx="Arguments"==ec(function(){return arguments}()),We=Lj?ec:function(e){var t;if(void 0===e)var n="Undefined";else{if(null===e)var r="Null";else{e:{var i=e=Object(e);try{r=i[cx];break e}catch(e){}r=void 0}r="string"==typeof(n=r)?n:dx?ec(e):"Object"==(t=ec(e))&&"function"==typeof e.callee?"Arguments":t}n=r}return n},ex=qa("iterator"),Zf=function(e){if(null!=e)return e[ex]||e["@@iterator"]||Ue[We(e)]},Td=function(e){var t,n=Va(e),r="function"==typeof this?this:Array,i=arguments.length,o=1<i?arguments[1]:void 0,a=void 0!==o,s=Zf(n),c=0;if(a&&(o=pd(o,2<i?arguments[2]:void 0,2)),null==s||r==Array&&Kj(s)){var u=va(n.length);for(r=new r(u);u>c;c++)s=a?o(n[c],c):n[c],Ve(r,c,s)}else for(i=(n=s.call(n)).next,r=new r;!(t=i.call(n)).done;c++){if(a){s=n;var l=o;t=[t.value,c];try{u=l(sa(t)[0],t[1])}catch(e){throw Jj(s),e}}else u=t.value;Ve(r,c,s=u)}return r.length=c,r},Oo=qa("iterator"),Po=!1;try{var fx=0,Qo={next:function(){return{done:!!fx++}},return:function(){Po=!0}};Qo[Oo]=function(){return this},Array.from(Qo,(function(){throw 2}))}catch(c){}var uh=function(e,t){if(!t&&!Po)return!1;var n=!1;try{(t={})[Oo]=function(){return{next:function(){return{done:n=!0}}}},e(t)}catch(e){}return n},gx=!uh((function(e){Array.from(e)}));M({target:"Array",stat:!0,forced:gx},{from:Td});var Ro=!R((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),So=nh("IE_PROTO"),hx=Object.prototype,ac=Ro?Object.getPrototypeOf:function(e){return e=Va(e),Q(e,So)?e[So]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?hx:null},Mj=qa("iterator"),To=!1,ix=function(){return this},Ud;if([].keys){var Uo=[].keys();if("next"in Uo){var Vo=ac(ac(Uo));Vo!==Object.prototype&&(Ud=Vo)}else To=!0}(null==Ud||R((function(){var e={};return Ud[Mj].call(e)!==e})))&&(Ud={}),Q(Ud,Mj)||Sa(Ud,Mj,ix);var vh=Ud,wh=To,Wo=fa?Object.defineProperties:function(e,t){sa(e);for(var n,r=Mc(t),i=r.length,o=0;i>o;)Wa.f(e,n=r[o++],t[n]);return e},Nj=Rb("document","documentElement"),Xo=nh("IE_PROTO"),Oj=function(){},Pj,xh=function(){try{Pj=document.domain&&new ActiveXObject("htmlfile")}catch(e){}if(Pj){var e=Pj;e.write("<script><\/script>"),e.close(),e=e.parentWindow.Object}else(e=mh?Ne.createElement("iframe"):{}).style.display="none",Nj.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),e=e.F;for(xh=e,e=ph.length;e--;)delete xh.prototype[ph[e]];return xh()};Pe[Xo]=!0;var Sb=Object.create||function(e,t){if(null!==e){Oj.prototype=sa(e);var n=new Oj;Oj.prototype=null,n[Xo]=e}else n=xh();return void 0===t?n:Wo(n,t)},jx=Wa.f,Yo=qa("toStringTag"),gc=function(e,t,n){e&&!Q(e=n?e:e.prototype,Yo)&&jx(e,Yo,{configurable:!0,value:t})},kx=function(){return this},Zo=function(e,t,n){return t+=" Iterator",e.prototype=Sb(vh,{next:sc(1,n)}),gc(e,t,!1),Ue[t]=kx,e},Ya=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,t={};try{var n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;n.call(t,[]),e=t instanceof Array}catch(e){}return function(t,r){if(sa(t),!ha(r)&&null!==r)throw TypeError("Can't set "+String(r)+" as a prototype");return e?n.call(t,r):t.__proto__=r,t}}():void 0),$f=qa("iterator"),lx=function(){return this},Qj=function(e,t,n,r,i,o,a){Zo(n,t,r),r=function(e){if(e===i&&h)return h;if(!wh&&e in l)return l[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}};var s,c=t+" Iterator",u=!1,l=e.prototype,d=l[$f]||l["@@iterator"]||i&&l[i],h=!wh&&d||r(i),f="Array"==t&&l.entries||d;if(f&&(e=ac(f.call(new e)),vh!==Object.prototype&&e.next&&(ac(e)!==vh&&(Ya?Ya(e,vh):"function"!=typeof e[$f]&&Sa(e,$f,lx)),gc(e,c,!0))),"values"==i&&d&&"values"!==d.name&&(u=!0,h=function(){return d.call(this)}),l[$f]!==h&&Sa(l,$f,h),Ue[t]=h,i){var p={values:r("values"),keys:o?h:r("keys"),entries:r("entries")};if(a)for(s in p)!wh&&!u&&s in l||Ea(l,s,p[s]);else M({target:t,proto:!0,forced:wh||u},p)}return p},mx=La.set,nx=La.getterFor("String Iterator");Qj(String,"String",(function(e){mx(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e=nx(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(t=Go(t,n),e.index+=t.length,{value:t,done:!1})}));var Rj=qa("unscopables"),Sj=Array.prototype;null==Sj[Rj]&&Wa.f(Sj,Rj,{configurable:!0,value:Sb(null)});var Vd=function(e){Sj[Rj][e]=!0},$o=!0;"find"in[]&&Array(1).find((function(){$o=!1})),M({target:"Array",proto:!0,forced:$o},{find:function(e){return Lo(this,e,1<arguments.length?arguments[1]:void 0)}}),Vd("find");var ap=function(e){var t=String(mb(this)),n="";if(0>(e=fc(e))||1/0==e)throw RangeError("Wrong number of repetitions");for(;0<e;(e>>>=1)&&(t+=t))1&e&&(n+=t);return n};M({target:"String",proto:!0},{repeat:ap});var bp=[].indexOf,cp=!!bp&&0>1/[1].indexOf(1,-0),ox=Te("indexOf");M({target:"Array",proto:!0,forced:cp||!ox},{indexOf:function(e){return cp?bp.apply(this,arguments)||0:zj(this,e,1<arguments.length?arguments[1]:void 0)}});var iu=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,ju=/CrOS/,ku=/android|ipad|playbook|silk/i;pe.isMobile=pe,pe.default=pe,M({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),M({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),C.Number.isNaN;var px=Lj?{}.toString:function(){return"[object "+We(this)+"]"};Lj||Ea(Object.prototype,"toString",px,{unsafe:!0});var Nc=C.Promise,Xe=function(e,t,n){for(var r in t)Ea(e,r,t[r],n);return e},dp=qa("species"),ag=function(e){e=Rb(e);var t=Wa.f;fa&&e&&!e[dp]&&t(e,dp,{configurable:!0,get:function(){return this}})},hc=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},bg=function(e,t){this.stopped=e,this.result=t},yh=function(e,t,n){var r,i=!(!n||!n.AS_ENTRIES),o=!(!n||!n.IS_ITERATOR),a=!(!n||!n.INTERRUPTED),s=pd(t,n&&n.that,1+i+a),c=function(e){return u&&Jj(u),new bg(!0,e)};if(t=function(e){return i?(sa(e),a?s(e[0],e[1],c):s(e[0],e[1])):a?s(e,c):s(e)},o)var u=e;else{if("function"!=typeof(o=Zf(e)))throw TypeError("Target is not iterable");if(Kj(o)){for(o=0,n=va(e.length);n>o;o++)if((r=t(e[o]))&&r instanceof bg)return r;return new bg(!1)}u=o.call(e)}for(e=u.next;!(o=e.call(u)).done;){try{r=t(o.value)}catch(e){throw Jj(u),e}if("object"==typeof r&&r&&r instanceof bg)return r}return new bg(!1)},ep=/(?:iphone|ipod|ipad).*applewebkit/i.test(Re),Oc="process"==ec(C.process),zh=C.location,Tj=C.setImmediate,fp=C.clearImmediate,qx=C.process,gp=C.MessageChannel,Uj=C.Dispatch,Vj=0,cg={},Wj=function(e){if(cg.hasOwnProperty(e)){var t=cg[e];delete cg[e],t()}},Xj=function(e){return function(){Wj(e)}},hp=function(e){Wj(e.data)},ip=function(e){C.postMessage(e+"",zh.protocol+"//"+zh.host)};if(!Tj||!fp)if(Tj=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return cg[++Vj]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},dg(Vj),Vj},fp=function(e){delete cg[e]},Oc)var dg=function(e){qx.nextTick(Xj(e))};else if(Uj&&Uj.now)dg=function(e){Uj.now(Xj(e))};else if(gp&&!ep){var jp=new gp,kp=jp.port2;jp.port1.onmessage=hp,dg=pd(kp.postMessage,kp,1)}else C.addEventListener&&"function"==typeof postMessage&&!C.importScripts&&zh&&"file:"!==zh.protocol&&!R(ip)?(dg=ip,C.addEventListener("message",hp,!1)):dg="onreadystatechange"in(mh?Ne.createElement("script"):{})?function(e){Nj.appendChild(mh?Ne.createElement("script"):{}).onreadystatechange=function(){Nj.removeChild(this),Wj(e)}}:function(e){setTimeout(Xj(e),0)};var Yj=Tj,rx=/web0s(?!.*chrome)/i.test(Re),sx=Jb.f,lp=C.MutationObserver||C.WebKitMutationObserver,mp=C.document,np=C.process,Ah=C.Promise,op=sx(C,"queueMicrotask"),pp=op&&op.value,Wd,eg;if(!pp){var Ch=function(){var e;for(Oc&&(e=np.domain)&&e.exit();Wd;){var t=Wd.fn;Wd=Wd.next;try{t()}catch(e){throw Wd?Bh():eg=void 0,e}}eg=void 0,e&&e.enter()};if(ep||Oc||rx||!lp||!mp)if(Ah&&Ah.resolve){var Zj=Ah.resolve(void 0);Zj.constructor=Ah;var tx=Zj.then,Bh=function(){tx.call(Zj,Ch)}}else Bh=Oc?function(){np.nextTick(Ch)}:function(){Yj.call(C,Ch)};else{var qp=!0,rp=mp.createTextNode("");new lp(Ch).observe(rp,{characterData:!0}),Bh=function(){rp.data=qp=!qp}}}var sp=pp||function(e){e={fn:e,next:void 0},eg&&(eg.next=e),Wd||(Wd=e,Bh()),eg=e},ux=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=Bb(t),this.reject=Bb(n)},ak={f:function(e){return new ux(e)}},bk=function(e,t){return sa(e),ha(t)&&t.constructor===e?t:((0,(e=ak.f(e)).resolve)(t),e.promise)},vx=function(e,t){var n=C.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},ck=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},wx="object"==typeof window,xx=qa("species"),tp=La.get,yx=La.set,zx=La.getterFor("Promise"),Xd=Nc&&Nc.prototype,Cb=Nc,Dh=Xd,up=C.TypeError,dk=C.document,ek=C.process,Ye=ak.f,Ax=Ye,Bx=!!(dk&&dk.createEvent&&C.dispatchEvent),vp="function"==typeof PromiseRejectionEvent,wp=!1,fg=uc("Promise",(function(){var e=wj(Cb)!==String(Cb);if(!e&&66===nd)return!0;if(51<=nd&&/native code/.test(Cb))return!1;var t=new Cb((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(t.constructor={})[xx]=n,!(wp=t.then((function(){}))instanceof n)||!e&&wx&&!vp})),Cx=fg||!uh((function(e){Cb.all(e).catch((function(){}))})),xp=function(e){var t;return!(!ha(e)||"function"!=typeof(t=e.then))&&t},fk=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;sp((function(){for(var r=e.value,i=1==e.state,o=0;n.length>o;){var a,s=n[o++],c=i?s.ok:s.fail,u=s.resolve,l=s.reject,d=s.domain;try{if(c){if(i||(2===e.rejection&&Dx(e),e.rejection=1),!0===c)var h=r;else if(d&&d.enter(),h=c(r),d){d.exit();var f=!0}h===s.promise?l(up("Promise-chain cycle")):(a=xp(h))?a.call(h,u,l):u(h)}else l(r)}catch(e){d&&!f&&d.exit(),l(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&Ex(e)}))}},yp=function(e,t,n){var r;if(Bx){var i=dk.createEvent("Event");i.promise=t,i.reason=n,i.initEvent(e,!1,!0),C.dispatchEvent(i)}else i={promise:t,reason:n};!vp&&(r=C["on"+e])?r(i):"unhandledrejection"===e&&vx("Unhandled promise rejection",n)},Ex=function(e){Yj.call(C,(function(){var t=e.facade,n=e.value;if(1!==e.rejection&&!e.parent){var r=ck((function(){Oc?ek.emit("unhandledRejection",n,t):yp("unhandledrejection",t,n)}));if(e.rejection=Oc||1!==e.rejection&&!e.parent?2:1,r.error)throw r.value}}))},Dx=function(e){Yj.call(C,(function(){var t=e.facade;Oc?ek.emit("rejectionHandled",t):yp("rejectionhandled",t,e.value)}))},Ze=function(e,t,n){return function(r){e(t,r,n)}},$e=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,fk(e,!0))},gk=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw up("Promise can't be resolved itself");var r=xp(t);r?sp((function(){var n={done:!1};try{r.call(t,Ze(gk,n,e),Ze($e,n,e))}catch(t){$e(n,t,e)}})):(e.value=t,e.state=1,fk(e,!1))}catch(t){$e({done:!1},t,e)}}};if(fg){Cb=function(e){hc(this,Cb,"Promise"),Bb(e),hk.call(this);var t=tp(this);try{e(Ze(gk,t),Ze($e,t))}catch(e){$e(t,e)}},Dh=Cb.prototype;var hk=function(e){yx(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};hk.prototype=Xe(Dh,{then:function(e,t){var n=zx(this),r=Ye(od(this,Cb));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Oc?ek.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&fk(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}});var Fx=function(){var e=new hk,t=tp(e);this.promise=e,this.resolve=Ze(gk,t),this.reject=Ze($e,t)};if(ak.f=Ye=function(e){return e===Cb||e===Gx?new Fx(e):Ax(e)},"function"==typeof Nc&&Xd!==Object.prototype){var Hx=Xd.then;wp||(Ea(Xd,"then",(function(e,t){var n=this;return new Cb((function(e,t){Hx.call(n,e,t)})).then(e,t)}),{unsafe:!0}),Ea(Xd,"catch",Dh.catch,{unsafe:!0}));try{delete Xd.constructor}catch(c){}Ya&&Ya(Xd,Dh)}}M({global:!0,wrap:!0,forced:fg},{Promise:Cb}),gc(Cb,"Promise",!1),ag("Promise");var Gx=Rb("Promise");M({target:"Promise",stat:!0,forced:fg},{reject:function(e){var t=Ye(this);return t.reject.call(void 0,e),t.promise}}),M({target:"Promise",stat:!0,forced:fg},{resolve:function(e){return bk(this,e)}}),M({target:"Promise",stat:!0,forced:Cx},{all:function(e){var t=this,n=Ye(t),r=n.resolve,i=n.reject,o=ck((function(){var n=Bb(t.resolve),o=[],a=0,s=1;yh(e,(function(e){var c=a++,u=!1;o.push(void 0),s++,n.call(t,e).then((function(e){u||(u=!0,o[c]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=Ye(t),r=n.reject,i=ck((function(){var i=Bb(t.resolve);yh(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Ix=Math.floor,Jx="".replace,Kx=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Lx=/\$([$&'`]|\d{1,2})/g,Mx=function(e,t,n,r,i,o){var a=n+e.length,s=r.length,c=Lx;return void 0!==i&&(i=Va(i),c=Kx),Jx.call(o,c,(function(o,c){switch(c.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(a);case"<":o=i[c.slice(1,-1)];break;default:var u=+c;if(0===u)return o;if(u>s)return 0===(u=Ix(u/10))?o:u<=s?void 0===r[u-1]?c.charAt(1):r[u-1]+c.charAt(1):o;o=r[u-1]}return void 0===o?"":o}))},Nx=Math.max,Ox=Math.min,Px=function(e){return void 0===e?e:String(e)};rh("replace",2,(function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=r.REPLACE_KEEPS_$0,a=i?"$":"$0";return[function(n,r){var i=mb(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&o||"string"==typeof r&&-1===r.indexOf(a)){var s=n(t,e,this,r);if(s.done)return s.value}var c=sa(e);e=String(this),(s="function"==typeof r)||(r=String(r));var u=c.global;if(u){var l=c.unicode;c.lastIndex=0}for(var d=[];;){var h=Se(c,e);if(null===h)break;if(d.push(h),!u)break;""===String(h[0])&&(c.lastIndex=Gj(e,va(c.lastIndex),l))}for(l="",u=c=0;u<d.length;u++){h=d[u];for(var f=String(h[0]),p=Nx(Ox(fc(h.index),e.length),0),m=[],g=1;g<h.length;g++)m.push(Px(h[g]));h=h.groups,s?(m=[f].concat(m,p,e),void 0!==h&&m.push(h),h=String(r.apply(void 0,m))):h=Mx(f,e,p,m,h,r),p>=c&&(l+=e.slice(c,p)+h,c=p+f.length)}return l+e.slice(c)}]}));var Qx=Yf("slice"),Rx=qa("species"),Sx=[].slice,Tx=Math.max;M({target:"Array",proto:!0,forced:!Qx},{slice:function(e,t){var n=tb(this),r=va(n.length);if(e=Ab(e,r),t=Ab(void 0===t?r:t,r),qd(n)){var i=n.constructor;if("function"!=typeof i||i!==Array&&!qd(i.prototype)?ha(i)&&null===(i=i[Rx])&&(i=void 0):i=void 0,i===Array||void 0===i)return Sx.call(n,e,t)}for(i=new(void 0===i?Array:i)(Tx(t-e,0)),r=0;e<t;e++,r++)e in n&&Ve(i,r,n[e]);return i.length=r,i}});var Ux=La.set,Vx=La.getterFor("Array Iterator"),sd=Qj(Array,"Array",(function(e,t){Ux(this,{type:"Array Iterator",target:tb(e),index:0,kind:t})}),(function(){var e=Vx(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");Ue.Arguments=Ue.Array,Vd("keys"),Vd("values"),Vd("entries");var zp="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,af=function(e){if(void 0===e)return 0;e=fc(e);var t=va(e);if(e!==t)throw RangeError("Wrong length or index");return t},Wx=Math.abs,Pc=Math.pow,Xx=Math.floor,Yx=Math.log,Zx=Math.LN2,ik=function(e){var t=Va(this),n=va(t.length),r=arguments.length,i=Ab(1<r?arguments[1]:void 0,n);for(n=void 0===(r=2<r?arguments[2]:void 0)?n:Ab(r,n);n>i;)t[i++]=e;return t},$x=Rd.f,ay=Wa.f,bf=La.get,Ap=La.set,ic=C.ArrayBuffer,Db=ic,jc=C.DataView,Eh=jc&&jc.prototype,Bp=Object.prototype,Fh=C.RangeError,Cp=function(e,t,n){var r,i=Array(n),o=(1<<(n=8*n-t-1))-1,a=o>>1,s=23===t?Pc(2,-24)-Pc(2,-77):0,c=0>e||0===e&&0>1/e?1:0,u=0;if((e=Wx(e))!=e||1/0===e){e=e!=e?1:0;var l=o}else l=Xx(Yx(e)/Zx),1>e*(r=Pc(2,-l))&&(l--,r*=2),2<=(e=1<=l+a?e+s/r:e+s*Pc(2,1-a))*r&&(l++,r/=2),l+a>=o?(e=0,l=o):1<=l+a?(e=(e*r-1)*Pc(2,t),l+=a):(e=e*Pc(2,a-1)*Pc(2,t),l=0);for(;8<=t;i[u++]=255&e,e/=256,t-=8);for(l=l<<t|e,n+=t;0<n;i[u++]=255&l,l/=256,n-=8);return i[--u]|=128*c,i},Dp=function(e,t){var n=e.length,r=8*n-t-1,i=(1<<r)-1,o=i>>1;r-=7,--n;var a=e[n--],s=127&a;for(a>>=7;0<r;s=256*s+e[n],n--,r-=8);var c=s&(1<<-r)-1;for(s>>=-r,r+=t;0<r;c=256*c+e[n],n--,r-=8);if(0===s)s=1-o;else{if(s===i)return c?NaN:a?-1/0:1/0;c+=Pc(2,t),s-=o}return(a?-1:1)*c*Pc(2,s-t)},Ep=function(e){return[255&e]},Fp=function(e){return[255&e,e>>8&255]},Gp=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Hp=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},by=function(e){return Cp(e,23,4)},cy=function(e){return Cp(e,52,8)},Gh=function(e,t){ay(e.prototype,t,{get:function(){return bf(this)[t]}})},td=function(e,t,n,r){n=af(n);var i=bf(e);if(n+t>i.byteLength)throw Fh("Wrong index");return e=bf(i.buffer).bytes,n+=i.byteOffset,t=e.slice(n,n+t),r?t:t.reverse()},ud=function(e,t,n,r,i,o){n=af(n);var a=bf(e);if(n+t>a.byteLength)throw Fh("Wrong index");for(e=bf(a.buffer).bytes,n+=a.byteOffset,r=r(+i),i=0;i<t;i++)e[n+i]=r[o?i:t-i-1]};if(zp){if(!R((function(){ic(1)}))||!R((function(){new ic(-1)}))||R((function(){return new ic,new ic(1.5),new ic(NaN),"ArrayBuffer"!=ic.name}))){Db=function(e){return hc(this,Db),new ic(af(e))};for(var dy=Db.prototype=ic.prototype,Ip=$x(ic),Jp=0,jk;Ip.length>Jp;)(jk=Ip[Jp++])in Db||Sa(Db,jk,ic[jk]);dy.constructor=Db}Ya&&ac(Eh)!==Bp&&Ya(Eh,Bp);var Hh=new jc(new Db(2)),Kp=Eh.setInt8;Hh.setInt8(0,2147483648),Hh.setInt8(1,2147483649),!Hh.getInt8(0)&&Hh.getInt8(1)||Xe(Eh,{setInt8:function(e,t){Kp.call(this,e,t<<24>>24)},setUint8:function(e,t){Kp.call(this,e,t<<24>>24)}},{unsafe:!0})}else Db=function(e){hc(this,Db,"ArrayBuffer"),e=af(e),Ap(this,{bytes:ik.call(Array(e),0),byteLength:e}),fa||(this.byteLength=e)},jc=function(e,t,n){hc(this,jc,"DataView"),hc(e,Db,"DataView");var r=bf(e).byteLength;if(0>(t=fc(t))||t>r)throw Fh("Wrong offset");if(t+(n=void 0===n?r-t:va(n))>r)throw Fh("Wrong length");Ap(this,{buffer:e,byteLength:n,byteOffset:t}),fa||(this.buffer=e,this.byteLength=n,this.byteOffset=t)},fa&&(Gh(Db,"byteLength"),Gh(jc,"buffer"),Gh(jc,"byteLength"),Gh(jc,"byteOffset")),Xe(jc.prototype,{getInt8:function(e){return td(this,1,e)[0]<<24>>24},getUint8:function(e){return td(this,1,e)[0]},getInt16:function(e){var t=td(this,2,e,1<arguments.length?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=td(this,2,e,1<arguments.length?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Hp(td(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return Hp(td(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return Dp(td(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return Dp(td(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,t){ud(this,1,e,Ep,t)},setUint8:function(e,t){ud(this,1,e,Ep,t)},setInt16:function(e,t){ud(this,2,e,Fp,t,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,t){ud(this,2,e,Fp,t,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,t){ud(this,4,e,Gp,t,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,t){ud(this,4,e,Gp,t,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,t){ud(this,4,e,by,t,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,t){ud(this,8,e,cy,t,2<arguments.length?arguments[2]:void 0)}});gc(Db,"ArrayBuffer"),gc(jc,"DataView");var gg={ArrayBuffer:Db,DataView:jc},kk=gg.ArrayBuffer,Lp=gg.DataView,Mp=kk.prototype.slice,ey=R((function(){return!new kk(2).slice(1,void 0).byteLength}));M({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:ey},{slice:function(e,t){if(void 0!==Mp&&void 0===t)return Mp.call(sa(this),e);var n=sa(this).byteLength;e=Ab(e,n),t=Ab(void 0===t?n:t,n),n=new(od(this,kk))(va(t-e));for(var r=new Lp(this),i=new Lp(n),o=0;e<t;)i.setUint8(o++,r.getUint8(e++));return n}});var fy=Wa.f,Ih=C.Int8Array,lk=Ih&&Ih.prototype,Np=C.Uint8ClampedArray,Op=Np&&Np.prototype,xc=Ih&&ac(Ih),kc=lk&&ac(lk),Pp=Object.prototype,Qp=Pp.isPrototypeOf,Rp=qa("toStringTag"),mk=Oe("TYPED_ARRAY_TAG"),Qc=zp&&!!Ya&&"Opera"!==We(C.opera),Sp=!1,Eb,yc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},gy={BigInt64Array:8,BigUint64Array:8},Jh=function(e){return!!ha(e)&&(e=We(e),Q(yc,e)||Q(gy,e))};for(Eb in yc)C[Eb]||(Qc=!1);if((!Qc||"function"!=typeof xc||xc===Function.prototype)&&(xc=function(){throw TypeError("Incorrect invocation")},Qc))for(Eb in yc)C[Eb]&&Ya(C[Eb],xc);if((!Qc||!kc||kc===Pp)&&(kc=xc.prototype,Qc))for(Eb in yc)C[Eb]&&Ya(C[Eb].prototype,kc);if(Qc&&ac(Op)!==kc&&Ya(Op,kc),fa&&!Q(kc,Rp))for(Eb in Sp=!0,fy(kc,Rp,{get:function(){return ha(this)?this[mk]:void 0}}),yc)C[Eb]&&Sa(C[Eb],mk,Eb);var hg=Qc,Tp=Sp&&mk,Fa=function(e){if(Jh(e))return e;throw TypeError("Target is not a typed array")},cf=function(e){if(Ya){if(Qp.call(xc,e))return e}else for(var t in yc)if(Q(yc,Eb)){var n=C[t];if(n&&(e===n||Qp.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},Ba=function(e,t,n){if(fa){if(n)for(var r in yc){var i=C[r];if(i&&Q(i.prototype,e))try{delete i.prototype[e]}catch(e){}}kc[e]&&!n||Ea(kc,e,n?t:Qc&&lk[e]||t)}},Up=function(e,t,n){var r,i;if(fa){if(Ya){if(n)for(r in yc)if((i=C[r])&&Q(i,e))try{delete i[e]}catch(e){}if(xc[e]&&!n)return;try{return Ea(xc,e,n?t:Qc&&xc[e]||t)}catch(e){}}for(r in yc)!(i=C[r])||i[e]&&!n||Ea(i,e,t)}},Vp=xc,ig=kc,hy=C.ArrayBuffer,Yd=C.Int8Array,nk=!hg||!R((function(){Yd(1)}))||!R((function(){new Yd(-1)}))||!uh((function(e){new Yd,new Yd(null),new Yd(1.5),new Yd(e)}),!0)||R((function(){return 1!==new Yd(new hy(2),1,void 0).length})),Kh=function(e,t){if(0>(e=fc(e)))throw RangeError("The argument can't be less than 0");if(e%t)throw RangeError("Wrong offset");return e},ok=function(e){var t=Va(e),n=arguments.length,r=1<n?arguments[1]:void 0,i=void 0!==r,o=Zf(t);if(null!=o&&!Kj(o)){var a=o.call(t),s=a.next;for(t=[];!(o=s.call(a)).done;)t.push(o.value)}for(i&&2<n&&(r=pd(r,arguments[2],2)),o=va(t.length),a=new(cf(this))(o),n=0;o>n;n++)a[n]=i?r(t[n],n):t[n];return a},Lh=function(e,t,n){var r,i;return Ya&&"function"==typeof(r=t.constructor)&&r!==n&&ha(i=r.prototype)&&i!==n.prototype&&Ya(e,i),e},jg=cb((function(e){var t=Rd.f,n=La.get,r=La.set,i=Wa.f,o=Jb.f,a=Math.round,s=C.RangeError,c=gg.ArrayBuffer,u=gg.DataView,l=function(e,t){var n=0,r=t.length;for(e=new(cf(e))(r);r>n;)e[n]=t[n++];return e},d=function(e,t){i(e,t,{get:function(){return n(this)[t]}})},h=function(e){var t;return e instanceof c||"ArrayBuffer"==(t=We(e))||"SharedArrayBuffer"==t},f=function(e,t){return Jh(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},p=function(e,t){return f(e,t=tc(t,!0))?sc(2,e[t]):o(e,t)},m=function(e,t,n){return!(f(e,t=tc(t,!0))&&ha(n)&&Q(n,"value"))||Q(n,"get")||Q(n,"set")||n.configurable||Q(n,"writable")&&!n.writable||Q(n,"enumerable")&&!n.enumerable?i(e,t,n):(e[t]=n.value,e)};fa?(hg||(Jb.f=p,Wa.f=m,d(ig,"buffer"),d(ig,"byteOffset"),d(ig,"byteLength"),d(ig,"length")),M({target:"Object",stat:!0,forced:!hg},{getOwnPropertyDescriptor:p,defineProperty:m}),e.exports=function(e,o,d){var f=e.match(/\d+$/)[0]/8,p=e+(d?"Clamped":"")+"Array",m="get"+e,g="set"+e,v=C[p],y=v;e=y&&y.prototype;var b={},_=function(e,t){i(e,t,{get:function(){var e=n(this);return e.view[m](t*f+e.byteOffset,!0)},set:function(e){var r=n(this);d&&(e=0>(e=a(e))?0:255<e?255:255&e),r.view[g](t*f+r.byteOffset,e,!0)},enumerable:!0})};hg?nk&&(y=o((function(e,t,n,r){return hc(e,y,p),Lh(ha(t)?h(t)?void 0!==r?new v(t,Kh(n,f),r):void 0!==n?new v(t,Kh(n,f)):new v(t):Jh(t)?l(y,t):ok.call(y,t):new v(af(t)),e,y)})),Ya&&Ya(y,Vp),Sd(t(v),(function(e){e in y||Sa(y,e,v[e])})),y.prototype=e):(y=o((function(e,t,n,i){hc(e,y,p);var o=0,a=0;if(ha(t)){if(!h(t))return Jh(t)?l(y,t):ok.call(y,t);var d=t;if(a=Kh(n,f),t=t.byteLength,void 0===i){if(t%f)throw s("Wrong length");if(0>(i=t-a))throw s("Wrong length")}else if((i=va(i)*f)+a>t)throw s("Wrong length");t=i/f}else t=af(t),d=new c(i=t*f);for(r(e,{buffer:d,byteOffset:a,byteLength:i,length:t,view:new u(d)});o<t;)_(e,o++)})),Ya&&Ya(y,Vp),e=y.prototype=Sb(ig)),e.constructor!==y&&Sa(e,"constructor",y),Tp&&Sa(e,Tp,p),b[p]=y,M({global:!0,forced:y!=v,sham:!hg},b),"BYTES_PER_ELEMENT"in y||Sa(y,"BYTES_PER_ELEMENT",f),"BYTES_PER_ELEMENT"in e||Sa(e,"BYTES_PER_ELEMENT",f),ag(p)}):e.exports=function(){}}));jg("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var iy=Math.min,jy=[].copyWithin||function(e,t){var n=Va(this),r=va(n.length),i=Ab(e,r),o=Ab(t,r),a=2<arguments.length?arguments[2]:void 0;for(r=iy((void 0===a?r:Ab(a,r))-o,r-i),a=1,o<i&&i<o+r&&(a=-1,o+=r-1,i+=r-1);0<r--;)o in n?n[i]=n[o]:delete n[i],i+=a,o+=a;return n};Ba("copyWithin",(function(e,t){return jy.call(Fa(this),e,t,2<arguments.length?arguments[2]:void 0)})),Ba("every",(function(e){return Sw(Fa(this),e,1<arguments.length?arguments[1]:void 0)})),Ba("fill",(function(e){return ik.apply(Fa(this),arguments)})),Ba("filter",(function(e){var t=Ko(Fa(this),e,1<arguments.length?arguments[1]:void 0),n=od(this,this.constructor),r=0,i=t.length;for(n=new(cf(n))(i);i>r;)n[r]=t[r++];return n})),Ba("find",(function(e){return Lo(Fa(this),e,1<arguments.length?arguments[1]:void 0)})),Ba("findIndex",(function(e){return Mo(Fa(this),e,1<arguments.length?arguments[1]:void 0)})),Ba("forEach",(function(e){Sd(Fa(this),e,1<arguments.length?arguments[1]:void 0)})),Ba("includes",(function(e){return so(Fa(this),e,1<arguments.length?arguments[1]:void 0)})),Ba("indexOf",(function(e){return zj(Fa(this),e,1<arguments.length?arguments[1]:void 0)}));var Wp=qa("iterator"),Xp=C.Uint8Array,ky=sd.values,ly=sd.keys,my=sd.entries,pk=Xp&&Xp.prototype[Wp],Yp=!!pk&&("values"==pk.name||null==pk.name),Zp=function(){return ky.call(Fa(this))};Ba("entries",(function(){return my.call(Fa(this))})),Ba("keys",(function(){return ly.call(Fa(this))})),Ba("values",Zp,!Yp),Ba(Wp,Zp,!Yp);var ny=[].join;Ba("join",(function(e){return ny.apply(Fa(this),arguments)}));var oy=Math.min,qk=[].lastIndexOf,$p=!!qk&&0>1/[1].lastIndexOf(1,-0),py=Te("lastIndexOf"),qy=$p||!py?function(e){if($p)return qk.apply(this,arguments)||0;var t=tb(this),n=va(t.length),r=n-1;for(1<arguments.length&&(r=oy(r,fc(arguments[1]))),0>r&&(r=n+r);0<=r;r--)if(r in t&&t[r]===e)return r||0;return-1}:qk;Ba("lastIndexOf",(function(e){return qy.apply(Fa(this),arguments)})),Ba("map",(function(e){return Jo(Fa(this),e,1<arguments.length?arguments[1]:void 0,(function(e,t){return new(cf(od(e,e.constructor)))(t)}))}));var aq=function(e){return function(t,n,r,i){Bb(n),t=Va(t);var o=Tf(t),a=va(t.length),s=e?a-1:0,c=e?-1:1;if(2>r)for(;;){if(s in o){i=o[s],s+=c;break}if(s+=c,e?0>s:a<=s)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=s:a>s;s+=c)s in o&&(i=n(i,o[s],s,t));return i}},bq=aq(!1),ry=aq(!0);Ba("reduce",(function(e){return bq(Fa(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)})),Ba("reduceRight",(function(e){return ry(Fa(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)}));var sy=Math.floor;Ba("reverse",(function(){for(var e,t=Fa(this).length,n=sy(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var ty=R((function(){new Int8Array(1).set({})}));Ba("set",(function(e){Fa(this);var t=Kh(1<arguments.length?arguments[1]:void 0,1),n=this.length,r=Va(e),i=va(r.length),o=0;if(i+t>n)throw RangeError("Wrong length");for(;o<i;)this[t+o]=r[o++]}),ty);var uy=[].slice,vy=R((function(){new Int8Array(1).slice()}));Ba("slice",(function(e,t){e=uy.call(Fa(this),e,t);var n=od(this,this.constructor);t=0;var r=e.length;for(n=new(cf(n))(r);r>t;)n[t]=e[t++];return n}),vy),Ba("some",(function(e){return Rw(Fa(this),e,1<arguments.length?arguments[1]:void 0)}));var wy=[].sort;Ba("sort",(function(e){return wy.call(Fa(this),e)})),Ba("subarray",(function(e,t){var n=Fa(this),r=n.length;return e=Ab(e,r),new(od(n,n.constructor))(n.buffer,n.byteOffset+e*n.BYTES_PER_ELEMENT,va((void 0===t?r:Ab(t,r))-e))}));var Mh=C.Int8Array,cq=[].toLocaleString,xy=[].slice,yy=!!Mh&&R((function(){cq.call(new Mh(1))})),zy=R((function(){return[1,2].toLocaleString()!=new Mh([1,2]).toLocaleString()}))||!R((function(){Mh.prototype.toLocaleString.call([1,2])}));Ba("toLocaleString",(function(){return cq.apply(yy?xy.call(Fa(this)):Fa(this),arguments)}),zy);var dq=C.Uint8Array,Ay=dq&&dq.prototype||{},Nh=[].toString,By=[].join;R((function(){Nh.call({})}))&&(Nh=function(){return By.call(this)}),Ba("toString",Nh,Ay.toString!=Nh);var eq=gg.ArrayBuffer;M({global:!0,forced:C.ArrayBuffer!==eq},{ArrayBuffer:eq}),ag("ArrayBuffer");var Cy=Wa.f,rk=Function.prototype,Dy=rk.toString,Ey=/^\s*function ([^ (]*)/;!fa||"name"in rk||Cy(rk,"name",{configurable:!0,get:function(){try{return Dy.call(this).match(Ey)[1]}catch(e){return""}}});var fq=RegExp.prototype,gq=fq.toString,Fy=R((function(){return"/a/b"!=gq.call({source:"a",flags:"b"})})),Gy="toString"!=gq.name;(Fy||Gy)&&Ea(RegExp.prototype,"toString",(function(){var e=sa(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in fq)?Aj.call(e):n)}),{unsafe:!0});var Hy=Yf("splice"),Iy=Math.max,Jy=Math.min;M({target:"Array",proto:!0,forced:!Hy},{splice:function(e,t){var n,r,i=Va(this),o=va(i.length),a=Ab(e,o),s=arguments.length;if(0===s?s=n=0:1===s?(s=0,n=o-a):(s-=2,n=Jy(Iy(fc(t),0),o-a)),9007199254740991<o+s-n)throw TypeError("Maximum allowed length exceeded");var c=th(i,n);for(r=0;r<n;r++){var u=a+r;u in i&&Ve(c,r,i[u])}if(c.length=n,s<n){for(r=a;r<o-n;r++){var l=r+s;(u=r+n)in i?i[l]=i[u]:delete i[l]}for(r=o;r>o-n+s;r--)delete i[r-1]}else if(s>n)for(r=o-n;r>a;r--)l=r+s-1,(u=r+n-1)in i?i[l]=i[u]:delete i[l];for(r=0;r<s;r++)i[r+a]=arguments[r+2];return i.length=o-n+s,c}});var sk={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},tk=qa("iterator"),hq=qa("toStringTag"),uk=sd.values,Oh;for(Oh in sk){var iq=C[Oh],Rc=iq&&iq.prototype;if(Rc){if(Rc[tk]!==uk)try{Sa(Rc,tk,uk)}catch(c){Rc[tk]=uk}if(Rc[hq]||Sa(Rc,hq,Oh),sk[Oh])for(var df in sd)if(Rc[df]!==sd[df])try{Sa(Rc,df,sd[df])}catch(c){Rc[df]=sd[df]}}}var jq=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};rh("search",1,(function(e,t,n){return[function(t){var n=mb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;e=sa(e);var i=String(this);return r=e.lastIndex,jq(r,0)||(e.lastIndex=0),i=Se(e,i),jq(e.lastIndex,r)||(e.lastIndex=r),null===i?-1:i.index}]})),cb((function(e){!function(t,n){e.exports?e.exports=n(t):n(t)}("undefined"!=typeof self?self:Ka,(function(e){function t(e){return btoa(e).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(e){return e=(e+="===").slice(0,-e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))}function r(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function i(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),String.fromCharCode.apply(String,e)}function o(e){var t={name:(e.name||e||"").toUpperCase().replace("V","v")};switch(t.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":e.length&&(t.length=e.length);break;case"HMAC":e.hash&&(t.hash=o(e.hash)),e.length&&(t.length=e.length);break;case"RSAES-PKCS1-v1_5":e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":e.hash&&(t.hash=o(e.hash)),e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return t}function a(e){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[e.name][(e.hash||{}).name||e.length||""]}function s(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&(e=JSON.parse(decodeURIComponent(escape(i(e)))));var t={kty:e.kty,alg:e.alg,ext:e.ext||e.extractable};switch(t.kty){case"oct":t.k=e.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach((function(n){n in e&&(t[n]=e[n])}));break;default:throw new TypeError("Unsupported key type")}return t}function c(e){return e=s(e),_&&(e.extractable=e.ext,delete e.ext),r(unescape(encodeURIComponent(JSON.stringify(e)))).buffer}function u(e){var n=l(e),r=!1;if("1.2.840.113549.1.1.1"!==(2<n.length&&(r=!0,n.shift()),e={ext:!0},n[0][0]))throw new TypeError("Unsupported key type");var o="n e d p q dp dq qi".split(" ");for(n=l(n[1]),r&&n.shift(),r=0;r<n.length;r++)n[r][0]||(n[r]=n[r].subarray(1)),e[o[r]]=t(i(n[r]));return e.kty="RSA",e}function l(e,t){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t||(t={pos:0,end:e.length}),2>t.end-t.pos||t.end>e.length)throw new RangeError("Malformed DER");var n=e[t.pos++],r=e[t.pos++];if(128<=r){if(r&=127,t.end-t.pos<r)throw new RangeError("Malformed DER");for(var o=0;r--;)o<<=8,o|=e[t.pos++];r=o}if(t.end-t.pos<r)throw new RangeError("Malformed DER");switch(n){case 2:n=e.subarray(t.pos,t.pos+=r);break;case 3:if(e[t.pos++])throw Error("Unsupported bit string");r--;case 4:n=new Uint8Array(e.subarray(t.pos,t.pos+=r)).buffer;break;case 5:n=null;break;case 6:if(!((e=btoa(i(e.subarray(t.pos,t.pos+=r))))in S))throw Error("Unsupported OBJECT ID "+e);n=S[e];break;case 48:for(n=[],r=t.pos+r;t.pos<r;)n.push(l(e,t));break;default:throw Error("Unsupported DER tag 0x"+n.toString(16))}return n}function d(e,t){t||(t=[]);var n=t.length+2;if(t.push(0,0),e instanceof Uint8Array)for(var i=2,o=e.length,a=0;a<o;a++)t.push(e[a]);else if(e instanceof ArrayBuffer)for(i=4,o=e.byteLength,e=new Uint8Array(e),a=0;a<o;a++)t.push(e[a]);else if(null===e)i=5,o=0;else if("string"==typeof e&&e in w)for(i=6,o=(e=r(atob(w[e]))).length,a=0;a<o;a++)t.push(e[a]);else if(e instanceof Array){for(a=0;a<e.length;a++)d(e[a],t);i=48,o=t.length-n}else{if(!("object"===V(e)&&3===e.tag&&e.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+e);for(i=3,o=(e=new Uint8Array(e.value)).byteLength,t.push(0),a=0;a<o;a++)t.push(e[a]);o++}if(128<=o){for(a=o,o=4,t.splice(n,0,a>>24&255,a>>16&255,a>>8&255,255&a);1<o&&!(a>>24);)a<<=8,o--;4>o&&t.splice(n,4-o),o|=128}return t.splice(n-2,2,i,o),t}function h(e,t,n,r){Object.defineProperties(this,{_key:{value:e},type:{value:e.type,enumerable:!0},extractable:{value:void 0===n?e.extractable:n,enumerable:!0},algorithm:{value:void 0===t?e.algorithm:t,enumerable:!0},usages:{value:void 0===r?e.usages:r,enumerable:!0}})}function f(e){return"verify"===e||"encrypt"===e||"wrapKey"===e}function p(e){return"sign"===e||"decrypt"===e||"unwrapKey"===e}if("function"!=typeof Promise)throw"Promise support required";var m=e.crypto||e.msCrypto;if(m){var g=m.subtle||m.webkitSubtle;if(g){var v=e.Crypto||m.constructor||Object,y=e.SubtleCrypto||g.constructor||Object;e.CryptoKey||e.Key;var b=-1<e.navigator.userAgent.indexOf("Edge/"),_=!!e.msCrypto&&!b,E=!m.subtle&&!!m.webkitSubtle;if(_||E){var S={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},w={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach((function(e){var t=g[e];g[e]=function(i,l,d){var v=[].slice.call(arguments);switch(e){case"generateKey":var y=o(i),b=l,S=d;break;case"importKey":y=o(d),b=v[3],S=v[4],"jwk"===i&&((l=s(l)).alg||(l.alg=a(y)),l.key_ops||(l.key_ops="oct"!==l.kty?"d"in l?S.filter(p):S.filter(f):S.slice()),v[1]=c(l));break;case"unwrapKey":y=v[4],b=v[5],S=v[6],v[2]=d._key}if("generateKey"===e&&"HMAC"===y.name&&y.hash)return y.length=y.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[y.hash.name],g.importKey("raw",m.getRandomValues(new Uint8Array(y.length+7>>3)),y,b,S);if(E&&"generateKey"===e&&"RSASSA-PKCS1-v1_5"===y.name&&(!y.modulusLength||2048<=y.modulusLength))return(i=o(i)).name="RSAES-PKCS1-v1_5",delete i.hash,g.generateKey(i,!0,["encrypt","decrypt"]).then((function(e){return Promise.all([g.exportKey("jwk",e.publicKey),g.exportKey("jwk",e.privateKey)])})).then((function(e){return e[0].alg=e[1].alg=a(y),e[0].key_ops=S.filter(f),e[1].key_ops=S.filter(p),Promise.all([g.importKey("jwk",e[0],y,!0,e[0].key_ops),g.importKey("jwk",e[1],y,b,e[1].key_ops)])})).then((function(e){return{publicKey:e[0],privateKey:e[1]}}));if((E||_&&"SHA-1"===(y.hash||{}).name)&&"importKey"===e&&"jwk"===i&&"HMAC"===y.name&&"oct"===l.kty)return g.importKey("raw",r(n(l.k)),d,v[3],v[4]);if(E&&"importKey"===e&&("spki"===i||"pkcs8"===i))return g.importKey("jwk",u(l),d,v[3],v[4]);if(_&&"unwrapKey"===e)return g.decrypt(v[3],d,l).then((function(e){return g.importKey(i,e,v[4],v[5],v[6])}));try{var w=t.apply(g,v)}catch(e){return Promise.reject(e)}return _&&(w=new Promise((function(e,t){w.onabort=w.onerror=function(e){t(e)},w.oncomplete=function(t){e(t.target.result)}}))),w=w.then((function(e){return"HMAC"!==y.name||y.length||(y.length=8*e.algorithm.length),0==y.name.search("RSA")&&(y.modulusLength||(y.modulusLength=(e.publicKey||e).algorithm.modulusLength),y.publicExponent||(y.publicExponent=(e.publicKey||e).algorithm.publicExponent)),e.publicKey&&e.privateKey?{publicKey:new h(e.publicKey,y,b,S.filter(f)),privateKey:new h(e.privateKey,y,b,S.filter(p))}:new h(e,y,b,S)}))}})),["exportKey","wrapKey"].forEach((function(e){var o=g[e];g[e]=function(c,u,l){var h=[].slice.call(arguments);switch(e){case"exportKey":h[1]=u._key;break;case"wrapKey":h[1]=u._key,h[2]=l._key}if((E||_&&"SHA-1"===(u.algorithm.hash||{}).name)&&"exportKey"===e&&"jwk"===c&&"HMAC"===u.algorithm.name&&(h[0]="raw"),!E||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(h[0]="jwk"),_&&"wrapKey"===e)return g.exportKey(c,u).then((function(e){return"jwk"===c&&(e=r(unescape(encodeURIComponent(JSON.stringify(s(e)))))),g.encrypt(h[3],l,e)}));try{var m=o.apply(g,h)}catch(e){return Promise.reject(e)}return _&&(m=new Promise((function(e,t){m.onabort=m.onerror=function(e){t(e)},m.oncomplete=function(t){e(t.target.result)}}))),"exportKey"===e&&"jwk"===c&&(m=m.then((function(e){return(E||_&&"SHA-1"===(u.algorithm.hash||{}).name)&&"HMAC"===u.algorithm.name?{kty:"oct",alg:a(u.algorithm),key_ops:u.usages.slice(),ext:!0,k:t(i(e))}:((e=s(e)).alg||(e.alg=a(u.algorithm)),e.key_ops||(e.key_ops="public"===u.type?u.usages.filter(f):"private"===u.type?u.usages.filter(p):u.usages.slice()),e)}))),!E||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(m=m.then((function(e){var t=[["",null]],i=!1;if("RSA"!==(e=s(e)).kty)throw new TypeError("Unsupported key type");for(var o="n e d p q dp dq qi".split(" "),a=[],c=0;c<o.length&&o[c]in e;c++){var u=a[c]=r(n(e[o[c]]));128&u[0]&&(a[c]=new Uint8Array(u.length+1),a[c].set(u,1))}return 2<a.length&&(i=!0,a.unshift(new Uint8Array([0]))),t[0][0]="1.2.840.113549.1.1.1",t.push(new Uint8Array(d(a)).buffer),i?t.unshift(new Uint8Array([0])):t[1]={tag:3,value:t[1]},new Uint8Array(d(t)).buffer}))),m}})),["encrypt","decrypt","sign","verify"].forEach((function(e){var t=g[e];g[e]=function(n,r,i,a){if(_&&(!i.byteLength||a&&!a.byteLength))throw Error("Empty input is not allowed");var s=[].slice.call(arguments),c=o(n);if(!_||"sign"!==e&&"verify"!==e||"RSASSA-PKCS1-v1_5"!==n&&"HMAC"!==n||(s[0]={name:n}),_&&r.algorithm.hash&&(s[0].hash=s[0].hash||r.algorithm.hash),_&&"decrypt"===e&&"AES-GCM"===c.name){var u=n.tagLength>>3;s[2]=(i.buffer||i).slice(0,i.byteLength-u),n.tag=(i.buffer||i).slice(i.byteLength-u)}_&&"AES-GCM"===c.name&&void 0===s[0].tagLength&&(s[0].tagLength=128),s[1]=r._key;try{var l=t.apply(g,s)}catch(e){return Promise.reject(e)}return _&&(l=new Promise((function(t,n){l.onabort=l.onerror=function(e){n(e)},l.oncomplete=function(n){if(n=n.target.result,"encrypt"===e&&n instanceof AesGcmEncryptResult){var r=n.ciphertext,i=n.tag;(n=new Uint8Array(r.byteLength+i.byteLength)).set(new Uint8Array(r),0),n.set(new Uint8Array(i),r.byteLength),n=n.buffer}t(n)}}))),l}})),_){var T=g.digest;g.digest=function(e,t){if(!t.byteLength)throw Error("Empty input is not allowed");try{var n=T.call(g,e,t)}catch(e){return Promise.reject(e)}return n=new Promise((function(e,t){n.onabort=n.onerror=function(e){t(e)},n.oncomplete=function(t){e(t.target.result)}}))},e.crypto=Object.create(m,{getRandomValues:{value:function(e){return m.getRandomValues(e)}},subtle:{value:g}}),e.CryptoKey=h}E&&(m.subtle=g,e.Crypto=v,e.SubtleCrypto=y,e.CryptoKey=h)}}}}))})),function(e){e.console||(e.console={}),e=e.console;for(var t,n=function(){},r=["memory"],i="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");t=r.pop();)e[t]||(e[t]={});for(;t=i.pop();)e[t]||(e[t]=n)}("undefined"==typeof window?Ka:window),M({target:"Object",stat:!0},{setPrototypeOf:Ya});var Ky=R((function(){ac(1)}));M({target:"Object",stat:!0,forced:Ky,sham:!Ro},{getPrototypeOf:function(e){return ac(Va(e))}});var kq=[].slice,vk={},Ly=Function.bind||function(e){var t=Bb(this),n=kq.call(arguments,1),r=function(){var i=n.concat(kq.call(arguments));if(this instanceof r){var o=i.length;if(!(o in vk)){for(var a=[],s=0;s<o;s++)a[s]="a["+s+"]";vk[o]=Function("C,a","return new C("+a.join(",")+")")}i=vk[o](t,i)}else i=t.apply(e,i);return i};return ha(t.prototype)&&(r.prototype=t.prototype),r},wk=Rb("Reflect","construct"),lq=R((function(){function e(){}return!(wk((function(){}),[],e)instanceof e)})),mq=!R((function(){wk((function(){}))})),nq=lq||mq;M({target:"Reflect",stat:!0,forced:nq,sham:nq},{construct:function(e,t){Bb(e),sa(t);var n=3>arguments.length?e:Bb(arguments[2]);if(mq&&!lq)return wk(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}return(n=[null]).push.apply(n,t),new(Ly.apply(e,n))}n=n.prototype,n=Sb(ha(n)?n:Object.prototype);var r=Function.apply.call(e,n,t);return ha(r)?r:n}}),M({target:"Reflect",stat:!0},{get:ym});var oq=Jb.f,My=R((function(){oq(1)}));M({target:"Object",stat:!0,forced:!fa||My,sham:!fa},{getOwnPropertyDescriptor:function(e,t){return oq(tb(e),t)}});var pq=Rd.f,Ny={}.toString,qq="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],xk=function(e){if(qq&&"[object Window]"==Ny.call(e))try{var t=pq(e)}catch(e){t=qq.slice()}else t=pq(tb(e));return t},rq={f:qa},Oy=Wa.f,Ph=function(e){var t=C.Symbol||(C.Symbol={});Q(t,e)||Oy(t,e,{value:rq.f(e)})},ub=nh("hidden"),sq=qa("toPrimitive"),Py=La.set,tq=La.getterFor("Symbol"),Tb=Object.prototype,vb=C.Symbol,kg=Rb("JSON","stringify"),uq=Jb.f,vd=Wa.f,vq=xk,Qy=Sf,Sc=ld("symbols"),lg=ld("op-symbols"),yk=ld("string-to-symbol-registry"),zk=ld("symbol-to-string-registry"),Ry=ld("wks"),Ak=C.QObject,Bk=!Ak||!Ak.prototype||!Ak.prototype.findChild,Ck=fa&&R((function(){return 7!=Sb(vd({},"a",{get:function(){return vd(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=uq(Tb,t);r&&delete Tb[t],vd(e,t,n),r&&e!==Tb&&vd(Tb,t,r)}:vd,Dk=function(e,t){var n=Sc[e]=Sb(vb.prototype);return Py(n,{type:"Symbol",tag:e,description:t}),fa||(n.description=t),n},Ek=Bo?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof vb},Qh=function(e,t,n){return e===Tb&&Qh(lg,t,n),sa(e),t=tc(t,!0),sa(n),Q(Sc,t)?(n.enumerable?(Q(e,ub)&&e[ub][t]&&(e[ub][t]=!1),n=Sb(n,{enumerable:sc(0,!1)})):(Q(e,ub)||vd(e,ub,sc(1,{})),e[ub][t]=!0),Ck(e,t,n)):vd(e,t,n)},wq=function(e,t){sa(e);var n=tb(t);return t=Mc(n).concat(Fk(n)),Sd(t,(function(t){fa&&!Gk.call(n,t)||Qh(e,t,n[t])})),e},Gk=function(e){e=tc(e,!0);var t=Qy.call(this,e);return!(this===Tb&&Q(Sc,e)&&!Q(lg,e))&&(!(t||!Q(this,e)||!Q(Sc,e)||Q(this,ub)&&this[ub][e])||t)},xq=function(e,t){if(e=tb(e),t=tc(t,!0),e!==Tb||!Q(Sc,t)||Q(lg,t)){var n=uq(e,t);return!n||!Q(Sc,t)||Q(e,ub)&&e[ub][t]||(n.enumerable=!0),n}},yq=function(e){e=vq(tb(e));var t=[];return Sd(e,(function(e){Q(Sc,e)||Q(Pe,e)||t.push(e)})),t},Fk=function(e){var t=e===Tb;e=vq(t?lg:tb(e));var n=[];return Sd(e,(function(e){!Q(Sc,e)||t&&!Q(Tb,e)||n.push(Sc[e])})),n};if(wc||(vb=function(){if(this instanceof vb)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=Oe(e),n=function(e){this===Tb&&n.call(lg,e),Q(this,ub)&&Q(this[ub],t)&&(this[ub][t]=!1),Ck(this,t,sc(1,e))};return fa&&Bk&&Ck(Tb,t,{configurable:!0,set:n}),Dk(t,e)},Ea(vb.prototype,"toString",(function(){return tq(this).tag})),Ea(vb,"withoutSetter",(function(e){return Dk(Oe(e),e)})),Sf=Gk,Wa.f=Qh,Jb.f=xq,Rd.f=xk=yq,Uf.f=Fk,rq.f=function(e){return Dk(qa(e),e)},fa&&(vd(vb.prototype,"description",{configurable:!0,get:function(){return tq(this).description}}),Ea(Tb,"propertyIsEnumerable",Gk,{unsafe:!0}))),M({global:!0,wrap:!0,forced:!wc,sham:!wc},{Symbol:vb}),Sd(Mc(Ry),(function(e){Ph(e)})),M({target:"Symbol",stat:!0,forced:!wc},{for:function(e){if(e=String(e),Q(yk,e))return yk[e];var t=vb(e);return yk[e]=t,zk[t]=e,t},keyFor:function(e){if(!Ek(e))throw TypeError(e+" is not a symbol");if(Q(zk,e))return zk[e]},useSetter:function(){Bk=!0},useSimple:function(){Bk=!1}}),M({target:"Object",stat:!0,forced:!wc,sham:!fa},{create:function(e,t){return void 0===t?Sb(e):wq(Sb(e),t)},defineProperty:Qh,defineProperties:wq,getOwnPropertyDescriptor:xq}),M({target:"Object",stat:!0,forced:!wc},{getOwnPropertyNames:yq,getOwnPropertySymbols:Fk}),M({target:"Object",stat:!0,forced:R((function(){Uf.f(1)}))},{getOwnPropertySymbols:function(e){return Uf.f(Va(e))}}),kg){var Sy=!wc||R((function(){var e=vb();return"[null]"!=kg([e])||"{}"!=kg({a:e})||"{}"!=kg(Object(e))}));M({target:"JSON",stat:!0,forced:Sy},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(ha(t)||void 0!==e)&&!Ek(e))return qd(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Ek(t))return t}),i[1]=t,kg.apply(null,i)}})}vb.prototype[sq]||Sa(vb.prototype,sq,vb.prototype.valueOf),gc(vb,"Symbol"),Pe[ub]=!0;var Ty=Wa.f,Tc=C.Symbol;if(fa&&"function"==typeof Tc&&(!("description"in Tc.prototype)||void 0!==Tc().description)){var zq={},mg=function(){var e=1>arguments.length||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof mg?new Tc(e):void 0===e?Tc():Tc(e);return""===e&&(zq[t]=!0),t};vo(mg,Tc);var Hk=mg.prototype=Tc.prototype;Hk.constructor=mg;var Uy=Hk.toString,Vy="Symbol(test)"==String(Tc("test")),Wy=/^Symbol\((.*)\)[^)]+$/;Ty(Hk,"description",{configurable:!0,get:function(){var e=ha(this)?this.valueOf():this,t=Uy.call(e);return Q(zq,e)?"":""===(e=Vy?t.slice(7,-1):t.replace(Wy,"$1"))?void 0:e}}),M({global:!0,forced:!0},{Symbol:mg})}Ph("toStringTag"),gc(C.JSON,"JSON",!0),gc(Math,"Math",!0),function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}var c=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n(t,[{key:"addEventListener",value:function(e,t,n){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:n})}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=0,r=(e=this.listeners[e]).length;n<r;n++)if(e[n].callback===t){e.splice(n,1);break}}},{key:"dispatchEvent",value:function(e){if(e.type in this.listeners){for(var t=this.listeners[e.type].slice(),n=0,r=t.length;n<r;n++){var i=t[n];try{i.callback.call(this,e)}catch(e){Promise.resolve().then((function(){throw e}))}i.options&&i.options.once&&this.removeEventListener(e.type,i.callback)}return!e.defaultPrevented}}}]),t}(),u=function(t){function o(){e(this,o);var t=u.call(this);return t.listeners||c.call(a(t)),Object.defineProperty(a(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(a(t),"onabort",{value:null,writable:!0,configurable:!0}),t}r(o,t);var u=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n=i(e);if(t){var r=i(this).constructor;n=Reflect.construct(n,arguments,r)}else n=n.apply(this,arguments);return!n||"object"!==V(n)&&"function"!=typeof n?a(this):n}}(o);return n(o,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),s(i(o.prototype),"dispatchEvent",this).call(this,e)}}]),o}(c),l=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new u,writable:!0,configurable:!0})}return n(t,[{key:"abort",value:function(){try{var e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(l.prototype[Symbol.toStringTag]="AbortController",u.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var t=!0}else t="function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController;t&&(e.AbortController=l,e.AbortSignal=u)}("undefined"!=typeof self?self:Ka)}();var Xy=Math.floor,Yy=Math.log,Zy=Math.LOG2E;M({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-Xy(Yy(e+.5)*Zy):32}});var $y=Math.log,az=Math.LN2,mu=Math.clz32||function(e){return 31-$y(e>>>0)/az|0},Gd=String.fromCharCode,Aq={}.toString,Ik=window.Uint8Array,Jk=Ik||Array,bz=Aq.call((window.ArrayBuffer||Jk).prototype),Kk;zm.prototype.decode=function(e){if(e=e&&e.buffer||e,Aq.call(e)!==bz)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var t="",n=0,r=0|(e=Ik?new Jk(e):e).length;n<r;n=n+32768|0)t+=Gd.apply(0,e[Ik?"slice":"subarray"](n,n+32768|0));return t.replace(/[\xc0-\xff][\x80-\xbf]*/g,lu)},window.TextDecoder||(window.TextDecoder=zm),Am.prototype.encode=function(e){for(var t=0|(e=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,nu)).length,n=new Jk(t),r=0;r<t;r=r+1|0)n[r]=e.charCodeAt(r);return n},window.TextEncoder||(window.TextEncoder=Am),function(e){var t,n,r,i,o,a,s,c,u,l,d;!function(e){e.LOGIN="LOGIN",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.LOGIN_FAILURE="LOGIN_FAILURE",e.LOGIN_TIMEOUT="LOGIN_TIMEOUT",e.INTERRUPTED="INTERRUPTED",e.LOGOUT="LOGOUT",e.BANNED_BY_SERVER="BANNED_BY_SERVER",e.REMOTE_LOGIN="REMOTE_LOGIN"}(t||(t={})),e.ConnectionChangeReason=t,function(e){e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECTING="RECONNECTING",e.ABORTED="ABORTED"}(n||(n={})),e.ConnectionState=n,function(e){e.IDLE="IDLE",e.SENT_TO_REMOTE="SENT_TO_REMOTE",e.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",e.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",e.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(r||(r={})),e.LocalInvitationState=r,function(e){e.INVITATION_RECEIVED="INVITATION_RECEIVED",e.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",e.REFUSED="REFUSED",e.ACCEPTED="ACCEPTED",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(i||(i={})),e.RemoteInvitationState=i,function(e){e.UNKNOWN="UNKNOWN",e.PEER_NO_RESPONSE="PEER_NO_RESPONSE",e.INVITATION_EXPIRE="INVITATION_EXPIRE",e.PEER_OFFLINE="PEER_OFFLINE",e.NOT_LOGGEDIN="NOT_LOGGEDIN"}(o||(o={})),e.LocalInvitationFailureReason=o,function(e){e.UNKNOWN="UNKNOWN",e.PEER_OFFLINE="PEER_OFFLINE",e.ACCEPT_FAILURE="ACCEPT_FAILURE",e.INVITATION_EXPIRE="INVITATION_EXPIRE"}(a||(a={})),e.RemoteInvitationFailureReason=a,function(e){e.ONLINE="ONLINE",e.UNREACHABLE="UNREACHABLE",e.OFFLINE="OFFLINE"}(s||(s={})),e.PeerOnlineState=s,(c||(c={})).ONLINE_STATUS="ONLINE_STATUS",e.PeerSubscriptionOption=c,function(e){e.TEXT="TEXT",e.RAW="RAW",e.IMAGE="IMAGE",e.FILE="FILE"}(u||(u={})),e.MessageType=u,function(e){e.CN="CN",e.NA="NA",e.EU="EU",e.AS="AS",e.JP="JP",e.IN="IN",e.GLOB="GLOB",e.OC="OC",e.SA="SA",e.AF="AF",e.OVS="OVS"}(l||(l={})),e.LegacyAreaCode=l,function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(d||(d={})),e.AreaCode=d}(Kk||(Kk={}));var S=Kk;M({target:"Array",proto:!0},{includes:function(e){return so(this,e,1<arguments.length?arguments[1]:void 0)}}),Vd("includes");var Lk=function(e){if(Fj(e))throw TypeError("The method doesn't accept regular expressions");return e},cz=qa("match"),Mk=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[cz]=!1,"/./"[e](t)}catch(e){}}return!1};M({target:"String",proto:!0,forced:!Mk("includes")},{includes:function(e){return!!~String(mb(this)).indexOf(Lk(e),1<arguments.length?arguments[1]:void 0)}});var lc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0,ENABLE_EDGE_AUTO_FALLBACK:!0};Ph("iterator"),Ph("asyncIterator");var Nk=Te("forEach")?[].forEach:function(e){return Sd(this,e,1<arguments.length?arguments[1]:void 0)},Bq;for(Bq in sk){var Cq=C[Bq],Rh=Cq&&Cq.prototype;if(Rh&&Rh.forEach!==Nk)try{Sa(Rh,"forEach",Nk)}catch(c){Rh.forEach=Nk}}var dz=[].reverse,Dq=[1,2];M({target:"Array",proto:!0,forced:String(Dq)===String(Dq.reverse())},{reverse:function(){return qd(this)&&(this.length=this.length),dz.call(this)}});var x=cb((function(e){e=function(e){function t(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function n(e,t,n,o){return t=Object.create((t&&t.prototype instanceof i?t:i).prototype),o=new h(o||[]),t._invoke=function(e,t,n){var i=S;return function(o,a){if(i===T)throw Error("Generator is already running");if(i===A){if("throw"===o)throw a;return p()}for(n.method=o,n.arg=a;;){if((o=n.delegate)&&(o=u(o,n))){if(o===R)continue;return o}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===S)throw i=A,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);if(i=T,"normal"===(o=r(e,t,n)).type){if(i=n.done?A:w,o.arg===R)continue;return{value:o.arg,done:n.done}}"throw"===o.type&&(i=A,n.method="throw",n.arg=o.arg)}}}(e,n,o),t}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function a(){}function s(e){["next","throw","return"].forEach((function(n){t(e,n,(function(e){return this._invoke(n,e)}))}))}function c(e,t){function n(i,o,a,s){if("throw"!==(i=r(e[i],e,o)).type){var c=i.arg;return(i=c.value)&&"object"===V(i)&&v.call(i,"__await")?t.resolve(i.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(i).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(i.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function u(e,t){var n=e.iterator[t.method];if(n===m){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=m,u(e,t),"throw"===t.method))return R;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return R}return"throw"===(n=r(n,e.iterator,t.arg)).type?(t.method="throw",t.arg=n.arg,t.delegate=null,R):(n=n.arg)?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,R):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,R)}function l(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function d(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(l,this),this.reset(!0)}function f(e){if(e){var t=e[b];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1;return(t=function t(){for(;++n<e.length;)if(v.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=m,t.done=!0,t}).next=t}}return{next:p}}function p(){return{value:m,done:!0}}var m,g=Object.prototype,v=g.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},b=y.iterator||"@@iterator",_=y.asyncIterator||"@@asyncIterator",E=y.toStringTag||"@@toStringTag";try{t({},"")}catch(e){t=function(e,t,n){return e[t]=n}}e.wrap=n;var S="suspendedStart",w="suspendedYield",T="executing",A="completed",R={};t(y={},b,(function(){return this}));var x=Object.getPrototypeOf;(x=x&&x(x(f([]))))&&x!==g&&v.call(x,b)&&(y=x);var I=a.prototype=i.prototype=Object.create(y);return o.prototype=a,t(I,"constructor",a),t(a,"constructor",o),o.displayName=t(a,E,"GeneratorFunction"),e.isGeneratorFunction=function(e){return!!(e="function"==typeof e&&e.constructor)&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,t(e,E,"GeneratorFunction")),e.prototype=Object.create(I),e},e.awrap=function(e){return{__await:e}},s(c.prototype),t(c.prototype,_,(function(){return this})),e.AsyncIterator=c,e.async=function(t,r,i,o,a){void 0===a&&(a=Promise);var s=new c(n(t,r,i,o),a);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},s(I),t(I,E,"Generator"),t(I,b,(function(){return this})),t(I,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t,n=[];for(t in e)n.push(t);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=f,h.prototype={constructor:h,reset:function(e){if(this.next=this.prev=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(d),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return o.type="throw",o.arg=e,n.next=t,r&&(n.method="next",n.arg=m),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var a=v.call(i,"catchLoc"),s=v.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&v.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}return i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null),(n=i?i.completion:{}).type=e,n.arg=t,i?(this.method="next",this.next=i.finallyLoc,R):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),R},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),d(n),R}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.tryLoc===e){if("throw"===(e=n.completion).type){var r=e.arg;d(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:f(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=m),R}},e}(e.exports);try{regeneratorRuntime=e}catch(t){"object"===("undefined"==typeof globalThis?"undefined":V(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})),Eq=!R((function(){return Object.isExtensible(Object.preventExtensions({}))})),Ok=cb((function(e){var t=Wa.f,n=Oe("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!ha(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Q(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!Q(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return Eq&&a.REQUIRED&&i(e)&&!Q(e,n)&&o(e),e}};Pe[n]=!0})),Fq=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=C[e],s=a&&a.prototype,c=a,u={},l=function(e){var t=s[e];Ea(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!ha(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!ha(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!ha(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(uc(e,"function"!=typeof a||!(i||s.forEach&&!R((function(){(new a).entries().next()})))))c=n.getConstructor(t,e,r,o),Ok.REQUIRED=!0;else if(uc(e,!0)){var d=new c,h=d[o](i?{}:-0,1)!=d,f=R((function(){d.has(1)})),p=uh((function(e){new a(e)})),m=!i&&R((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));p||((c=t((function(t,n){return hc(t,c,e),t=Lh(new a,t,c),null!=n&&yh(n,t[o],{that:t,AS_ENTRIES:r}),t}))).prototype=s,s.constructor=c),(f||m)&&(l("delete"),l("has"),r&&l("get")),(m||h)&&l(o),i&&s.clear&&delete s.clear}return u[e]=c,M({global:!0,forced:c!=a},u),gc(c,e),i||n.setStrong(c,e,r),c},ez=Wa.f,Gq=Ok.fastKey,Hq=La.set,Pk=La.getterFor,Iq={getConstructor:function(e,t,n,r){var i=e((function(e,o){hc(e,i,t),Hq(e,{type:t,index:Sb(null),first:void 0,last:void 0,size:0}),fa||(e.size=0),null!=o&&yh(o,e[r],{that:e,AS_ENTRIES:n})})),o=Pk(t),a=function(e,t,n){var r,i=o(e),a=s(e,t);return a?a.value=n:(i.last=a={index:r=Gq(t,!0),key:t,value:n,previous:t=i.last,next:void 0,removed:!1},i.first||(i.first=a),t&&(t.next=a),fa?i.size++:e.size++,"F"!==r&&(i.index[r]=a)),e},s=function(e,t){e=o(e);var n=Gq(t);if("F"!==n)return e.index[n];for(e=e.first;e;e=e.next)if(e.key==t)return e};return Xe(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,fa?e.size=0:this.size=0},delete:function(e){var t=o(this);if(e=s(this,e)){var n=e.next,r=e.previous;delete t.index[e.index],e.removed=!0,r&&(r.next=n),n&&(n.previous=r),t.first==e&&(t.first=n),t.last==e&&(t.last=r),fa?t.size--:this.size--}return!!e},forEach:function(e){for(var t,n=o(this),r=pd(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),Xe(i.prototype,n?{get:function(e){return(e=s(this,e))&&e.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),fa&&ez(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=Pk(t),o=Pk(r);Qj(e,t,(function(e,t){Hq(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),ag(t)}};Fq("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Iq);var fz=Rd.f,gz=Jb.f,hz=Wa.f,wd=C.Number,Sh=wd.prototype,iz="Number"==ec(Sb(Sh)),Jq=function(e){var t,n=tc(e,!1);if("string"==typeof n&&2<n.length)if(43===(e=(n=Ij(n)).charCodeAt(0))||45===e){if(88===(e=n.charCodeAt(2))||120===e)return NaN}else if(48===e){switch(n.charCodeAt(1)){case 66:case 98:e=2;var r=49;break;case 79:case 111:e=8,r=55;break;default:return+n}var i=(n=n.slice(2)).length;for(t=0;t<i;t++){var o=n.charCodeAt(t);if(48>o||o>r)return NaN}return parseInt(n,e)}return+n};if(uc("Number",!wd(" 0o1")||!wd("0b1")||wd("+0x1"))){for(var Zd=function(e){var t=1>arguments.length?0:e,n=this;return n instanceof Zd&&(iz?R((function(){Sh.valueOf.call(n)})):"Number"!=ec(n))?Lh(new wd(Jq(t)),n,Zd):Jq(t)},Kq=fa?fz(wd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),Qk=0,Th;Kq.length>Qk;Qk++)Q(wd,Th=Kq[Qk])&&!Q(Zd,Th)&&hz(Zd,Th,gz(wd,Th));Zd.prototype=Sh,Sh.constructor=Zd,Ea(C,"Number",Zd)}var Lq=qa("isConcatSpreadable"),jz=51<=nd||!R((function(){var e=[];return e[Lq]=!1,e.concat()[0]!==e})),kz=Yf("concat");M({target:"Array",proto:!0,forced:!jz||!kz},{concat:function(e){var t,n=Va(this),r=th(n,0),i=0,o=-1;for(t=arguments.length;o<t;o++){var a=-1===o?n:arguments[o],s=a;if(ha(s)){var c=s[Lq];s=void 0!==c?!!c:qd(s)}else s=!1;if(s){if(9007199254740991<i+(c=va(a.length)))throw TypeError("Maximum allowed index exceeded");for(s=0;s<c;s++,i++)s in a&&Ve(r,i,a[s])}else{if(9007199254740991<=i)throw TypeError("Maximum allowed index exceeded");Ve(r,i++,a)}}return r.length=i,r}});var Rk=Rb("Reflect","apply"),lz=Function.apply,mz=!R((function(){Rk((function(){}))}));M({target:"Reflect",stat:!0,forced:mz},{apply:function(e,t,n){return Bb(e),sa(n),Rk?Rk(e,t,n):lz.call(e,t,n)}}),M({target:"Reflect",stat:!0},{ownKeys:uo});var nz=xk,oz=R((function(){return!Object.getOwnPropertyNames(1)}));M({target:"Object",stat:!0,forced:oz},{getOwnPropertyNames:nz});var ef="object"===("undefined"==typeof Reflect?"undefined":V(Reflect))?Reflect:null,Mq=ef&&"function"==typeof ef.apply?ef.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},pz=ef&&"function"==typeof ef.ownKeys?ef.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},Nq=Number.isNaN||function(e){return e!=e};ia.EventEmitter=ia,ia.prototype._events=void 0,ia.prototype._eventsCount=0,ia.prototype._maxListeners=void 0;var Oq=10;Object.defineProperty(ia,"defaultMaxListeners",{enumerable:!0,get:function(){return Oq},set:function(e){if("number"!=typeof e||0>e||Nq(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Oq=e}}),ia.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ia.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||Nq(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ia.prototype.getMaxListeners=function(){return void 0===this._maxListeners?ia.defaultMaxListeners:this._maxListeners},ia.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);n="error"===e;var r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var i;if(0<t.length&&(i=t[0]),i instanceof Error)throw i;throw(t=Error("Unhandled error."+(i?" ("+i.message+")":""))).context=i,t}if(void 0===(n=r[e]))return!1;if("function"==typeof n)Mq(n,this,t);else for(r=Em(n,i=n.length),n=0;n<i;++n)Mq(r[n],this,t);return!0},ia.prototype.addListener=function(e,t){return Bm(this,e,t,!1)},ia.prototype.on=ia.prototype.addListener,ia.prototype.prependListener=function(e,t){return Bm(this,e,t,!0)},ia.prototype.once=function(e,t){return Kg(t),this.on(e,Cm(this,e,t)),this},ia.prototype.prependOnceListener=function(e,t){return Kg(t),this.prependListener(e,Cm(this,e,t)),this},ia.prototype.removeListener=function(e,t){var n;Kg(t);var r=this._events;if(void 0===r)return this;var i=r[e];if(void 0===i)return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){var o=-1;for(n=i.length-1;0<=n;n--)if(i[n]===t||i[n].listener===t){var a=i[n].listener;o=n;break}if(0>o)return this;if(0===o)i.shift();else{for(;o+1<i.length;o++)i[o]=i[o+1];i.pop()}1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},ia.prototype.off=ia.prototype.removeListener,ia.prototype.removeAllListeners=function(e){var t=this._events;if(void 0===t)return this;if(void 0===t.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==t[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete t[e]),this;if(0===arguments.length){var n=Object.keys(t);for(t=0;t<n.length;++t){var r=n[t];"removeListener"!==r&&this.removeAllListeners(r)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=t[e]))this.removeListener(e,n);else if(void 0!==n)for(t=n.length-1;0<=t;t--)this.removeListener(e,n[t]);return this},ia.prototype.listeners=function(e){return Dm(this,e,!0)},ia.prototype.rawListeners=function(e){return Dm(this,e,!1)},ia.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Fm.call(e,t)},ia.prototype.listenerCount=Fm,ia.prototype.eventNames=function(){return 0<this._eventsCount?pz(this._events):[]},ia.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}Gm(e,t,o,{once:!0}),"error"!==t&&pu(e,i,{once:!0})}))};var ff=Object.assign,Pq=Object.defineProperty,ng=!ff||R((function(){if(fa&&1!==ff({b:1},ff(Pq({},"a",{enumerable:!0,get:function(){Pq(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=ff({},e)[n]||"abcdefghijklmnopqrst"!=Mc(ff({},t)).join("")}))?function(e,t){for(var n=Va(e),r=arguments.length,i=1,o=Uf.f,a=Sf;r>i;)for(var s,c=Tf(arguments[i++]),u=o?Mc(c).concat(o(c)):Mc(c),l=u.length,d=0;l>d;)s=u[d++],(!fa||a.call(c,s))&&(n[s]=c[s]);return n}:ff;M({target:"Object",stat:!0,forced:Object.assign!==ng},{assign:ng}),Fq("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Iq);var qz=Math.log,rz=Math.LN2;M({target:"Math",stat:!0},{log2:function(e){return qz(e)/rz}});var sz=Wa.f,tz=Rd.f,uz=La.enforce,vz=qa("match"),zc=C.RegExp,Sk=zc.prototype,og=/a/g,Tk=/a/g,Uk=new zc(og)!==og;if(fa&&uc("RegExp",!Uk||vc||R((function(){return Tk[vz]=!1,zc(og)!=og||zc(Tk)==Tk||"/a/i"!=zc(og,"i")})))){for(var Uc=function(e,t){var n,r=this instanceof Uc,i=Fj(e),o=void 0===t;return!r&&i&&e.constructor===Uc&&o||(Uk?i&&!o&&(e=e.source):e instanceof Uc&&(o&&(t=Aj.call(e)),e=e.source),vc&&(n=!!t&&-1<t.indexOf("y"))&&(t=t.replace(/y/g,"")),e=Lh(Uk?new zc(e,t):zc(e,t),r?this:Sk,Uc),vc&&n&&(uz(e).sticky=!0)),e},wz=function(e){e in Uc||sz(Uc,e,{configurable:!0,get:function(){return zc[e]},set:function(t){zc[e]=t}})},Qq=tz(zc),Rq=0;Qq.length>Rq;)wz(Qq[Rq++]);Sk.constructor=Uc,Uc.prototype=Sk,Ea(C,"RegExp",Uc)}ag("RegExp"),jg("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),jg("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}})),jg("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),jg("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var Vk=function(e,t){return e===t?0:null==e?null==t?0:-1:null==t?null==e?0:1:"function"==typeof e.compare?e.compare(t):"function"==typeof t.compare?-t.compare(e):e<t?-1:e>t?1:0},Wk=[],Sq=Wk.sort,xz=R((function(){Wk.sort(void 0)})),yz=R((function(){Wk.sort(null)})),zz=Te("sort");M({target:"Array",proto:!0,forced:xz||!yz||!zz},{sort:function(e){return void 0===e?Sq.call(Va(this)):Sq.call(Va(this),Bb(e))}});var Tq=Object.getPrototypeOf({}),pg=function(e,t){var n;return e===t||(null==e?e==t:"function"===V(e.equiv)?e.equiv(t):null==t?e==t:"function"===V(t.equiv)?t.equiv(e):"string"!==V(e)&&"string"!==V(t)&&(null!=(n=Object.getPrototypeOf(e))&&n!==Tq||null!=(n=Object.getPrototypeOf(t))&&n!==Tq?"function"!==V(e)&&void 0!==e.length&&"function"!==V(t)&&void 0!==t.length?Bz(e,t):e instanceof Set&&t instanceof Set?Cz(e,t):e instanceof Map&&t instanceof Map?Dz(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:Az(e,t)))},Bz=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:pg,r=e.length;if(r===t.length)for(;0<=--r&&n(e[r],t[r]););return 0>r},Cz=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:pg;return e.size===t.size&&n(G(e.keys()).sort(),G(t.keys()).sort())},Dz=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:pg;return e.size===t.size&&n(G(e).sort(),G(t).sort())},Az=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:pg;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(!t.hasOwnProperty(r)||!n(e[r],t[r]))return!1;return!0},Uq=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return void 0!==e?": "+e:""};return function(n){function r(n){return X(this,r),i.call(this,e(n)+t(n))}ja(r,n);var i=ka(r);return r}(xf(Error))},Ez=Uq((function(){return"illegal argument(s)"})),Uh=function(e){throw new Ez(e)},Xk=Uq((function(){return"index out of bounds"})),Vq=1/4294967295,Fz=function(){function e(){X(this,e)}return Ia(e,[{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.int()*Vq*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(this.int()*Vq-.5)*e}},{key:"minmax",value:function(e,t){return this.float()*(t-e)+e}}]),e}(),Yk=Math.random,Gz=new(function(e){function t(){return X(this,t),n.apply(this,arguments)}ja(t,e);var n=ka(t);return Ia(t,[{key:"int",value:function(){return 4294967296*Yk()>>>0}},{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return Yk()*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(Yk()-.5)*e}}]),t}(Fz)),zi=Symbol(),Jm=function(){},Hz=Ok.onFreeze,Zk=Object.freeze,Iz=R((function(){Zk(1)}));M({target:"Object",stat:!0,forced:Iz,sham:!Eq},{freeze:function(e){return Zk&&ha(e)?Zk(Hz(e)):e}});var Jz=Te("reduce"),Kz=!Oc&&79<nd&&83>nd;M({target:"Array",proto:!0,forced:!Jz||Kz},{reduce:function(e){return bq(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Im=function(e){return null!=e&&"function"==typeof e.xform?e.xform():e},Lg=function(){function e(t){X(this,e),this.value=t}return Ia(e,[{key:"deref",value:function(){return this.value}}]),e}(),Ai=function(e){return e instanceof Lg?e.deref():e},ru=function(e,t){return[e,function(e){return e},t]},Lz=x.mark((function(e,t){var n,r,i,o,a,s;return x.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=Im(e)(qu()),r=n[1],i=n[2],o=0;case 4:if(!(o<t.length)){c.next=15;break}if(a=t[o],!((s=i([],a))instanceof Lg)){c.next=10;break}return c.delegateYield(Ai(r(s.deref())),"t0",9);case 9:return c.abrupt("return");case 10:if(!s.length){c.next=12;break}return c.delegateYield(s,"t1",12);case 12:o++,c.next=4;break;case 15:return c.delegateYield(Ai(r([])),"t2",16);case 16:case"end":return c.stop()}}),Lz)})),su=x.mark(Hm),tu=function(e,t){return[e[0],e[1],t]},Wq=!0;"findIndex"in[]&&Array(1).findIndex((function(){Wq=!1})),M({target:"Array",proto:!0,forced:Wq},{findIndex:function(e){return Mo(this,e,1<arguments.length?arguments[1]:void 0)}}),Vd("findIndex"),M({target:"Array",proto:!0},{fill:ik}),Vd("fill");var Mz=function(){function e(t){X(this,e),this._length=0,t&&this.into(t)}return Ia(e,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e(this)}},{key:"empty",value:function(){return new e}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var e,t=this.head;t;)e=t.next,delete t.value,delete t.prev,delete t.next,t=e;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(e){var t=this._length;if(t<e._length)return-1;if(t>e._length)return 1;if(0===t)return 0;t=this.head,e=e.head;for(var n=0;t&&0==n;)n=Vk(t.value,e.value),t=t.next,e=e.next;return n}},{key:"equiv",value:function(t){if(!(t instanceof e||null!=t&&"function"!=typeof t&&void 0!==t.length)||this._length!==t.length)return!1;if(!this._length||this===t)return!0;for(var n=this.head,r=0;r<t.length;r++){if(!pg(n.value,t[r]))return!1;n=n.next}return!0}},{key:Symbol.iterator,value:x.mark((function e(){var t;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.head;case 1:if(!t){e.next=7;break}return e.next=4,t.value;case 4:t=t.next,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"seq",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;if(!(e>=t||0>e)){e=this.nthCell(e);var n=this.nthCell(t-1);return t=function e(t){return{first:function(){return t.value},next:function(){return t!==n&&t.next?e(t.next):void 0}}},e?t(e):void 0}}},{key:"cycle",value:x.mark((function e(){return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this,"t0",2);case 2:e.next=0;break;case 4:case"end":return e.stop()}}),e,this)}))},{key:"$reduce",value:function(e,t){for(var n=this.head;n&&!(t instanceof Lg);)t=e(t,n.value),n=n.next;return t}},{key:"drop",value:function(){var e=this.head;if(e)return(this.head=e.next)?delete this.head.prev:delete this.tail,this._length--,e.value}},{key:"cons",value:function(e){return e={value:e,next:this.head},this.head?this.head.prev=e:this.tail=e,this.head=e,this._length++,this}},{key:"insertBefore",value:function(e,t){return e||Uh("cell is undefined"),t={value:t,next:e,prev:e.prev},e.prev?e.prev.next=t:this.head=t,e.prev=t,this._length++,this}},{key:"insertAfter",value:function(e,t){return e||Uh("cell is undefined"),t={value:t,next:e.next,prev:e},e.next?e.next.prev=t:this.tail=t,e.next=t,this._length++,this}},{key:"insertBeforeNth",value:function(e,t){if(0>e&&(e+=this._length),0>=e)return this.cons(t);if(0>e||e>=this._length)throw new Xk(e);return this.insertBefore(this.nthCellUnsafe(e),t)}},{key:"insertAfterNth",value:function(e,t){if(0>e&&(e+=this._length),e>=this._length-1)return this.push(t);if(0>e||e>=this._length)throw new Xk(e);return this.insertAfter(this.nthCellUnsafe(e),t)}},{key:"insertSorted",value:function(e,t){t=t||Vk;for(var n=this.head;n;){if(0>=t(e,n.value))return this.insertBefore(n,e);n=n.next}return this.push(e)}},{key:"find",value:function(e){for(var t=this.head;t;){if(t.value===e)return t;t=t.next}}},{key:"findWith",value:function(e){for(var t=this.head;t;){if(e(t.value))return t;t=t.next}}},{key:"concat",value:function(){for(var e=this.copy(),t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e.into(n[t]);return e}},{key:"into",value:function(e){for(var t=0;t<e.length;t++)this.push(e[t])}},{key:"slice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;t=0>t?t+this._length:t,n=0>n?n+this._length:n,(0>t||0>n)&&Uh("invalid indices: ${from} / ${to}");for(var r=new e,i=this.nthCell(t);i&&++t<=n;)r.push(i.value),i=i.next;return r}},{key:"splice",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length?arguments[2]:void 0;if("number"==typeof t){if(0>t&&(t+=this._length),0>t||t>=this._length)throw new Xk(t);var i=this.nthCellUnsafe(t)}else i=t;var o=new e;if(0<n)for(;i&&0<n--;)this.remove(i),o.push(i.value),i=i.next;else i&&(i=i.next);if(r)if(i)for(n=0;n<r.length;n++)this.insertBefore(i,r[n]);else for(i=0;i<r.length;i++)this.push(r[i]);return o}},{key:"remove",value:function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,this._length--,this}},{key:"swap",value:function(e,t){if(e!==t){var n=e.value;e.value=t.value,t.value=n}return this}},{key:"push",value:function(e){return this.tail?(e={value:e,prev:this.tail},this.tail=this.tail.next=e,this._length++,this):this.cons(e)}},{key:"pop",value:function(){var e=this.tail;if(e)return(this.tail=e.prev)?delete this.tail.next:delete this.head,this._length--,e.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(e){return this.head?(this.head.value=e,this):this.cons(e)}},{key:"setTail",value:function(e){return this.tail?(this.tail.value=e,this):this.push(e)}},{key:"setNth",value:function(e,t){var n=this.nthCell(e);return!n&&Uh("index out of bounds: ".concat(e)),n.value=t,this}},{key:"nth",value:function(e,t){return(e=this.nthCell(e))?e.value:t}},{key:"nthCell",value:function(e){if(0>e&&(e+=this._length),!(0>e||e>=this._length))return this.nthCellUnsafe(e)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var e=this.peek();return this.pop(),this.cons(e)}}},{key:"map",value:function(t){for(var n=new e,r=this.head;r;)n.push(t(r.value)),r=r.next;return n}},{key:"filter",value:function(t){for(var n=new e,r=this.head;r;)t(r.value)&&n.push(r.value),r=r.next;return n}},{key:"reduce",value:function(e,t){for(var n=this.head;n;)t=e(t,n.value),n=n.next;return t}},{key:"shuffle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Gz;if(2>this._length)return this;for(e=null!=e?e:Math.ceil(1.5*Math.log2(this._length));0<e;e--)for(var n=this.head;n;){var r=n.next;.5>t.float()?this.asHead(n):this.asTail(n),n=r}return this}},{key:"sort",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Vk;if(!this._length)return this;for(var t=1;;){var n=this.head;this.tail=this.head=void 0;for(var r=0;n;){r++;for(var i=n,o=0,a=0;a<t&&(o++,i=i.next);a++);for(a=t;0<o||0<a&&i;){if(0===o){var s=i;i=i.next,a--}else i&&0!==a?0>=e(n.value,i.value)?(s=n,n=n.next,o--):(s=i,i=i.next,a--):(s=n,n=n.next,o--);this.tail?this.tail.next=s:this.head=s,s.prev=this.tail,this.tail=s}n=i}if(this.tail.next=void 0,1>=r)return this;t*=2}}},{key:"reverse",value:function(){for(var e=this.head,t=this.tail,n=(this._length>>>1)+(1&this._length);e&&t&&0<n;){var r=e.value;e.value=t.value,t.value=r,e=e.next,t=t.prev,n--}return this}},{key:"asHead",value:function(e){return e===this.head||(this.remove(e),this.head.prev=e,e.next=this.head,e.prev=void 0,this.head=e,this._length++),this}},{key:"asTail",value:function(e){return e===this.tail||(this.remove(e),this.tail.next=e,e.prev=this.tail,e.next=void 0,this.tail=e,this._length++),this}},{key:"toString",value:function(){for(var e=[],t=this.head;t;)e.push(String(t.value)),t=t.next;return e.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(e){if(e<=this._length>>1)var t=this.head,n="next";else t=this.tail,n="prev",e=this._length-e-1;for(;0<e--&&t;)t=t[n];return t}}]),e}(),Ac=function(){function e(t,n){X(this,e),n=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},n),this.map=n.map(),this.items=new Mz,this._size=0,this.opts=n,t&&this.into(t)}return Ia(e,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return Mg((function(e){return[e.k,e]}),this.items)}},{key:"keys",value:function(){return Mg((function(e){return e.k}),this.items)}},{key:"values",value:function(){return Mg((function(e){return e.v}),this.items)}},{key:"copy",value:function(){var e=this.empty();e.items=this.items.copy();for(var t=e.items.head;t;)e.map.set(t.value.k,t),t=t.next;return e}},{key:"empty",value:function(){return new e(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var e=this.opts.release;if(e){for(var t;t=this.items.drop();)e(t.k,t.v);return!0}return this.items.release()}},{key:"has",value:function(e){return this.map.has(e)}},{key:"get",value:function(e,t){return(e=this.map.get(e))?this.resetEntry(e):t}},{key:"set",value:function(e,t){var n=this.opts.ksize(e)+this.opts.vsize(t),r=this.map.get(e);return this._size+=Math.max(0,n-(r?r.value.s:0)),this.ensureSize()&&this.doSetEntry(r,e,t,n),t}},{key:"into",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.set(n[0],n[1])}return this}},{key:"getSet",value:function(e,t){var n=this,r=this.map.get(e);return r?Promise.resolve(this.resetEntry(r)):t().then((function(t){return n.set(e,t)}))}},{key:"delete",value:function(e){return!!(e=this.map.get(e))&&(this.removeEntry(e),!0)}},{key:"resetEntry",value:function(e){return this.items.asTail(e),e.value.v}},{key:"ensureSize",value:function(){for(var e=this.opts.release,t=this.opts.maxsize,n=this.opts.maxlen;this._size>t||this.length>=n;){var r=this.items.drop();if(!r)return!1;this.map.delete(r.k),e&&e(r.k,r.v),this._size-=r.s}return!0}},{key:"removeEntry",value:function(e){var t=e.value;this.map.delete(t.k),this.items.remove(e),this.opts.release&&this.opts.release(t.k,t.v),this._size-=t.s}},{key:"doSetEntry",value:function(e,t,n,r){e?(e.value.v=n,e.value.s=r,this.items.asTail(e)):(this.items.push({k:t,v:n,s:r}),this.map.set(t,this.items.tail))}}]),e}(),Nz=function(e){function t(e,r){return X(this,t),r=Object.assign({ttl:36e5},r),n.call(this,e,r)}ja(t,e);var n=ka(t);return Ia(t,[{key:"empty",value:function(){return new t(null,this.opts)}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"get",value:function(e,t){if(e=this.map.get(e)){if(e.value.t>=Date.now())return this.resetEntry(e);this.removeEntry(e)}return t}},{key:"set",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,r=this.opts.ksize(e)+this.opts.vsize(t),i=this.map.get(e);return this._size+=Math.max(0,r-(i?i.value.s:0)),this.ensureSize()&&(n=Date.now()+n,i?(i.value.v=t,i.value.s=r,i.value.t=n,this.items.asTail(i)):(this.items.push({k:e,v:t,s:r,t:n}),this.map.set(e,this.items.tail))),t}},{key:"getSet",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,i=this.get(e);return i?Promise.resolve(i):t().then((function(t){return n.set(e,t,r)}))}},{key:"prune",value:function(){for(var e=Date.now(),t=this.items.head;t;)t.value.t<e&&this.removeEntry(t),t=t.next}},{key:"ensureSize",value:function(){for(var e=this.opts.maxsize,n=this.opts.maxlen,r=Date.now(),i=this.items.head;i&&(this._size>e||this.length>=n);)i.value.t<r&&this.removeEntry(i),i=i.next;return xi(Fd(t.prototype),"ensureSize",this).call(this)}}]),t}(Ac),Xq="object"==V(Ka)&&Ka&&Ka.Object===Object&&Ka,Oz="object"==("undefined"==typeof self?"undefined":V(self))&&self&&self.Object===Object&&self,Fb=Xq||Oz||Function("return this")(),Ub=Fb.Symbol,Yq=Object.prototype,Pz=Yq.hasOwnProperty,Qz=Yq.toString,qg=Ub?Ub.toStringTag:void 0,Rz=Object.prototype.toString,Zq=Ub?Ub.toStringTag:void 0,$d=function(e){if(null==e)e=void 0===e?"[object Undefined]":"[object Null]";else if(Zq&&Zq in Object(e)){var t=Pz.call(e,qg),n=e[qg];try{e[qg]=void 0;var r=!0}catch(e){}var i=Qz.call(e);r&&(t?e[qg]=n:delete e[qg]),e=i}else e=Rz.call(e);return e},ob=function(e){var t=V(e);return null!=e&&("object"==t||"function"==t)},Wi=function(e){return!!ob(e)&&("[object Function]"==(e=$d(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)},$k=Fb["__core-js_shared__"],$q=function(){var e=/[^.]+$/.exec($k&&$k.keys&&$k.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Sz=Function.prototype.toString,ae=function(e){if(null!=e){try{return Sz.call(e)}catch(e){}return e+""}return""},Tz=/^\[object .+?Constructor\]$/,Uz=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),be=function(e,t){return e=null==e?void 0:e[t],!ob(e)||$q&&$q in e||!(Wi(e)?Uz:Tz).test(ae(e))?void 0:e},rg=be(Object,"create"),Vz=Object.prototype.hasOwnProperty,Wz=Object.prototype.hasOwnProperty;Id.prototype.clear=function(){this.__data__=rg?rg(null):{},this.size=0},Id.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},Id.prototype.get=function(e){var t=this.__data__;return rg?"__lodash_hash_undefined__"===(e=t[e])?void 0:e:Vz.call(t,e)?t[e]:void 0},Id.prototype.has=function(e){var t=this.__data__;return rg?void 0!==t[e]:Wz.call(t,e)},Id.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=rg&&void 0===t?"__lodash_hash_undefined__":t,this};var sg=function(e,t){return e===t||e!=e&&t!=t},Vh=function(e,t){for(var n=e.length;n--;)if(sg(e[n][0],t))return n;return-1},Xz=Array.prototype.splice;qe.prototype.clear=function(){this.__data__=[],this.size=0},qe.prototype.delete=function(e){var t=this.__data__;return!(0>(e=Vh(t,e))||(e==t.length-1?t.pop():Xz.call(t,e,1),--this.size,0))},qe.prototype.get=function(e){var t=this.__data__;return 0>(e=Vh(t,e))?void 0:t[e][1]},qe.prototype.has=function(e){return-1<Vh(this.__data__,e)},qe.prototype.set=function(e,t){var n=this.__data__,r=Vh(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this};var Og=qe,tg=be(Fb,"Map"),Wh=function(e,t){e=e.__data__;var n=V(t);return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map};re.prototype.clear=function(){this.size=0,this.__data__={hash:new Id,map:new(tg||Og),string:new Id}},re.prototype.delete=function(e){return e=Wh(this,e).delete(e),this.size-=e?1:0,e},re.prototype.get=function(e){return Wh(this,e).get(e)},re.prototype.has=function(e){return Wh(this,e).has(e)},re.prototype.set=function(e,t){var n=Wh(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};var Ng=re;zf.prototype.add=zf.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},zf.prototype.has=function(e){return this.__data__.has(e)};var ar=function(e,t,n,r){var i=e.length;for(n+=r?1:-1;r?n--:++n<i;)if(t(e[n],n,e))return n;return-1},Yz=function(e){return e!=e},Zz=function(e,t){var n;if(n=!(null==e||!e.length)){if(t==t)e:{n=-1;for(var r=e.length;++n<r;)if(e[n]===t){e=n;break e}e=-1}else e=ar(e,Yz,0);n=-1<e}return n},$z=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1},aA=function(e,t){return e.has(t)},gf=be(Fb,"Set"),bA=function(){},al=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},cA=1/0,dA=gf&&1/al(new gf([,-0]))[1]==cA?function(e){return new gf(e)}:bA,bl=function(e,t,n){var r=-1,i=Zz,o=e.length,a=!0,s=[],c=s;if(n)a=!1,i=$z;else if(200<=o){if(i=t?null:dA(e))return al(i);a=!1,i=aA,c=new zf}else c=t?[]:s;e:for(;++r<o;){var u=e[r],l=t?t(u):u;if(u=n||0!==u?u:0,a&&l==l){for(var d=c.length;d--;)if(c[d]===l)continue e;t&&c.push(l),s.push(u)}else i(c,l,n)||(c!==s&&c.push(l),s.push(u))}return s},br=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},ve=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};se.prototype.clear=function(){this.__data__=new Og,this.size=0},se.prototype.delete=function(e){var t=this.__data__;return e=t.delete(e),this.size=t.size,e},se.prototype.get=function(e){return this.__data__.get(e)},se.prototype.has=function(e){return this.__data__.has(e)},se.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Og){var r=n.__data__;if(!tg||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ng(r)}return n.set(e,t),this.size=n.size,this};var ue=se,Cu=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},Xh=function(){try{var e=be(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),ug=function(e,t,n){"__proto__"==t&&Xh?Xh(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},eA=Object.prototype.hasOwnProperty,Om=function(e,t,n){var r=e[t];eA.call(e,t)&&sg(r,n)&&(void 0!==n||t in e)||ug(e,t,n)},Fe=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=r?r(n[s],e[s],s,n,e):void 0;void 0===c&&(c=e[s]),i?ug(n,s,c):Om(n,s,c)}return n},oc=function(e){return null!=e&&"object"==V(e)},cr=function(e){return oc(e)&&"[object Arguments]"==$d(e)},dr=Object.prototype,fA=dr.hasOwnProperty,gA=dr.propertyIsEnumerable,Jf=cr(function(){return arguments}())?cr:function(e){return oc(e)&&fA.call(e,"callee")&&!gA.call(e,"callee")},Za=Array.isArray,hA=function(){return!1},Bf=cb((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e;t=n&&n.exports===t?Fb.Buffer:void 0,e.exports=(t?t.isBuffer:void 0)||hA})),iA=/^(?:0|[1-9]\d*)$/,cl=function(e,t){var n=V(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&iA.test(e))&&-1<e&&0==e%1&&e<t},dl=function(e){return"number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e},Ga={};Ga["[object Float32Array]"]=Ga["[object Float64Array]"]=Ga["[object Int8Array]"]=Ga["[object Int16Array]"]=Ga["[object Int32Array]"]=Ga["[object Uint8Array]"]=Ga["[object Uint8ClampedArray]"]=Ga["[object Uint16Array]"]=Ga["[object Uint32Array]"]=!0,Ga["[object Arguments]"]=Ga["[object Array]"]=Ga["[object ArrayBuffer]"]=Ga["[object Boolean]"]=Ga["[object DataView]"]=Ga["[object Date]"]=Ga["[object Error]"]=Ga["[object Function]"]=Ga["[object Map]"]=Ga["[object Number]"]=Ga["[object Object]"]=Ga["[object RegExp]"]=Ga["[object Set]"]=Ga["[object String]"]=Ga["[object WeakMap]"]=!1;var jA=function(e){return oc(e)&&dl(e.length)&&!!Ga[$d(e)]},Yh=function(e){return function(t){return e(t)}},hf=cb((function(e,t){var n=t&&!t.nodeType&&t;n=(t=n&&e&&!e.nodeType&&e)&&t.exports===n&&Xq.process;e:{try{var r=t&&t.require&&t.require("util").types;if(r){var i=r;break e}i=n&&n.binding&&n.binding("util");break e}catch(e){}i=void 0}e.exports=i})),er=hf&&hf.isTypedArray,Gi=er?Yh(er):jA,kA=Object.prototype.hasOwnProperty,fr=function(e,t){var n=Za(e),r=!n&&Jf(e),i=!n&&!r&&Bf(e),o=!n&&!r&&!i&&Gi(e);if(n=n||r||i||o){r=e.length;for(var a=String,s=-1,c=Array(r);++s<r;)c[s]=a(s);r=c}else r=[];for(var u in a=r.length,e)!t&&!kA.call(e,u)||n&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||cl(u,a))||r.push(u);return r},lA=Object.prototype,el=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||lA)},gr=function(e,t){return function(n){return e(t(n))}},mA=gr(Object.keys,Object),nA=Object.prototype.hasOwnProperty,Nd=function(e){return null!=e&&dl(e.length)&&!Wi(e)},Jd=function(e){if(Nd(e))e=fr(e);else if(el(e)){var t,n=[];for(t in Object(e))nA.call(e,t)&&"constructor"!=t&&n.push(t);e=n}else e=mA(e);return e},yu=function(e,t){return e&&Fe(t,Jd(t),e)},oA=Object.prototype.hasOwnProperty,Cf=function(e){if(Nd(e))e=fr(e,!0);else if(ob(e)){var t=el(e),n=[];for(r in e)("constructor"!=r||!t&&oA.call(e,r))&&n.push(r);e=n}else{var r=[];if(null!=e)for(t in Object(e))r.push(t);e=r}return e},wu=function(e,t){return e&&Fe(t,Cf(t),e)},Lm=cb((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e,r=(t=n&&n.exports===t?Fb.Buffer:void 0)?t.allocUnsafe:void 0;e.exports=function(e,t){return t?e.slice():(t=e.length,t=r?r(t):new e.constructor(t),e.copy(t),t)}})),Bi=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},pA=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o},hr=function(){return[]},qA=Object.prototype.propertyIsEnumerable,ir=Object.getOwnPropertySymbols,fl=ir?function(e){return null==e?[]:(e=Object(e),pA(ir(e),(function(t){return qA.call(e,t)})))}:hr,xu=function(e,t){return Fe(e,fl(e),t)},Fi=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},gl=gr(Object.getPrototypeOf,Object),jr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Fi(t,fl(e)),e=gl(e);return t}:hr,vu=function(e,t){return Fe(e,jr(e),t)},kr=function(e,t,n){return t=t(e),Za(e)?t:Fi(t,n(e))},Ci=function(e){return kr(e,Jd,fl)},Nm=function(e){return kr(e,Cf,jr)},hl=be(Fb,"DataView"),il=be(Fb,"Promise"),jl=be(Fb,"WeakMap"),rA=ae(hl),sA=ae(tg),tA=ae(il),uA=ae(gf),vA=ae(jl),ce=$d;(hl&&"[object DataView]"!=ce(new hl(new ArrayBuffer(1)))||tg&&"[object Map]"!=ce(new tg)||il&&"[object Promise]"!=ce(il.resolve())||gf&&"[object Set]"!=ce(new gf)||jl&&"[object WeakMap]"!=ce(new jl))&&(ce=function(e){var t=$d(e);if(e=(e="[object Object]"==t?e.constructor:void 0)?ae(e):"")switch(e){case rA:return"[object DataView]";case sA:return"[object Map]";case tA:return"[object Promise]";case uA:return"[object Set]";case vA:return"[object WeakMap]"}return t});var Af=ce,wA=Object.prototype.hasOwnProperty,uu=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&wA.call(e,"index")&&(n.index=e.index,n.input=e.input),n},Zh=Fb.Uint8Array,kl=function(e){var t=new e.constructor(e.byteLength);return new Zh(t).set(new Zh(e)),t},xA=/\w*$/,lr=Ub?Ub.prototype:void 0,mr=lr?lr.valueOf:void 0,An=function(e,t){return t=t?kl(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.length)},zu=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return kl(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return t=n?kl(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return An(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return(t=new e.constructor(e.source,xA.exec(e))).lastIndex=e.lastIndex,t;case"[object Symbol]":return mr?Object(mr.call(e)):{}}},nr=Object.create,yA=function(){function e(){}return function(t){return ob(t)?nr?nr(t):(e.prototype=t,t=new e,e.prototype=void 0,t):{}}}(),Mm=function(e){return"function"!=typeof e.constructor||el(e)?{}:yA(gl(e))},zA=function(e){return oc(e)&&"[object Map]"==Af(e)},or=hf&&hf.isMap,Bu=or?Yh(or):zA,AA=function(e){return oc(e)&&"[object Set]"==Af(e)},pr=hf&&hf.isSet,Au=pr?Yh(pr):AA,xa={};xa["[object Arguments]"]=xa["[object Array]"]=xa["[object ArrayBuffer]"]=xa["[object DataView]"]=xa["[object Boolean]"]=xa["[object Date]"]=xa["[object Float32Array]"]=xa["[object Float64Array]"]=xa["[object Int8Array]"]=xa["[object Int16Array]"]=xa["[object Int32Array]"]=xa["[object Map]"]=xa["[object Number]"]=xa["[object Object]"]=xa["[object RegExp]"]=xa["[object Set]"]=xa["[object String]"]=xa["[object Symbol]"]=xa["[object Uint8Array]"]=xa["[object Uint8ClampedArray]"]=xa["[object Uint16Array]"]=xa["[object Uint32Array]"]=!0,xa["[object Error]"]=xa["[object Function]"]=xa["[object WeakMap]"]=!1;var we=function(e){return"symbol"==V(e)||oc(e)&&"[object Symbol]"==$d(e)},BA=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,CA=/^\w*$/,ll=function(e,t){if(Za(e))return!1;var n=V(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!we(e))||CA.test(e)||!BA.test(e)||null!=t&&e in Object(t)};Di.Cache=Ng;var DA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,EA=/\\(\\)?/g,FA=function(e){var t=(e=Di(e,(function(e){return 500===t.size&&t.clear(),e}))).cache;return e}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(DA,(function(e,n,r,i){t.push(r?i.replace(EA,"$1"):n||e)})),t})),Du=1/0,qr=Ub?Ub.prototype:void 0,Qm=qr?qr.toString:void 0,$h=function(e,t){return Za(e)?e:ll(e,t)?[e]:FA(null==e?"":Pm(e))},GA=1/0,vg=function(e){if("string"==typeof e||we(e))return e;var t=e+"";return"0"==t&&1/e==-GA?"-0":t},ai=function(e,t){for(var n=0,r=(t=$h(t,e)).length;null!=e&&n<r;)e=e[vg(t[n++])];return n&&n==r?e:void 0},HA=function(e,t){if(!(2>(t=$h(t,e)).length)){var n=t,r=0,i=-1,o=-1,a=n.length;for(0>r&&(r=-r>a?0:a+r),0>(i=i>a?a:i)&&(i+=a),a=r>i?0:i-r>>>0,r>>>=0,i=Array(a);++o<a;)i[o]=n[o+r];e=ai(e,i)}return(n=null==e)||(n=null==t?0:t.length,n=delete e[vg(n?t[n-1]:void 0)]),n},rr=Function.prototype.toString,IA=Object.prototype.hasOwnProperty,JA=rr.call(Object),Bn=function(e){return!(!oc(e)||"[object Object]"!=$d(e))&&(null===(e=gl(e))||"function"==typeof(e=IA.call(e,"constructor")&&e.constructor)&&e instanceof e&&rr.call(e)==JA)},KA=function(e){return Bn(e)?void 0:e},sr=Ub?Ub.isConcatSpreadable:void 0,Eu=function(e){return Za(e)||Jf(e)||!!(sr&&e&&e[sr])},LA=function(e){return null!=e&&e.length?Ei(e,1):[]},MA=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},tr=Math.max,ur=function(e,t,n){return t=tr(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=tr(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];for(i=-1,o=Array(t+1);++i<t;)o[i]=r[i];return o[t]=n(a),MA(e,this,o)}},NA=function(e){return function(){return e}},bi=function(e){return e},OA=Date.now,vr=function(e){var t=0,n=0;return function(){var r=OA(),i=16-(r-n);if(n=r,0<i){if(800<=++t)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Xh?function(e,t){return Xh(e,"toString",{configurable:!0,enumerable:!1,value:NA(t),writable:!0})}:bi),ml=function(e){return vr(ur(e,void 0,LA),e+"")}((function(e,t){var n={};if(null==e)return n;var r=!1;t=ve(t,(function(t){return t=$h(t,e),r||(r=1<t.length),t})),Fe(e,Nm(e),n),r&&(n=te(n,7,KA));for(var i=t.length;i--;)HA(n,t[i]);return n})),PA=function(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(r,a,n(a),e)}return r},zn=function(e,t,n){for(var r=-1,i=Object(e),o=(n=n(e)).length;o--;){var a=n[++r];if(!1===t(i[a],a,i))break}return e},wr=function(e,t){return e&&zn(e,t,Jd)},nl=function(e,t){return function(t,n){if(null==t)return t;if(!Nd(t))return e(t,n);for(var r=t.length,i=-1,o=Object(t);++i<r&&!1!==n(o[i],i,o););return t}}(wr),QA=function(e,t,n,r){return nl(e,(function(e,i,o){t(r,e,n(e),o)})),r},xr=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},Rm=function(e,t,n,r,i,o){var a=1&n,s=e.length,c=t.length;if(s!=c&&!(a&&c>s))return!1;c=o.get(e);var u=o.get(t);if(c&&u)return c==t&&u==e;c=-1,u=!0;var l=2&n?new zf:void 0;for(o.set(e,t),o.set(t,e);++c<s;){var d=e[c],h=t[c];if(r)var f=a?r(h,d,c,t,e,o):r(d,h,c,e,t,o);if(void 0!==f){if(f)continue;u=!1;break}if(l){if(!xr(t,(function(e,t){if(!l.has(t)&&(d===e||i(d,e,n,r,o)))return l.push(t)}))){u=!1;break}}else if(d!==h&&!i(d,h,n,r,o)){u=!1;break}}return o.delete(e),o.delete(t),u},RA=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},yr=Ub?Ub.prototype:void 0,ol=yr?yr.valueOf:void 0,Fu=function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!o(new Zh(e),new Zh(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return sg(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=RA;case"[object Set]":if(s||(s=al),e.size!=t.size&&!(1&r))break;return(n=a.get(e))?n==t:(r|=2,a.set(e,t),t=Rm(s(e),s(t),r,i,o,a),a.delete(e),t);case"[object Symbol]":if(ol)return ol.call(e)==ol.call(t)}return!1},Gu=Object.prototype.hasOwnProperty,Sm=Object.prototype.hasOwnProperty,SA=function(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var c=(s=n[i])[0],u=e[c],l=s[1];if(a&&s[2]){if(void 0===u&&!(c in e))return!1}else{if(s=new ue,r)var d=r(u,l,c,e,t,s);if(void 0===d?!xe(l,u,3,r,s):!d)return!1}}return!0},TA=function(e){for(var t=Jd(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,i==i&&!ob(i)]}return t},zr=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},UA=function(e){var t=TA(e);return 1==t.length&&t[0][2]?zr(t[0][0],t[0][1]):function(n){return n===e||SA(n,e,t)}},VA=function(e,t){return ll(e)&&t==t&&!ob(t)?zr(vg(e),t):function(n){var r=null==n?void 0:ai(n,e);if(void 0===(r=void 0===r?void 0:r)&&r===t){if(r=null!=n){for(var i=-1,o=(r=$h(r=e,n)).length,a=!1;++i<o;){var s=vg(r[i]);if(!(a=null!=n&&null!=n&&s in Object(n)))break;n=n[s]}r=a||++i!=o?a:!!(o=null==n?0:n.length)&&dl(o)&&cl(s,o)&&(Za(n)||Jf(n))}s=r}else s=xe(t,r,3);return s}},WA=function(e){return function(t){return null==t?void 0:t[e]}},XA=function(e){return function(t){return ai(t,e)}},jf=function(e){return"function"==typeof e?e:null==e?bi:"object"==V(e)?Za(e)?VA(e[0],e[1]):UA(e):ll(e)?WA(vg(e)):XA(e)},pl=function(e,t){return function(t,n){return(Za(t)?PA:QA)(t,e,jf(n),{})}}((function(e,t,n){ug(e,n,t)})),Bc=function(e,t){var n={};return t=jf(t),wr(e,(function(e,r,i){ug(n,r,t(e,r,i))})),n};M({target:"String",proto:!0,forced:R((function(){var e="".sub('"');return e!==e.toLowerCase()||3<e.split('"').length}))},{sub:function(){return"<sub>"+String(mb(this))+"</sub>"}});var U=ya,Vb=null;try{Vb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(c){}ya.prototype.__isLong__,Object.defineProperty(ya.prototype,"__isLong__",{value:!0}),ya.isLong=pb;var Um={},Tm={};ya.fromInt=Kd,ya.fromNumber=Kb,ya.fromBits=za;var Pg=Math.pow;ya.fromString=Hi,ya.fromValue=bc;var ye=4294967296,Vm=ye*ye,Xm=Vm/2,Ar=Kd(16777216),Lb=Kd(0);ya.ZERO=Lb;var Ld=Kd(0,!0);ya.UZERO=Ld;var kf=Kd(1);ya.ONE=kf;var Br=Kd(1,!0);ya.UONE=Br;var ql=Kd(-1);ya.NEG_ONE=ql;var Ym=za(-1,2147483647,!1);ya.MAX_VALUE=Ym;var Wm=za(-1,-1,!0);ya.MAX_UNSIGNED_VALUE=Wm;var qb=za(0,-2147483648,!1);ya.MIN_VALUE=qb;var z=ya.prototype;z.toInt=function(){return this.unsigned?this.low>>>0:this.low},z.toNumber=function(){return this.unsigned?(this.high>>>0)*ye+(this.low>>>0):this.high*ye+(this.low>>>0)},z.toString=function(e){if(2>(e=e||10)||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(qb)){var t=Kb(e),n=this.div(t);return t=n.mul(t).sub(this),n.toString(e)+t.toInt().toString(e)}return"-"+this.neg().toString(e)}n=Kb(Pg(e,6),this.unsigned),t=this;for(var r="";;){var i=t.div(n),o=(t.sub(i.mul(n)).toInt()>>>0).toString(e);if((t=i).isZero())return o+r;for(;6>o.length;)o="0"+o;r=""+o+r}},z.getHighBits=function(){return this.high},z.getHighBitsUnsigned=function(){return this.high>>>0},z.getLowBits=function(){return this.low},z.getLowBitsUnsigned=function(){return this.low>>>0},z.getNumBitsAbs=function(){if(this.isNegative())return this.eq(qb)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},z.isZero=function(){return 0===this.high&&0===this.low},z.eqz=z.isZero,z.isNegative=function(){return!this.unsigned&&0>this.high},z.isPositive=function(){return this.unsigned||0<=this.high},z.isOdd=function(){return 1==(1&this.low)},z.isEven=function(){return 0==(1&this.low)},z.equals=function(e){return pb(e)||(e=bc(e)),(this.unsigned===e.unsigned||1!=this.high>>>31||1!=e.high>>>31)&&this.high===e.high&&this.low===e.low},z.eq=z.equals,z.notEquals=function(e){return!this.eq(e)},z.neq=z.notEquals,z.ne=z.notEquals,z.lessThan=function(e){return 0>this.comp(e)},z.lt=z.lessThan,z.lessThanOrEqual=function(e){return 0>=this.comp(e)},z.lte=z.lessThanOrEqual,z.le=z.lessThanOrEqual,z.greaterThan=function(e){return 0<this.comp(e)},z.gt=z.greaterThan,z.greaterThanOrEqual=function(e){return 0<=this.comp(e)},z.gte=z.greaterThanOrEqual,z.ge=z.greaterThanOrEqual,z.compare=function(e){if(pb(e)||(e=bc(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},z.comp=z.compare,z.negate=function(){return!this.unsigned&&this.eq(qb)?qb:this.not().add(kf)},z.neg=z.negate,z.add=function(e){pb(e)||(e=bc(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=e.high>>>16,o=65535&e.high,a=e.low>>>16;return r=(a=((e=(65535&this.low)+(65535&e.low))>>>16)+(r+a))>>>16,za((65535&a)<<16|65535&e,(t=((r+=n+o)>>>16)+(t+i)&65535)<<16|65535&r,this.unsigned)},z.subtract=function(e){return pb(e)||(e=bc(e)),this.add(e.neg())},z.sub=z.subtract,z.multiply=function(e){if(this.isZero())return Lb;if(pb(e)||(e=bc(e)),Vb){var t=Vb.mul(this.low,this.high,e.low,e.high);return za(t,Vb.get_high(),this.unsigned)}if(e.isZero())return Lb;if(this.eq(qb))return e.isOdd()?qb:Lb;if(e.eq(qb))return this.isOdd()?qb:Lb;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Ar)&&e.lt(Ar))return Kb(this.toNumber()*e.toNumber(),this.unsigned);t=this.high>>>16;var n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,a=65535&e.high,s=e.low>>>16,c=i*(e=65535&e.low),u=(c>>>16)+r*e,l=u>>>16;l+=(u=(65535&u)+i*s)>>>16;var d=(l+=n*e)>>>16;return za((65535&u)<<16|65535&c,(d=(d+=(l=(65535&l)+r*s)>>>16)+((l=(65535&l)+i*a)>>>16)+(t*e+n*s+r*a+i*o)&65535)<<16|65535&l,this.unsigned)},z.mul=z.multiply,z.divide=function(e){if(pb(e)||(e=bc(e)),e.isZero())throw Error("division by zero");if(Vb)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?za(e=(this.unsigned?Vb.div_u:Vb.div_s)(this.low,this.high,e.low,e.high),Vb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Ld:Lb;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ld;if(e.gt(this.shru(1)))return Br;var t=Ld}else{if(this.eq(qb)){if(e.eq(kf)||e.eq(ql))return qb;if(e.eq(qb))return kf;var n=this.shr(1).div(e).shl(1);if(n.eq(Lb))return e.isNegative()?kf:ql;var r=this.sub(e.mul(n));return n.add(r.div(e))}if(e.eq(qb))return this.unsigned?Ld:Lb;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();t=Lb}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));var i=Math.ceil(Math.log(n)/Math.LN2);i=48>=i?1:Pg(2,i-48);for(var o=Kb(n),a=o.mul(e);a.isNegative()||a.gt(r);)a=(o=Kb(n-=i,this.unsigned)).mul(e);o.isZero()&&(o=kf),t=t.add(o),r=r.sub(a)}return t},z.div=z.divide,z.modulo=function(e){return pb(e)||(e=bc(e)),Vb?za(e=(this.unsigned?Vb.rem_u:Vb.rem_s)(this.low,this.high,e.low,e.high),Vb.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},z.mod=z.modulo,z.rem=z.modulo,z.not=function(){return za(~this.low,~this.high,this.unsigned)},z.and=function(e){return pb(e)||(e=bc(e)),za(this.low&e.low,this.high&e.high,this.unsigned)},z.or=function(e){return pb(e)||(e=bc(e)),za(this.low|e.low,this.high|e.high,this.unsigned)},z.xor=function(e){return pb(e)||(e=bc(e)),za(this.low^e.low,this.high^e.high,this.unsigned)},z.shiftLeft=function(e){return pb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?za(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):za(0,this.low<<e-32,this.unsigned)},z.shl=z.shiftLeft,z.shiftRight=function(e){return pb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?za(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):za(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},z.shr=z.shiftRight,z.shiftRightUnsigned=function(e){if(pb(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return 32>e?za(this.low>>>e|t<<32-e,t>>>e,this.unsigned):za(32===e?t:t>>>e-32,0,this.unsigned)},z.shru=z.shiftRightUnsigned,z.shr_u=z.shiftRightUnsigned,z.toSigned=function(){return this.unsigned?za(this.low,this.high,!1):this},z.toUnsigned=function(){return this.unsigned?this:za(this.low,this.high,!0)},z.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},z.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},z.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},ya.fromBytes=function(e,t,n){return n?ya.fromBytesLE(e,t):ya.fromBytesBE(e,t)},ya.fromBytesLE=function(e,t){return new ya(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},ya.fromBytesBE=function(e,t){return new ya(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var Ii=function(e,t){return(Ii=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},rl=!1,Mb={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e?console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+Error().stack):rl&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),rl=e},get useDeprecatedSynchronousErrorHandling(){return rl}},ci={closed:!0,next:function(e){},error:function(e){if(Mb.useDeprecatedSynchronousErrorHandling)throw e;Ae(e)},complete:function(){}},Nb=Array.isArray||function(e){return e&&"number"==typeof e.length},Df=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),Ta=function(){function e(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){if(!this.closed){var t=this._parentOrParents,n=this._ctorUnsubscribe,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,t instanceof e)t.remove(this);else if(null!==t)for(var o=0;o<t.length;++o)t[o].remove(this);if(ze(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(e){var a=e instanceof Df?Zm(e.errors):[e]}}if(Nb(i))for(o=-1,t=i.length;++o<t;)if(Ji(n=i[o]))try{n.unsubscribe()}catch(e){a=a||[],e instanceof Df?a=a.concat(Zm(e.errors)):a.push(e)}if(a)throw new Df(a)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(V(t)){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof e||(t=n,(n=new e)._subscriptions=[t]);break;default:throw Error("unrecognized teardown "+t+" added to Subscription.")}if(null===(t=n._parentOrParents))n._parentOrParents=this;else if(t instanceof e){if(t===this)return n;n._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return n;t.push(this)}return null===(t=this._subscriptions)?this._subscriptions=[n]:t.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;t&&-1!==(e=t.indexOf(e))&&t.splice(e,1)},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),di="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ma=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=ci;break;case 1:if(!n){o.destination=ci;break}if("object"===V(n)){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new Cr(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new Cr(o,n,r,i)}return o}return O(t,e),t.prototype[di]=function(){return this},t.create=function(e,n,r){return(e=new t(e,n,r)).syncErrorThrowable=!1,e},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=e,this},t}(Ta),Cr=function(e){function t(t,n,r,i){var o=e.call(this)||this;if(o._parentSubscriber=t,t=o,ze(n))var a=n;else n&&(a=n.next,r=n.error,i=n.complete,n!==ci&&(ze((t=Object.create(n)).unsubscribe)&&o.add(t.unsubscribe.bind(t)),t.unsubscribe=o.unsubscribe.bind(o)));return o._context=t,o._next=a,o._error=r,o._complete=i,o}return O(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;Mb.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=Mb.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?this.__tryOrSetError(t,this._error,e):this.__tryOrUnsub(this._error,e),this.unsubscribe();else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):Ae(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;Ae(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};Mb.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,n):this.__tryOrUnsub(n)}this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),Mb.useDeprecatedSynchronousErrorHandling)throw e;Ae(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!Mb.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{t.call(this._context,n)}catch(t){return Mb.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0):Ae(t),!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._parentSubscriber=this._context=null,e.unsubscribe()},t}(ma),Be="function"==typeof Symbol&&Symbol.observable||"@@observable",Y=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator;e:{if(e){if(e instanceof ma)break e;if(e[di]){e=e[di]();break e}}e=e||t||n?new ma(e,t,n):new ma(ci)}if(r?e.add(r.call(e,this.source)):e.add(this.source||Mb.useDeprecatedSynchronousErrorHandling&&!e.syncErrorThrowable?this._subscribe(e):this._trySubscribe(e)),Mb.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable&&(e.syncErrorThrowable=!1,e.syncErrorThrown))throw e.syncErrorValue;return e},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){Mb.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),Ki(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=an(t))((function(t,r){var i=n.subscribe((function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[Be]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:$m(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=an(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}(),xd=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),Dr=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return O(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;this.subject=null,!t||0===t.length||e.isStopped||e.closed||-1!==(e=t.indexOf(this.subscriber))&&t.splice(e,1)}},t}(Ta),Er=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return O(t,e),t}(ma),Ua=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return O(t,e),t.prototype[di]=function(){return new Er(this)},t.prototype.lift=function(e){var t=new Fr(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new xd;if(!this.isStopped){var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].next(e)}},t.prototype.error=function(e){if(this.closed)throw new xd;this.hasError=!0,this.thrownError=e,this.isStopped=!0;var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new xd;this.isStopped=!0;var e=this.observers,t=e.length;e=e.slice();for(var n=0;n<t;n++)e[n].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new xd;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new xd;return this.hasError?(e.error(this.thrownError),Ta.EMPTY):this.isStopped?(e.complete(),Ta.EMPTY):(this.observers.push(e),new Dr(this,e))},t.prototype.asObservable=function(){var e=new Y;return e.source=this,e},t.create=function(e,t){return new Fr(e,t)},t}(Y),Fr=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return O(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Ta.EMPTY},t}(Ua),Hu=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;return n._refCount++,e=new YA(e,n),t=t.subscribe(e),e.closed||(e.connection=n.connect()),t},e}(),YA=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return O(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null},t}(ma),Gr=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return O(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new Ta).add(this.source.subscribe(new ZA(this.getSubject(),this))),e.closed&&(this._connection=null,e=Ta.EMPTY)),e},t.prototype.refCount=function(){return bn()(this)},t}(Y),uv=function(){var e=Gr.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),ZA=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return O(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(Er);!function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}O(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null}}(ma),function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).keySelector=n,t.elementSelector=r,t.durationSelector=i,t.subjectSelector=o,t.groups=null,t.attemptedToUnsubscribe=!1,t.count=0,t}O(t,e),t.prototype._next=function(e){try{var t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r=n.get(t);if(this.elementSelector)try{var i=this.elementSelector(e)}catch(e){this.error(e)}else i=e;if(!r&&(r=this.subjectSelector?this.subjectSelector():new Ua,n.set(t,r),e=new sl(t,r,this),this.destination.next(e),this.durationSelector)){e=void 0;try{e=this.durationSelector(new sl(t,r))}catch(e){return void this.error(e)}this.add(e.subscribe(new $A(t,r,this)))}r.closed||r.next(i)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach((function(t,n){t.error(e)})),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach((function(e,t){e.complete()})),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))}}(ma);var $A=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return O(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(ma),sl=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return O(t,e),t.prototype._subscribe=function(e){var t=new Ta,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new aB(n)),t.add(r.subscribe(e)),t},t}(Y),aB=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return O(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),--t.count,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(Ta),bB=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return O(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new xd;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Ua),wg=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return O(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,e=this.id;var n=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(n,e,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(e=this._execute(e,t))?e:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},t.prototype._execute=function(e,t){t=!1;var n=void 0;try{this.work(e)}catch(e){t=!0,n=!!e&&e||Error(e)}if(t)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return O(t,e),t.prototype.schedule=function(e,t){return this},t}(Ta)),cB=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),0<n?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return 0<n||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(wg),tl=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),xg=function(e){function t(n,r){void 0===r&&(r=tl.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return O(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(tl),yg=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t}(xg))(cB),yb=new Y((function(e){return e.complete()})),cn=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}},ul;!function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(ul||(ul={}));var lf=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return eb(this.value);case"E":return Z(this.error);case"C":return Ef()}throw Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Lu=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new Hr(e,this.scheduler,this.delay))},e}(),Hr=function(e){function t(t,n,r){return void 0===r&&(r=0),(t=e.call(this,t)||this).scheduler=n,t.delay=r,t}return O(t,e),t.dispatch=function(e){e.notification.observe(e.destination),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new dB(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(lf.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(lf.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(lf.createComplete()),this.unsubscribe()},t}(ma),dB=function(e,t){this.notification=e,this.destination=t},Ee=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=1>t?1:t,i._windowTime=1>n?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return O(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new eB(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t=this._infiniteTimeWindow,n=t?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;if(this.closed)throw new xd;if(this.isStopped||this.hasError)var o=Ta.EMPTY;else this.observers.push(e),o=new Dr(this,e);if(r&&e.add(e=new Hr(e,r)),t)for(t=0;t<i&&!e.closed;t++)e.next(n[t]);else for(t=0;t<i&&!e.closed;t++)e.next(n[t].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),o},t.prototype._getNow=function(){return(this.scheduler||yg).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),0<o&&r.splice(0,o),r},t}(Ua),eB=function(e,t){this.time=e,this.value=t},Gf=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return O(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),Ta.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),Ta.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(Ua),fB=1,gB=Promise.resolve(),Ni={},Ir={setImmediate:function(e){var t=fB++;return Ni[t]=!0,gB.then((function(){return dn(t)&&e()})),t},clearImmediate:function(e){dn(e)}},hB=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=Ir.setImmediate(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(Ir.clearImmediate(n),t.scheduled=void 0)},t}(wg),Xi=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(xg))(hB),iB=Xi,vl=new xg(wg),id=vl,jB=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(wg),Jr=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(xg))(jB),kB=function(e){function t(t,n){void 0===t&&(t=Kr),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return O(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(xg),Kr=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return O(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),this.delay=e.frame+r,(e=e.actions).push(this),e.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(wg),wl=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),Sg=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),sb=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),Mu=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new lB(e,this.project,this.thisArg))},e}(),lB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).project=n,t.count=0,t.thisArg=r||t,t}return O(t,e),t.prototype._next=function(e){try{var t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ma),xl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(ma),Ru=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return O(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(ma),mB=function(e){return function(t){return e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,Ae),t}},gd="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",nB=function(e){return function(t){for(var n=e[gd]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t}},oB=function(e){return function(t){var n=e[Be]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}},kn=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},Hf=function(e){if(e&&"function"==typeof e[Be])return oB(e);if(kn(e))return cn(e);if(hn(e))return mB(e);if(e&&"function"==typeof e[gd])return nB(e);throw e=Ji(e)?"an invalid object":"'"+e+"'",new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Lr={},qB=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new pB(e,this.resultSelector))},e}(),pB=function(e){function t(t,n){return(t=e.call(this,t)||this).resultSelector=n,t.active=0,t.values=[],t.observables=[],t}return O(t,e),t.prototype._next=function(e){this.values.push(Lr),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.toRespond=this.active=t;for(var n=0;n<t;n++)this.add(Oi(this,e[n],void 0,n))}},t.prototype.notifyComplete=function(e){0==--this.active&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=(e=this.values)[n];r=this.toRespond?r===Lr?--this.toRespond:this.toRespond:0,e[n]=t,0===r&&(this.resultSelector?this._tryResultSelector(e):this.destination.next(e.slice()))},t.prototype._tryResultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(xl),Cc=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return O(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(ma);!function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i}O(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(ma);var Dc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(ma);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}O(t,e),t.prototype.notifyNext=function(e,t,n,r){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()}}(ma);var Vu=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new rB(e,this.project,this.concurrent))},e}(),rB=function(e){function t(t,n,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),(t=e.call(this,t)||this).project=n,t.concurrent=r,t.hasCompleted=!1,t.buffer=[],t.active=0,t.index=0,t}return O(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new Cc(this),n=this.destination;n.add(t),(e=qc(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,0<e.length?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(Dc),yl=C.parseFloat,Mr=-1/0!=1/yl("\t\n\v\f\r \u2028\u2029\ufeff-0")?function(e){e=Ij(String(e));var t=yl(e);return 0===t&&"-"==e.charAt(0)?-0:t}:yl;M({global:!0,forced:parseFloat!=Mr},{parseFloat:Mr});var zl=new Y(pc),$u=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new sB(e,this.predicate,this.thisArg))},e}(),sB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.thisArg=r,t.count=0,t}return O(t,e),t.prototype._next=function(e){try{var t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(ma),av=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new tB(e))},e}(),tB=function(e){function t(t){return(t=e.call(this,t)||this).hasFirst=!1,t.observables=[],t.subscriptions=[],t}return O(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=Oi(this,e[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){for(this.hasFirst=!0,e=0;e<this.subscriptions.length;e++)if(e!==n){var r=this.subscriptions[e];r.unsubscribe(),this.remove(r)}this.subscriptions=null}this.destination.next(t)},t}(xl),dv=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new uB(e,this.resultSelector))},e}(),uB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).resultSelector=n,t.iterators=[],t.active=0,t.resultSelector="function"==typeof n?n:void 0,t}return O(t,e),t.prototype._next=function(e){var t=this.iterators;Nb(e)?t.push(new vB(e)):"function"==typeof e[gd]?t.push(new wB(e[gd]())):t.push(new xB(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0===t)this.destination.complete();else{this.active=t;for(var n=0;n<t;n++){var r=e[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){var i=e[r];if("function"==typeof i.hasValue&&!i.hasValue())return}var o=!1,a=[];for(r=0;r<t;r++){var s=(i=e[r]).next();if(i.hasCompleted()&&(o=!0),s.done)return void n.complete();a.push(s.value)}this.resultSelector?this._tryresultSelector(a):n.next(a),o&&n.complete()},t.prototype._tryresultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ma),wB=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return!(!e||!e.done)},e}(),vB=function(){function e(e){this.array=e,this.length=this.index=0,this.length=e.length}return e.prototype[gd]=function(){return this},e.prototype.next=function(e){e=this.index++;var t=this.array;return e<this.length?{value:t[e],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),xB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).parent=n,t.observable=r,t.stillUnsubscribed=!0,t.buffer=[],t.isComplete=!1,t}return O(t,e),t.prototype[gd]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return 0<this.buffer.length},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return qc(this.observable,new Cc(this))},t}(Dc),yB=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Gr,GroupedObservable:sl,observable:Be,Subject:Ua,BehaviorSubject:bB,ReplaySubject:Ee,AsyncSubject:Gf,asap:iB,asapScheduler:Xi,async:id,asyncScheduler:vl,queue:yg,queueScheduler:yg,animationFrame:Jr,animationFrameScheduler:Jr,VirtualTimeScheduler:kB,VirtualAction:Kr,Scheduler:tl,Subscription:Ta,Subscriber:ma,Notification:lf,get NotificationKind(){return ul},pipe:Li,noop:pc,identity:ed,isObservable:function(e){return!!e&&(e instanceof Y||"function"==typeof e.lift&&"function"==typeof e.subscribe)},ArgumentOutOfRangeError:wl,EmptyError:Sg,ObjectUnsubscribedError:xd,UnsubscriptionError:Df,TimeoutError:sb,bindCallback:en,bindNodeCallback:fn,combineLatest:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=t=void 0;return fd(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&Nb(e[0])&&(e=e[0]),Ff(e,n).lift(new qB(t))},concat:ln,defer:hd,empty:Ef,forkJoin:mn,from:Ob,fromEvent:jb,fromEventPattern:on,generate:function(e,t,n,r,i){if(1==arguments.length){var o=e.initialState;t=e.condition,n=e.iterate;var a=e.resultSelector||ed;i=e.scheduler}else void 0===r||fd(r)?(o=e,a=ed,i=r):(o=e,a=r);return new Y((function(e){var r=o;if(i)return i.schedule(Wu,0,{subscriber:e,iterate:n,condition:t,resultSelector:a,state:r});for(;;){if(t){var s=void 0;try{s=t(r)}catch(t){e.error(t);break}if(!s){e.complete();break}}s=void 0;try{s=a(r)}catch(t){e.error(t);break}if(e.next(s),e.closed)break;try{r=n(r)}catch(t){e.error(t);break}}}))},iif:function(e,t,n){return void 0===t&&(t=yb),void 0===n&&(n=yb),hd((function(){return e()?t:n}))},interval:pn,merge:cc,never:function(){return zl},of:eb,onErrorResumeNext:Qi,pairs:function(e,t){return new Y(t?function(n){var r=Object.keys(e),i=new Ta;return i.add(t.schedule(Yu,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i}:function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})},partition:function(e,t,n){return[zb(t,n)(new Y(Hf(e))),zb(Zu(t,n))(new Y(Hf(e)))]},race:Da,range:function(e,t,n){return void 0===e&&(e=0),new Y((function(r){void 0===t&&(t=e,e=0);var i=0,o=e;if(n)return n.schedule(bv,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(o++),r.closed)break}}))},throwError:Z,timer:Kc,using:function(e,t){return new Y((function(n){try{var r=e()}catch(e){return void n.error(e)}try{var i=t(r)}catch(e){return void n.error(e)}var o=(i?Ob(i):yb).subscribe(n);return function(){o.unsubscribe(),r&&r.unsubscribe()}}))},zip:Ri,scheduled:jn,EMPTY:yb,NEVER:zl,config:Mb}),ev=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new zB(e,this.selector,this.caught))},e}(),zB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).selector=n,t.caught=r,t}return O(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle(),t=new Cc(this),this.add(t),(n=qc(n,t))!==t&&this.add(n)}},t}(Dc),fv=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new AB(e,this.defaultValue))},e}(),AB=function(e){function t(t,n){return(t=e.call(this,t)||this).defaultValue=n,t.isEmpty=!0,t}return O(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(ma),gv=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new BB(e,this.delay,this.scheduler))},e}(),BB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).delay=n,t.scheduler=r,t.queue=[],t.active=!1,t.errored=!1,t}return O(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;0<n.length&&0>=n[0].time-r.now();)n.shift().notification.observe(i);0<n.length?(t=Math.max(0,n[0].time-r.now()),this.schedule(e,t)):(this.unsubscribe(),t.active=!1)},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler;e=new CB(t.now()+this.delay,e),this.queue.push(e),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(lf.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(lf.createComplete()),this.unsubscribe()},t}(ma),CB=function(e,t){this.time=e,this.notification=t},hv=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new DB(e,this.keySelector,this.flushes))},e}(),DB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).keySelector=n,t.values=new Set,r&&t.add(qc(r,new Cc(t))),t}return O(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t=this.destination;try{var n=this.keySelector(e)}catch(e){return void t.error(e)}this._finalizeNext(n,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(Dc),jv=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new EB(e,this.errorFactory))},e}(),EB=function(e){function t(t,n){return(t=e.call(this,t)||this).errorFactory=n,t.hasValue=!1,t}return O(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(ma),kv=function(){function e(e){if(this.total=e,0>this.total)throw new wl}return e.prototype.call=function(e,t){return t.subscribe(new FB(e,this.total))},e}(),FB=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.count=0,t}return O(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(ma),lv=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new GB(e,this.project))},e}(),GB=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.hasSubscription=!1,t.hasCompleted=!1,t.index=0,t}return O(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.hasSubscription=!0,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new Cc(this),n=this.destination;n.add(t),(e=qc(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(Dc),mv=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new HB(e,this.callback))},e}(),HB=function(e){function t(t,n){return(t=e.call(this,t)||this).add(new Ta(n)),t}return O(t,e),t}(ma),ov=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new IB(e))},e}(),IB=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype._next=function(e){},t}(ma),pv=function(){function e(e){if(this.total=e,0>this.total)throw new wl}return e.prototype.call=function(e,t){return t.subscribe(new JB(e,this.total))},e}(),JB=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.ring=[],t.count=0,t}return O(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(0<t)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()},t}(ma),qv=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new KB(e,this.value))},e}(),KB=function(e){function t(t,n){return(t=e.call(this,t)||this).value=n,t}return O(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(ma),rv=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new LB(e,this.accumulator,this.seed,this.hasSeed))},e}(),LB=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this).accumulator=n,t._seed=r,t.hasSeed=i,t.index=0,t}return O(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.accumulator(this.seed,e,t)}catch(e){this.destination.error(e)}this.seed=n,this.destination.next(n)},t}(ma),tv=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory();return(e=n(r).subscribe(e)).add(t.subscribe(r)),e},e}(),vv=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new MB(e,this.notifier,this.source))},e}(),MB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).notifier=n,t.source=r,t}return O(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.retriesSubscription=this.errors=void 0;else{n=new Ua;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}i=qc(r,new Cc(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(Dc),yv=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new NB(e,this.project))},e}(),NB=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.index=0,t}return O(t,e),t.prototype._next=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this._innerSub(n)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe(),t=new Cc(this);var n=this.destination;n.add(t),this.innerSubscription=qc(e,t),this.innerSubscription!==t&&n.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(Dc),zv=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){e=new OB(e);var n=qc(this.notifier,new Cc(e));return n&&!e.seenValue?(e.add(n),t.subscribe(e)):e},e}(),OB=function(e){function t(t){return(t=e.call(this,t)||this).seenValue=!1,t}return O(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(Dc),Bv=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new PB(e,this.predicate,this.inclusive))},e}(),PB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.inclusive=r,t.index=0,t}return O(t,e),t.prototype._next=function(e){var t=this.destination;try{var n=this.predicate(e,this.index++)}catch(e){return void t.error(e)}this.nextOrComplete(e,n)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;t?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(ma),Cv=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new QB(e,this.nextOrObserver,this.error,this.complete))},e}(),QB=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this)._tapNext=pc,t._tapError=pc,t._tapComplete=pc,t._tapError=r||pc,t._tapComplete=i||pc,ze(n)?(t._context=t,t._tapNext=n):n&&(t._context=n,t._tapNext=n.next||pc,t._tapError=n.error||pc,t._tapComplete=n.complete||pc),t}return O(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(ma),Ev={leading:!0,trailing:!1};!function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}O(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._sendValue;this._hasValue&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=void 0},t.prototype.throttle=function(e){(e=this.tryDurationSelector(e))&&this.add(this._throttled=qc(e,new Cc(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()}}(Dc);for(var Fv=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new RB(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),RB=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).duration=n,t.scheduler=r,t.leading=i,t.trailing=o,t._hasTrailingValue=!1,t._trailingValue=null,t}return O(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Gv,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(ma),Iv=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new SB(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),SB=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).absoluteTimeout=n,t.waitFor=r,t.withObservable=i,t.scheduler=o,t.scheduleTimeout(),t}return O(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(qc(t,new Cc(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},t}(Dc),Kv=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new TB(e,this.observables,this.project))},e}(),TB=function(e){function t(t,n,r){(t=e.call(this,t)||this).observables=n,t.project=r,t.toRespond=[],r=n.length,t.values=Array(r);for(var i=0;i<r;i++)t.toRespond.push(i);for(i=0;i<r;i++)t.add(Oi(t,n[i],void 0,i));return t}return O(t,e),t.prototype.notifyNext=function(e,t,n){this.values[n]=t,0<(e=this.toRespond).length&&-1!==(n=e.indexOf(n))&&e.splice(n,1)},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){0===this.toRespond.length&&(e=[e].concat(this.values),this.project?this._tryProject(e):this.destination.next(e))},t.prototype._tryProject=function(e){try{var t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(xl),Nr=cb((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=Array(16);e.exports=function(){for(var e,t=0;16>t;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}})),db=[],ei=0;256>ei;++ei)db[ei]=(ei+256).toString(16).substr(1);var Or=function(e,t){return t=t||0,[db[e[t++]],db[e[t++]],db[e[t++]],db[e[t++]],"-",db[e[t++]],db[e[t++]],"-",db[e[t++]],db[e[t++]],"-",db[e[t++]],db[e[t++]],"-",db[e[t++]],db[e[t++]],db[e[t++]],db[e[t++]],db[e[t++]],db[e[t++]]].join("")},de=function(e,t,n){if(n=t&&n||0,"string"==typeof e&&(t="binary"===e?Array(16):null,e=null),(e=(e=e||{}).random||(e.rng||Nr)())[6]=15&e[6]|64,e[8]=63&e[8]|128,t)for(var r=0;16>r;++r)t[n+r]=e[r];return t||Or(e)},zg=de(),Ti=!1,xn=new AbortController,Vc,yd,Al,Bl,zd,ee,mc,mf,Wb,Cl,Wc,fe,Xc,Yc,Zc,nf,$c,ad;!function(e){e[e.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e[e.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e[e.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e[e.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e[e.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"}(Vc||(Vc={})),function(e){e[e.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e[e.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e[e.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e[e.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e[e.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e[e.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(yd||(yd={})),function(e){e[e.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Al||(Al={})),function(e){e[e.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Bl||(Bl={})),function(e){e[e.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e[e.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e[e.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e[e.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e[e.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e[e.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(zd||(zd={})),function(e){e[e.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e[e.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e[e.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e[e.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e[e.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(ee||(ee={})),function(e){e[e.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e[e.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e[e.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e[e.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e[e.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e[e.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e[e.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(mc||(mc={})),function(e){e[e.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e[e.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e[e.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e[e.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(mf||(mf={})),function(e){e[e.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e[e.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e[e.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e[e.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e[e.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e[e.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e[e.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e[e.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e[e.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e[e.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e[e.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Wb||(Wb={})),function(e){e[e.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Cl||(Cl={})),function(e){e[e.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e[e.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e[e.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e[e.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e[e.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e[e.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e[e.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Wc||(Wc={})),function(e){e[e.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(fe||(fe={})),function(e){e[e.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e[e.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e[e.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e[e.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e[e.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e[e.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e[e.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e[e.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Xc||(Xc={})),function(e){e[e.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Yc||(Yc={})),function(e){e[e.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e[e.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e[e.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e[e.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Zc||(Zc={})),function(e){e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(nf||(nf={})),function(e){e[e.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",e[e.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",e[e.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",e[e.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",e[e.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}($c||($c={})),function(e){e[e.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",e[e.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",e[e.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",e[e.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",e[e.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(ad||(ad={}));var Xb=Vc.ATTRIBUTE_OPERATION_ERR_FAILURE,Oa=Vc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,Ge=Vc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Vc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Pr=Vc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Yb=Vc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Zb=Vc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,Ag=yd.CHANNEL_MESSAGE_ERR_FAILURE,Dl=yd.CHANNEL_MESSAGE_ERR_TIMEOUT,Qr=yd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,fi=yd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE,UB=yd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL,El=yd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,VB=Al.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Rr=Bl.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Yc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Sr=Yc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Yc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Tr=Yc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,WB=Yc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Yc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var XB=Yc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,YB=zd.GET_MEMBERS_ERR_FAILURE,ZB=zd.GET_MEMBERS_ERR_REJECTED;zd.GET_MEMBERS_ERR_TIMEOUT,zd.GET_MEMBERS_ERR_TOO_OFTEN;var $B=zd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,aC=zd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,Ec=ee.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,bC=ee.INVITATION_API_CALL_ERR_NOT_STARTED,gi=ee.INVITATION_API_CALL_ERR_ALREADY_END,Ur=ee.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,cC=ee.INVITATION_API_CALL_ERR_ALREADY_SENT,Vr=mc.JOIN_CHANNEL_ERR_FAILURE;mc.JOIN_CHANNEL_ERR_REJECTED;var dC=mc.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Wr=mc.JOIN_CHANNEL_TIMEOUT,Xr=mc.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Yr=mc.JOIN_CHANNEL_ERR_ALREADY_JOINED;mc.JOIN_CHANNEL_ERR_TOO_OFTEN;var Zr=mc.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,$r=mc.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,as=mf.LEAVE_CHANNEL_ERR_FAILURE,bs=mf.LEAVE_CHANNEL_ERR_REJECTED,eC=mf.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,fC=mf.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,cs=Wb.LOGIN_ERR_UNKNOWN,Bg=Wb.LOGIN_ERR_REJECTED,hi=Wb.LOGIN_ERR_INVALID_ARGUMENT,ds=Wb.LOGIN_ERR_INVALID_APP_ID,es=Wb.LOGIN_ERR_INVALID_TOKEN,ii=Wb.LOGIN_ERR_TOKEN_EXPIRED;Wb.LOGIN_ERR_NOT_AUTHORIZED;var gC=Wb.LOGIN_ERR_ALREADY_LOGIN,hC=Wb.LOGIN_ERR_TIMEOUT,iC=Wb.LOGIN_ERR_TOO_OFTEN,fs=Cl.LOGOUT_ERR_USER_NOT_LOGGED_IN,gs=Wc.PEER_MESSAGE_ERR_FAILURE,Fl=Wc.PEER_MESSAGE_ERR_TIMEOUT,hs=Wc.PEER_MESSAGE_ERR_TOO_OFTEN,Gl=Wc.PEER_MESSAGE_ERR_INVALID_USERID,Ie=Wc.PEER_MESSAGE_ERR_INVALID_MESSAGE,Hl=Wc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,jC=Wc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,is=fe.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;fe.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var kC=fe.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;fe.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var lC=fe.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,mC=Xc.RENEW_TOKEN_ERR_FAILURE,nC=Xc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Xc.RENEW_TOKEN_ERR_REJECTED,Xc.RENEW_TOKEN_ERR_TOO_OFTEN;var oC=Xc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,pC=Xc.RENEW_TOKEN_ERR_INVALID_TOKEN,qC=Xc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,js=Zc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,Cg=Zc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Zc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var rC=Zc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Zc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var ks=Zc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,Il=Zc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;nf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,nf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,nf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,nf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var Dg=$c.UPLOAD_MEDIA_ERR_FAILURE,Of=$c.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,ji=$c.UPLOAD_MEDIA_ERR_TIMEOUT,sC=$c.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,tC=$c.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ls=$c.UPLOAD_MEDIA_ERR_INTERRUPTED,uC=$c.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,Eg=ad.DOWNLOAD_MEDIA_ERR_FAILURE,Jl=ad.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,vC=ad.DOWNLOAD_MEDIA_ERR_TIMEOUT,wC=ad.DOWNLOAD_MEDIA_ERR_NOT_EXIST,xC=ad.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ms=ad.DOWNLOAD_MEDIA_ERR_INTERRUPTED,yC=ad.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,zC=function(e,t){var n;return nl(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n},ki=function(e,t,n){if(!ob(n))return!1;var r=V(t);return!!("number"==r?Nd(n)&&cl(t,n.length):"string"==r&&t in n)&&sg(n[t],e)},Kl=function(e,t,n){var r=Za(e)?xr:zC;return n&&ki(e,t,n)&&(t=void 0),r(e,jf(t))},AC=function(e,t){var n=-1,r=Nd(e)?Array(e.length):[];return nl(e,(function(e,i,o){r[++n]=t(e,i,o)})),r},BC=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e},CC=function(e,t,n){t=t.length?ve(t,(function(e){return Za(e)?function(t){return ai(t,1===e.length?e[0]:e)}:e})):[bi];var r=-1;return t=ve(t,Yh(jf)),e=AC(e,(function(e,n,i){return{criteria:ve(t,(function(t){return t(e)})),index:++r,value:e}})),BC(e,(function(e,t){e:{for(var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;++r<a;){t:{var c=i[r],u=o[r];if(c!==u){var l=void 0!==c,d=null===c,h=c==c,f=we(c),p=void 0!==u,m=null===u,g=u==u,v=we(u);if(!m&&!v&&!f&&c>u||f&&p&&g&&!m&&!v||d&&p&&g||!l&&g||!h){c=1;break t}if(!d&&!f&&!v&&c<u||v&&l&&h&&!d&&!f||m&&l&&h||!p&&h||!g){c=-1;break t}}c=0}if(c){e=r>=s?c:c*("desc"==n[r]?-1:1);break e}}e=e.index-t.index}return e}))},ns=function(e,t){return vr(ur(e,t,bi),e+"")},os=ns((function(e,t){if(null==e)return[];var n=t.length;return 1<n&&ki(e,t[0],t[1])?t=[]:2<n&&ki(t[0],t[1],t[2])&&(t=[t[0]]),CC(e,Ei(t,1),[])})),ps=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}(yB),qs=cb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=[],r=function(e,t){return new WebSocket(e,t)};t.normalClosureMessage="Normal closure",t.default=function(e,i){var o=(i=void 0===i?{protocols:n,makeWebSocket:r}:i).protocols,a=void 0===o?n:o,s=void 0===(i=i.makeWebSocket)?r:i;return new ps.Observable((function(n){var r,i=new ps.Subject,o=s(e,a),c=!1,u=!1,l=function(e){if(r)throw c=!0,e=Error("Web socket message factory function called more than once"),n.error(e),e;return r=e.subscribe((function(e){o.send(e)})),i};return o.onopen=function(){u?(c=!0,o.close()):n.next(l)},o.onmessage=function(e){i.next(e.data)},o.onerror=function(e){c=!0,n.error(Error(e.message))},o.onclose=function(e){c||(c=!0,u?(n.complete(),i.complete()):n.error(Error(1e3===e.code?t.normalClosureMessage:e.reason)))},function(){u=!0,r&&r.unsubscribe(),c||(c=!0,o.close())}}))}}));!function(e){e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default}(qs);var Vi=function(e,t,n){(void 0===n||sg(e[t],n))&&(void 0!==n||t in e)||ug(e,t,n)},Ui=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},DC=function(e){return ns((function(t,n){var r=-1,i=n.length,o=1<i?n[i-1]:void 0,a=2<i?n[2]:void 0;for(o=3<e.length&&"function"==typeof o?(i--,o):void 0,a&&ki(n[0],n[1],a)&&(o=3>i?void 0:o,i=1),t=Object(t);++r<i;)(a=n[r])&&e(t,a,r,o);return t}))}((function(e,t,n,r){yn(e,t,n,r)})),EC=Math.floor,FC=Math.random,rs=function(e,t){return e+EC(FC()*(t-e+1))},ss=function(e){var t=e.length;return t?e[rs(0,t-1)]:void 0},GC=function(e,t){return ve(t,(function(t){return e[t]}))},tj=function(e){return null==e?[]:GC(e,Jd(e))},HC=function(e){return ss(tj(e))},fo=function(e){return(Za(e)?ss:HC)(e)},Cn=[],Dn=function(e,t){return new WebSocket(e,t)},IC=Math.floor;M({target:"Number",stat:!0},{isInteger:function(e){return!ha(e)&&isFinite(e)&&IC(e)===e}}),Up("from",ok,nk);var JC=function(e,t){for(var n=Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,a){n[r]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,a(e))}}))},KC=cb((function(e,t){t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;1<--t%4&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};var n=Array(64),r=Array(123);for(e=0;64>e;)r[n[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;t.encode=function(e,t,r){for(var i,o=null,a=[],s=0,c=0;t<r;){var u=e[t++];switch(c){case 0:a[s++]=n[u>>2],i=(3&u)<<4,c=1;break;case 1:a[s++]=n[i|u>>4],i=(15&u)<<2,c=2;break;case 2:a[s++]=n[i|u>>6],a[s++]=n[63&u],c=0}8191<s&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return c&&(a[s++]=n[i],a[s++]=61,1===c&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))},t.decode=function(e,t,n){for(var i,o=n,a=0,s=0;s<e.length;){var c=e.charCodeAt(s++);if(61===c&&1<a)break;if(void 0===(c=r[c]))throw Error("invalid encoding");switch(a){case 0:i=c,a=1;break;case 1:t[n++]=i<<2|(48&c)>>4,i=c,a=2;break;case 2:t[n++]=(15&i)<<4|(60&c)>>2,i=c,a=3;break;case 3:t[n++]=(3&i)<<6|c,a=0}}if(1===a)throw Error("invalid encoding");return n-o},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}));Vg.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},Vg.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else{e=this._listeners[e];for(var n=0;n<e.length;)e[n].fn===t?e.splice(n,1):++n}return this},Vg.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var LC=En(En),MC=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(e){}return null},NC=cb((function(e,t){t.length=function(e){for(var t,n=0,r=0;r<e.length;++r)128>(t=e.charCodeAt(r))?n+=1:2048>t?n+=2:55296==(64512&t)&&56320==(64512&e.charCodeAt(r+1))?(++r,n+=4):n+=3;return n},t.read=function(e,t,n){if(1>n-t)return"";for(var r,i=null,o=[],a=0;t<n;)128>(r=e[t++])?o[a++]=r:191<r&&224>r?o[a++]=(31&r)<<6|63&e[t++]:239<r&&365>r?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(r>>10),o[a++]=56320+(1023&r)):o[a++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],8191<a&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},t.write=function(e,t,n){for(var r,i,o=n,a=0;a<e.length;++a)128>(r=e.charCodeAt(a))?t[n++]=r:(2048>r?t[n++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(a+1)))?(r=65536+((1023&r)<<10)+(1023&i),++a,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-o}})),OC=function(e,t,n){var r=n||8192,i=r>>>1,o=null,a=r;return function(n){return 1>n||n>i?e(n):(a+n>r&&(o=e(r),a=0),n=t.call(o,a,a+=n),7&a&&(a=1+(7|a)),n)}},ge=$a.zero=new $a(0,0);ge.toNumber=function(){return 0},ge.zzEncode=ge.zzDecode=function(){return this},ge.length=function(){return 1};var PC=$a.zeroHash="\0\0\0\0\0\0\0\0";$a.fromNumber=function(e){if(0===e)return ge;var t=0>e;t&&(e=-e);var n=e>>>0;return e=(e-n)/4294967296>>>0,t&&(e=~e>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++e&&(e=0))),new $a(n,e)},$a.from=function(e){if("number"==typeof e)return $a.fromNumber(e);if(W.isString(e)){if(!W.Long)return $a.fromNumber(parseInt(e,10));e=W.Long.fromString(e)}return e.low||e.high?new $a(e.low>>>0,e.high>>>0):ge},$a.prototype.toNumber=function(e){if(!e&&this.hi>>>31){e=1+~this.lo>>>0;var t=~this.hi>>>0;return e||(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi},$a.prototype.toLong=function(e){return W.Long?new W.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var Ad=String.prototype.charCodeAt;$a.fromHash=function(e){return e===PC?ge:new $a((Ad.call(e,0)|Ad.call(e,1)<<8|Ad.call(e,2)<<16|Ad.call(e,3)<<24)>>>0,(Ad.call(e,4)|Ad.call(e,5)<<8|Ad.call(e,6)<<16|Ad.call(e,7)<<24)>>>0)},$a.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},$a.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},$a.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},$a.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?16384>e?128>e?1:2:2097152>e?3:4:16384>t?128>t?5:6:2097152>t?7:8:128>n?9:10};var W=cb((function(e,t){function n(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function r(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=JC,t.base64=KC,t.EventEmitter=Vg,t.float=LC,t.inquire=MC,t.utf8=NC,t.pool=OC,t.LongBits=$a,t.isNode=!!(void 0!==Ka&&Ka&&Ka.process&&Ka.process.versions&&Ka.process.versions.node),t.global=t.isNode&&Ka||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||Ka,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"===V(e)},t.isset=t.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==V(n)||0<(Array.isArray(n)?n.length:Object.keys(n).length))},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,n){return e=t.LongBits.fromHash(e),t.Long?t.Long.fromBits(e.lo,e.hi,n):e.toNumber(!!n)},t.merge=n,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=r,t.ProtocolError=r("ProtocolError"),t.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;-1<n;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},t.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}})),cj=na,Ll,li=W.LongBits,ts=W.base64,us=W.utf8,vs=function(){return W.Buffer?function(){return(na.create=function(){return new Ll})()}:function(){return new na}};na.create=vs(),na.alloc=function(e){return new W.Array(e)},W.Array!==Array&&(na.alloc=W.pool(na.alloc,W.Array.prototype.subarray)),na.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Kf(e,t,n),this.len+=t,this},$i.prototype=Object.create(Kf.prototype),$i.prototype.fn=function(e,t,n){for(;127<e;)t[n++]=127&e|128,e>>>=7;t[n]=e},na.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new $i(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},na.prototype.int32=function(e){return 0>e?this._push(aj,10,li.fromNumber(e)):this.uint32(e)},na.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},na.prototype.uint64=function(e){return e=li.from(e),this._push(aj,e.length(),e)},na.prototype.int64=na.prototype.uint64,na.prototype.sint64=function(e){return e=li.from(e).zzEncode(),this._push(aj,e.length(),e)},na.prototype.bool=function(e){return this._push(Zi,1,e?1:0)},na.prototype.fixed32=function(e){return this._push(bj,4,e>>>0)},na.prototype.sfixed32=na.prototype.fixed32,na.prototype.fixed64=function(e){return e=li.from(e),this._push(bj,4,e.lo)._push(bj,4,e.hi)},na.prototype.sfixed64=na.prototype.fixed64,na.prototype.float=function(e){return this._push(W.float.writeFloatLE,4,e)},na.prototype.double=function(e){return this._push(W.float.writeDoubleLE,8,e)};var QC=W.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};na.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Zi,1,0);if(W.isString(e)){var n=na.alloc(t=ts.length(e));ts.decode(e,n,0),e=n}return this.uint32(t)._push(QC,t,e)},na.prototype.string=function(e){var t=us.length(e);return t?this.uint32(t)._push(us.write,t,e):this._push(Zi,1,0)},na.prototype.fork=function(){return this.states=new Nv(this),this.head=this.tail=new Kf(Yi,0,0),this.len=0,this},na.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Kf(Yi,0,0),this.len=0),this},na.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},na.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},na._configure=function(e){Ll=e,na.create=vs(),Ll._configure()},(rc.prototype=Object.create(cj.prototype)).constructor=rc,rc._configure=function(){rc.alloc=W._Buffer_allocUnsafe,rc.writeBytesBuffer=W.Buffer&&W.Buffer.prototype instanceof Uint8Array&&"set"===W.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},rc.prototype.bytes=function(e){W.isString(e)&&(e=W._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(rc.writeBytesBuffer,t,e),this},rc.prototype.string=function(e){var t=W.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Ov,t,e),this},rc._configure();var ej=Qa,Ml,Jn=W.LongBits,RC=W.utf8,ws="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Qa(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Qa(e);throw Error("illegal buffer")},xs=function(){return W.Buffer?function(e){return(Qa.create=function(e){return W.Buffer.isBuffer(e)?new Ml(e):ws(e)})(e)}:ws};Qa.create=xs(),Qa.prototype._slice=W.Array.prototype.subarray||W.Array.prototype.slice,Qa.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return e;if((this.pos+=5)>this.len)throw this.pos=this.len,dc(this,10);return e}}(),Qa.prototype.int32=function(){return 0|this.uint32()},Qa.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Qa.prototype.bool=function(){return 0!==this.uint32()},Qa.prototype.fixed32=function(){if(this.pos+4>this.len)throw dc(this,4);return Wg(this.buf,this.pos+=4)},Qa.prototype.sfixed32=function(){if(this.pos+4>this.len)throw dc(this,4);return 0|Wg(this.buf,this.pos+=4)},Qa.prototype.float=function(){if(this.pos+4>this.len)throw dc(this,4);var e=W.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Qa.prototype.double=function(){if(this.pos+8>this.len)throw dc(this,4);var e=W.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Qa.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw dc(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},Qa.prototype.string=function(){var e=this.bytes();return RC.read(e,0,e.length)},Qa.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw dc(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw dc(this)}while(128&this.buf[this.pos++]);return this},Qa.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Qa._configure=function(e){Ml=e,Qa.create=xs(),Ml._configure();var t=W.Long?"toLong":"toNumber";W.merge(Qa.prototype,{int64:function(){return dj.call(this)[t](!1)},uint64:function(){return dj.call(this)[t](!0)},sint64:function(){return dj.call(this).zzDecode()[t](!1)},fixed64:function(){return Kn.call(this)[t](!0)},sfixed64:function(){return Kn.call(this)[t](!1)}})},(Od.prototype=Object.create(ej.prototype)).constructor=Od,Od._configure=function(){W.Buffer&&(Od.prototype._slice=W.Buffer.prototype.slice)},Od.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},Od._configure(),(Lf.prototype=Object.create(W.EventEmitter.prototype)).constructor=Lf,Lf.prototype.rpcCall=function e(t,n,r,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return W.asPromise(e,a,t,n,r,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof r))try{n=r[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(e){a.emit("error",e,t),setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},Lf.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var SC=cb((function(e,t){t.Service=Lf})),TC={},nc=cb((function(e,t){function n(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}var r=t;r.build="minimal",r.Writer=cj,r.BufferWriter=rc,r.Reader=ej,r.BufferReader=Od,r.util=W,r.rpc=SC,r.roots=TC,r.configure=n,n()}));nc.util.Long=U,nc.configure();var u=nc.Reader,N=nc.Writer,r=nc.util,t=nc.roots.default||(nc.roots.default={}),UC=t.URI=function(){var e={},t=Object.create(e);return t[e[0]="Unknown"]=0,t[e[1]="PingUri"]=1,t[e[2]="PongUri"]=2,t[e[11]="UserJoinUri"]=11,t[e[12]="UserRespUri"]=12,t[e[21]="UserQuitUri"]=21,t[e[22]="UserDropUri"]=22,t[e[31]="GroupEnterUri"]=31,t[e[32]="GroupLeaveUri"]=32,t[e[33]="GroupReplyUri"]=33,t[e[36]="GroupEnterNoticeUri"]=36,t[e[37]="GroupLeaveNoticeUri"]=37,t[e[38]="GroupEventNoticeUri"]=38,t[e[39]="GroupCountNoticeUri"]=39,t[e[41]="UserStatusListUri"]=41,t[e[42]="UserStatusResultUri"]=42,t[e[51]="GroupStatusListUri"]=51,t[e[52]="GroupStatusResultUri"]=52,t[e[55]="GroupAllUsersListUri"]=55,t[e[56]="GroupAllUsersResultUri"]=56,t[e[100]="MessageUri"]=100,t[e[101]="AckUri"]=101,t[e[115]="FileUploadIndexGetUri"]=115,t[e[116]="FileUploadIndexRetUri"]=116,t[e[117]="FileUploadIndexSetUri"]=117,t[e[118]="FileUploadIndexFinUri"]=118,t[e[119]="FileUploadIndexErrUri"]=119,t[e[125]="FileDownloadIndexGetUri"]=125,t[e[126]="FileDownloadIndexRetUri"]=126,t[e[127]="FileDownloadIndexErrUri"]=127,t[e[201]="UserJoinNoticeUri"]=201,t[e[202]="UserQuitNoticeUri"]=202,t[e[203]="UserWaitNoticeUri"]=203,t[e[301]="UserAttributeGetUri"]=301,t[e[302]="UserAttributeRetUri"]=302,t[e[303]="UserAttributeSetUri"]=303,t[e[304]="UserAttributeModUri"]=304,t[e[305]="UserAttributeDelUri"]=305,t[e[307]="UserAttributeRspUri"]=307,t[e[308]="UserAttributeErrUri"]=308,t[e[311]="UserAttributeKeysGetUri"]=311,t[e[312]="UserAttributeKeysRetUri"]=312,t[e[351]="GroupAttributeGetUri"]=351,t[e[352]="GroupAttributeRetUri"]=352,t[e[353]="GroupAttributeSetUri"]=353,t[e[354]="GroupAttributeModUri"]=354,t[e[355]="GroupAttributeDelUri"]=355,t[e[356]="GroupAttributeAltUri"]=356,t[e[357]="GroupAttributeRspUri"]=357,t[e[358]="GroupAttributeErrUri"]=358,t[e[361]="GroupAttributeKeysGetUri"]=361,t[e[362]="GroupAttributeKeysRetUri"]=362,t[e[401]="SubscribeUserStatusUri"]=401,t[e[402]="UnsubscribeUserStatusUri"]=402,t[e[499]="SubscribeResponseUri"]=499,t}(),mi=t.Wrapper=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.uri=0,e.prototype.data=r.newBuffer([]),e.encode=function(e,t){return t||(t=N.create()),null!=e.uri&&Object.hasOwnProperty.call(e,"uri")&&t.uint32(8).int32(e.uri),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Wrapper;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.uri=e.int32();break;case 2:r.data=e.bytes();break;default:e.skipType(7&i)}}return r},e}(),VC=t.Ping=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.ms=r.Long?r.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ping;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),WC=t.Pong=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.ms=r.Long?r.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Pong;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),XC=t.UserJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.opt=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.instance=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.opt&&Object.hasOwnProperty.call(e,"opt")&&t.uint32(16).uint64(e.opt),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(24).uint64(e.instance),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(34).string(e.account),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(42).string(e.ticket),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.opt=e.uint64();break;case 3:r.instance=e.uint64();break;case 4:r.account=e.string();break;case 5:r.ticket=e.string();break;default:e.skipType(7&i)}}return r},e}(),YC=t.UserResp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserResp;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),ZC=t.UserQuit=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.encode=function(e,t){return t||(t=N.create()),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuit;e.pos<n;){var i=e.uint32();e.skipType(7&i)}return r},e}(),$C=t.UserDrop=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.code=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(8).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserDrop;e.pos<n;){var i=e.uint32();if(i>>>3==1)r.code=e.uint32();else e.skipType(7&i)}return r},e}(),aD=t.GroupEnter=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnter;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),bD=t.GroupLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.encode=function(e,t){return t||(t=N.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeave;e.pos<n;){var i=e.uint32();if(i>>>3==1)r.account=e.string();else e.skipType(7&i)}return r},e}(),cD=t.GroupReply=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupReply;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),ys=t.GroupLeaveNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeaveNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),zs=t.GroupEnterNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnterNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),As=t.Message=function(){function e(e){if(this.MiscMap={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.dialogue=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.sequence=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.options=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=r.newBuffer([]),e.prototype.MiscMap=r.emptyObject,e.prototype.ms=r.Long?r.Long.fromBits(0,0,!0):0,e.encode=function(e,t){if(t||(t=N.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.options&&Object.hasOwnProperty.call(e,"options")&&t.uint32(32).uint64(e.options),null!=e.src&&Object.hasOwnProperty.call(e,"src")&&t.uint32(42).string(e.src),null!=e.dst&&Object.hasOwnProperty.call(e,"dst")&&t.uint32(50).string(e.dst),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(58).bytes(e.payload),null!=e.MiscMap&&Object.hasOwnProperty.call(e,"MiscMap"))for(var n=Object.keys(e.MiscMap),r=0;r<n.length;++r)t.uint32(66).fork().uint32(10).string(n[r]).uint32(18).bytes(e.MiscMap[n[r]]).ldelim();return null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(72).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var i,o,a=new t.Message;e.pos<n;)switch(i=e.uint32(),i>>>3){case 1:a.instance=e.uint64();break;case 2:a.dialogue=e.uint64();break;case 3:a.sequence=e.uint64();break;case 4:a.options=e.uint64();break;case 5:a.src=e.string();break;case 6:a.dst=e.string();break;case 7:a.payload=e.bytes();break;case 8:a.MiscMap===r.emptyObject&&(a.MiscMap={});var s=e.uint32()+e.pos;for(i="",o=[];e.pos<s;){var c=e.uint32();switch(c>>>3){case 1:i=e.string();break;case 2:o=e.bytes();break;default:e.skipType(7&c)}}a.MiscMap[i]=o;break;case 9:a.ms=e.uint64();break;default:e.skipType(7&i)}return a},e}(),Bs=t.Ack=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.dialogue=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.sequence=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(32).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ack;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.dialogue=e.uint64();break;case 3:r.sequence=e.uint64();break;case 4:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),dD=t.FileUploadIndexGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.hash=r.newBuffer([]),e.prototype.size=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(18).bytes(e.hash),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(24).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),eD=t.FileUploadIndexRet=function(){function e(e){if(this.servers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.servers=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(16).uint32(e.unit),null!=e.servers&&e.servers.length){t.uint32(26).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),fD=t.FileUploadIndexSet=function(){function e(e){if(this.servers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.hash=r.newBuffer([]),e.prototype.unit=0,e.prototype.servers=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(18).bytes(e.hash),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(24).uint32(e.unit),null!=e.servers&&e.servers.length){t.uint32(34).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.unit=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),gD=t.FileUploadIndexFin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.unit=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(16).uint32(e.zone),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(24).uint32(e.unit),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexFin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),hD=t.FileUploadIndexErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),iD=t.FileDownloadIndexGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.hash=r.newBuffer([]),e.prototype.size=0,e.prototype.unit=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(16).uint32(e.zone),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(26).bytes(e.hash),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(40).uint32(e.unit),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.hash=e.bytes();break;case 4:r.size=e.uint32();break;case 5:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),jD=t.FileDownloadIndexRet=function(){function e(e){if(this.servers=[],this.backups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.zone=0,e.prototype.servers=r.emptyArray,e.prototype.backups=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(16).uint32(e.unit),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(24).uint32(e.zone),null!=e.servers&&e.servers.length){t.uint32(34).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}if(null!=e.backups&&e.backups.length){for(t.uint32(42).fork(),n=0;n<e.backups.length;++n)t.uint32(e.backups[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:r.zone=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;case 5:if(r.backups&&r.backups.length||(r.backups=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.backups.push(e.uint32());else r.backups.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),kD=t.FileDownloadIndexErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),lD=t.GroupAllUsersList=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&t.uint32(24).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&t.uint32(32).uint32(e.pageNumber),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.pageSize=e.uint32();break;case 4:r.pageNumber=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),mD=t.GroupAllUsersResult=function(){function e(e){if(this.memberInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=r.emptyArray,e.encode=function(e,n){if(n||(n=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.totalSize&&Object.hasOwnProperty.call(e,"totalSize")&&n.uint32(24).uint32(e.totalSize),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&n.uint32(32).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&n.uint32(40).uint32(e.pageNumber),null!=e.memberInfos&&e.memberInfos.length)for(var r=0;r<e.memberInfos.length;++r)t.GroupAllUsersResult.MemberInfo.encode(e.memberInfos[r],n.uint32(50).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.totalSize=e.uint32();break;case 4:r.pageSize=e.uint32();break;case 5:r.pageNumber=e.uint32();break;case 6:r.memberInfos&&r.memberInfos.length||(r.memberInfos=[]),r.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.MemberInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult.MemberInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),nD=t.UserStatusList=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.users=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),oD=t.UserStatusResult=function(){function e(e){if(this.userInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.userInfos=r.emptyArray,e.encode=function(e,n){if(n||(n=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.userInfos&&e.userInfos.length)for(var r=0;r<e.userInfos.length;++r)t.UserStatusResult.UserStatusInfo.encode(e.userInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.userInfos&&r.userInfos.length||(r.userInfos=[]),r.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.UserStatusInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult.UserStatusInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),pD=t.UserAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),qD=t.UserAttributeRet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=r.emptyArray,e.encode=function(e,n){if(n||(n=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeRet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=N.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),rD=t.UserAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=r.emptyArray,e.encode=function(e,n){if(n||(n=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=N.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),sD=t.UserAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=r.emptyArray,e.encode=function(e,n){if(n||(n=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=N.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),tD=t.UserAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),uD=t.UserAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),vD=t.UserAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),wD=t.UserAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.keys=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),xD=t.UserAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRsp;e.pos<n;){var i=e.uint32();if(i>>>3==1)r.seq=e.uint64();else e.skipType(7&i)}return r},e}(),yD=t.GroupStatusList=function(){function e(e){if(this.groups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.groups=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.groups&&e.groups.length)for(var n=0;n<e.groups.length;++n)t.uint32(18).string(e.groups[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groups&&r.groups.length||(r.groups=[]),r.groups.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),zD=t.GroupStatusResult=function(){function e(e){if(this.groupInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=r.emptyArray,e.encode=function(e,n){if(n||(n=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.groupInfos&&e.groupInfos.length)for(var r=0;r<e.groupInfos.length;++r)t.GroupStatusResult.GroupInfo.encode(e.groupInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groupInfos&&r.groupInfos.length||(r.groupInfos=[]),r.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.GroupInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.group="",e.prototype.memberCount=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(10).string(e.group),null!=e.memberCount&&Object.hasOwnProperty.call(e,"memberCount")&&t.uint32(16).uint32(e.memberCount),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult.GroupInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.group=e.string();break;case 2:r.memberCount=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),AD=t.GroupCountNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupCountNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.group=e.string();break;case 4:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),BD=t.GroupAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),CD=t.GroupAttributeRet=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=r.emptyArray,e.encode=function(e,n){if(n||(n=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeRet.AttributeMap.encode(e.attributeMaps[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=r.Long?r.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=N.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),DD=t.GroupAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=r.emptyArray,e.encode=function(e,n){if(n||(n=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=N.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),ED=t.GroupAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=r.emptyArray,e.encode=function(e,n){if(n||(n=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=N.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),FD=t.GroupAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(34).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),GD=t.GroupAttributeAlt=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=r.emptyArray,e.encode=function(e,n){if(n||(n=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&n.uint32(24).uint64(e.instance),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeAlt.AttributeMap.encode(e.attributeMaps[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.instance=e.uint64();break;case 4:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=r.Long?r.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=N.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),HD=t.GroupAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRsp;e.pos<n;){var i=e.uint32();if(i>>>3==1)r.seq=e.uint64();else e.skipType(7&i)}return r},e}(),ID=t.GroupAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),JD=t.GroupAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(e,t){return t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;default:e.skipType(7&i)}}return r},e}(),KD=t.GroupAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.keys=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),LD=t.SubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.users=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),MD=t.UnsubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.users=r.emptyArray,e.encode=function(e,t){if(t||(t=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UnsubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),ND=t.UserJoinNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=N.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoinNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),OD=t.UserQuitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=N.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),PD=t.UserWaitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=N.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserWaitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),QD=t.SubscribeResponse=function(){function e(e){if(this.errors=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=r.Long?r.Long.fromBits(0,0,!0):0,e.prototype.errors=r.emptyArray,e.encode=function(e,n){if(n||(n=N.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.errors&&e.errors.length)for(var r=0;r<e.errors.length;++r)t.SubscribeResponse.SubscribeErrorsType.encode(e.errors[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.errors&&r.errors.length||(r.errors=[]),r.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.SubscribeErrorsType=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=N.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse.SubscribeErrorsType;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),RD=Object.freeze({__proto__:null,URI:UC,Wrapper:mi,Ping:VC,Pong:WC,UserJoin:XC,UserResp:YC,UserQuit:ZC,UserDrop:$C,GroupEnter:aD,GroupLeave:bD,GroupReply:cD,GroupLeaveNotice:ys,GroupEnterNotice:zs,Message:As,Ack:Bs,FileUploadIndexGet:dD,FileUploadIndexRet:eD,FileUploadIndexSet:fD,FileUploadIndexFin:gD,FileUploadIndexErr:hD,FileDownloadIndexGet:iD,FileDownloadIndexRet:jD,FileDownloadIndexErr:kD,GroupAllUsersList:lD,GroupAllUsersResult:mD,UserStatusList:nD,UserStatusResult:oD,UserAttributeGet:pD,UserAttributeRet:qD,UserAttributeSet:rD,UserAttributeMod:sD,UserAttributeDel:tD,UserAttributeErr:uD,UserAttributeKeysGet:vD,UserAttributeKeysRet:wD,UserAttributeRsp:xD,GroupStatusList:yD,GroupStatusResult:zD,GroupCountNotice:AD,GroupAttributeGet:BD,GroupAttributeRet:CD,GroupAttributeSet:DD,GroupAttributeMod:ED,GroupAttributeDel:FD,GroupAttributeAlt:GD,GroupAttributeRsp:HD,GroupAttributeErr:ID,GroupAttributeKeysGet:JD,GroupAttributeKeysRet:KD,SubscribeUserStatus:LD,UnsubscribeUserStatus:MD,UserJoinNotice:ND,UserQuitNotice:OD,UserWaitNotice:PD,SubscribeResponse:QD,default:t}),SD=Math.ceil,Cs=function(e){return function(t,n,r){var i=(t=String(mb(t))).length;return r=void 0===r?" ":String(r),(n=va(n))<=i||""==r?t:(n-=i,(i=ap.call(r,SD(n/r.length))).length>n&&(i=i.slice(0,n)),e?t+i:i+t)}},TD=Cs(!1),UD=Cs(!0),Ds=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(Re);M({target:"String",proto:!0,forced:Ds},{padEnd:function(e){return UD(this,e,1<arguments.length?arguments[1]:void 0)}});var VD=Sf,Es=function(e){return function(t){t=tb(t);for(var n,r=Mc(t),i=r.length,o=0,a=[];i>o;)n=r[o++],fa&&!VD.call(t,n)||a.push(e?[n,t[n]]:t[n]);return a}},WD=Es(!0),XD=Es(!1);M({target:"Object",stat:!0},{entries:function(e){return WD(e)}});var YD=Jb.f,Fs="".endsWith,ZD=Math.min,Gs=Mk("endsWith"),$D=!Gs&&!!function(){var e=YD(String.prototype,"endsWith");return e&&!e.writable}();M({target:"String",proto:!0,forced:!$D&&!Gs},{endsWith:function(e){var t=String(mb(this));Lk(e);var n=1<arguments.length?arguments[1]:void 0,r=va(t.length);return n=void 0===n?r:ZD(va(n),r),r=String(e),Fs?Fs.call(t,r,n):t.slice(n-r.length,n)===r}}),rh("match",1,(function(e,t,n){return[function(t){var n=mb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;if(e=sa(e),r=String(this),!e.global)return Se(e,r);var i=e.unicode;e.lastIndex=0;for(var o,a=[],s=0;null!==(o=Se(e,r));)o=String(o[0]),a[s]=o,""===o&&(e.lastIndex=Gj(r,va(e.lastIndex),i)),s++;return 0===s?null:a}]}));var aE=Jb.f,Hs="".startsWith,bE=Math.min,Is=Mk("startsWith"),cE=!Is&&!!function(){var e=aE(String.prototype,"startsWith");return e&&!e.writable}();M({target:"String",proto:!0,forced:!cE&&!Is},{startsWith:function(e){var t=String(mb(this));Lk(e);var n=va(bE(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return Hs?Hs.call(t,r,n):t.slice(n,n+r.length)===r}});var Sn=function(e){var t=/(%?)(%([jds]))/g,n=Array.prototype.slice.call(arguments,1);return n.length&&(e=e.replace(t,(function(e,t,r,i){switch(r=n.shift(),i){case"s":r=""+r;break;case"d":r=Number(r);break;case"j":r=JSON.stringify(r)}return t?(n.unshift(r),e):r}))),n.length&&(e+=" "+n.join(" ")),""+e.replace(/%{2,2}/g,"%")},dE=/\s/,eE=function(e){for(var t=e.length;t--&&dE.test(e.charAt(t)););return t},fE=/^\s+/,Js=NaN,gE=/^[-+]0x[0-9a-f]+$/i,hE=/^0b[01]+$/i,iE=/^0o[0-7]+$/i,jE=parseInt,Nl=function(e){if("number"==typeof e)return e;if(we(e))return Js;if(ob(e)&&(e="function"==typeof e.valueOf?e.valueOf():e,e=ob(e)?e+"":e),"string"!=typeof e)return 0===e?e:+e;e=e?e.slice(0,eE(e)+1).replace(fE,""):e;var t=hE.test(e);return t||iE.test(e)?jE(e.slice(2),t?2:8):gE.test(e)?Js:+e},kE=Math.max,lE=Math.min,mE=function(e,t,n){function r(t){var n=c,r=u;return c=u=void 0,f=t,l=e.apply(r,n)}function i(e){var n=e-h;return e-=f,void 0===h||n>=t||0>n||m&&e>=v}function o(){var e=Fb.Date.now();if(i(e))return a(e);var n=setTimeout,r=e-f;e=t-(e-h),r=m?lE(e,v-r):e,d=n(o,r)}function a(e){return d=void 0,g&&c?r(e):(c=u=void 0,l)}function s(){var e=Fb.Date.now(),n=i(e);if(c=arguments,u=this,h=e,n){if(void 0===d)return f=e=h,d=setTimeout(o,t),p?r(e):l;if(m)return clearTimeout(d),d=setTimeout(o,t),r(h)}return void 0===d&&(d=setTimeout(o,t)),l}var c,u,l,d,h,f=0,p=!1,m=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");if(t=Nl(t)||0,ob(n)){p=!!n.leading;var v=(m="maxWait"in n)?kE(Nl(n.maxWait)||0,t):v;g="trailing"in n?!!n.trailing:g}return s.cancel=function(){void 0!==d&&clearTimeout(d),f=0,c=h=u=d=void 0},s.flush=function(){return void 0===d?l:a(Fb.Date.now())},s},Fc=function(e){function t(e,i){return X(this,t),m(n(e=r.call(this,Rn(e,i))),"originalError",void 0),m(n(e),"code",void 0),m(n(e),"serverCode",void 0),"number"==typeof i?e.code=i:"string"==typeof i?e.name=i:void 0!==i&&(i.originalError&&(e.originalError=i.originalError),void 0!==i.code&&(e.code=i.code),void 0!==i.serverCode&&(e.serverCode=i.serverCode)),e}ja(t,e);var r=ka(t);return t}(xf(Error)),Ma=function(e){function t(e,i){return X(this,t),m(n(e=r.call(this,Rn(e,i))),"name","RtmInternalError"),m(n(e),"code",void 0),e.code=i,e}ja(t,e);var r=ka(t);return t}(xf(Error)),ni=function(){return function(e){function t(e){X(this,t);var r=Object.keys(e);return n.call(this,e[r[0]],r[0])}ja(t,e);var n=ka(t);return t}(Ma)},Ha=ni(),gb=function(e){function t(){X(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmTimeoutError"),e}ja(t,e);var r=ka(t);return t}(Fc),H=function(e){function t(){X(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvalidArgumentError"),e}ja(t,e);var r=ka(t);return t}(Fc),L=function(e){function t(){X(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvalidStatusError"),e}ja(t,e);var r=ka(t);return t}(Fc),Ol=function(e){function t(){X(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInterruptedError"),e}ja(t,e);var r=ka(t);return t}(Fc),lb=function(e){function t(){X(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmLimitExceededError"),e}ja(t,e);var r=ka(t);return t}(Fc),nE=function(e){function t(){X(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvokeTooOftenError"),e}ja(t,e);var r=ka(t);return t}(Fc),da=function(e){function t(){X(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnavailableError"),m(n(e),"serverCode",void 0),m(n(e),"statusCode",void 0),e}ja(t,e);var r=ka(t);return t}(Fc),of=function(e){function t(){X(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnauthenticatedError"),m(n(e),"serverCode",void 0),e}ja(t,e);var r=ka(t);return t}(Fc),bd=function(e){function t(){X(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnknownError"),e}ja(t,e);var r=ka(t);return t}(Fc),Xa=function(e){return e instanceof gb||e instanceof sb},ta=function(e){return e instanceof Fc},he=function(e,t,n){return['Executing "%s.%s" timed out after %ds',e,t,n/1e3]},Qn=new Map,oE=function(){var e=new Date;return"".concat(e.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e.getMilliseconds())},Pf=Object.keys,eh=Object.entries.bind(Object),Zg=function(e){return"string"==typeof e?e.endsWith(".")?e:"".concat(e,"."):e},Vn=function(e){for(var t="",n=(e=new Uint8Array(e)).byteLength,r=-1;++r<n;)t+=String.fromCharCode(e[r]);return t=btoa(t),"data:;base64,".concat(t)},pE=R((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));M({target:"Date",proto:!0,forced:pE},{toJSON:function(e){e=Va(this);var t=tc(e);return"number"!=typeof t||isFinite(t)?e.toISOString():null}}),M({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var Vv=Object.prototype.hasOwnProperty,Ks=function(e,t,n){return JSON.stringify(ao(e),t,n)};Ks.ensureProperties=ao;var qE=function(e,t){t=t||{};var n=V(e);if("string"===n&&0<e.length)return Wv(e);if("number"===n&&isFinite(e))return e=t.long?864e5<=(t=Math.abs(e))?gh(e,t,864e5,"day"):36e5<=t?gh(e,t,36e5,"hour"):6e4<=t?gh(e,t,6e4,"minute"):1e3<=t?gh(e,t,1e3,"second"):e+" ms":864e5<=(t=Math.abs(e))?Math.round(e/864e5)+"d":36e5<=t?Math.round(e/36e5)+"h":6e4<=t?Math.round(e/6e4)+"m":1e3<=t?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},rE=function(e){function t(e){function r(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];if(r.enabled){e=Number(new Date),r.diff=e-(i||e),r.prev=i,i=r.curr=e,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var a=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,i){return"%%"===e?"%":(a++,"function"==typeof(i=t.formatters[i])&&(e=i.call(r,n[a]),n.splice(a,1),a--),e)})),t.formatArgs.call(r,n),(r.log||t.log).apply(r,n)}}var i,o=null;return r.namespace=e,r.useColors=t.useColors(),r.color=t.selectColor(e),r.extend=n,r.destroy=t.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:function(){return null===o?t.enabled(e):o},set:function(e){o=e}}),"function"==typeof t.init&&t.init(r),r}function n(e,n){return(e=t(this.namespace+(void 0===n?":":n)+e)).log=this.log,e}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat(G(t.names.map(r)),G(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var n,r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r=0;for(n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=qE,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t},Ls=cb((function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){try{var e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};e:{try{var n=localStorage;break e}catch(e){}n=void 0}t.storage=n,t.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),t.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),t.log=console.debug||console.log||function(){},e.exports=rE(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),Ms=Ls("RTM:DEBUG"),pf;Ms.enabled=!1,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(pf||(pf={}));var sE=function(){function e(t){X(this,e),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=t.processId,this.sdkVersion=t.sdkVersion,this.rtmConfig=t.rtmConfig,this.uploadRequest=t.uploadRequest,this.uploadState=pf.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ia(e,[{key:"upload",value:function(e){this.LogCache.push(e),this.uploadState===pf.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(e){var t=this;this.uploadState=pf.Uploading,setTimeout(J(x.mark((function n(){var r,i,o;return x.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={sdk_version:t.sdkVersion,process_id:t.processId,payload:JSON.stringify(e)},n.prev=1,n.next=4,t.uploadRequest(r,null!==(i=t.rtmConfig.enableCloudProxy)&&void 0!==i&&i);case 4:if(!Ti){n.next=6;break}throw Error("RTM is busy");case 6:n.next=13;break;case 8:return n.prev=8,n.t0=n.catch(1),o=2>t.uploadResendCount++?2e3:1e4,setTimeout((function(){return t.postLog(t.LogsToPost)}),o),n.abrupt("return");case 13:if(Ms('The logs uploaded for "process-'.concat(zg,'"')),0!==t.LogCache.length){n.next=17;break}return t.uploadState=pf.Free,n.abrupt("return");case 17:t.uploadResendCount=0,t.LogsToPost=40>t.LogCache.length?t.LogCache.splice(0,t.LogCache.length):t.LogCache.splice(0,40),t.postLog(t.LogsToPost);case 20:case"end":return n.stop()}}),n,null,[[1,8]])}))),ie.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e}(),Ns=function(e,t,n,r,i,o,a,s){var c=0;for(a=!!a&&pd(a,s,3);c<r;){if(c in n){if(s=a?a(n[c],c,t):n[c],0<o&&qd(s))i=Ns(e,t,s,va(s.length),i,o-1)-1;else{if(9007199254740991<=i)throw TypeError("Exceed the acceptable array length");e[i]=s}i++}c++}return i},tE=Ns;M({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=Va(this),n=va(t.length),r=th(t,0);return r.length=tE(r,t,t,n,0,void 0===e?1:fc(e)),r}}),M({target:"Object",stat:!0},{values:function(e){return XD(e)}});var uE=["CODE"],Gb,Bd,D;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(D||(D={}));var vE={CN:D.CHINA,NA:D.NORTH_AMERICA,EU:D.EUROPE,AS:D.ASIA,JP:D.JAPAN,IN:D.INDIA,GLOB:D.GLOBAL,AF:D.AFRICA,OC:D.OVERSEA,OVS:D.OVERSEA,SA:D.SOUTH_AMERICA},hh=Zn((Gb={},m(Gb,D.ASIA,{CODE:D.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Gb,D.NORTH_AMERICA,{CODE:D.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Gb,D.EUROPE,{CODE:D.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Gb,D.JAPAN,{CODE:D.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Gb,D.INDIA,{CODE:D.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Gb,D.OVERSEA,{CODE:D.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Gb,D.GLOBAL,{CODE:D.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Gb,D.OCEANIA,{CODE:D.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Gb,D.SOUTH_AMERICA,{CODE:D.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Gb,D.AFRICA,{CODE:D.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Gb,D.CHINA,{CODE:D.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Gb)),Qf=(Bd={},m(Bd,D.ASIA,[D.CHINA,D.JAPAN,D.INDIA]),m(Bd,D.EUROPE,[]),m(Bd,D.NORTH_AMERICA,[]),m(Bd,D.SOUTH_AMERICA,[]),m(Bd,D.OCEANIA,[]),m(Bd,D.AFRICA,[]),Bd),Os=[D.OVERSEA,D.GLOBAL,D.CHINA,D.NORTH_AMERICA,D.EUROPE,D.ASIA,D.JAPAN,D.INDIA,D.OCEANIA,D.SOUTH_AMERICA,D.AFRICA],bo=function(e){return Object.values(Qf).flat().includes(e)},Yv=function(e){var t;return null===(t=eh(Qf).find((function(t){return(t=ua(t,2))[0],t[1].includes(e)})))||void 0===t?void 0:t[0]},wE=function(e){return e.sort((function(e,t){return Os.indexOf(e)-Os.indexOf(t)}))},Ke=function(e){var t=new Set;if(0===(e=wE(e).slice(0,3).map((function(e){var n=hh[e];if(void 0===n)throw new Ma("invalid area key");return e=n.CODE,n=yf(n,uE),t.add(e),n}))).length)throw new Ma("areas cannot be empty");return wa({CODES:t},e.reduce((function(e,t){for(var n=0,r=eh(e);n<r.length;n++){var i=ua(r[n],2),o=i[0];i=i[1],e[o]=Array.from(new Set([].concat(G(t[o]),G(i))))}return e})))},P,Ps=function(){var e=J(x.mark((function e(t,n){var r,i,o,a,s,c=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(2<(i=2<c.length&&void 0!==c[2]?c[2]:0))){e.next=3;break}return e.abrupt("return");case 3:return o={withCredentials:!0,body:t,timeout:2e4},a=0<i?(null==P?void 0:P.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(null==P?void 0:P.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",s=n?"https://".concat(null!==(r=null==P?void 0:P.PROXY_NGINX[0])&&void 0!==r?r:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(a,"&p=443&d=upload/v1"):"https://".concat(a,"/upload/v1"),e.next=8,He(s,o).catch((function(e){return Ps(t,n,i+1)}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Qs=new sE({processId:"process-".concat(zg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.5-0-g9cf39592"),uploadRequest:Ps,rtmConfig:{}}),Pl="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Rs="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Ss="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),xE="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),Le=function(e){if("string"==typeof e)return pa(e);if(Array.isArray(e)&&e.every((function(e){return"string"==typeof e})))return e.map((function(e){return pa(e)}));if(!Km(e)){for(var t={},n=0;n<Ss.length;n++){var r=Ss[n];r in e&&(t[r]=e[r])}if(0<Object.keys(t).length)return t;if(5>Object.keys(e).length){for(n=0,e=Object.entries(e);n<e.length;n++){var i=ua(e[n],2);r=i[0],i=i[1],Pl.includes(r)?t[r]="[Hidden Info]":t[pa(r)]="string"==typeof i?pa(i):"[Sensitive Info]"}return t}return"[Sensitive Info]"}return e},Ts=function(e){return"object"===V(e)?Hd(e)?Yn(te(e,5),Pl,Rs):e.constructor&&e.constructor.name:e},Us=function(e,t){return e instanceof Error?e.message:"string"!=typeof e?JSON.stringify(Yn(te(e,5),Pl,Rs)):(t=t.map((function(e){return e instanceof Error?e.message:"object"===V(e)?Ks(Array.isArray(e)?e.map(Ts):Ts(e)):e})),Sn.apply(void 0,[e.replace(/%[%Oo]/g,(function(e){return"%%"===e?"%":"%o"===e||"%O"===e?"%s":e}))].concat(G(t))))},yE=1,Vs=function(e,t,n){var r=Ls(e);return r.enabled=!0,r.log=n,r.useColors=!1,function(n){for(var i=arguments.length,o=Array(1<i?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];if(t.enableLogUpload){i=Zg(n);var s=Us(i,o);Qs.upload({log_item_id:"".concat(yE++),log_level:e,payload_str:"[".concat(oE(),"] ").concat(e," - ").concat(256<s.length?s.slice(0,256):s)})}switch(i=function(e){var t=s||Us(Zg(n),o),i=lc.LOG_HANDLER;"function"==typeof i&&i({level:e,message:t}),r(t)},e){case"RTM:INFO":t.logFilter.info&&i("log");break;case"RTM:WARN":t.logFilter.warn&&i("warning");break;case"RTM:ERROR":t.logFilter.error&&i("error");break;case"RTM:TRACK":t.logFilter.track&&i("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":case"RTM:DEBUG":t.logFilter.debug&&i("debug")}}},Ql,Ws=function(e){return function(t){var n=1===Ql||void 0===e?"":"Ins#".concat(e," ");return"".concat(n).concat(t)}},Rl=function(e,t,n){var r=Ws(Ql);return Vs("RTM:".concat(t),n,(function(t){return e(r(t))}))},wb=function(){return function(e){function t(e,i){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];X(this,t);var a=r.call(this);if(m(n(a),"logError",void 0),m(n(a),"invokeTracker",void 0),m(n(a),"resultTracker",void 0),m(n(a),"errorTracker",void 0),m(n(a),"eventTracker",void 0),m(n(a),"info",void 0),m(n(a),"warn",void 0),m(n(a),"log",void 0),m(n(a),"genLogger",void 0),m(n(a),"loggerId",void 0),m(n(a),"logger",void 0),m(n(a),"name",void 0),a.logger=e,a.name=i,a.loggerId=e.loggerId,a.info=e.info,a.warn=e.warn,a.logError=e.logError,a.genLogger=e.genLogger,a.log=e.genLogger("RTM:DEBUG","<".concat(i,"> ")),a.invokeTracker=e.genTracker("Invoke"),a.eventTracker=e.genTracker("Event"),a.resultTracker=e.genTracker("Result"),a.errorTracker=e.genTracker("Error"),o){var s=a.emit.bind(n(a));a.emit=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];e=t[0],n=t.slice(1);var r=xE.includes(e);a.eventTracker.apply(a,["%s: ".concat(0<n.length?"%s emitted with args: ".concat(n.map((function(){return"%o"}))):"%s emitted"),i,e].concat(G(r?n.map(Le):n)));try{s.apply(void 0,t)}catch(t){a.logError("Caught in the callback function of the event %s",e,t)}}}return a}ja(t,e);var r=ka(t);return t}(ia)},zE=function(e){return Rl(console.log.bind(console),"INFO",e)},AE=function(e){return Rl(console.warn.bind(console),"WARN",e)},BE=function(e){return Rl(console.error.bind(console),"ERROR",e)},Xs=function(e,t){return function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=Ws(e),o=console.debug.bind(console),a=Vs(n,t,(function(e){return o(i(e))}));return function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return a.apply(void 0,[r+e].concat(n))}}},CE=function(e,t){return function(n){return Xs(e,t)("RTM:TRACK","[".concat(n,"] "))}},rj=t.URI,$v=mi,DE=yf(RD,["Wrapper"]),co=ml(DE,"URI"),Ys=function(e,t){var n=-1,r=e.length,i=r-1;for(t=void 0===t?r:t;++n<t;){var o=e[r=rs(n,i)];e[r]=e[n],e[n]=o}return e.length=t,e},EE=function(e){return Ys(Bi(e))},FE=function(e){return Ys(tj(e))},qf=function(e){return(Za(e)?EE:FE)(e)},rf={0:9591,1:9593},je=function(e){var t=Pd(null);return"https://".concat(t?null:e,"/api/v1")},GE=eb.apply(void 0,G(qf(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map(je)))),HE=eb.apply(void 0,G(qf(["ap-web-1.agora.io","ap-web-2.agora.io"].map(je)))),IE=eb.apply(void 0,G(qf(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map(je)))),JE=eb.apply(void 0,G(qf(["ap-web-3.agora.io","ap-web-4.agora.io"].map(je)))),Zs=ni(),Sl=function(e){function t(e,i,o,a,s,c){X(this,t);var u=r.call(this,s,fj("Socket-",s.loggerId));if(m(n(u),"isActiveClose",!1),m(n(u),"loggedIn",!1),m(n(u),"useNewDomain",void 0),m(n(u),"receivedPacket",new Ua),m(n(u),"open$",void 0),m(n(u),"input$",new Ua),m(n(u),"userJoin$",new Ua),m(n(u),"attemptsSinceLastError",0),m(n(u),"message$",new Ua),m(n(u),"socket$",void 0),m(n(u),"toClose",new Ua),m(n(u),"toReconnect",new Ua),m(n(u),"sendLogger",void 0),m(n(u),"receiveLogger",void 0),m(n(u),"ip",void 0),m(n(u),"env",void 0),m(n(u),"ticket",void 0),m(n(u),"context",void 0),m(n(u),"getDomain",(function(){return eo(u.ip,u.useNewDomain)})),m(n(u),"socketReconnector",(function(e){var t=function(e){return u.attemptsSinceLastError+=1,u.warn("The %s of Env %d reconnecting %s",u.name,u.env,e.message),Kc(3e3)};return e.pipe(Ja((function(e){return u.log("socket connection closed"),u.loggedIn=!1,2<=u.attemptsSinceLastError?(u.warn("socket connection failure"),u.emit("connectionFailure"),u.close(),Z(e)):u.isActiveClose?yb:(u.emit("reconnect"),u.useNewDomain=!u.useNewDomain,Z(e))})),Ce((function(e){return e.pipe(Lc(t))})))})),u.ip=e,u.env=i,u.ticket=o,u.context=a,u.useNewDomain=null!=c?c:.5<=Math.random(),u.sendLogger=u.genLogger("RTM:MSG:SEND"),u.receiveLogger=u.genLogger("RTM:MSG:RECV"),0!==i&&1!==i)throw new Zs({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});var l=rf[i];u.log("Opening websocket address %s for the Env %d",u.ip,u.env);var d=cc(u.input$,u.userJoin$.pipe(Lv(2)),u.message$).pipe(ea((function(e){return mi.encode(e).finish()})));return e=cc(Mv("",{protocols:[],makeWebSocket:function(){if(u.context.config.enableCloudProxy||u.context.socketUseProxy){if(0===u.context.cloudProxyServers.length)throw u.logError("No cloud proxy server to connect"),new da;var e=Pd(null)?JSON.parse(null.replace(/-/g,".")):u.context.cloudProxyServers;e=Je(e="wss://".concat(eo(fo(e),!1),"/"),"sid",u.context.sid),e=Je(e,"remote_port",l.toString()),e=Je(e,"remote_ip",u.ip),e=Je(e,"token",u.context.key),e=new WebSocket(e)}else e=new WebSocket("wss://".concat(u.getDomain(),":").concat(l));return e.binaryType="arraybuffer",e}}),u.toReconnect),u.socket$=Da(e,zl.pipe(kb(7e3),Ja((function(e){return Xa(e)&&u.warn("socket open timed out"),Z(e)})))).pipe(ea((function(e){if(e instanceof Error)throw u.warn("Env_%d: Force reconnect the socket",u.env),e;return e(d).pipe(ea((function(e){return mi.decode(new Uint8Array(e))})))})),u.socketReconnector),u.open$=u.socket$.pipe(ba((function(e){u.log("Websocket opened",u.name),e.subscribe((function(e){var t=e.data;e=rj[e.uri].slice(0,-3),t=co[e].decode(t);var n=DC({},ml(t,"toJSON"),(function(e,t){return t instanceof U?Pn(t):t})),r=!1;if((t instanceof zs||t instanceof ys)&&t.instance.lessThanOrEqual(4294967295)&&(r=!0),t instanceof As||t instanceof Bs){var i=t.instance,o=t.sequence;(t.dialogue.lessThanOrEqual(4294967295)||i.lessThanOrEqual(4294967295)||o.lessThan(1))&&(r=!0)}r?u.warn("Env_%d: Illegal %s, abandoned %o",u.env,e,n):("Pong"!==e&&u.receiveLogger("Env_%d: %s %o",u.env,e,n),u.receivedPacket.next([e,t]))}),(function(){}))})),If(void 0),rb(u.toClose),De()),u}ja(t,e);var r=ka(t);return Ia(t,[{key:"address",get:function(){return"".concat(this.ip,":").concat(rf[this.env])}},{key:"sendPacket",value:function(e,t){if("Ping"!==e){var n=Bc(t,(function(e){return e instanceof U?Pn(e):e}));this.sendLogger("Env_%d: %s %o",this.env,e,n)}t=Zv(e,t),"UserJoin"===e?this.userJoin$.next(t):"Message"===e?this.message$.next(t):this.input$.next(t)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(e){return this.receivedPacket.pipe(zb((function(t){return ua(t,1)[0]===e})),ea((function(e){return ua(e,2)[1]})))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new Zs({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),t}(wb());M({target:"String",proto:!0,forced:Ds},{padStart:function(e){return TD(this,e,1<arguments.length?arguments[1]:void 0)}});var KE=function(e){var t=Pf(hh);e=Tv(e);for(var n=0;n<t.length;n++){var r=hh[t[n]];if(null!=r&&r.AP_DOMAINS.includes(e)||null!=r&&r.AP_BACKUP_DOMAINS.includes(e)||null!=r&&r.PROXY_AP.includes(e))return[r.CODE]}return[D.CHINA,D.GLOBAL]},LE={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},$s={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},ME=[100,101,102],oi=/web-(\d)/,at=function(e){function t(e,i){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];X(this,t);var a=r.call(this,i,"AccessPoint");return m(n(a),"handleUniLbsError",(function(e,t){var n=e;if(4<e.toString().length){var r=e.toString().padStart(8,"0"),i=parseInt(r.slice(0,4),10);if(r=parseInt(r.slice(4,8),10),201===i)n=r;else if(101===i&&!ME.includes(r))return Z(Error("service is currently unavailable"))}if(i=n.toString(),!Object.keys($s).includes(i))return(e=new da(["Login is rejected by the server. The response code is %d",e],Bg)).serverCode=n,Z(e);switch(i=$s[i],n=LE[i],i){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(t=new of(n,ds)).serverCode=e,Z(t);case"INVALID_USER_ID":return(t=new of(n,hi)).serverCode=e,Z(t);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(t=new of(n,ii)).serverCode=e,Z(t);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(t=new of(n,es)).serverCode=e,Z(t);case"CANNOT_MEET_AREA_DEMAND":return(t=KE(t)).forEach((function(e){return a.failedAreas.add(e)})),a.failedAreas.size===(void 0===P?2:P.CODES.size)?((t=new H(n,Bg)).serverCode=e,Z(t)):Z(Error("ap ".concat(t.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(t=new da(n,Bg)).serverCode=e,Z(t);default:return Z(Nn("ApResErrType",i))}})),m(n(a),"getApEdgeInfo$",void 0),m(n(a),"getApEdgeInfoEndFirst$",void 0),m(n(a),"apFinish$",new Ua),m(n(a),"retryCount",0),m(n(a),"failedAreas",new Set),m(n(a),"usedUrl",[]),m(n(a),"newDomainUsed",!1),m(n(a),"backupNewDomainUsed",!1),m(n(a),"genUrl",(function(){return void 0===P?Ri.apply(void 0,G(qf([GE,HE]))).pipe(Si((function(e){return eb.apply(void 0,G(e))}))):eb.apply(void 0,G(P.AP_DOMAINS.slice(0,3).map(je)))})),m(n(a),"genBackupUrl",(function(){return void 0===P?Ri.apply(void 0,G(qf([IE,JE]))).pipe(Si((function(e){return eb.apply(void 0,G(e))}))):eb.apply(void 0,G(P.AP_BACKUP_DOMAINS.slice(0,3).map(je)))})),m(n(a),"getApUrl$",(function(e){var n,r;return a.genUrl().pipe(zb((function(e){return!(a.newDomainUsed&&e.includes("sd-rtn.com")||(e.includes("sd-rtn.com")&&(a.newDomainUsed=!0),Kl(a.usedUrl,(function(t){var n;return t===(null===(n=e.match(oi))||void 0===n?void 0:n[1])}))))})),ba((function(e){var t;void 0===P&&"string"==typeof(e=null===(t=e.match(oi))||void 0===t?void 0:t[1])&&a.usedUrl.push(e)})),Pa(e?Math.max(lc.RECONNECTING_AP_NUM,null!==(n=null==P?void 0:P.CODES.size)&&void 0!==n?n:0):null!==(r=null==P?void 0:P.CODES.size)&&void 0!==r?r:2),Md((function(){return t.runOutOfUrlSymbol})),Ja((function(e,n){return a.newDomainUsed=!1,e===t.runOutOfUrlSymbol?(a.usedUrl=[],n):Z(e)})))})),m(n(a),"getBackupApUrl$",(function(e){var n,r;return a.genBackupUrl().pipe(zb((function(e){return!(a.backupNewDomainUsed&&e.includes("sd-rtn.com")||(e.includes("sd-rtn.com")&&(a.backupNewDomainUsed=!0),Kl(a.usedUrl,(function(t){var n;return t===(null===(n=e.match(oi))||void 0===n?void 0:n[1])}))))})),ba((function(e){var t;void 0===P&&"string"==typeof(e=null===(t=e.match(oi))||void 0===t?void 0:t[1])&&a.usedUrl.push(e)})),Pa(e?Math.max(lc.RECONNECTING_AP_NUM,null!==(n=null==P?void 0:P.CODES.size)&&void 0!==n?n:0):null!==(r=null==P?void 0:P.CODES.size)&&void 0!==r?r:2),Md((function(){return t.runOutOfUrlSymbol})),Ja((function(e,n){return a.backupNewDomainUsed=!1,e===t.runOutOfUrlSymbol?(a.usedUrl=[],n):Z(e)})))})),m(n(a),"getProxyApUrl$",(function(e){var t,n;return eb.apply(void 0,G(((null==P?void 0:P.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map(je))).pipe(Pa(e?Math.max(lc.RECONNECTING_AP_NUM,null!==(t=null==P?void 0:P.CODES.size)&&void 0!==t?t:0):null!==(n=null==P?void 0:P.CODES.size)&&void 0!==n?n:2))})),m(n(a),"context",void 0),m(n(a),"fetchCloudProxy",(function(e,t){var n=fj("AP-",a.loggerId);a.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;return a.apFinish$.pipe(Pa(1)).subscribe((function(){return r.abort()})),hd(J(x.mark((function i(){var o;return x.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=Xg(0,Number.MAX_SAFE_INTEGER),a.log("%s request opid: %d",n,o),i.abrupt("return",He(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:a.context.sid,opid:o,appid:a.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:null!=t?t:a.context.key,cname:a.context.uid,uid:0,detail:wa({},void 0===P?{11:[D.CHINA,D.GLOBAL].join()}:{11:Array.from(P.CODES).map((function(e){return e===D.OVERSEA?"".concat(D.ASIA,",").concat(D.EUROPE,",").concat(D.AFRICA,",").concat(D.NORTH_AMERICA,",").concat(D.SOUTH_AMERICA,",").concat(D.OCEANIA):e})).join(",")})}}]},signal:r.signal}));case 3:case"end":return i.stop()}}),i)})))).pipe(Ja((function(t){return"AbortError"!==t.name&&(a.logError(t),a.warn("The AP server %s request failure",e,t)),yb})),fb(function(){var t=J(x.mark((function t(r){var i,o,s,c,u,l,d,h,f,p,m,g,v,y,b,_,E,S,w;return x.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.responseText,o=JSON.parse(i),a.log("The %s response is %o",n,o),(void 0===(s=o.response_body)||0===s.length||s.some((function(e){var t;return void 0===(null===(t=e.buffer)||void 0===t?void 0:t.code)||23!==e.uri})))&&Z(new da("cloud proxy response_body not valid",Bg)),0===(c=s.filter((function(e){return 0!==e.buffer.code}))).length){t.next=14;break}if(void 0===(u=c.find((function(e){return 128===e.buffer.flag})))){t.next=12;break}return t.abrupt("return",a.handleUniLbsError(u.buffer.code,e));case 12:return a.logError("cloud proxy error response"),t.abrupt("return",a.handleUniLbsError(c[0].buffer.code,e));case 14:for(l=[],d=0;d<s.length;d++)if(262144===(null==(p=s[d])||null===(h=p.buffer)||void 0===h?void 0:h.flag))null===(m=p.buffer)||void 0===m||null===(g=m.edges_services)||void 0===g||null===(v=g.forEach)||void 0===v||v.call(g,(function(e){Ln(e=e.ip)&&-1===a.context.cloudProxyServers.indexOf(e)&&(a.log("got cloud proxy server: %s",e),a.context.cloudProxyServers.push(e))}));else if(128===(null==p||null===(f=p.buffer)||void 0===f?void 0:f.flag)){for(E=function(e,t){var n=t[e];l.some((function(e){return e.ip===n.ip}))||l.push({ip:n.ip,ticket:p.buffer.cert})},S=0,w=p.buffer.edges_services;S<w.length;S++)E(S,w);a.context.rtmArea=null!==(y=null===(b=p.buffer)||void 0===b||null===(_=b.detail)||void 0===_?void 0:_[9])&&void 0!==y?y:""}return t.abrupt("return",eb.apply(void 0,G(l).concat([yg])));case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Ja((function(e){return ta(e)?Z(e):yb})),Qg(),zb((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket&&Ln(e.ip)})))})),m(n(a),"fetchAp",(function(e,t){var n=fj("AP-",a.loggerId);a.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;return a.apFinish$.pipe(Pa(1)).subscribe((function(){return r.abort()})),hd(J(x.mark((function i(){var o;return x.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=Xg(0,Number.MAX_SAFE_INTEGER),a.log("%s request opid: %d",n,o),i.abrupt("return",He(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:o,key:t||a.context.key,cname:a.context.uid,detail:wa({},void 0===P?{11:[D.CHINA,D.GLOBAL].join()}:{11:Array.from(P.CODES).map((function(e){return e===D.OVERSEA?"".concat(D.ASIA,",").concat(D.EUROPE,",").concat(D.AFRICA,",").concat(D.NORTH_AMERICA,",").concat(D.SOUTH_AMERICA,",").concat(D.OCEANIA):e})).join(",")}),uid:0,sid:a.context.sid},signal:r.signal}));case 3:case"end":return i.stop()}}),i)})))).pipe(Ja((function(t){return"AbortError"!==t.name&&(a.logError(t),a.warn("The AP server %s request failure",e,t)),yb})),fb(function(){var t=J(x.mark((function t(r){var i,o,s,c,u,l,d,h;return x.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.responseText,o=JSON.parse(i),a.log("The %s response is %o",n,o),c=(s=o).code,u=s.addresses,l=s.detail,0===c){t.next=6;break}return t.abrupt("return",a.handleUniLbsError(c,e));case 6:if(d=u,Pd(null)&&(h=JSON.parse(null.replace(/-/g,".")),d=h.map((function(e){return{ip:e,ticket:d[0].ticket}}))),0!==d.length){t.next=11;break}return t.abrupt("return",Z(Error("No available edge address to connect")));case 11:return a.context.rtmArea=null==l?void 0:l[9],t.abrupt("return",eb.apply(void 0,G(d).concat([yg])));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Qg(),Ja((function(e){return ta(e)?Z(e):yb})),zb((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket})))})),a.context=e,a.getApEdgeInfoEndFirst$=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return Kc(0,e||o?lc.RECONNECTING_AP_INTERVAL:2e3).pipe(Pa(1),ba((function(){a.retryCount+=1})),fb((function(){return a.context.config.enableCloudProxy||a.context.socketUseProxy?a.getProxyApUrl$(e||o):(4<=a.retryCount&&(a.retryCount=0),3>=a.retryCount?a.getApUrl$(e||o):a.getBackupApUrl$(e||o))})),fb((function(e){return a.context.config.enableCloudProxy||a.context.socketUseProxy?a.fetchCloudProxy(e):a.fetchAp(e)})),Ja((function(e){return e instanceof sb&&a.warn("AP request timeout"),Z(e)})),rn((function(e){return e.ip})),rb(a.apFinish$))},a.getApEdgeInfo$=function(e){return Kc(0,e||o?lc.RECONNECTING_AP_INTERVAL:2e3).pipe(Pa(8),ba((function(){a.retryCount+=1})),fb((function(){return a.context.config.enableCloudProxy||a.context.socketUseProxy?a.getProxyApUrl$(e||o):3>=a.retryCount?a.getApUrl$(e||o):a.getBackupApUrl$(e||o)})),fb((function(e){return(a.context.config.enableCloudProxy||a.context.socketUseProxy?a.fetchCloudProxy(e):a.fetchAp(e)).pipe()})),Ja((function(e){return e instanceof sb&&a.warn("AP request timeout"),Z(e)})),rn((function(e){return e.ip})),rb(a.apFinish$))},a}ja(t,e);var r=ka(t);return Ia(t,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),t}(wb());m(at,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var bt=ni(),ct=function(e){function t(e,i,o){X(this,t);var a=r.call(this,i,"Connection");m(n(a),"apClient",void 0),m(n(a),"lastOpenSockets",[new Ee(1),new Ee(1)]),m(n(a),"curOpenSockets",[void 0,void 0]),m(n(a),"ipIterator",0),m(n(a),"loginSocketOpenFailureCount",0),m(n(a),"firstEnv",.5<=Math.random()?1:0),m(n(a),"firstSocketOpener",void 0),m(n(a),"secondSocketOpener",void 0),m(n(a),"firstOpenKeeperSubject",new Ua),m(n(a),"secondOpenKeeperSubject",new Ua),m(n(a),"blacklistedIP",{}),m(n(a),"edgeInfoReplayed",void 0),m(n(a),"firstEnvOpenSocket",void 0),m(n(a),"firstOpenKeeperSub",void 0),m(n(a),"secondOpenKeeperSub",void 0),m(n(a),"context",void 0),m(n(a),"logger",void 0),a.context=e,a.logger=i,a.apClient=new at(a.context,i),a.apClient.apFinish$.subscribe((function(){a.log("Ap client fetch finished")}));var s,c=[];return a.edgeInfoReplayed=a.apClient.getApEdgeInfo$(o).pipe(Ce((function(e){return e.pipe(ba((function(e){if(ta(e))throw e})),jd(o?ie.getParameter("RECONNECTING_AP_INTERVAL"):900),rb(Kc(2e4)))})),zb((function(e){var t;return!Kl(c,e)&&1>=(null!==(t=a.blacklistedIP[e.ip])&&void 0!==t?t:0)})),Md((function(){return new bt({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),ba((function(e){c.push(e),a.log("An edge info got %o",e)})),ba({error:function(e){a.emit("connectionInitFailure",e)}}),Tg((function(){a.apClient.clearUp()})),vn()),a.firstEnvOpenSocket=a.edgeInfoReplayed.pipe(fb((function(e){if(void 0===e)return Z(Error("Invalid edge info"));var t=new Sl(e.ip,a.firstEnv,e.ticket,a.context,i,s);if(a.firstEnv=1===a.firstEnv?0:1,t.once("connectionFailure",(function(){return a.onSocketConnectionFailure(t)})),!o&&lc.ENABLE_EDGE_AUTO_FALLBACK&&!a.context.config.enableCloudProxy){var n,r=Date.now();t.on("reconnect",(function(){var e;a.loginSocketOpenFailureCount+=1,null!==(e=n)&&void 0!==e||(n=Date.now()-r),500>n&&1<a.loginSocketOpenFailureCount&&(a.context.socketUseProxy=!0)}))}return s=!t.useNewDomain,t.open$.pipe(If(t))})),ba((function(e){a.log("The websocket of ENV_%d opened to %s:%d",e.env,e.ip,rf[e.env]),a.curOpenSockets[e.env]=e,a.lastOpenSockets[e.env].next(e),a.firstEnv=e.env,a.openSecondSocket(e.env,e.ip,e.useNewDomain)})),Pa(1),De()),a.firstSocketOpener=a.firstEnvOpenSocket.pipe(fb((function(e){return e.open$.pipe(ba((function(){a.log("The websocket of first ENV_%d re-opened to %s:%d",e.env,e.ip,rf[e.env]),a.curOpenSockets[e.env]=e,a.lastOpenSockets[e.env].next(e)})))}))),e=a.firstOpenKeeperSubject.pipe(Lc(ed)),a.firstOpenKeeperSub=e.subscribe({error:a.logError}),a}ja(t,e);var r=ka(t);return Ia(t,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(e,t){if(![0,1].includes(e))throw new Ha({INVALID_ENV:"The env argument is not 0 or 1"});var n=e===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var r=this.curOpenSockets[e];this.curOpenSockets[e]=void 0,r&&(r.isActiveClose=!0,setTimeout((function(){r.close()}),t)),void 0!==n&&setTimeout((function(){null==n||n.unsubscribe()}),t)}},{key:"waitClosing",value:function(e){var t=this;return e.isActiveClose=!0,e.open$.pipe(nv(),Ja((function(e){return e.message===qs.normalClosureMessage?yb:Z(e)})),kb(5e3),Ja((function(n){return n instanceof sb?(t.warn("Force closing the ENV_%d connection",e.env),yb):Z(n)})))}},{key:"onSocketConnectionFailure",value:function(e){var t=[0,1].filter((function(t){return t!==e.env}))[0];(t=this.curOpenSockets[t])&&t.loggedIn?this.reopenSocketWithApRequest(e.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(e,t,n){var r=this,i=1===e?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(un((function(e,t){return[].concat(G(e),[t])}),[]),ea((function(e){return os(e,(function(e){return On(t,e.ip)})).slice(-1)[0]})),Pa(1),fb((function(e){if(void 0===e)return Z(Error("Invalid edge info"));var t=new Sl(e.ip,i,e.ticket,r.context,r.logger,n);return t.on("connectionFailure",(function(){return r.onSocketConnectionFailure(t)})),t.open$.pipe(ba((function(){r.lastOpenSockets[i].next(t),r.curOpenSockets[i]=t})))})),De()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Lc(ed)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(e){var t=this,n=[0,1].filter((function(t){return t!==e}))[0];if(void 0!==(n=this.curOpenSockets[n])){var r,i=n.ip;n=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Md((function(){return new bt({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),Ce((function(e){return e.pipe(ba((function(e){if(e.code===ii)t.emit("tokenExpired"),t.apClient.apFinish$.next(void 0);else if(ta(e))throw e})),jd(ie.getParameter("RECONNECTING_AP_INTERVAL")),rb(Kc(15e3)))})),ba((function(e){t.log("An edge info got %o",e)})),Tg((function(){t.apClient.clearUp()}))).pipe(un((function(e,t){return[].concat(G(e),[t])}),[]),ea((function(e){return(e=os(e,(function(e){return On(i,e.ip)}))).length-1>=t.ipIterator?e.slice(-t.ipIterator++-1)[0]:(t.ipIterator=0,e.slice(-1)[0])})),Md(),fb((function(n){if(void 0===n)return Z(Error("Invalid edge info"));var i=new Sl(n.ip,e,n.ticket,t.context,t.logger,r);return i.on("connectionFailure",(function(){return t.onSocketConnectionFailure(i)})),r=!i.useNewDomain,i.open$.pipe(If(i))})),ba((function(n){t.log("The websocket of ENV_%d re-opened to %s:%d using ap",n.env,n.ip,rf[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})),fb((function(n){return n.open$.pipe(ba((function(){t.log("The websocket of ENV_%d re-opened to %s:%d",n.env,n.ip,rf[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})))})),De()),e===this.firstEnv?this.firstOpenKeeperSubject.next(n):this.secondOpenKeeperSubject.next(n)}}}]),t}(wb()),cd=nc.Writer,oa=nc.util,Gc=nc.roots.default||(nc.roots.default={}),NE=Gc.Session=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.elapse=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(e,t){return t||(t=cd.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.appId&&Object.hasOwnProperty.call(e,"appId")&&t.uint32(42).string(e.appId),null!=e.ver&&Object.hasOwnProperty.call(e,"ver")&&t.uint32(50).string(e.ver),null!=e.buildno&&Object.hasOwnProperty.call(e,"buildno")&&t.uint32(56).int32(e.buildno),null!=e.installId&&Object.hasOwnProperty.call(e,"installId")&&t.uint32(66).string(e.installId),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(128).int32(e.os),null!=e.did&&Object.hasOwnProperty.call(e,"did")&&t.uint32(138).string(e.did),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&Gc.Session.CommonIndex.encode(e.index,t.uint32(162).fork()).ldelim(),null!=e.token&&Object.hasOwnProperty.call(e,"token")&&t.uint32(170).string(e.token),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(176).int32(e.version),null!=e.subVersion&&Object.hasOwnProperty.call(e,"subVersion")&&t.uint32(184).int32(e.subVersion),t},e.CommonIndex=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.index1="",e.prototype.index2="",e.prototype.index3="",e.encode=function(e,t){return t||(t=cd.create()),null!=e.index1&&Object.hasOwnProperty.call(e,"index1")&&t.uint32(10).string(e.index1),null!=e.index2&&Object.hasOwnProperty.call(e,"index2")&&t.uint32(18).string(e.index2),null!=e.index3&&Object.hasOwnProperty.call(e,"index3")&&t.uint32(26).string(e.index3),t},e}(),e}(),OE=Gc.Link=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.elapse=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(e,t){return t||(t=cd.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.ec&&Object.hasOwnProperty.call(e,"ec")&&t.uint32(40).int32(e.ec),null!=e.sc&&Object.hasOwnProperty.call(e,"sc")&&t.uint32(48).int32(e.sc),null!=e.destServerIp&&Object.hasOwnProperty.call(e,"destServerIp")&&t.uint32(58).string(e.destServerIp),null!=e.ackedServerIp&&Object.hasOwnProperty.call(e,"ackedServerIp")&&t.uint32(66).string(e.ackedServerIp),null!=e.responseTime&&Object.hasOwnProperty.call(e,"responseTime")&&t.uint32(72).int32(e.responseTime),t},e}(),PE=Gc.Logout=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.elapse=oa.Long?oa.Long.fromBits(0,0,!1):0,e.encode=function(e,t){return t||(t=cd.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),t},e}(),QE=Gc.KickedOff=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.elapse=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(e,t){return t||(t=cd.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.linkId&&Object.hasOwnProperty.call(e,"linkId")&&t.uint32(48).int32(e.linkId),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(56).int32(e.code),null!=e.server&&Object.hasOwnProperty.call(e,"server")&&t.uint32(66).string(e.server),null!=e.serverCode&&Object.hasOwnProperty.call(e,"serverCode")&&t.uint32(72).int32(e.serverCode),t},e}(),RE=Gc.ChnJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.elapse=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=cd.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),SE=Gc.ChnJoinRes=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.elapse=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(e,t){return t||(t=cd.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),null!=e.serverErrCode&&Object.hasOwnProperty.call(e,"serverErrCode")&&t.uint32(64).int32(e.serverErrCode),t},e}(),TE=Gc.ChnLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.elapse=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=cd.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),UE=Gc.ConnectionStateChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.elapse=oa.Long?oa.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(e,t){return t||(t=cd.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.oldState&&Object.hasOwnProperty.call(e,"oldState")&&t.uint32(40).int32(e.oldState),null!=e.newState&&Object.hasOwnProperty.call(e,"newState")&&t.uint32(48).int32(e.newState),null!=e.reason&&Object.hasOwnProperty.call(e,"reason")&&t.uint32(56).int32(e.reason),null!=e.reconnId&&Object.hasOwnProperty.call(e,"reconnId")&&t.uint32(64).int32(e.reconnId),t},e}(),aw=Object.freeze({__proto__:null,Session:NE,Link:OE,Logout:PE,KickedOff:QE,ChnJoin:RE,ChnJoinRes:SE,ChnLeave:TE,ConnectionStateChange:UE,default:Gc}),bw=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),VE=function(e){function t(e,i,o){return X(this,t),m(n(o=r.call(this,o,"Context")),"_token",void 0),m(n(o),"config",void 0),m(n(o),"_uid",void 0),m(n(o),"_sid",void 0),m(n(o),"_area","CN"),m(n(o),"_socketUseProxy",!1),m(n(o),"appId",void 0),m(n(o),"enableCloudProxy",!1),m(n(o),"cloudProxyServers",[]),o.appId=e,o.config=i,o}ja(t,e);var r=ka(t);return Ia(t,[{key:"socketUseProxy",get:function(){return this._socketUseProxy&&lc.ENABLE_EDGE_AUTO_FALLBACK},set:function(e){this.log("socketUseProxy is set to %s",e),this._socketUseProxy=e}},{key:"token",set:function(e){this._token="string"==typeof e&&e?e:void 0}},{key:"uid",get:function(){if("string"==typeof this._uid&&this._uid)return this._uid;throw new Ma("Cannot get illegal uid")},set:function(e){if(this.log("The user ID is set to %s",pa(e)),!Aa(e))throw new Ma;this._uid=e}},{key:"key",get:function(){if("string"==typeof this._token&&this._token)return this._token;if("string"==typeof this.appId&&this.appId)return this.appId;throw new Ma("Cannot get illegal key")}},{key:"sid",get:function(){if("string"==typeof this._sid&&this._sid)return this._sid;throw new Ma("Cannot get illegal sid")},set:function(e){if(this.log("sid is set to %s",e),"string"!=typeof e||!e)throw new Ma;this._sid=e}},{key:"rtmArea",get:function(){if("string"==typeof this._area&&this._area)return this._area;throw new Ma("Cannot get illegal area")},set:function(e){this.log("area is set to %s",e),"string"==typeof e&&e?this._area=e:this.warn("set area failed")}}]),t}(wb()),WE=!!Nc&&R((function(){Nc.prototype.finally.call({then:function(){}},(function(){}))}));if(M({target:"Promise",proto:!0,real:!0,forced:WE},{finally:function(e){var t=od(this,Rb("Promise")),n="function"==typeof e;return this.then(n?function(n){return bk(t,e()).then((function(){return n}))}:e,n?function(n){return bk(t,e()).then((function(){throw n}))}:e)}}),"function"==typeof Nc){var dt=Rb("Promise").prototype.finally;Nc.prototype.finally!==dt&&Ea(Nc.prototype,"finally",dt,{unsafe:!0})}var XE=function(){var e=J(x.mark((function e(t){return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Uint8Array,e.next=3,crypto.subtle.digest("SHA-256",t);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),et=function(e){return Array.from(e).map((function(e){return e.toString(16).padStart(2,"0")})).join("")},YE=function(e){if("string"!=typeof e)throw new TypeError("Expected input to be a string");if(0!=e.length%2)throw new RangeError("Expected string to be an even number of characters");for(var t=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)t[n/2]=parseInt(e.substring(n,n+2),16);return t},ft=function(e){return btoa(String.fromCharCode.apply(String,G(e))).replace(/={1,2}$/,"")},gt=function(){var e=J(x.mark((function e(t){var n;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.digest("SHA-1",t);case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n=sha1.arrayBuffer(t);case 9:return e.abrupt("return",ft(new Uint8Array(n)));case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),ht=function(e,t,n,r){r[t]=!0,n.has(e)?n.get(e).add(t):n.set(e,new Set([t]))},ZE=function(e){switch(e){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},it=function(e){function t(e,i,o,a){X(this,t);var s=r.call(this,o,"ChunkDownloadManager");if(m(n(s),"abortController",new AbortController),m(n(s),"downloadedSize",0),m(n(s),"successCount",0),m(n(s),"timer",void 0),m(n(s),"chunks",[]),m(n(s),"retUnit",void 0),m(n(s),"singleThread",!1),m(n(s),"initialized",!1),m(n(s),"ee",void 0),m(n(s),"chunkCount",void 0),m(n(s),"aborted",!1),m(n(s),"serverToIndices",new Map),m(n(s),"backupToIndices",new Map),m(n(s),"indexToBackupServers",[]),m(n(s),"busyBackupServers",new Map),m(n(s),"downloadingChunks",new Set),m(n(s),"metaInfo",void 0),m(n(s),"transHandler",void 0),s.metaInfo=e,s.transHandler=i,s.ee=void 0===a?new ia:a,o=e.size,e=e.unit,0===o)throw new Ma("size cannot be 0");return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",(function(){s.abortController.abort()}),{once:!0}),s.abortController.signal.addEventListener("abort",(function(){s.aborted=!0}),{once:!0}),s.chunkCount=Math.ceil(o/(32768*e)),s}ja(t,e);var r=ka(t);return Ia(t,[{key:"setInfoByResponse",value:function(e){var t=this,n=e.serverList,r=e.backupList;if(e=e.unit,n.length<this.chunkCount&&r.length<this.chunkCount)throw new Ma("servers is not enough");this.updateProgress(0),this.initialized=!0;var i=Array(this.chunkCount).fill(!1);if(n.forEach((function(e,n){return e.forEach((function(e){return ht(e,n,t.serverToIndices,i)}))})),r.forEach((function(e,n){return e.forEach((function(e){return ht(e,n,t.backupToIndices,i)}))})),i.some((function(){return!1})))throw new da("Not enough servers to download",Eg);this.indexToBackupServers=r.map((function(e){return new Set(e)})),this.retUnit=e}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):1===this.serverToIndices.size&&0===Array.from(this.serverToIndices.keys())[0]?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",Eg))}},{key:"updateProgress",value:function(e){var t=this,n=this.downloadedSize+e;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new bd("Invalid download size",Eg))):(this.downloadedSize=n,void 0!==this.timer&&0!==e&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&this.successCount!==this.chunkCount&&(this.timer=setTimeout((function(){t.ee.emit("timedOut"),t.abortController.abort()}),12e4)),this.initialized&&0===e||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var e=0,t=0,n=this.chunks;t<n.length;t++)e+=n[t].byteLength;if(e!==this.metaInfo.size)throw new Ma("invalid chunks total size");e=new Uint8Array(e),n=t=0;for(var r=this.chunks;n<r.length;n++){var i=r[n];e.set(new Uint8Array(i),t),t+=i.byteLength}return t=Array.from(e.subarray(0,4)).map((function(e){return e.toString(16)})).join("").toUpperCase(),Uv(e.buffer,ZE(t))}},{key:"getDownloadUrl",value:function(e){var t=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat($g(e).split(".").join("-"),".edge.").concat(Pd(null)?null:t,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var e=J(x.mark((function e(t){var n,r=this,i=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<i.length&&void 0!==i[1]&&i[1],e.next=3,Promise.all(Array.from(t.entries()).map((function(e){return e=ua(e,2),r.postDownloadRequest(e[0],Array.from(e[1]),n).catch((function(e){404===e.statusCode?(r.ee.emit("notExist"),r.abortController.abort()):"AbortError"!==e.name&&(Xa(e)?r.singleThread?(r.abortController.abort(),r.ee.emit("timedOut")):(r.warn("%d download timed out after %d, retrying use single thread",e.index,r.singleThread?6e4:3e4),r.abortController.abort(),r.singleThread=!0,r.ee.emit("multiTimeOut")):(r.ee.emit("error",e),r.abortController.abort()))}))})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var e=J(x.mark((function e(t,n,r){var i,o,a,s,c,u,l,d,h,f=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h=function(){return(h=J(x.mark((function e(o){var a,h,f,p,m,g,v,y,b;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0!==o||0!==t){e.next=5;break}throw new Ma("Invalid serverIp");case 5:a=void 0===o?l.getDownloadUrl(t):o;case 6:return l.downloadingChunks.add(i),e.next=9,u(a);case 9:return h=e.sent,f=h.responseData,l.downloadingChunks.delete(i),e.abrupt("return",f);case 15:if(e.prev=15,e.t0=e.catch(0),l.downloadingChunks.delete(i),n.unshift(i),l.metaInfo.useNewDomain=!1,"AbortError"!==e.t0.name){e.next=22;break}throw e.t0;case 22:if(!Xa(e.t0)){e.next=25;break}throw e.t0.index=i,e.t0;case 25:if(p=s,s+=1,!(2>p)){e.next=30;break}return e.t0 instanceof Ma||l.warn("%o, %d download failed, retrying",e.t0,i),e.abrupt("return",d());case 30:if(504!==e.t0.statusCode){e.next=34;break}throw(m=new gb("download server timed out",{originalError:e.t0,serverCode:504})).index=i,m;case 34:if(!r||2!==p||0===c[0]){e.next=45;break}return e.t0 instanceof Ma||l.warn("%d download failed, using backup: %d, %o",i,c[0],e.t0),e.next=38,l.busyBackupServers.get(c[0]);case 38:return g=d(l.getDownloadUrl(c[0])),l.busyBackupServers.set(c[0],g),e.next=42,g;case 42:return v=e.sent,l.busyBackupServers.delete(c[0]),e.abrupt("return",v);case 45:if(!(r&&2<p&&void 0!==c[1]&&0!==c[1])){e.next=56;break}return l.warn("%d download failed, using backup 1: %d",i,c[1]),e.next=49,l.busyBackupServers.get(c[1]);case 49:return y=d(l.getDownloadUrl(c[1])),l.busyBackupServers.set(c[1],y),e.next=53,y;case 53:return b=e.sent,l.busyBackupServers.delete(c[1]),e.abrupt("return",b);case 56:throw e.t0.index=i,e.t0;case 58:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)},d=function(e){return h.apply(this,arguments)},!this.aborted){e.next=4;break}throw new Ma("download already aborted");case 4:if(void 0!==(i=n.shift())){e.next=8;break}return this.log("%s download finished",t),e.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){e.next=10;break}return e.abrupt("return");case 10:if(!this.downloadingChunks.has(i)){e.next=13;break}return this.log("%s already downloading, return",i),e.abrupt("return");case 13:if(void 0===this.chunks[i]){e.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",i),e.next=18,this.postDownloadRequest(t,n,r);case 18:return e.abrupt("return");case 19:return o=new FormData,a={hash:cw(this.metaInfo.hashHexStr),unit:void 0===this.retUnit?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:i},o.append("parameter",JSON.stringify(a)),s=0,c=Array.from(this.indexToBackupServers[i]),u=function(e){return He(e,{body:o,signal:f.abortController.signal,timeout:f.singleThread?12e4:3e4},{useBinaryResponse:!0})},l=this,e.next=28,d().then((function(e){return void 0!==f.chunks[i]?f.log("chunk %d download duplicated",i):(f.chunks[i]=e,f.log("chunk %d downloaded",i),f.successCount+=1,f.updateProgress(f.chunks[i].byteLength)),f.successCount===f.chunkCount&&(f.log("chunks all download"),f.ee.emit("finished")),f.singleThread?(f.downloadChunks(),Promise.resolve()):f.postDownloadRequest(t,n,r)}));case 28:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}(wb()),jt=function(e){function t(e,i,o,a){X(this,t);var s=r.call(this,o,"ChunkUploadManager");if(m(n(s),"chunkCount",0),m(n(s),"chunks",[]),m(n(s),"uploadedChunks",[]),m(n(s),"totalFailures",0),m(n(s),"timer",void 0),m(n(s),"initState","uninitialized"),m(n(s),"ee",void 0),m(n(s),"unit",0),m(n(s),"uploadedSize",0),m(n(s),"singleThread",!1),m(n(s),"abortController",new AbortController),m(n(s),"servers",[]),m(n(s),"aborted",!1),m(n(s),"metaInfo",void 0),m(n(s),"transHandler",void 0),s.metaInfo=e,s.transHandler=i,s.ee=void 0===a?new ia:a,0===e.file.length)throw new H("file not found or is empty",Of);return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",(function(){s.abortController.abort()}),{once:!0}),s.abortController.signal.addEventListener("abort",(function(){s.aborted=!0}),{once:!0}),s}ja(t,e);var r=ka(t);return Ia(t,[{key:"initChunks",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a,s=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("initialized"!==this.initState&&"initializing"!==this.initState){e.next=2;break}throw new Ma("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=t,n=this.sliceFile(t,this.metaInfo.file),this.chunkCount=n.length,r=[],i=function(e,t){var n=(e=ua(t[e],2))[0],i=e[1];e=gt(i).then((function(e){s.chunks[n]={payload:i,sha1:e,uploadedTo:void 0,index:n,processed:!1}})),r.push(e)},o=0,a=Array.from(n.entries());o<a.length;o++)i(o,a);return e.next=11,Promise.all(r);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var e=this;if(!this.aborted){for(var t=this.chunks.filter((function(e){return!e.processed})),n=function(n){var r=t[n],i=e.servers.filter((function(e){return!e.isUploading})).sort((function(e,t){return e.successCount-t.successCount})).sort((function(e,t){return e.failureCount-t.failureCount}))[0];if(void 0===i||1<i.failureCount)return e.log("Upload server not available, waiting"),e.ee.emit("serverUsedUp"),gj(1e3).then((function(){e.totalFailures>2*e.chunkCount&&e.ee.emit("error"),e.totalFailures+=1,void 0!==i&&(i.failureCount=0),e.uploadToServers()})).catch((function(){})),"break";r.processed=!0,i.isUploading=!0,e.log("uploading chunk %d to server %s",r.index,$g(i.ip));var o=e.getUploadUrl(i.ip);return J(x.mark((function t(){var n;return x.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.postChunk(r.payload,o,r.index);case 3:n=e.chunks.findIndex((function(e){return e===r})),r.uploadedTo=i.ip,e.chunks.splice(n,1),e.uploadedChunks.push(r),i.successCount+=1,i.isUploading=!1,e.updateProgress(r.payload.byteLength),e.log("upload chunk %d successfully",r.index),t.next=31;break;case 13:if(t.prev=13,t.t0=t.catch(0),i.isUploading=!1,r.processed=!1,504!==t.t0.statusCode&&!Xa(t.t0)){t.next=27;break}if(e.singleThread){t.next=24;break}return e.warn("%d upload timed out after %d, retrying use single thread",r.index,e.singleThread?12e4:3e4),e.abortController.abort(),e.singleThread=!0,e.ee.emit("multiTimeOut"),t.abrupt("return");case 24:return e.ee.emit("timedOut"),e.abortController.abort(),t.abrupt("return");case 27:return e.metaInfo.useNewDomain=!1,i.failureCount+=1,t.next=31,gj(1e3);case 31:e.uploadedChunks.length===e.chunkCount?(e.log("chunks uploaded"),e.ee.emit("finished")):(e.singleThread||1===e.chunks.filter((function(e){return!e.processed})).length)&&e.uploadToServers();case 32:case"end":return t.stop()}}),t,null,[[0,13]])})))(),e.singleThread?"break":void 0},r=0;r<t.length&&"break"!==n(r);r++);0===t.length&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var e=!0,t=[],n=G(this.uploadedChunks).sort((function(e,t){return e.index-t.index})),r=0;for(n=Array.from(n.values());r<n.length;r++){var i=n[r].uploadedTo;if(void 0===i){e=!1;break}t.push(i)}if(!e)throw new Ma("some chunks not uploaded, cannot get upload server ips");return t}},{key:"addServers",value:function(e){var t=this;e.forEach((function(e){var n=t.servers.findIndex((function(t){return t.ip===e}));-1!==n?t.servers[n].failureCount=0:(t.log("server %s added",$g(e)),t.servers.push({successCount:0,isUploading:!1,ip:e,failureCount:0}))}))}},{key:"updateProgress",value:function(e){var t=this,n=void 0!==e?this.uploadedSize+e:this.metaInfo.file.length;n>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new bd("Invalid upload size",Dg))):(this.uploadedSize=n,void 0!==this.timer&&0!==e&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&void 0!==e&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout((function(){t.ee.emit("timedOut"),t.abortController.abort()}),12e4)),"initialized"===this.initState&&0===e||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(e,t){var n=0,r=[],i=t.length;for(e*=32768;n<i;)r.push(t.slice(n,n+e)),n+=e;return this.log("chunks split into %d",r.length),r}},{key:"postChunk",value:function(){var e=J(x.mark((function e(t,n,r){var i,o,a,s,c,u,l;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.aborted){e.next=2;break}throw new Ma("upload already aborted");case 2:if(void 0!==this.unit){e.next=4;break}throw new Ma("unit is undefined");case 4:return i=this.metaInfo,o=i.ticket,a=i.instance,s=i.loginOpt,c=i.hashStr,e.t0=r,e.t1=c,e.next=9,gt(t);case 9:return e.t2=e.sent,e.t3=this.unit,e.t4=o,e.t5=a,e.t6=s,u={index:e.t0,hash:e.t1,sha1:e.t2,unit:e.t3,ticket:e.t4,instance:e.t5,loginOpt:e.t6},(l=new FormData).append("parameter",JSON.stringify(u)),l.append("payload",new Blob([t])),e.next=20,He(n,{headers:{Accept:"application/json"},body:l,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(201===e.sent.status){e.next=24;break}throw new da("uploading chunk ".concat(r," failed"));case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(e){var t=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat($g(e).split(".").join("-"),".edge.").concat(Pd(null)?null:t,":9601/api/v1/chuck/upload")}}]),t}(wb()),kt=function(e){function t(e){X(this,t);var i=r.call(this,e,"MediaTaskManager");return m(n(i),"isProcessing",!1),m(n(i),"authInfo",void 0),m(n(i),"taskFinishers",{}),m(n(i),"mediaTasks",new Map),m(n(i),"ongoingTask",void 0),i.on("connectionStateChanged",(function(e){if(e===S.ConnectionState.ABORTED||e===S.ConnectionState.DISCONNECTED){void 0!==i.ongoingTask&&i.cancelTask(i.ongoingTask),e=0;for(var t=Array.from(i.mediaTasks.entries());e<t.length;e++){var n=ua(t[e],2)[1];i.cancelTask(n)}i.mediaTasks.clear(),i.taskFinishers={}}else e===S.ConnectionState.RECONNECTING?void 0!==i.ongoingTask&&i.ongoingTask.manager.abortController.abort():e===S.ConnectionState.CONNECTED&&void 0!==i.ongoingTask&&i.ongoingTask.manager.ee.emit("reconnected")})),i}ja(t,e);var r=ka(t);return Ia(t,[{key:"setAuthInfo",value:function(e){this.authInfo=e}},{key:"waitMediaTask",value:function(e){var t=this;return new Promise((function(n,r){t.taskFinishers[e]={resolve:n,reject:r},t.isProcessing||t.processMediaTask()})).finally((function(){void 0!==t.ongoingTask&&void 0!==t.ongoingTask.manager.timer&&clearTimeout(t.ongoingTask.manager.timer),delete t.taskFinishers[e],0!==t.mediaTasks.size?t.processMediaTask():t.isProcessing=!1}))}},{key:"addUploadTask",value:function(e,n,r,i){var o=e.file;if(e=e.hash,void 0===this.authInfo)throw new Ma("session not found");if(this.mediaTasks.size>=t.MAX_PENDING_TASK_COUNT-1)throw new lb("Upload media failed, exceed max pending jobs",tC);return i=new jt({hashStr:ft(e),file:o,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},i,this.logger),o=de(),this.mediaTasks.set(o,{type:"UPLOAD",manager:i,hash:e,setter:r,fetcher:n,taskId:o}),o}},{key:"addDownloadTask",value:function(e,n,r){var i=e.hashHexStr,o=e.size,a=e.unit;if(e=e.zone,void 0===this.authInfo)throw new Ma("session not found");if(this.mediaTasks.size>=t.MAX_PENDING_TASK_COUNT-1)throw new lb("Download media failed, exceed max pending jobs",xC);return r=new it({hashHexStr:i,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:o,zone:e,unit:a},r,this.logger),i=de(),this.mediaTasks.set(i,{type:"DOWNLOAD",manager:r,fetcher:n,taskId:i}),i}},{key:"doDownloadTaskImpl",value:function(){var e=J(x.mark((function e(t,n){var r,i,o,a,s,c,u,l,d=this,h=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<h.length&&void 0!==h[2]&&h[2],o=i=t.manager,r&&(i=new it(o.metaInfo,o.transHandler,this.logger,o.ee)),a=t.fetcher,e.next=7,a();case 7:if(s=e.sent,c=s.serverList,u=s.backupList,l=s.unit,!r||l===o.retUnit){e.next=13;break}throw new da("download unit is different, reject to continue",Eg);case 13:r&&(t.manager=i,i.downloadedSize=o.downloadedSize,i.successCount=o.successCount,i.timer=o.timer,i.chunks=o.chunks,i.initialized=o.initialized,i.singleThread=o.singleThread,i.updateProgress(0)),i.ee.once("reconnected",(function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("multiTimeOut",(function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("error",(function(e){i.ee.removeAllListeners(),n.reject(new da(["download file file, index %d",e.index],{code:Eg,originalError:e}))})),i.ee.once("notExist",(function(){i.abortController.abort(),i.ee.removeAllListeners(),n.reject(new da("download file not found",wC))})),i.ee.once("timedOut",(function(){i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new gb("download timed out",vC))})),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",(function(){n.reject(new Ol("Downloading canceled",ms))}),{once:!0}),i.ee.once("finished",(function(){n.resolve({type:"DOWNLOAD",payload:i.getPayload()})})),i.setInfoByResponse({serverList:c,backupList:u,unit:l}),i.downloadChunks();case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=e.taskId;return r||(this.mediaTasks.delete(i),this.ongoingTask=e),new Promise((function(i,o){n.doDownloadTaskImpl(e,t,r).then(i).catch(o)}))}},{key:"doUploadTaskImpl",value:function(){var e=J(x.mark((function e(t,n){var r,i,o,a,s,c,u,l,d=this,h=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<h.length&&void 0!==h[2]&&h[2],o=i=t.manager,r&&(i=new jt(o.metaInfo,o.transHandler,this.logger,o.ee)),a=t.fetcher,s=new Ua,u=new Promise((function(e,u){var l=a(),d=l.ret,h=l.err,f=l.timeout;l.fin.pipe(rb(s)).subscribe({next:function(e){n.resolve({type:"UPLOAD",retUnit:e.unit,zone:e.zone})},complete:function(){e({hasExist:!0}),s.next(),s.complete()}}),d.pipe(rb(s),fb(function(){var e=J(x.mark((function e(a){var s,u;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=a.servers,u=a.unit,r&&o.unit!==u?n.reject(new da("upload unit is different, reject to continue",Dg)):r&&(t.manager=i,i.chunkCount=o.chunkCount,i.chunks=o.chunks,i.totalFailures=o.totalFailures,i.uploadedChunks=o.uploadedChunks,i.timer=o.timer,i.initState=o.initState,i.unit=o.unit,i.uploadedSize=o.uploadedSize,i.singleThread=o.singleThread,i.updateProgress(0)),i.addServers(s),"uninitialized"!==i.initState){e.next=7;break}return c=i.initChunks(u),e.next=7,c;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).subscribe({complete:function(){return e({hasExist:!1})},error:u}),l=function(t){"uninitialized"!==i.initState&&c?e(c.then((function(){return{hasExist:!1}}))):u(t)},h.pipe(rb(s)).subscribe({error:l}),f.pipe(rb(s)).subscribe({error:l})})),e.next=9,u;case 9:if(!e.sent.hasExist){e.next=15;break}return i.updateProgress(),this.log("file already exists, skipping upload"),e.abrupt("return");case 15:s.next(),s.complete(),this.log("chunks initialization promise resolved"),l=jb(i.ee,"serverUsedUp").pipe(Av((function(){return i.chunkCount!==i.uploadedChunks.length})),Dv(5e3,void 0,{leading:!1}),sn((function(){return a().ret}))).subscribe((function(e){i.addServers(e.servers)})),i.ee.once("reconnected",(function(){i.ee.removeAllListeners(),d.doUploadTask(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("multiTimeOut",(function(){i.ee.removeAllListeners(),d.doUploadTask(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("timedOut",(function(){l.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new gb("upload timed out",ji))})),i.ee.once("error",(function(e){l.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(e||new da("upload error",Dg))})),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",(function(){n.reject(new Ol("Uploading canceled",ls))}),{once:!0}),i.ee.once("finished",J(x.mark((function e(){var r,o,a;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.unsubscribe(),e.next=3,t.setter(i.unit,i.getUploadServerIPs());case 3:r=e.sent,o=r.zone,a=r.unit,i.ee.removeAllListeners(),n.resolve({type:"UPLOAD",retUnit:a,zone:o});case 8:case"end":return e.stop()}}),e)})))),i.uploadToServers();case 26:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"doUploadTask",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=e.taskId;return r||(this.mediaTasks.delete(i),this.ongoingTask=e),new Promise((function(i,o){n.doUploadTaskImpl(e,t,r).then(i).catch(o)}))}},{key:"processMediaTask",value:function(){var e=J(x.mark((function e(){var t,n,r;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.mediaTasks.size){e.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,t=this.mediaTasks.keys().next().value,void 0!==(n=this.taskFinishers[t])){e.next=7;break}throw Error("top task not found");case 7:if(void 0!==(r=this.mediaTasks.get(t))){e.next=10;break}throw new Ma("task invalid");case 10:if("UPLOAD"!==r.type){e.next=15;break}return e.next=13,this.doUploadTask(r,n).catch((function(e){r.manager.ee.removeAllListeners(),n.reject(e)}));case 13:e.next=18;break;case 15:if("DOWNLOAD"!==r.type){e.next=18;break}return e.next=18,this.doDownloadTask(r,n).catch((function(e){r.manager.ee.removeAllListeners(),n.reject(e)}));case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancelTask",value:function(e){var t="DOWNLOAD"===e.type?ms:ls;e.manager.ee.removeAllListeners(),e.manager.abortController.abort(),void 0!==this.taskFinishers[e.taskId]&&this.taskFinishers[e.taskId].reject(new Ol("User logged out or kicked off, media task canceled",t))}}]),t}(wb());m(kt,"MAX_PENDING_TASK_COUNT",9),Up("of",(function(){for(var e=0,t=arguments.length,n=new(cf(this))(t);t>e;)n[e]=arguments[e++];return n}),nk);var lt=1/0,$E=Math.max,ew=function(e,t,n){var r=Object(e);if(!Nd(e)){var i=jf(t);e=Jd(e),t=function(e){return i(r[e],e,r)}}return-1<(t=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;if(null==n)n=0;else{var i=(n=n?(n=Nl(n))===lt||n===-lt?17976931348623157e292*(0>n?-1:1):n==n?n:0:0===n?n:0)%1;n=n==n?i?n-i:n:0}return 0>n&&(n=$E(r+n,0)),ar(e,jf(t),n)}(e,t,n))?r[i?e[t]:t]:void 0},dw=function(e,t){return e&&e.length?bl(e,void 0,"function"==typeof t?t:void 0):[]},mt=function(){function e(){X(this,e),m(this,"size",0),m(this,"fields",new Map)}return Ia(e,[{key:"define",value:function(e,t,n){if(this.size+=n,64<this.size)throw new RangeError("the struct over 64 bits is not supported");jh(t={val:0,isNumber:"number"===t,isBoolean:"boolean"===t,oneof:"number"===t||"boolean"===t?void 0:t,len:n}),this.fields.set(e,t)}},{key:"set",value:function(e,t){if(!(e=this.fields.get(e)))throw Error("field not found");var n=e.oneof;if(!U.isLong(t)&&"number"!=typeof t)if("boolean"==typeof t)t=t?1:0;else{if(void 0===n)throw Error("invalid field type");if(void 0===(t=n[t]))throw Error("field type not found")}jh(e,t),e.val=t}},{key:"toNumber",value:function(){for(var e=0,t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ua(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e+=U.fromValue(i).shiftLeft(t).toNumber(),t+=o)}return e}},{key:"toLong",value:function(){for(var e=U.fromNumber(0,!0),t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ua(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e=U.fromValue(i).shiftLeft(t).add(e),t+=o)}return e}},{key:"assert",value:function(e,t){function n(e){if(!U.isLong(e)&&"number"!=typeof e)if("boolean"==typeof e)e=e?1:0;else{if(void 0===i)throw Error("invalid field type");if(void 0===(e=i[e]))throw Error("field type not found")}return jh(r,e),ih(e,r.val)}var r=this.fields.get(e);if(!r)throw Error("field not found");var i=r.oneof;if(!Array.isArray(t))return n(t);if(1===t.length)return n(t[0]);if(t.every((function(e){return"string"==typeof e}))&&void 0!==i)return t.some((function(e){return n(e)}));throw Error("invalid valueTypes")}},{key:"from",value:function(e){e=U.fromValue(e);for(var t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ua(r[n],2)[1],o=i.len,a=U.fromNumber(Math.pow(2,o)-1,!0).shiftLeft(t);jh(i,a=e.and(a).shiftRightUnsigned(t)),i.val=a,t+=o}}},{key:"typeOf",value:function(e){if(void 0!==(e=this.fields.get(e))){var t=e.oneof;if(e=e.val,void 0!==t){var n=0;for(t=Object.entries(t);n<t.length;n++){var r=ua(t[n],2),i=r[0];if(ih(e,r[1]))return i}}}throw new TypeError("can only get type of oneof type")}}]),e}(),nt=function(e){function t(e){X(this,t);var r=n.call(this);return r.define("Rejoin","boolean",1),r.define("Unused","number",31),r.define("Platform","number",8),r.define("Version","number",12),r.define("Subversion","number",12),r.set("Platform",7),r.set("Version",4),r.set("Subversion",15),r.set("Rejoin",e),r}ja(t,e);var n=ka(t);return t}(mt),aF=wa(wa(wa(wa({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),ot={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},bF=wa(wa({},aF),ot),cF={Uncompressed:0,Zlib:1},ke=function(e){function t(e){X(this,t);var r=n.call(this);if(r.define("MessageType",bF,8),r.define("BroadcastJumps","number",2),r.define("ToCache","boolean",1),r.define("FromCache","boolean",1),r.define("CompressionMethod",cF,2),r.define("IterationNumber","number",4),r.define("BufferedMessage","boolean",1),r.define("ToArchive","boolean",1),r.define("FromArchive","boolean",1),"number"==typeof e||U.isLong(e))r.from(e);else if(void 0!==e){var i=0;for(e=eh(e);i<e.length;i++){var o=ua(e[i],2);r.set(o[0],o[1])}}return r}ja(t,e);var n=ka(t);return Ia(t,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(e){var t=this;return void 0!==e?this.assert("MessageType",e):Pf(ot).some((function(e){return t.assert("MessageType",e)}))}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),t}(mt),dF=function(e){function t(e){return X(this,t),m(n(e=r.call(this,e,"ChatManager")),"dialogueLru",new Nz(void 0,{maxlen:1e4,ttl:1e4})),e}ja(t,e);var r=ka(t);return Ia(t,[{key:"getChatInfo",value:function(e){var t=this.dialogueLru.get(e);if(this.dialogueLru.prune(),t){var n=t.dialogue,r={dialogue:n,sequence:t=t.sequence.add(1)};return this.dialogueLru.set(e,{dialogue:n,sequence:t}),r}return n={dialogue:Yg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(e,n),n}}]),t}(wb()),v={};"object"==("undefined"==typeof module?"undefined":V(module))&&(module.exports=v),v.parse=function(e,t){var n,r=v.bin.readUshort,i=v.bin.readUint,o={};for(n=(e=new Uint8Array(e)).length-4;101010256!=i(e,n);)n--;var a=r(e,n=n+4+4);r(e,n+=2),i(e,n+=2),n=i(e,n+=4);for(var s=0;s<a;s++){i(e,n),n+=4,n+=4,n+=4,i(e,n+=4);var c=i(e,n+=4),u=i(e,n+=4),l=r(e,n+=4),d=r(e,n+2),h=r(e,n+4);n+=6;var f=i(e,n+=8);n+=4,n+=l+d+h,v._readLocal(e,f,o,c,u,t)}return o},v._readLocal=function(e,t,n,r,i,o){var a=v.bin.readUshort,s=v.bin.readUint;s(e,t),a(e,t+=4),a(e,t+=2);var c=a(e,t+=2);s(e,t+=2),s(e,t+=4),s=a(e,t=t+4+8);var u=a(e,t+=2);if(t+=2,a=v.bin.readUTF8(e,t,s),t=t+s+u,o)n[a]={size:i,csize:r};else if(e=new Uint8Array(e.buffer,t),0==c)n[a]=new Uint8Array(e.buffer.slice(t,t+r));else{if(8!=c)throw"unknown compression method: "+c;t=new Uint8Array(i),v.inflateRaw(e,t),n[a]=t}},v.inflateRaw=function(e,t){return v.F.inflate(e,t)},v.inflate=function(e,t){return e[0],e[1],v.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-2),t)},v.deflate=function(e,t){null==t&&(t={level:6});var n=0,r=new Uint8Array(50+Math.floor(1.1*e.length));return r[n]=120,r[n+1]=156,n=v.F.deflateRaw(e,r,n+2,t.level),e=v.adler(e,0,e.length),r[n+0]=e>>>24&255,r[n+1]=e>>>16&255,r[n+2]=e>>>8&255,r[n+3]=e>>>0&255,new Uint8Array(r.buffer,0,n+4)},v.deflateRaw=function(e,t){null==t&&(t={level:6});var n=new Uint8Array(50+Math.floor(1.1*e.length)),r=v.F.deflateRaw(e,n,r,t.level);return new Uint8Array(n.buffer,0,r)},v.encode=function(e,t){null==t&&(t=!1);var n,r=0,i=v.bin.writeUint,o=v.bin.writeUshort,a={};for(n in e){var s=!v._noNeed(n)&&!t,c=e[n],u=v.crc.crc(c,0,c.length);a[n]={cpr:s,usize:c.length,crc:u,file:s?v.deflateRaw(c):c}}for(n in a)r+=a[n].file.length+30+46+2*v.bin.sizeUTF8(n);for(n in e=new Uint8Array(r+22),t=0,c=[],a)u=a[n],c.push(t),t=v._writeHeader(e,t,n,u,0);for(n in r=0,s=t,a)u=a[n],c.push(t),t=v._writeHeader(e,t,n,u,1,c[r++]);return a=t-s,i(e,t,101010256),o(e,t=t+4+4,r),o(e,t+=2,r),i(e,t+=2,a),i(e,t+4,s),e.buffer},v._noNeed=function(e){return e=e.split(".").pop().toLowerCase(),-1!="png,jpg,jpeg,zip".indexOf(e)},v._writeHeader=function(e,t,n,r,i,o){var a=v.bin.writeUint,s=v.bin.writeUshort,c=r.file;return a(e,t,0==i?67324752:33639248),t+=4,1==i&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,r.cpr?8:0),a(e,t+=2,0),a(e,t+=4,r.crc),a(e,t+=4,c.length),a(e,t+=4,r.usize),s(e,t+=4,v.bin.sizeUTF8(n)),s(e,t+=2,0),t+=2,1==i&&(a(e,t=t+2+2+6,o),t+=4),t+=n=v.bin.writeUTF8(e,t,n),0==i&&(e.set(c,t),t+=c.length),t},v.crc={table:function(){for(var e=new Uint32Array(256),t=0;256>t;t++){for(var n=t,r=0;8>r;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}(),update:function(e,t,n,r){for(var i=0;i<r;i++)e=v.crc.table[255&(e^t[n+i])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^v.crc.update(4294967295,e,t,n)}},v.adler=function(e,t,n){var r=1,i=0,o=t;for(t+=n;o<t;){for(n=Math.min(o+5552,t);o<n;)i+=r+=e[o++];r%=65521,i%=65521}return i<<16|r},v.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},readASCII:function(e,t,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(e,t,n){for(var r,i="",o=0;o<n;o++)i+="%"+v.bin.pad(e[t+o].toString(16));try{r=decodeURIComponent(i)}catch(r){return v.bin.readASCII(e,t,n)}return r},writeUTF8:function(e,t,n){for(var r=n.length,i=0,o=0;o<r;o++){var a=n.charCodeAt(o);if(0==(4294967168&a))e[t+i]=a,i++;else if(0==(4294965248&a))e[t+i]=192|a>>6,e[t+i+1]=128|a>>0&63,i+=2;else if(0==(4294901760&a))e[t+i]=224|a>>12,e[t+i+1]=128|a>>6&63,e[t+i+2]=128|a>>0&63,i+=3;else{if(0!=(4292870144&a))throw"e";e[t+i]=240|a>>18,e[t+i+1]=128|a>>12&63,e[t+i+2]=128|a>>6&63,e[t+i+3]=128|a>>0&63,i+=4}}return i},sizeUTF8:function(e){for(var t=e.length,n=0,r=0;r<t;r++){var i=e.charCodeAt(r);if(0==(4294967168&i))n++;else if(0==(4294965248&i))n+=2;else if(0==(4294901760&i))n+=3;else{if(0!=(4292870144&i))throw"e";n+=4}}return n}},v.F={},v.F.deflateRaw=function(e,t,n,r){var i=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][r],o=v.F.U,a=v.F._goodIndex;v.F._hash;var s=v.F._putsE,c=0;n<<=3;var u=0,l=e.length;if(0==r){for(;c<l;){var d=Math.min(65535,l-c);s(t,n,c+d==l?1:0),n=v.F._copyExact(e,c,d,t,n+8),c+=d}return n>>>3}s=o.lits,r=o.strt;var h=o.prev,f=0,p=0,m=0,g=0,y=0;for(2<l&&(r[y=v.F._hash(e,0)]=0),c=0;c<l;c++){if(d=y,c+1<l-2){y=v.F._hash(e,c+1);var b=c+1&32767;h[b]=r[y],r[y]=b}if(u<=c){if((14e3<f||26697<p)&&100<l-c&&(u<c&&(s[f]=c-u,f+=2,u=c),n=v.F._writeBlock(c==l-1||u==l?1:0,s,f,g,e,m,c-m,t,n),f=p=g=0,m=c),b=0,c<l-2&&(b=v.F._bestMatch(e,c,h,d,Math.min(i[2],l-c),i[3])),0!=b){d=b>>>16,b&=65535;var _=a(d,o.of0);o.lhst[257+_]++;var E=a(b,o.df0);o.dhst[E]++,g+=o.exb[_]+o.dxb[E],s[f]=d<<23|c-u,s[f+1]=b<<16|_<<8|E,f+=2,u=c+d}else o.lhst[e[c]]++;p++}}for(m==c&&0!=e.length||(u<c&&(s[f]=c-u,f+=2),n=v.F._writeBlock(1,s,f,g,e,m,c-m,t,n));0!=(7&n);)n++;return n>>>3},v.F._bestMatch=function(e,t,n,r,i,o){var a=32767&t,s=n[a],c=a-s+32768&32767;if(s==a||r!=v.F._hash(e,t-c))return 0;for(var u=r=0,l=Math.min(32767,t);c<=l&&0!=--o&&s!=a;){if((0==r||e[t+r]==e[t+r-c])&&(a=v.F._howLong(e,t,c))>r){if(u=c,(r=a)>=i)break;c+2<a&&(a=c+2);for(var d=0,h=0;h<a-2;h++){var f=t-c+h+32768&32767,p=f-n[f]+32768&32767;p>d&&(d=p,s=f)}}c+=(a=s)-(s=n[a])+32768&32767}return r<<16|u},v.F._howLong=function(e,t,n){if(e[t]!=e[t-n]||e[t+1]!=e[t+1-n]||e[t+2]!=e[t+2-n])return 0;var r=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]==e[t-n];)t++;return t-r},v.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(e,t,n,r,i,o,a,s,c){var u=v.F.U,l=v.F._putsF,d=v.F._putsE;u.lhst[256]++;var h=v.F.getTrees(),f=h[0],p=h[1],m=h[2],g=h[3],y=h[4],b=h[5],_=h[6];h=h[7];var E=32+(0==(c+3&7)?0:8-(c+3&7))+(a<<3),S=r+v.F.contSize(u.fltree,u.lhst)+v.F.contSize(u.fdtree,u.dhst);r=r+v.F.contSize(u.ltree,u.lhst)+v.F.contSize(u.dtree,u.dhst),r+=14+3*b+v.F.contSize(u.itree,u.ihst)+(2*u.ihst[16]+3*u.ihst[17]+7*u.ihst[18]);for(var w=0;286>w;w++)u.lhst[w]=0;for(w=0;30>w;w++)u.dhst[w]=0;for(w=0;19>w;w++)u.ihst[w]=0;if(E=E<S&&E<r?0:S<r?1:2,l(s,c,e),l(s,c+1,E),c+=3,0==E){for(;0!=(7&c);)c++;c=v.F._copyExact(i,o,a,s,c)}else{if(1==E)var T=u.fltree,A=u.fdtree;if(2==E){for(v.F.makeCodes(u.ltree,f),v.F.revCodes(u.ltree,f),v.F.makeCodes(u.dtree,p),v.F.revCodes(u.dtree,p),v.F.makeCodes(u.itree,m),v.F.revCodes(u.itree,m),T=u.ltree,A=u.dtree,d(s,c,g-257),d(s,c+=5,y-1),d(s,c+=5,b-4),c+=4,e=0;e<b;e++)d(s,c+3*e,u.itree[1+(u.ordr[e]<<1)]);c=v.F._codeTiny(_,u.itree,s,c+3*b),c=v.F._codeTiny(h,u.itree,s,c)}for(b=0;b<n;b+=2){for(_=(e=t[b])>>>23,e=o+(8388607&e);o<e;)c=v.F._writeLit(i[o++],T,s,c);0!=_&&(e=(f=t[b+1])>>16,a=f>>8&255,f&=255,d(s,c=v.F._writeLit(257+a,T,s,c),_-u.of0[a]),c+=u.exb[a],l(s,c=v.F._writeLit(f,A,s,c),e-u.df0[f]),c+=u.dxb[f],o+=_)}c=v.F._writeLit(256,T,s,c)}return c},v.F._copyExact=function(e,t,n,r,i){var o=i>>>3;return r[o]=n,r[o+1]=n>>>8,r[o+2]=255-r[o],r[o+3]=255-r[o+1],o+=4,r.set(new Uint8Array(e.buffer,t,n),o),i+(n+4<<3)},v.F.getTrees=function(){for(var e=v.F.U,t=v.F._hufTree(e.lhst,e.ltree,15),n=v.F._hufTree(e.dhst,e.dtree,15),r=[],i=v.F._lenCodes(e.ltree,r),o=[],a=v.F._lenCodes(e.dtree,o),s=0;s<r.length;s+=2)e.ihst[r[s]]++;for(s=0;s<o.length;s+=2)e.ihst[o[s]]++;s=v.F._hufTree(e.ihst,e.itree,7);for(var c=19;4<c&&0==e.itree[1+(e.ordr[c-1]<<1)];)c--;return[t,n,s,i,a,c,r,o]},v.F.getSecond=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(e[n+1]);return t},v.F.nonZero=function(e){for(var t="",n=0;n<e.length;n+=2)0!=e[n+1]&&(t+=(n>>1)+",");return t},v.F.contSize=function(e,t){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[1+(r<<1)];return n},v.F._codeTiny=function(e,t,n,r){for(var i=0;i<e.length;i+=2){var o=e[i],a=e[i+1];r=v.F._writeLit(o,t,n,r);var s=16==o?2:17==o?3:7;15<o&&(v.F._putsE(n,r,a,s),r+=s)}return r},v.F._lenCodes=function(e,t){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var r=0;r<n;r+=2){var i=e[r+1],o=r+3<n?e[r+3]:-1,a=r+5<n?e[r+5]:-1,s=0==r?-1:e[r-1];if(0==i&&o==i&&a==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;11>(i=Math.min(o+1-r>>>1,138))?t.push(17,i-3):t.push(18,i-11),r+=2*i-2}else if(i==s&&o==i&&a==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;i=Math.min(o+1-r>>>1,6),t.push(16,i-3),r+=2*i-2}else t.push(i,0)}return n>>>1},v.F._hufTree=function(e,t,n){var r=[],i=e.length,o=t.length,a=0;for(a=0;a<o;a+=2)t[a]=0,t[a+1]=0;for(a=0;a<i;a++)0!=e[a]&&r.push({lit:a,f:e[a]});if(e=r.length,i=r.slice(0),0==e)return 0;if(1==e)return t[1+((n=r[0].lit)<<1)]=1,t[1+((0==n?1:0)<<1)]=1;r.sort((function(e,t){return e.f-t.f})),a=r[0],o=r[1];var s=0,c=1,u=2;for(r[0]={lit:-1,f:a.f+o.f,l:a,r:o,d:0};c!=e-1;)a=s!=c&&(u==e||r[s].f<r[u].f)?r[s++]:r[u++],o=s!=c&&(u==e||r[s].f<r[u].f)?r[s++]:r[u++],r[c++]={lit:-1,f:a.f+o.f,l:a,r:o};for((r=v.F.setDepth(r[c-1],0))>n&&(v.F.restrictDepth(i,n,r),r=n),a=0;a<e;a++)t[1+(i[a].lit<<1)]=i[a].d;return r},v.F.setDepth=function(e,t){return-1!=e.lit?e.d=t:Math.max(v.F.setDepth(e.l,t+1),v.F.setDepth(e.r,t+1))},v.F.restrictDepth=function(e,t,n){var r=0,i=1<<n-t,o=0;for(e.sort((function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d})),r=0;r<e.length&&e[r].d>t;r++){var a=e[r].d;e[r].d=t,o+=i-(1<<n-a)}for(o>>>=n-t;0<o;)(a=e[r].d)<t?(e[r].d++,o-=1<<t-a-1):r++;for(;0<=r;r--)e[r].d==t&&0>o&&(e[r].d--,o++);0!=o&&console.log("debt left")},v.F._goodIndex=function(e,t){var n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n},v.F._writeLit=function(e,t,n,r){return v.F._putsF(n,r,t[e<<1]),r+t[1+(e<<1)]},v.F.inflate=function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var r=v.F,i=r._bitsF,o=r._bitsE,a=r._decodeTiny,s=r.makeCodes,c=r.codes2map,u=r._get17,l=r.U,d=null==t;d&&(t=new n(e.length>>>2<<3));for(var h,f,p,m,g=0,y=0,b=f=0,_=0;0==g;)if(g=i(e,_,1),h=i(e,_+1,2),_+=3,0==h)0!=(7&_)&&(_+=8-(7&_)),h=e[(_=4+(_>>>3))-4]|e[_-3]<<8,d&&(t=v.F._check(t,b+h)),t.set(new n(e.buffer,e.byteOffset+_,h),b),_=_+h<<3,b+=h;else{if(d&&(t=v.F._check(t,b+131072)),1==h&&(p=l.flmap,m=l.fdmap,y=511,f=31),2==h){for(f=o(e,_,5)+257,h=o(e,_+5,5)+1,p=o(e,_+10,4)+4,_+=14,m=0;38>m;m+=2)l.itree[m]=0,l.itree[m+1]=0;for(y=1,m=0;m<p;m++){var E=o(e,_+3*m,3);l.itree[1+(l.ordr[m]<<1)]=E,E>y&&(y=E)}_+=3*p,s(l.itree,y),c(l.itree,y,l.imap),p=l.lmap,m=l.dmap,_=a(l.imap,(1<<y)-1,f+h,e,_,l.ttree),y=(1<<(E=r._copyOut(l.ttree,0,f,l.ltree)))-1,f=(1<<(h=r._copyOut(l.ttree,f,h,l.dtree)))-1,s(l.ltree,E),c(l.ltree,E,p),s(l.dtree,h),c(l.dtree,h,m)}for(;;)if(_+=15&(h=p[u(e,_)&y]),0==(E=h>>>4)>>>8)t[b++]=E;else{if(256==E)break;h=b+E-254,264<E&&(h=b+((E=l.ldef[E-257])>>>3)+o(e,_,7&E),_+=7&E),_+=15&(E=m[u(e,_)&f]);var S=((E=l.ddef[E>>>4])>>>4)+i(e,_,15&E);for(_+=15&E,d&&(t=v.F._check(t,b+131072));b<h;)t[b]=t[b++-S],t[b]=t[b++-S],t[b]=t[b++-S],t[b]=t[b++-S];b=h}}return t.length==b?t:t.slice(0,b)},v.F._check=function(e,t){var n=e.length;return t<=n?e:((t=new Uint8Array(Math.max(n<<1,t))).set(e,0),t)},v.F._decodeTiny=function(e,t,n,r,i,o){for(var a=v.F._bitsE,s=v.F._get17,c=0;c<n;){var u=e[s(r,i)&t];i+=15&u;var l=u>>>4;if(15>=l)o[c]=l,c++;else{var d=u=0;for(16==l?(d=3+a(r,i,2),i+=2,u=o[c-1]):17==l?(d=3+a(r,i,3),i+=3):18==l&&(d=11+a(r,i,7),i+=7),l=c+d;c<l;)o[c]=u,c++}}return i},v.F._copyOut=function(e,t,n,r){for(var i=0,o=0,a=r.length>>>1;o<n;){var s=e[o+t];r[o<<1]=0,r[1+(o<<1)]=s,s>i&&(i=s),o++}for(;o<a;)r[o<<1]=0,r[1+(o<<1)]=0,o++;return i},v.F.makeCodes=function(e,t){var n,r,i=v.F.U,o=e.length,a=i.bl_count;for(n=0;n<=t;n++)a[n]=0;for(n=1;n<o;n+=2)a[e[n]]++;for(i=i.next_code,n=0,a[0]=0,r=1;r<=t;r++)n=n+a[r-1]<<1,i[r]=n;for(t=0;t<o;t+=2)0!=(a=e[t+1])&&(e[t]=i[a],i[a]++)},v.F.codes2map=function(e,t,n){for(var r=e.length,i=v.F.U.rev15,o=0;o<r;o+=2)if(0!=e[o+1]){var a=e[o+1],s=o>>1<<4|a,c=t-a;for(c=(a=e[o]<<c)+(1<<c);a!=c;)n[i[a]>>>15-t]=s,a++}},v.F.revCodes=function(e,t){for(var n=v.F.U.rev15,r=15-t,i=0;i<e.length;i+=2)e[i]=n[e[i]<<t-e[i+1]]>>>r},v.F._putsE=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8},v.F._putsF=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8,e[t+2]|=n>>>16},v.F._bitsE=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},v.F._bitsF=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},v.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},v.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},v.F.U=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}(),function(){function e(e,t,n){for(;0!=t--;)e.push(0,n)}for(var t=v.F.U,n=0;32768>n;n++){var r=n;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,t.rev15[n]=(r>>>16|r<<16)>>>17}for(n=0;32>n;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];e(t.fltree,144,8),e(t.fltree,112,9),e(t.fltree,24,7),e(t.fltree,8,8),v.F.makeCodes(t.fltree,9),v.F.codes2map(t.fltree,9,t.flmap),v.F.revCodes(t.fltree,9),e(t.fdtree,32,5),v.F.makeCodes(t.fdtree,5),v.F.codes2map(t.fdtree,5,t.fdmap),v.F.revCodes(t.fdtree,5),e(t.itree,19,0),e(t.ltree,286,0),e(t.dtree,30,0),e(t.ttree,320,0)}();var eF=Array.isArray||function(e){return e&&"number"==typeof e.length},fF=Object.defineProperty({isArray:eF},"__esModule",{value:!0}),gF=Object.defineProperty({isObject:function(e){return null!==e&&"object"===V(e)}},"__esModule",{value:!0}),hF=Object.defineProperty({isFunction:function(e){return"function"==typeof e}},"__esModule",{value:!0}),iF=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),kh=Object.defineProperty({UnsubscriptionError:iF},"__esModule",{value:!0}),jF=function(){function e(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){if(!this.closed){var t=this._parentOrParents,n=this._ctorUnsubscribe,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,t instanceof e)t.remove(this);else if(null!==t)for(var o=0;o<t.length;++o)t[o].remove(this);if(hF.isFunction(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(e){var a=e instanceof kh.UnsubscriptionError?go(e.errors):[e]}}if(fF.isArray(i))for(o=-1,t=i.length;++o<t;)if(n=i[o],gF.isObject(n))try{n.unsubscribe()}catch(e){a=a||[],e instanceof kh.UnsubscriptionError?a=a.concat(go(e.errors)):a.push(e)}if(a)throw new kh.UnsubscriptionError(a)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(V(t)){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof e||(t=n,(n=new e)._subscriptions=[t]);break;default:throw Error("unrecognized teardown "+t+" added to Subscription.")}if(null===(t=n._parentOrParents))n._parentOrParents=this;else if(t instanceof e){if(t===this)return n;n._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return n;t.push(this)}return null===(t=this._subscriptions)?this._subscriptions=[n]:t.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;t&&-1!==(e=t.indexOf(e))&&t.splice(e,1)},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),kF=Object.defineProperty({Subscription:jF},"__esModule",{value:!0}),lF=Ka&&Ka.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mF=function(e){function t(t,n){return e.call(this)||this}return lF(t,e),t.prototype.schedule=function(e,t){return this},t}(kF.Subscription),nF=Object.defineProperty({Action:mF},"__esModule",{value:!0}),oF=Ka&&Ka.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return oF(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,e=this.id;var n=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(n,e,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(e=this._execute(e,t))?e:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},t.prototype._execute=function(e,t){t=!1;var n=void 0;try{this.work(e)}catch(e){t=!0,n=!!e&&e||Error(e)}if(t)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(nF.Action);Object.defineProperty({AsyncAction:pt},"__esModule",{value:!0});var pF=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),qt=Object.defineProperty({Scheduler:pF},"__esModule",{value:!0}),qF=Ka&&Ka.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),rt=function(e){function t(n,r){void 0===r&&(r=qt.Scheduler.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return qF(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(qt.Scheduler);Object.defineProperty({AsyncScheduler:rt},"__esModule",{value:!0});var rF=qa("iterator"),Tl=!R((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[rF]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://").host||"#%D0%B1"!==new URL("http://a#").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),sF=/[^\0-\u007E]/,tF=/[.\u3002\uFF0E\uFF61]/g,sf=Math.floor,Ul=String.fromCharCode,st=function(e){return e+22+75*(26>e)},uF=function(e){for(var t=[],n=[],r=0,i=e.length;r<i;){var o=e.charCodeAt(r++);if(55296<=o&&56319>=o&&r<i){var a=e.charCodeAt(r++);56320==(64512&a)?n.push(((1023&o)<<10)+(1023&a)+65536):(n.push(o),r--)}else n.push(o)}n=(e=n).length,r=128;var s=0,c=72;for(i=0;i<e.length;i++){var u=e[i];128>u&&t.push(Ul(u))}for((a=o=t.length)&&t.push("-");a<n;){var l=2147483647;for(i=0;i<e.length;i++)(u=e[i])>=r&&u<l&&(l=u);var d=a+1;if(l-r>sf((2147483647-s)/d))throw RangeError("Overflow: input needs wider integers to process");for(s+=(l-r)*d,r=l,i=0;i<e.length;i++){if((u=e[i])<r&&2147483647<++s)throw RangeError("Overflow: input needs wider integers to process");if(u==r){var h=s;for(u=36;!(h<(l=u<=c?1:u>=c+26?26:u-c));u+=36){h-=l;var f=36-l;t.push(Ul(st(l+h%f))),h=sf(h/f)}for(t.push(Ul(st(h))),c=d,u=0,s=a==o?sf(s/700):s>>1,s+=sf(s/c);455<s;u+=36)s=sf(s/35);c=sf(u+36*s/(s+38)),s=0,++a}}++s,++r}return t.join("")},tt=function(e){var t=Zf(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return sa(t.call(e))},ut=Rb("fetch"),Vl=Rb("Headers"),vF=qa("iterator"),vt=La.set,Hb=La.getterFor("URLSearchParams"),wF=La.getterFor("URLSearchParamsIterator"),xF=/\+/g,wt=Array(4),yF=function(e){return wt[e-1]||(wt[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},zF=function(e){try{return decodeURIComponent(e)}catch(t){return e}},xt=function(e){e=e.replace(xF," ");var t=4;try{return decodeURIComponent(e)}catch(n){for(;t;)e=e.replace(yF(t--),zF);return e}},yt=/[!'()~]|%20/g,AF={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},zt=function(e){return AF[e]},At=function(e,t){if(t){t=t.split("&");for(var n,r=0;r<t.length;)(n=t[r++]).length&&(n=n.split("="),e.push({key:xt(n.shift()),value:xt(n.join("="))}))}},BF=function(e){this.entries.length=0,At(this.entries,e)},tf=function(e,t){if(e<t)throw TypeError("Not enough arguments")},Wl=Zo((function(e,t){vt(this,{type:"URLSearchParamsIterator",iterator:tt(Hb(e).entries),kind:t})}),"Iterator",(function(){var e=wF(this),t=e.kind,n=(e=e.iterator.next()).value;return e.done||(e.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),e})),Fg=function(){hc(this,Fg,"URLSearchParams");var e,t,n,r=0<arguments.length?arguments[0]:void 0,i=[];if(vt(this,{type:"URLSearchParams",entries:i,updateURL:function(){},updateSearchParams:BF}),void 0!==r)if(ha(r)){var o=Zf(r);if("function"==typeof o)for(r=o.call(r),o=r.next;!(e=o.call(r)).done;){var a=(e=tt(sa(e.value))).next;if((t=a.call(e)).done||(n=a.call(e)).done||!a.call(e).done)throw TypeError("Expected sequence with length 2");i.push({key:t.value+"",value:n.value+""})}else for(e in r)Q(r,e)&&i.push({key:e,value:r[e]+""})}else At(i,"string"==typeof r?"?"===r.charAt(0)?r.slice(1):r:r+"")},pi=Fg.prototype;Xe(pi,{append:function(e,t){tf(arguments.length,2);var n=Hb(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){tf(arguments.length,1);for(var t=Hb(this),n=t.entries,r=e+"",i=0;i<n.length;)n[i].key===r?n.splice(i,1):i++;t.updateURL()},get:function(e){tf(arguments.length,1);for(var t=Hb(this).entries,n=e+"",r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){tf(arguments.length,1);for(var t=Hb(this).entries,n=e+"",r=[],i=0;i<t.length;i++)t[i].key===n&&r.push(t[i].value);return r},has:function(e){tf(arguments.length,1);for(var t=Hb(this).entries,n=e+"",r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){tf(arguments.length,1);for(var n,r=Hb(this),i=r.entries,o=!1,a=e+"",s=t+"",c=0;c<i.length;c++)(n=i[c]).key===a&&(o?i.splice(c--,1):(o=!0,n.value=s));o||i.push({key:a,value:s}),r.updateURL()},sort:function(){var e,t,n=Hb(this),r=n.entries,i=r.slice();for(t=r.length=0;t<i.length;t++){var o=i[t];for(e=0;e<t;e++)if(r[e].key>o.key){r.splice(e,0,o);break}e===t&&r.push(o)}n.updateURL()},forEach:function(e){for(var t,n=Hb(this).entries,r=pd(e,1<arguments.length?arguments[1]:void 0,3),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new Wl(this,"keys")},values:function(){return new Wl(this,"values")},entries:function(){return new Wl(this,"entries")}},{enumerable:!0}),Ea(pi,vF,pi.entries),Ea(pi,"toString",(function(){for(var e,t=Hb(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(encodeURIComponent(e.key).replace(yt,zt)+"="+encodeURIComponent(e.value).replace(yt,zt));return n.join("&")}),{enumerable:!0}),gc(Fg,"URLSearchParams"),M({global:!0,forced:!Tl},{URLSearchParams:Fg}),Tl||"function"!=typeof ut||"function"!=typeof Vl||M({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t=[e];if(1<arguments.length){var n=arguments[1];if(ha(n)){var r=n.body;if("URLSearchParams"===We(r)){var i=n.headers?new Vl(n.headers):new Vl;i.has("content-type")||i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),n=Sb(n,{body:sc(0,String(r)),headers:sc(0,i)})}}t.push(n)}return ut.apply(this,t)}});var Gg=C.URL,CF=Fg,DF=La.set,Na=La.getterFor("URL"),EF=Math.floor,Bt=Math.pow,Ct=/[A-Za-z]/,FF=/[\d+-.A-Za-z]/,Xl=/\d/,GF=/^(0x|0X)/,HF=/^[0-7]+$/,IF=/^\d+$/,Dt=/^[\dA-Fa-f]+$/,JF=/[\0\t\n\r #%/:?@[\\]]/,KF=/[\0\t\n\r #/:?@[\\]]/,LF=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,MF=/[\t\n\r]/g,Yl=function(e,t){var n;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return"Invalid host";var r=NF(t.slice(1,-1));if(!r)return"Invalid host"}else if(bb(e)){for(r=[],t=t.toLowerCase().replace(tF,".").split("."),n=0;n<t.length;n++){var i=t[n];r.push(sF.test(i)?"xn--"+uF(i):i)}if(t=r.join("."),JF.test(t))return"Invalid host";if(null===(r=OF(t)))return"Invalid host"}else{if(KF.test(t))return"Invalid host";for(r="",t=Td(t),n=0;n<t.length;n++)r+=Cd(t[n],qi)}e.host=r},OF=function(e){var t,n=e.split(".");n.length&&""==n[n.length-1]&&n.pop();var r=n.length;if(4<r)return e;var i=[];for(t=0;t<r;t++){var o=n[t];if(""==o)return e;var a=10;if(1<o.length&&"0"==o.charAt(0)&&(a=GF.test(o)?16:8,o=o.slice(8==a?1:2)),""===o)o=0;else{if(!(10==a?IF:8==a?HF:Dt).test(o))return e;o=parseInt(o,a)}i.push(o)}for(t=0;t<r;t++)if(o=i[t],t==r-1){if(o>=Bt(256,5-r))return null}else if(255<o)return null;for(e=i.pop(),t=0;t<i.length;t++)e+=i[t]*Bt(256,3-t);return e},NF=function(e){var t,n,r=[0,0,0,0,0,0,0,0],i=0,o=null,a=0,s=function(){return e.charAt(a)};if(":"==s()){if(":"!=e.charAt(1))return;a+=2,o=++i}for(;s();){if(8==i)return;if(":"==s()){if(null!==o)return;a++,o=++i}else{for(t=n=0;4>n&&Dt.test(s());)t=16*t+parseInt(s(),16),a++,n++;if("."==s()){if(0==n)return;if(a-=n,6<i)return;for(t=0;s();){if(n=null,0<t){if(!("."==s()&&4>t))return;a++}if(!Xl.test(s()))return;for(;Xl.test(s());){var c=parseInt(s(),10);if(null===n)n=c;else{if(0==n)return;n=10*n+c}if(255<n)return;a++}r[i]=256*r[i]+n,2!=++t&&4!=t||i++}if(4!=t)return;break}if(":"==s()){if(a++,!s())return}else if(s())return;r[i++]=t}}if(null!==o)for(s=i-o,i=7;0!=i&&0<s;)t=r[i],r[i--]=r[o+s-1],r[o+--s]=t;else if(8!=i)return;return r},Hg=function(e){var t,n;if("number"==typeof e){var r=[];for(t=0;4>t;t++)r.unshift(e%256),e=EF(e/256);return r.join(".")}if("object"==typeof e){r="",t=null;for(var i=1,o=null,a=0,s=0;8>s;s++)0!==e[s]?(a>i&&(t=o,i=a),o=null,a=0):(null===o&&(o=s),++a);for(a>i&&(t=o),i=t,t=0;8>t;t++)n&&0===e[t]||(n&&(n=!1),i===t?(r+=t?":":"::",n=!0):(r+=e[t].toString(16),7>t&&(r+=":")));return"["+r+"]"}return e},qi={},Et=ng({},qi,{" ":1,'"':1,"<":1,">":1,"`":1}),Ft=ng({},Et,{"#":1,"?":1,"{":1,"}":1}),Zl=ng({},Ft,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Cd=function(e,t){var n=Kw(e,0);return 32<n&&127>n&&!Q(t,e)?e:encodeURIComponent(e)},ri={ftp:21,file:null,http:80,https:443,ws:80,wss:443},bb=function(e){return Q(ri,e.scheme)},$l=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},Ig=function(e,t){var n;return 2==e.length&&Ct.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},Gt=function(e){var t;return 1<e.length&&Ig(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},Ht=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&Ig(t[0],!0)||t.pop()},am={},It={},bm={},Jt={},Kt={},cm={},Lt={},Mt={},si={},ti={},dm={},em={},fm={},gm={},Nt={},hm={},Jg={},Hc={},Ot={},le={},dd={},Ic=function(e,t,n,r){var i=n||am,o=0,a="",s=!1,c=!1,u=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(LF,"")),t=t.replace(MF,""),t=Td(t);o<=t.length;){var l=t[o];switch(i){case am:if(!l||!Ct.test(l)){if(n)return"Invalid scheme";i=bm;continue}a+=l.toLowerCase(),i=It;break;case It:if(l&&(FF.test(l)||"+"==l||"-"==l||"."==l))a+=l.toLowerCase();else{if(":"!=l){if(n)return"Invalid scheme";a="",i=bm,o=0;continue}if(n&&(bb(e)!=Q(ri,a)||"file"==a&&(""!=e.username||""!=e.password||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=a,n)return void(bb(e)&&ri[e.scheme]==e.port&&(e.port=null));a="","file"==e.scheme?i=gm:bb(e)&&r&&r.scheme==e.scheme?i=Jt:bb(e)?i=Mt:"/"==t[o+1]?(i=Kt,o++):(e.cannotBeABaseURL=!0,e.path.push(""),i=Ot)}break;case bm:if(!r||r.cannotBeABaseURL&&"#"!=l)return"Invalid scheme";if(r.cannotBeABaseURL&&"#"==l){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,i=dd;break}i="file"==r.scheme?gm:cm;continue;case Jt:if("/"!=l||"/"!=t[o+1]){i=cm;continue}i=si,o++;break;case Kt:if("/"==l){i=ti;break}i=Hc;continue;case cm:if(e.scheme=r.scheme,null==l)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==l||"\\"==l&&bb(e))i=Lt;else if("?"==l)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",i=le;else{if("#"!=l){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),i=Hc;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",i=dd}break;case Lt:if(!bb(e)||"/"!=l&&"\\"!=l){if("/"!=l){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,i=Hc;continue}i=ti}else i=si;break;case Mt:if(i=si,"/"!=l||"/"!=a.charAt(o+1))continue;o++;break;case si:if("/"!=l&&"\\"!=l){i=ti;continue}break;case ti:if("@"==l){for(s&&(a="%40"+a),s=!0,a=Td(a),l=0;l<a.length;l++){var d=a[l];":"!=d||u?(d=Cd(d,Zl),u?e.password+=d:e.username+=d):u=!0}a=""}else if(null==l||"/"==l||"?"==l||"#"==l||"\\"==l&&bb(e)){if(s&&""==a)return"Invalid authority";o-=Td(a).length+1,a="",i=dm}else a+=l;break;case dm:case em:if(n&&"file"==e.scheme){i=hm;continue}if(":"!=l||c){if(null==l||"/"==l||"?"==l||"#"==l||"\\"==l&&bb(e)){if(bb(e)&&""==a)return"Invalid host";if(n&&""==a&&(""!=e.username||""!=e.password||null!==e.port))return;if(i=Yl(e,a))return i;if(a="",i=Jg,n)return;continue}"["==l?c=!0:"]"==l&&(c=!1),a+=l}else{if(""==a)return"Invalid host";if(i=Yl(e,a))return i;if(a="",i=fm,n==em)return}break;case fm:if(!Xl.test(l)){if(null==l||"/"==l||"?"==l||"#"==l||"\\"==l&&bb(e)||n){if(""!=a){if(65535<(i=parseInt(a,10)))return"Invalid port";e.port=bb(e)&&i===ri[e.scheme]?null:i,a=""}if(n)return;i=Jg;continue}return"Invalid port"}a+=l;break;case gm:if(e.scheme="file","/"==l||"\\"==l)i=Nt;else{if(!r||"file"!=r.scheme){i=Hc;continue}if(null==l)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==l)e.host=r.host,e.path=r.path.slice(),e.query="",i=le;else{if("#"!=l){Gt(t.slice(o).join(""))||(e.host=r.host,e.path=r.path.slice(),Ht(e)),i=Hc;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",i=dd}}break;case Nt:if("/"==l||"\\"==l){i=hm;break}r&&"file"==r.scheme&&!Gt(t.slice(o).join(""))&&(Ig(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),i=Hc;continue;case hm:if(null==l||"/"==l||"\\"==l||"?"==l||"#"==l){if(!n&&Ig(a))i=Hc;else{if(""==a){if(e.host="",n)return}else{if(i=Yl(e,a))return i;if("localhost"==e.host&&(e.host=""),n)return;a=""}i=Jg}continue}a+=l;break;case Jg:if(bb(e)){if(i=Hc,"/"!=l&&"\\"!=l)continue}else if(n||"?"!=l)if(n||"#"!=l){if(null!=l&&(i=Hc,"/"!=l))continue}else e.fragment="",i=dd;else e.query="",i=le;break;case Hc:if(null==l||"/"==l||"\\"==l&&bb(e)||!n&&("?"==l||"#"==l)){if(".."===(d=(d=a).toLowerCase())||"%2e."===d||".%2e"===d||"%2e%2e"===d?(Ht(e),"/"==l||"\\"==l&&bb(e)||e.path.push("")):"."===a||"%2e"===a.toLowerCase()?"/"==l||"\\"==l&&bb(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&Ig(a)&&(e.host&&(e.host=""),a=a.charAt(0)+":"),e.path.push(a)),a="","file"==e.scheme&&(null==l||"?"==l||"#"==l))for(;1<e.path.length&&""===e.path[0];)e.path.shift();"?"==l?(e.query="",i=le):"#"==l&&(e.fragment="",i=dd)}else a+=Cd(l,Ft);break;case Ot:"?"==l?(e.query="",i=le):"#"==l?(e.fragment="",i=dd):null!=l&&(e.path[0]+=Cd(l,qi));break;case le:n||"#"!=l?null!=l&&("'"==l&&bb(e)?e.query+="%27":e.query="#"==l?e.query+"%23":e.query+Cd(l,qi)):(e.fragment="",i=dd);break;case dd:null!=l&&(e.fragment+=Cd(l,Et))}o++}},Dd=function(e){var t=hc(this,Dd,"URL"),n=1<arguments.length?arguments[1]:void 0,r=String(e),i=DF(t,{type:"URL"});if(void 0!==n)if(n instanceof Dd)var o=Na(n);else if(n=Ic(o={},String(n)))throw TypeError(n);if(n=Ic(i,r,null,o))throw TypeError(n);var a=i.searchParams=new CF;(r=Hb(a)).updateSearchParams(i.query),r.updateURL=function(){i.query=String(a)||null},fa||(t.href=ui.call(t),t.origin=Pt.call(t),t.protocol=Qt.call(t),t.username=Rt.call(t),t.password=St.call(t),t.host=Tt.call(t),t.hostname=Ut.call(t),t.port=Vt.call(t),t.pathname=Wt.call(t),t.search=Xt.call(t),t.searchParams=Yt.call(t),t.hash=Zt.call(t))},im=Dd.prototype,ui=function(){var e=Na(this),t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",""==e.username&&""==e.password||(u+=n+(r?":"+r:"")+"@"),u+=Hg(i),null!==o&&(u+=":"+o)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},Pt=function(){var e=Na(this),t=e.scheme,n=e.port;if("blob"==t)try{return new Dd(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&bb(e)?t+"://"+Hg(e.host)+(null!==n?":"+n:""):"null"},Qt=function(){return Na(this).scheme+":"},Rt=function(){return Na(this).username},St=function(){return Na(this).password},Tt=function(){var e=Na(this),t=e.host;return e=e.port,null===t?"":null===e?Hg(t):Hg(t)+":"+e},Ut=function(){var e=Na(this).host;return null===e?"":Hg(e)},Vt=function(){var e=Na(this).port;return null===e?"":String(e)},Wt=function(){var e=Na(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},Xt=function(){var e=Na(this).query;return e?"?"+e:""},Yt=function(){return Na(this).searchParams},Zt=function(){var e=Na(this).fragment;return e?"#"+e:""},$b=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(fa&&Wo(im,{href:$b(ui,(function(e){var t=Na(this);if(e=Ic(t,String(e)))throw TypeError(e);Hb(t.searchParams).updateSearchParams(t.query)})),origin:$b(Pt),protocol:$b(Qt,(function(e){var t=Na(this);Ic(t,String(e)+":",am)})),username:$b(Rt,(function(e){var t=Na(this);if(e=Td(String(e)),!$l(t)){t.username="";for(var n=0;n<e.length;n++)t.username+=Cd(e[n],Zl)}})),password:$b(St,(function(e){var t=Na(this);if(e=Td(String(e)),!$l(t)){t.password="";for(var n=0;n<e.length;n++)t.password+=Cd(e[n],Zl)}})),host:$b(Tt,(function(e){var t=Na(this);t.cannotBeABaseURL||Ic(t,String(e),dm)})),hostname:$b(Ut,(function(e){var t=Na(this);t.cannotBeABaseURL||Ic(t,String(e),em)})),port:$b(Vt,(function(e){var t=Na(this);$l(t)||(""==(e=String(e))?t.port=null:Ic(t,e,fm))})),pathname:$b(Wt,(function(e){var t=Na(this);t.cannotBeABaseURL||(t.path=[],Ic(t,e+"",Jg))})),search:$b(Xt,(function(e){var t=Na(this);""==(e=String(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",Ic(t,e,le)),Hb(t.searchParams).updateSearchParams(t.query)})),searchParams:$b(Yt),hash:$b(Zt,(function(e){var t=Na(this);""==(e=String(e))?t.fragment=null:("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",Ic(t,e,dd))}))}),Ea(im,"toJSON",(function(){return ui.call(this)}),{enumerable:!0}),Ea(im,"toString",(function(){return ui.call(this)}),{enumerable:!0}),Gg){var $t=Gg.createObjectURL,au=Gg.revokeObjectURL;$t&&Ea(Dd,"createObjectURL",(function(e){return $t.apply(Gg,arguments)})),au&&Ea(Dd,"revokeObjectURL",(function(e){return au.apply(Gg,arguments)}))}gc(Dd,"URL"),M({global:!0,forced:!Tl,sham:!fa},{URL:Dd});var PF=new Blob(["var fakeIdToId = {};onmessage = function (event) {\tvar data = event.data,\t\tname = data.name,\t\tfakeId = data.fakeId,\t\ttime;\tif(data.hasOwnProperty('time')) {\t\ttime = data.time;\t}\tswitch (name) {\t\tcase 'setInterval':\t\t\tfakeIdToId[fakeId] = setInterval(function () {\t\t\t\tpostMessage({fakeId: fakeId});\t\t\t}, time);\t\t\tbreak;\t\tcase 'clearInterval':\t\t\tif (fakeIdToId.hasOwnProperty (fakeId)) {\t\t\t\tclearInterval(fakeIdToId[fakeId]);\t\t\t\tdelete fakeIdToId[fakeId];\t\t\t}\t\t\tbreak;\t}}"]),QF=window.URL.createObjectURL(PF),Me={},Rf=0,uj=new Worker(QF);uj.onmessage=function(e){if(e=e.data.fakeId,Me.hasOwnProperty(e)){var t=Me[e];e=t.callback,t=t.parameters,e.apply(window,t)}};var RF=function(e){function t(){return X(this,t),n.apply(this,arguments)}ja(t,e);var n=ka(t);return Ia(t,[{key:"requestAsyncId",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return fw(e.flush.bind(e,this),n)}},{key:"recycleAsyncId",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(null!==n&&this.delay===n&&!1===this.pending)return t;Me.hasOwnProperty(t)&&(delete Me[t],uj.postMessage({name:"clearInterval",fakeId:t}))}}]),t}(pt),SF=new rt(RF),TF=["backups","servers"],UF=["backups","servers"],VF=["group"],jm=v.inflate,bu=v.deflate,cu=function(e){function t(e,i,o,a){X(this,t);var s=r.call(this,a,"Session");return m(n(s),"chatManager",void 0),m(n(s),"usedChannelIds",[]),m(n(s),"msgDedupLru",new Ac(void 0,{maxlen:200})),m(n(s),"startTime",Date.now()),m(n(s),"seq",U.fromNumber(1,!0)),m(n(s),"userJoinOptions",new nt(!1)),m(n(s),"seqSentStatuses",[!1,!1]),m(n(s),"dialogueSequenceLru",new Ac(void 0,{maxlen:1e4})),m(n(s),"loggedOut",!1),m(n(s),"messageSentTimes",[]),m(n(s),"curLoginSockets",[void 0,void 0]),m(n(s),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(s),"lastLoginSockets",[new Ee(1),new Ee(1)]),m(n(s),"dialPendingMsgSubjectMap",new Map),m(n(s),"context",void 0),m(n(s),"connection",void 0),m(n(s),"instanceId",void 0),m(n(s),"lastPingTime",void 0),m(n(s),"registerSocketsFailureListener",(function(){s.connection.once("socketsFailure",(function(){s.log("socketsFailure, creating a new connection"),hd((function(){return s.connection.removeAllListeners(),s.connection=new ct(s.context,s.logger,!0),s.loginHandler(15e3,!0)})).pipe(Ce((function(e){return e.pipe(jd(ie.getParameter("RECONNECTING_AP_INTERVAL")))})),rb(s.connection.apClient.apFinish$)).subscribe((function(){s.log("new connection connected")}))})),0===s.connection.listenerCount("tokenExpired")&&s.connection.on("tokenExpired",(function(){s.emit("tokenExpired")}))})),s.context=e,s.connection=i,s.instanceId=o,s.chatManager=new dF(a),s.lastPingTime=[0,0],s.setMaxListeners(512),s.log("The instanceId is %s",s.instanceId.toString()),s}ja(t,e);var r=ka(t);return Ia(t,[{key:"fetchFileUploadIndexGet",value:function(e){var n=e.hash,r=e.size;if(0===(e=this.getLoginSockets()).length)throw new L("Client is not logged in");var i=this.incGetSeq();return e.forEach((function(e){e.sendPacket("FileUploadIndexGet",{seq:i,hash:n,size:r})})),{ret:Da.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexRet").pipe(aa((function(e){return i.eq(e.seq)})))})))),fin:Da.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexFin").pipe(aa((function(e){return i.eq(e.seq)})))})))),err:cc.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexErr").pipe(aa((function(e){return i.eq(e.seq)})),ea((function(e){throw new da(["The media message upload failure, code %d",e.code],Dg)})))})))),timeout:t.genTimeoutError(ji)}}},{key:"requestFileUploadIndexSet",value:function(e){var n=e.hash,r=e.unit,i=e.servers;if(0===(e=this.getLoginSockets()).length)throw new L("Client is not logged in");var o=this.incGetSeq();return e.forEach((function(e){e.sendPacket("FileUploadIndexSet",{seq:o,servers:i,hash:n,unit:r})})),Da.apply(void 0,[t.genTimeoutError(ji)].concat(G(e.map((function(e){return e.fromReceived("FileUploadIndexErr").pipe(aa((function(e){return o.eq(e.seq)})),ea((function(e){throw new da(["FileUploadIndexSet failure, code %d",e.code],Dg)})))}))),G(e.map((function(e){return e.fromReceived("FileUploadIndexFin").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestFileDownloadIndexGet",value:function(e){var n=e.size,r=e.zone,i=e.unit,o=e.hash,a=this.getLoginSockets();if(0===a.length)throw new L("Client is not logged in");var s=this.incGetSeq();return a.forEach((function(e){e.sendPacket("FileDownloadIndexGet",{seq:s,size:n,zone:r,unit:i,hash:o})})),e=Da.apply(void 0,G(a.map((function(e){return e.fromReceived("FileDownloadIndexRet").pipe(aa((function(e){return s.eq(e.seq)})))})))).pipe(ea((function(e){var t=e.backups,n=e.servers;return e=yf(e,TF),wa({backupList:t.map((function(e){return[e]})),serverList:n.map((function(e){return[e]}))},e)})),jd(500)),a=mn(a.map((function(e){return e.fromReceived("FileDownloadIndexRet").pipe(aa((function(e){return s.eq(e.seq)})))}))),Da(e,a.pipe(ea((function(e){return e.reduce((function(e,t){var n=e.backupList,r=e.serverList;e=t.backups;var i=t.servers;return t=yf(t,UF),wa({backupList:e.map((function(e,t){return[e].concat(G(void 0!==n&&Array.isArray(n[t])?n[t]:[]))})),serverList:i.map((function(e,t){return[e].concat(G(void 0!==n&&Array.isArray(r[t])?r[t]:[]))}))},t)}),{})}))),t.genTimeoutError(ji))}},{key:"loginHandler",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:12e3,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this.loggedOut&&n)throw new L("Already logged out, request ignored");n&&this.registerSocketsFailureListener(),this.connection.initConnection();var r=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),i=Date.now();return r.forEach((function(t,r){var o=e.loginSocketSubs[r].login;void 0!==o&&o.unsubscribe(),e.loginSocketSubs[r].login=t.pipe(ba((function(t){var o;e.curLoginSockets[r]=t;var a=Date.now();hb("Link",{ackedServerIp:t.address,destServerIp:t.ip,ec:0,sc:0,elapse:ib(e.startTime),lts:U.fromNumber(a),responseTime:a-i,sid:ab(e.instanceId),userId:e.context.uid},null!==(o=e.context.config.enableCloudProxy)&&void 0!==o&&o),e.emit("userJoined",t.env),n&&e.connection.apClient.apFinish$.next(void 0)}))).subscribe(e.lastLoginSockets[r])})),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),cc.apply(void 0,G(r).concat([jb(this.connection,"connectionInitFailure").pipe(ba((function(e){if(ta(e)||Xa(e))throw e;throw new da("Login failure",{code:cs,originalError:e})})))])).pipe(Pa(1),kb(t),Ja((function(t){return t instanceof sb&&e.warn("Client login timeout"),t&&t.code===ii&&(e.connection.emit("tokenExpired"),e.connection.apClient.apFinish$.next(void 0)),e.clearSockets(0,n),Z(t)})),ba((function(){n||e.registerSocketsFailureListener()})),Tg((function(){n||e.connection.apClient.apFinish$.next(void 0)})))}},{key:"logoutHandler",value:function(){var e=J(x.mark((function e(){var t,n,r,i=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),t=this.getLoginSockets(),n=t.map((function(e){return e.sendPacket("UserQuit",{}),i.connection.waitClosing(e)})),this.clearSockets(5e3),r=t.map((function(e){return e.env})),[0,1].filter((function(e){return!r.includes(e)})).forEach((function(e){i.connection.closeSocket(e,0)})),e.abrupt("return",cc.apply(void 0,G(n)).toPromise());case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var e=J(x.mark((function e(t){var n,r,i,o=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.getLoginSockets().length){e.next=2;break}throw new L("Client is not logged in. Cannot join the channel",Zr);case 2:return n=jb(this,"channelLeft").pipe(zb((function(e){return t===e})),Pa(1)),r=this.incGetSeq(),(i=this.lastLoginSockets.map((function(e){return e.pipe(Lc((function(e,n){0!==n&&o.incSeqIfNeeded(e.env);var i=0===n?r:o.seq;return e.sendPacket("GroupEnter",{account:t,seq:i}),e.fromReceived("GroupReply").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){if(0!==(e=e.code))throw new da(["Channel join failure. The response code is %d",e],Vr)})))})),rb(n),De())}))).forEach((function(e,n){var r=function(){return o.loginSocketSubs[n].channels.delete(t)};o.loginSocketSubs[n].channels.set(t,e.subscribe({error:r,complete:r}))})),e.next=8,cc.apply(void 0,G(i)).pipe(Pa(1),kb(1e4),Ja((function(e){return e instanceof sb&&o.warn("Channel join timeout"),Z(e)}))).toPromise();case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(e){this.getLoginSockets().forEach((function(t){t.sendPacket("GroupLeave",{account:e})}))}},{key:"requestChannelMemberList",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new L("Client is not logged in. Cannot get the channel members",ZB);var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAllUsersList",{group:e,pageNumber:0,pageSize:200,seq:r})})),Da.apply(void 0,[t.genTimeoutError(Tr)].concat(G(n.map((function(t){return t.fromReceived("GroupAllUsersResult").pipe(aa((function(t){var n=t.seq;return t.group===e&&r.eq(n)})))})))))}},{key:"requestPeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new L("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserStatusList",{users:e,seq:r})})),Da.apply(void 0,[t.genTimeoutError(kC)].concat(G(n.map((function(e){return e.fromReceived("UserStatusResult").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSetLocalUserAttributes",value:function(e,n){var r=this,i=this.getLoginSockets();if(0===i.length)throw new L("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t,i){void 0!==n&&i!==n||t.sendPacket("UserAttributeSet",{account:r.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=ua(e,2))[0],value:e[1]}})),seq:o})})),Da.apply(void 0,G(i.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ea((function(e){throw new da(["The user attributes set failure, code %d",e.code],Xb)})))}))).concat([t.genTimeoutError(Yb)],G(i.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestSetChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new L("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeSet",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=ua(e,2))[0],value:e[1]}})),seq:o})})),Da.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ea((function(e){throw new da(["The group attributes set failure, code %d",e.code],Xb)})))}))).concat([t.genTimeoutError(Yb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new L("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeMod",{account:n.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=ua(e,2))[0],value:e[1]}})),seq:i})})),Da.apply(void 0,G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ea((function(e){throw new da(["The user attributes add or update failure, code %d",e.code],Xb)})))}))).concat([t.genTimeoutError(Yb)],G(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new L("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeMod",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=ua(e,2))[0],value:e[1]}})),seq:o})})),Da.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ea((function(e){throw new da(["The group attributes add or update failure, code %d",e.code],Xb)})))}))).concat([t.genTimeoutError(Yb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new L("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeDel",{account:n.context.uid,attributes:e,seq:i})})),Da.apply(void 0,G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ea((function(e){throw new da(["The user attributes delete failure, code %d",e.code],Xb)})))}))).concat([t.genTimeoutError(Yb)],G(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new L("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeDel",{group:e,broadcast:r,attributes:n,seq:o})})),Da.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ea((function(e){throw new da(["The channel attributes delete failure, code %d",e.code],Xb)})))}))).concat([t.genTimeoutError(Yb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestClearLocalUserAttributes",value:function(){var e=this,n=this.getLoginSockets();if(0===n.length)throw new L("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeSet",{account:e.context.uid,seq:r,attributeInfos:[]})})),Da.apply(void 0,G(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ea((function(e){throw new da(["The user attributes clear failure, code %d",e.code],Xb)})))}))).concat([t.genTimeoutError(Yb)],G(n.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestClearChannelAttributes",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new L("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeSet",{group:e,seq:i,attributeInfos:[],broadcast:n})})),Da.apply(void 0,G(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ea((function(e){throw new da(["The channel attributes clear failure, code %d",e.code],Xb)})))}))).concat([t.genTimeoutError(Yb)],G(r.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetUserAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new L("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeGet",{account:e,seq:i,attributes:n})})),Da.apply(void 0,[t.genTimeoutError(Yb)].concat(G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ea((function(e){if(10008===(e=e.code))throw new da("The user requested is not online",Pr);throw new bd(["User attribute operation unknown error code: %d",e],Xb)})))}))),G(r.map((function(e){return e.fromReceived("UserAttributeRet").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new L("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeGet",{group:e,seq:i,attributes:n})})),Da.apply(void 0,[t.genTimeoutError(Yb)].concat(G(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ea((function(e){throw new da(["The channel attributes get failure, code %d",e.code],Xb)})))}))),G(r.map((function(e){return e.fromReceived("GroupAttributeRet").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetUserAttributeKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new L("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeKeysGet",{account:e,seq:r})})),Da.apply(void 0,[t.genTimeoutError(Yb)].concat(G(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ea((function(e){if(10008===(e=e.code))throw new da("The user requested is not online",Pr);throw new bd(["User attribute operation unknown error code: %d",e],Xb)})))}))),G(n.map((function(e){return e.fromReceived("UserAttributeKeysRet").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new L("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAttributeKeysGet",{group:e,seq:r})})),Da.apply(void 0,[t.genTimeoutError(Yb)].concat(G(n.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ea((function(e){throw new bd(["Channel attribute operation unknown error code: %d",e.code],Xb)})))}))),G(n.map((function(e){return e.fromReceived("GroupAttributeKeysRet").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelMemberCount",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new L("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupStatusList",{groups:e,seq:r})})),Da.apply(void 0,[t.genTimeoutError(Tr)].concat(G(n.map((function(e){return e.fromReceived("GroupStatusResult").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSubscribePeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new L("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("SubscribeUserStatus",{seq:r,users:e})})),Da.apply(void 0,[t.genTimeoutError(rC)].concat(G(n.map((function(e){return e.fromReceived("SubscribeResponse").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(e){var t=this.getLoginSockets();if(0===t.length)throw new L("Client is not logged in");var n=this.incGetSeq();t.forEach((function(t){t.sendPacket("UnsubscribeUserStatus",{seq:n,users:e})}))}},{key:"sendInvitationMessage",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a,s,c,u,l,d,h,f,p=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.peerId,r=t.callId,i=t.extra,o=t.isAcceptAck,a=t.channelId,s=t.type,c={callId:r},void 0===o){e.next=6;break}if("CallAccept"===s){e.next=5;break}throw Error("invalid invitation type");case 5:c.type=o?"ack":"request";case 6:return c.channel=a,("CallInvite"===s||"CallCancel"===s||"CallReject"===s||"CallAccept"===s&&!1===o)&&void 0!==i&&(c.extra=i),u=Yg(),this.log("The sent invitation body is %o",c),l=function(e){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:u,instance:p.instanceId,dst:n,ms:U.fromNumber(Date.now(),!0),options:new ke({IterationNumber:e,MessageType:s}).toLong(),payload:(new TextEncoder).encode(JSON.stringify(c)),src:p.context.uid}},e.next=14,Ob(this.sendMessageToRetry(l,!0)).pipe(kb(1e4),Ja((function(e){return e instanceof sb&&p.warn("Send invitation timeout"),Z(e)}))).toPromise();case 14:return d=e.sent,h=d.code,f=d.retryTimes,e.abrupt("return",{hasPeerReceived:0===h,hasReSent:0!==f});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var e=J(x.mark((function e(t,n,r,i,o,a){var s,c,u,l,d,h,f,p,g,v,y,b,_,E,S,w,T,A,R,I,O,C,M,N,L,k,P,D,F,j=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.width,u=void 0===c?0:c,l=n.height,d=void 0===l?0:l,h=n.fileName,f=void 0===h?"":h,p=n.description,g=void 0===p?"":p,v=n.thumbnail,y=void 0===v?new Blob:v,b=n.thumbnailHeight,_=void 0===b?0:b,E=n.thumbnailWidth,S=void 0===E?0:E,w=n.size,T=void 0===w?0:w,A=n.mediaId,R=o.enableOfflineMessaging,I=o.enableHistoricalMessaging,Aa(r)){e.next=4;break}throw new H("The send message arguments are not valid",i?Gl:Ag);case 4:if(!(32768<new Blob([f,y,g]).size)){e.next=6;break}throw new H("The size of message overflowed ",i?Ie:fi);case 6:return O=this.chatManager.getChatInfo(r),C=O.dialogue,M=O.sequence,N=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(N,"-").concat(C,"#").concat(M,'"'),i?" peer":" channel",pa(r)),m(s={},"media_description",g),m(s,"media_width",u),m(s,"media_height",d),m(s,"media_thumbnailwidth",S),m(s,"media_thumbnailheight",_),m(s,"media_size",T),m(s,"media_id",A),m(s,"media_filename",f),L=Bc(s,(function(e){return(new TextEncoder).encode(e.toString())})),e.t0=Uint8Array,e.next=14,pj(y);case 14:return e.t1=e.sent,L.media_thumbnail=new e.t0(e.t1),k=i&&"IMAGE"===t?"PeerImageMessage":i&&"FILE"===t?"PeerFileMessage":i||"IMAGE"!==t?"ChannelFileMessage":"ChannelImageMessage",P=function(e){return{MiscMap:L,sequence:M,dialogue:C,instance:N,dst:r,ms:U.fromNumber(Date.now(),!0),options:new ke({IterationNumber:e,CompressionMethod:"Uncompressed",MessageType:k,ToCache:R,ToArchive:I}).toLong(),payload:new Uint8Array,src:j.context.uid}},e.next=20,Ob(this.sendMessageToRetry(P,!0)).pipe(kb(void 0===a?1e4:a),Ja((function(e){return e instanceof sb&&j.warn("Send message timeout"),Z(e)}))).toPromise();case 20:if(D=e.sent,2!==(F=D.code)){e.next=24;break}throw new da("The peer does not support this type of message",jC);case 24:return e.abrupt("return",{hasPeerReceived:0===F});case 25:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a){return e.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var e=J(x.mark((function e(t,n,r,i,o,a){var s,c,u,l,d,h,f,p,m,g,v=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=o.enableOfflineMessaging,c=o.enableHistoricalMessaging,Aa(r)&&t instanceof Uint8Array&&"string"==typeof n){e.next=3;break}throw new H("The send message arguments are not valid",i?Gl:Ag);case 3:if(!(32768<t.byteLength+new Blob([n]).size)){e.next=5;break}throw new lb("The message size is over the 32KB limit",i?Ie:fi);case 5:return u=!ie.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=t.byteLength,l=this.chatManager.getChatInfo(r),d=l.dialogue,h=l.sequence,f=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(f,"-").concat(d,"#").concat(h,'"'),u?" compressed":"",i?"peer":"channel",pa(r)),p=function(e){return{MiscMap:{description:(new TextEncoder).encode(n)},sequence:h,dialogue:d,instance:f,dst:r,ms:U.fromNumber(Date.now(),!0),options:new ke({IterationNumber:e,CompressionMethod:u?"Zlib":"Uncompressed",MessageType:i?"PeerRawMessage":"ChannelRawMessage",ToCache:s,ToArchive:c}).toLong(),payload:u?bu(t):t,src:v.context.uid}},e.next=12,Ob(this.sendMessageToRetry(p,!0)).pipe(kb(void 0===a?1e4:a),Ja((function(e){return e instanceof sb&&v.warn("Send message timeout"),Z(e)}))).toPromise();case 12:return m=e.sent,g=m.code,e.abrupt("return",{hasPeerReceived:0===g});case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a){return e.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var e=J(x.mark((function e(t,n,r,i,o){var a,s,c,u,l,d,h,f,p,m,g,v=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.enableOfflineMessaging,s=i.enableHistoricalMessaging,Aa(n)){e.next=3;break}throw new H("The send message arguments are not valid",r?Gl:Ag);case 3:if(!(32768<new Blob([t]).size)){e.next=5;break}throw new lb("The message size is over the 32KB limit",r?Ie:fi);case 5:return c=!ie.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([t]).size,u=this.chatManager.getChatInfo(n),l=u.dialogue,d=u.sequence,h=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(h,"-").concat(l,"#").concat(d,'"'),c?" compressed":"",r?"peer":"channel",pa(n)),f=(new TextEncoder).encode(t),p=function(e){return{MiscMap:{},sequence:d,dialogue:l,instance:h,dst:n,ms:U.fromNumber(Date.now(),!0),options:new ke({IterationNumber:e,CompressionMethod:c?"Zlib":"Uncompressed",MessageType:r?"PeerTextMessage":"ChannelTextMessage",ToCache:a,ToArchive:s}).toLong(),payload:c?bu(f):f,src:v.context.uid}},e.next=13,Ob(this.sendMessageToRetry(p,!0)).pipe(kb(void 0===o?1e4:o),Ja((function(e){return e instanceof sb&&v.warn("Send message timeout"),Z(e)}))).toPromise();case 13:return m=e.sent,g=m.code,e.abrupt("return",{hasPeerReceived:0===g});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(e,t){Object.entries(this.loginSocketSubs[e]).forEach((function(e){var n=(e=ua(e,2))[1];"channels"===e[0]&&t||(Array.isArray(n)||n instanceof Map?n.forEach((function(e){return e.unsubscribe()})):n&&n.unsubscribe())})),this.loginSocketSubs[e]={channels:t?this.loginSocketSubs[e].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var e=J(x.mark((function e(t,n){var r,i,o,a,s,c,u,l,d,h=this,f=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<f.length&&void 0!==f[2]?f[2]:0,this.log("Attempt to send the message ".concat(n?" with retrying, %o":"without retrying"),{retryTimes:r}),0!==(i=this.getLoginSockets()).length){e.next=5;break}throw Error("no logged-in sockets");case 5:return o=t(r),i.forEach((function(e){e.sendPacket("Message",o)})),a=o.dialogue,s=o.sequence,c=o.instance,u=i.map((function(e){return e.fromReceived("Ack").pipe(zb((function(e){return a.eq(e.dialogue)&&s.eq(e.sequence)&&c.eq(e.instance)})))})),e.prev=9,e.next=12,cc.apply(void 0,G(u)).pipe(kb(6e3),Ja((function(e){return Xa(e)&&h.warn("Message send timeout, retry times %d",r),Z(e)})),Pa(1)).toPromise();case 12:return l=e.sent,d=l.code,this.log("The message has been acked, %o",{code:d}),e.abrupt("return",{code:d,retryTimes:r});case 18:if(e.prev=18,e.t0=e.catch(9),!(e.t0 instanceof sb&&n)){e.next=22;break}return e.abrupt("return",this.sendMessageToRetry(t,!1,r+1));case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[9,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var e=this;this.lastLoginSockets.map((function(t){return t.pipe(Lc((function(t){return Kc(0,2500,pe()?void 0:SF).pipe(ba((function(){e.sendPing(t)})))})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAlive;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAlive=t.subscribe({error:function(){}})}))}},{key:"initKeepAliveReconnector",value:function(){var e=this;this.lastLoginSockets.map((function(e){return e.pipe(Lc((function(e){var t,n=!1,r=e.userJoin$.pipe(ba((function(){n=!0}))),i=e.input$.pipe(ba((function(e){"Ping"!==rj[e.uri].slice(0,-3)&&(n=!1)})));return cc(Kc(6e3,1e4).pipe(Jv(e.receivedPacket),ba((function(r){r=ua(r,2),r=ua(r[1],2)[1],t!==r||n||e.forceReconnect(),t=r}))),r,i)})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAliveReconnector;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAliveReconnector=t.subscribe({error:function(){}})}))}},{key:"initLoginReceiver",value:function(){var e=this;this.lastLoginSockets.map((function(t){return t.pipe(Lc((function(t){return cc(jb(t,"reconnect").pipe(ba(e.onSocketReconnect(t))),t.fromReceived("Message").pipe(ba(e.onMessage(t))),t.fromReceived("GroupEnterNotice").pipe(ba(e.onGroupEnterNotice())),t.fromReceived("GroupLeaveNotice").pipe(ba(e.onGroupLeaveNotice())),t.fromReceived("GroupCountNotice").pipe(ba(e.onGroupCountNotice())),t.fromReceived("GroupAttributeAlt").pipe(ba(e.onGroupAttributeAlt())),t.fromReceived("UserJoinNotice").pipe(ba(e.onUserNotice(S.PeerOnlineState.ONLINE))),t.fromReceived("UserQuitNotice").pipe(ba(e.onUserNotice(S.PeerOnlineState.OFFLINE))),t.fromReceived("UserWaitNotice").pipe(ba(e.onUserNotice(S.PeerOnlineState.UNREACHABLE))),t.fromReceived("Pong").pipe(ba(e.onPong())),t.fromReceived("UserDrop").pipe(ba(e.onUserDrop(t)))).pipe(If(void 0))})))})).forEach((function(t,n){e.loginSocketSubs[n].receivers.push(t.subscribe({error:function(){}}))}))}},{key:"requestSocketLogin",value:function(e,t,n){var r=this;return ln(hd((function(){r.userJoinOptions=new nt(t),e.sendPacket("UserJoin",{account:r.context.uid,instance:r.instanceId,opt:r.userJoinOptions.toLong(),seq:n,ticket:e.ticket})})),e.fromReceived("UserResp").pipe(aa((function(e){return n.eq(e.seq)})),ba((function(t){if(0!==(t=t.code))throw r.clearSockets(),r.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",t],Bg);e.attemptsSinceLastError=0,e.loggedIn=!0,r.log("ENV_%d logged in",e.env)})),If(e),kb(6e3))).pipe(zb((function(e){return void 0!==e})),Ja((function(n){return n instanceof sb&&r.warn("Login response timeout, rejoin: %s",t),r.clearSockets(),n.name="loginRespTimeout",r.emit("banEdgeIP",e.ip),Z(n)})))}},{key:"getSocketLoginObservables",value:function(e,t){var n=this;return e.map((function(e){return e.pipe(Lc((function(e,r){return n.incSeqIfNeeded(e.env),n.requestSocketLogin(e,0!==r,0===r?t:n.seq)})),De())}))}},{key:"incSeqIfNeeded",value:function(e){if(![0,1].includes(e))throw new Ha({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[e]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[e]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var e=this.curLoginSockets,t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i}},{key:"emitMessage",value:function(e,n){var r=e.options,i=e.payload,o=e.src,a=e.dst,s=e.instance,c=e.dialogue,u=e.sequence,l=e.ms,d=e.MiscMap;this.dialogueSequenceLru.set(c.toString(),u),s="".concat(s,"-").concat(c,"#").concat(u),this.msgDedupLru.has(s)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",n,s):(this.msgDedupLru.set(s,void 0),n=new ke(r),this.lastLoginSockets.forEach(function(){var n=J(x.mark((function n(r){var i;return x.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.pipe(Pa(1)).toPromise();case 2:i=n.sent,t.sendMessageAck(e,i);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),r=n.isZlibCompressed(),n.isInvitation()?(a=ra(r?jm($n(i,Uint8Array.of(0,0,0,0))):i),a=JSON.parse(a),this.log("The received invitation body is %o",a),this.emit("invitationMessage",{body:a,type:n.getInvitationType(),peerId:o,serverReceivedTs:l.toNumber()})):n.isTextMessage()?(d=n.isPeerTextMessage(),i=ra(r?jm($n(i,Uint8Array.of(0,0,0,0))):i),this.info("Received a %s %s text message from %s to %s, %s",r?" compressed":"",d?"peer":"channel",pa(o),pa(a),s),d?(o={text:i,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerTextMessage",o)):this.emit("channelTextMessage",{channelId:a,memberId:o,text:i,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:!1}})):n.isRawMessage()?(c=n.isRawPeerMessage(),d=void 0===(d=d.description)?"":ra(d),i=r?jm(i):i,this.info("Received a %s %s raw message from %s to %s, %s",r?" compressed":"",c?"peer":"channel",pa(o),pa(a),s),c?(o={desc:d,raw:i,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerRawMessage",o)):this.emit("channelRawMessage",{desc:d,raw:i,channelId:a,memberId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:!1}})):(n.isImageMessage()||n.isFileMessage())&&(i=n.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",i?"peer":"channel",pa(o),pa(a),s),i?this.emit("peerMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}}):this.emit("channelMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,memberId:o,channelId:a,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}})))}},{key:"onSocketReconnect",value:function(e){var t=this;return function(){var n=[0,1].filter((function(t){return t!==e.env}))[0];(n=t.connection.curOpenSockets[n])&&!n.loggedIn&&t.emit("connectionLost")}}},{key:"onUserDrop",value:function(e){var t=this;return function(n){var r;n=n.code,hb("KickedOff",{code:0,elapse:ib(t.startTime),linkId:parseInt(e.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:e.address,serverCode:n,sid:ab(t.instanceId),userId:t.context.uid},null!==(r=t.context.config.enableCloudProxy)&&void 0!==r&&r),10006===n||10001===n?t.warn("Login too often and kicked off, reconnect and login"):10009===n?(t.warn("The instance ID conflicts, reconnecting"),t.instanceId=Yg(),t.context.sid=ab(t.instanceId),t.emit("instanceChanged",t.instanceId)):[11,14,15,16].includes(n)&&(t.emit("userDrop",n),t.clearSockets())}}},{key:"clearSockets",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];[0,1].forEach((function(r){e.cleanLoginSubs(r,n),e.connection.closeSocket(r,t)}))}},{key:"onMessage",value:function(e){var t=this;return function(n){var r=n.dialogue,i=n.instance,o=n.sequence,a=n.options;if(n.src===t.context.uid)t.log("The message is from the local account, ignored");else{var s=r.toString(),c=t.dialPendingMsgSubjectMap.get(s);if(r="".concat(i,"-").concat(r,"#").concat(o),c)c.next(n),t.log("Env_%d: The dialogue has pending messages, next: %s",e.env,r);else{var u=t.dialogueSequenceLru.get(s);if(c=!u&&o.eq(1),i=void 0!==u&&o.sub(u).eq(1),c||i)t.emitMessage(n,e.env);else{if(u){if(o.lte(u))return;t.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",e.env,r)}else t.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",e.env,r);o=new Ua,t.dialPendingMsgSubjectMap.set(s,o);var l=o.pipe(Ku(vl),Ug((function(e,t){return[].concat(G(e),[t])}),[]),ea((function(e){return G(e).sort((function(e,t){return e=e.sequence,t=t.sequence,e.eq(t)?0:e.gt(t)?1:-1}))})),vn(1));a=!(a=new ke(a)).isFromCache()&&!a.isBufferedMessage(),l.pipe(rb(Kc(a?750:1500)),aa((function(e){if(2>e.length)return!1;for(var t=void 0===u?U.fromNumber(1,!0):u.add(1),n=0;n<e.length;t=t.add(1),n++)if(!e[n].sequence.eq(t))return!1;return!0})),Tg((function(){t.dialPendingMsgSubjectMap.delete(s)}))).subscribe((function(n){n.forEach((function(n){t.emitMessage(n,e.env),t.log("Env_%d: The message queue has fully ordered, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence))}))}),(function(n){n instanceof Sg&&l.pipe(Pa(1)).subscribe((function(n){return n.forEach((function(n){t.log("Env_%d: The message pending queue expired, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence)),t.emitMessage(n,e.env)}))}))})),o.next(n)}}}}}},{key:"onPong",value:function(){var e=this;return function(){document.hidden&&e.getLoginSockets().forEach((function(t){e.sendPing(t)}))}}},{key:"onGroupEnterNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberJoined",size:t.size})}}},{key:"onGroupLeaveNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberLeft",size:t.size})}}},{key:"onGroupCountNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,type:"MemberCountUpdated",size:t.size})}}},{key:"onGroupAttributeAlt",value:function(){var e=this;return function(t){var n=t.group;t=yf(t,VF),e.emit("channelAttributesUpdated",wa({channelId:n},t))}}},{key:"onUserNotice",value:function(e){var t=this;return function(n){t.emit("peerOnlineStatusChanged",{peerId:n.user,instance:n.instance,seq:n.seq,state:e})}}},{key:"sendPing",value:function(e){2500>=Date.now()-this.lastPingTime[e.env]||(this.incSeqIfNeeded(e.env),e.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:this.seq}),this.lastPingTime[e.env]=Date.now())}}],[{key:"sendMessageAck",value:function(e,t){var n=new ke(e.options);(n.isInvitation()||n.isPeerMessage())&&t.sendPacket("Ack",{code:0,dialogue:e.dialogue,instance:e.instance,sequence:e.sequence})}}]),t}(wb());m(cu,"genTimeoutError",(function(e,t){return eb(void 0).pipe(jd(void 0===t?1e4:t),ea((function(){throw new gb(["Request timed out after %ds",void 0===t?1e4:t],e)})))}));var du,km,lm=0,mm=0;de.v1=function(e,t,n){n=t&&n||0;var r=t||[],i=(e=e||{}).node||du,o=void 0!==e.clockseq?e.clockseq:km;if(null==i||null==o){var a=Nr();null==i&&(i=du=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==o&&(o=km=16383&(a[6]<<8|a[7]))}a=void 0!==e.msecs?e.msecs:(new Date).getTime();var s=void 0!==e.nsecs?e.nsecs:mm+1,c=a-lm+(s-mm)/1e4;if(0>c&&void 0===e.clockseq&&(o=o+1&16383),(0>c||a>lm)&&void 0===e.nsecs&&(s=0),1e4<=s)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(lm=a,mm=s,km=o,e=(1e4*(268435455&(a+=122192928e5))+s)%4294967296,r[n++]=e>>>24&255,r[n++]=e>>>16&255,r[n++]=e>>>8&255,r[n++]=255&e,e=a/4294967296*1e4&268435455,r[n++]=e>>>8&255,r[n++]=255&e,r[n++]=e>>>24&15|16,r[n++]=e>>>16&255,r[n++]=o>>>8|128,r[n++]=255&o,o=0;6>o;++o)r[n+o]=i[o];return t||Or(r)},de.v4=de;var nm=ni(),Ed,uf=S.LocalInvitationFailureReason,Ca=S.LocalInvitationState,WF=(Ed=function(e){function t(e,i,o){X(this,t);var a=r.call(this,o,"RtmLocalInvitation",!0);return m(n(a),"state",Ca.IDLE),m(n(a),"localInvitationEnd$",Da(jb(n(a),"LocalInvitationAccepted"),jb(n(a),"LocalInvitationRefused"),jb(n(a),"LocalInvitationFailure"),jb(n(a),"LocalInvitationCanceled")).pipe(Pa(1))),m(n(a),"callId",de.v4()),m(n(a),"_content",""),m(n(a),"_channelId",""),m(n(a),"_response",""),m(n(a),"calleeId",void 0),m(n(a),"logger",void 0),m(n(a),"getSession",void 0),a.calleeId=e,a.getSession=i,a.logger=o,a}ja(t,e);var r=ka(t);return Ia(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){this.state!==Ca.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=e)}},{key:"content",get:function(){return this._content},set:function(e){this.log("set content for %s",this.callId),this._content=e}},{key:"response",get:function(){return this._response},set:function(e){throw new H('Cannot set the "response" of the LocalInvitation instance.',Ec)}},{key:"send",value:function(){var e,t=this;if(this.state===Ca.SENT_TO_REMOTE||this.state===Ca.RECEIVED_BY_REMOTE)throw new L("The local invitation send failure. The call invitation has already been sent.",cC);if(this.isLocalInvitationEnd())throw new L("The local invitation send failure. The call invitation has ended.",gi);if(0<this._channelId.length&&!Aa(this._channelId))throw new H("Illegal invitation channel ID",Ec);if(!Aa(this.calleeId))throw new H("Illegal invitation callee user ID",Ec);if(8192<fh(this._content))throw new H('The length of the "content" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',Ec);this.state=Ca.SENT_TO_REMOTE,hd(J(x.mark((function n(){var r,i,o;return x.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getSession().sendInvitationMessage({peerId:t.calleeId,callId:t.callId,extra:t._content,type:"CallInvite",channelId:t._channelId});case 2:if(r=n.sent,i=r.hasPeerReceived,o=r.hasReSent,!t.isLocalInvitationEnd()){n.next=7;break}throw new gb("send invitation timeout");case 7:if(t.log("The local invitation has sent to the callee"),i||o){n.next=11;break}throw e=new nm({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(i){n.next=14;break}throw e=new nm({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return n.stop()}}),n)})))).pipe(Ce((function(e){return e.pipe(ba((function(e){if(!(e instanceof nm))throw e})),jd(2e3))})),kb(3e4),Ja((function(e){return Xa(e)&&t.warn("local invitation ack timed out"),Z(e)})),rb(this.localInvitationEnd$)).subscribe({next:function(){t.state===Ca.RECEIVED_BY_REMOTE?t.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):t.state!==Ca.SENT_TO_REMOTE?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(t.info("The peer received the local invitation %s.",t.callId),t.state=Ca.RECEIVED_BY_REMOTE,t.emit("LocalInvitationReceivedByPeer"),t.localInvitationEnd$.pipe(kb(6e4),Ja((function(e){return Xa(e)&&t.warn("local invitation expired"),Z(e)}))).subscribe({error:function(){t.state=Ca.FAILURE,t.emit("LocalInvitationFailure",uf.INVITATION_EXPIRE)}}))},error:function(n){t.isLocalInvitationEnd()?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(t.state=Ca.FAILURE,Xa(n)&&e?"PEER_NOT_ONLINE"===e.code?t.emit("LocalInvitationFailure",uf.PEER_OFFLINE):"RESENT_AND_OFFLINE"===e.code&&t.emit("LocalInvitationFailure",uf.PEER_NO_RESPONSE):Xa(n)?t.emit("LocalInvitationFailure",uf.PEER_NO_RESPONSE):"RtmInvalidStatusError"===n.name?t.emit("LocalInvitationFailure",uf.NOT_LOGGEDIN):t.emit("LocalInvitationFailure",uf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new L("The local invitation cancel failure",gi);if(this.state===Ca.IDLE)throw new L("The local invitation has not been sent",bC);if(8192<fh(this._content))throw new H('The length of the "content" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',Ec);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ca.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(e){if(this.isLocalInvitationEnd()&&this.state!==Ca.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ca.IDLE)throw new L("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ca.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ca.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ca.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ca.ACCEPTED_BY_REMOTE,this._response=e,this.emit("LocalInvitationAccepted",e))}}},{key:"onRefuseReceived",value:function(e){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ca.IDLE)throw new L("the local have not sent the invitation, how can remote refuse it?");this.state===Ca.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ca.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=e,this.state=Ca.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",e)}}},{key:"isLocalInvitationEnd",value:function(){return[Ca.CANCELED,Ca.FAILURE,Ca.ACCEPTED_BY_REMOTE,Ca.REFUSED_BY_REMOTE].includes(this.state)}}]),t}(wb()),la(Ed.prototype,"send",[Qb],Object.getOwnPropertyDescriptor(Ed.prototype,"send"),Ed.prototype),la(Ed.prototype,"cancel",[Qb],Object.getOwnPropertyDescriptor(Ed.prototype,"cancel"),Ed.prototype),Ed),vi=S.RemoteInvitationFailureReason,nb=S.RemoteInvitationState,XF=function(e){function t(e){var i=e.invitationChannel,o=e.extraContent,a=e.callId,s=e.callerId,c=e.logger;e=e.getSession,X(this,t);var u=r.call(this,c,"RtmRemoteInvitation",!0);return m(n(u),"state",nb.INVITATION_RECEIVED),m(n(u),"remoteInvitationEnd$",Da(jb(n(u),"RemoteInvitationCanceled"),jb(n(u),"RemoteInvitationRefused"),jb(n(u),"RemoteInvitationAccepted"),jb(n(u),"RemoteInvitationFailure")).pipe(Pa(1))),m(n(u),"callerId",void 0),m(n(u),"callId",void 0),m(n(u),"_getSession",void 0),m(n(u),"logger",void 0),m(n(u),"_content",void 0),m(n(u),"_channelId",void 0),m(n(u),"_response",""),u._channelId=i,u._content=o,u.callId=a,u.callerId=s,u._getSession=e,u.logger=c,u.remoteInvitationEnd$.pipe(kb(6e4),Ja((function(e){return Xa(e)&&u.warn("Remote invitation expired"),Z(e)}))).subscribe({error:function(){u.state=nb.FAILURE,u.emit("RemoteInvitationFailure",vi.INVITATION_EXPIRE)}}),u}ja(t,e);var r=ka(t);return Ia(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){throw new H('Cannot set the "response" of the RemoteInvitation instance.',Ec)}},{key:"content",get:function(){return this._content},set:function(e){throw new H('Cannot set the "content" of the RemoteInvitation instance.',Ec)}},{key:"response",get:function(){return this._response},set:function(e){this._response=e}},{key:"accept",value:function(){var e,t=this;if(this.isRemoteInvitationEnd())throw new L("The local invitation has ended. Cannot accept.",gi);if(this.state===nb.ACCEPT_SENT_TO_LOCAL)throw new L("The remote invitation is accepting. Cannot do the operation.",Ur);if(8192<fh(this._response))throw new H('The length of the "response" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',Ec);this.state=nb.ACCEPT_SENT_TO_LOCAL,cc(pn(1e3).pipe(fb((function(){return hd(J(x.mark((function e(){return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._getSession().sendInvitationMessage({peerId:t.callerId,callId:t.callId,extra:t.response,type:"CallAccept",isAcceptAck:!1,channelId:t.channelId}));case 1:case"end":return e.stop()}}),e)}))))})),zb((function(t){return e=t.hasPeerReceived})),Pa(1)),jb(this,"RemoteInvitationAccepted")).pipe(kb(5e3),rb(this.remoteInvitationEnd$)).subscribe({error:function(n){if(t.logError(n),t.state=nb.FAILURE,Xa(n))switch(e){case void 0:case!0:return void t.emit("RemoteInvitationFailure",vi.ACCEPT_FAILURE);case!1:return void t.emit("RemoteInvitationFailure",vi.PEER_OFFLINE)}t.emit("RemoteInvitationFailure",vi.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===nb.ACCEPT_SENT_TO_LOCAL)throw new L("The remote invitation is accepting. Cannot do the operation.",Ur);if(this.isRemoteInvitationEnd())throw new L("The invitation is end. Cannot refuse",gi);if(8192<fh(this._response))throw new H('The length of the "response" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',Ec);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=nb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(e){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===nb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=e,this.state=nb.CANCELED,this.emit("RemoteInvitationCanceled",e))}},{key:"onAcceptAckReceived",value:function(){this.state!==nb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=nb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[nb.ACCEPTED,nb.REFUSED,nb.CANCELED,nb.FAILURE].includes(this.state)}}]),t}(wb()),YF=function(e){function t(e,i){X(this,t);var o=r.call(this,i,"InvitationManager");return m(n(o),"getSession",void 0),m(n(o),"invitationDispatcher",new ia.EventEmitter),m(n(o),"outgoingLocalInvitations",new Map),m(n(o),"receivedRemoteInvitations",new Ac(void 0,{maxlen:1e4})),m(n(o),"logger",void 0),o.getSession=ho(e),o.logger=i,o.invitationDispatcher.on("remoteInvitationToManager",(function(e){var t=e.callId,n=e.extra,r=e.callerId;e=e.channelId,o.receivedRemoteInvitations.has(t)||((n=new XF({callerId:r,callId:t,getSession:o.getSession,logger:i,extraContent:n,invitationChannel:e})).remoteInvitationEnd$.subscribe((function(){o.receivedRemoteInvitations.delete(t)})),o.receivedRemoteInvitations.set(t,n),o.emit("remoteInvitationInstance",n))})),o.invitationDispatcher.on("acceptAckToRemoteInvitation",(function(e){(e=o.receivedRemoteInvitations.get(e.callId))&&e.onAcceptAckReceived()})),o.invitationDispatcher.on("cancelToRemoteInvitation",(function(e){var t=e.extra;(e=o.receivedRemoteInvitations.get(e.callId))&&e.onCancelReceived(t)})),o.invitationDispatcher.on("acceptToLocalInvitation",(function(e){var t=e.extra;(e=o.outgoingLocalInvitations.get(e.callId))&&e.onAcceptReceived(t)})),o.invitationDispatcher.on("refuseToLocalInvitation",(function(e){var t=e.extra;(e=o.outgoingLocalInvitations.get(e.callId))&&e.onRefuseReceived(t)})),o}ja(t,e);var r=ka(t);return Ia(t,[{key:"invitationMessageHandler",value:function(e){var t=e.body,n=t.callId,r=t.extra;r=void 0===r?"":r;var i=t.type,o=void 0===(t=t.channel)?"":t,a=e.type;switch(t=e.peerId,e=e.serverReceivedTs,a){case"CallAccept":"ack"===i?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:n}):"request"===i&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:n,extra:r});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:n,callerId:t,extra:r,channelId:o});break;case"CallCancel":if("0"===n){n="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(o,"_").concat(r),this.getSession().emit("peerTextMessage",{peerId:t,properties:{serverReceivedTs:e,isOfflineMessage:!1},text:n});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:n,extra:r});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:n,extra:r});break;default:throw Nn("invitationType",a)}}},{key:"genLocalInvitation",value:function(e){var t=this,n=new WF(e,this.getSession,this.logger);return n.localInvitationEnd$.subscribe((function(){t.outgoingLocalInvitations.delete(n.callId)})),this.outgoingLocalInvitations.set(n.callId,n),n}}]),t}(wb()),ZF=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return ob(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),mE(e,t,{leading:r,maxWait:t,trailing:i})},xb,vf;!function(e){e[e.JOINED=0]="JOINED",e[e.LEFT=1]="LEFT"}(vf||(vf={}));var om=S.ConnectionState,$F=(xb=function(e){function t(e,i,o,a){X(this,t);var s=r.call(this,a,"RtmChannel",!0);return m(n(s),"onMemberCountUpdated",ZF((function(e){e!==s.memberCount&&(s.memberCount=e,s.emit("MemberCountUpdated",e))}),1e3)),m(n(s),"getSession",void 0),m(n(s),"memberCount",0),m(n(s),"joinState","LEFT"),m(n(s),"joinPromise",void 0),m(n(s),"memberJoinedLru",new Ac(void 0,{maxlen:1e4})),m(n(s),"memberLeftLru",new Ac(void 0,{maxlen:1e4})),m(n(s),"memberJoinStateLru",new Ac(void 0,{maxlen:1e4})),m(n(s),"attributesSeqLru",new Ac(void 0,{maxlen:1e4})),m(n(s),"channelId",void 0),m(n(s),"client",void 0),m(n(s),"onChannelMemberCountUpdated",(function(e,t){s.channelId===e&&s.onMemberCountUpdated(t)})),m(n(s),"onLogout",(function(){try{s.clearChannel(s.getSession())}catch(e){}})),m(n(s),"onAttributesUpdated",(function(e){var t=e.channelId,n=e.attributeMaps,r=e.seq;e=e.instance.toString();var i=s.attributesSeqLru.get(e);if((!i||r.greaterThan(i))&&(s.attributesSeqLru.set(e,r),t===s.channelId)){for(t={},r=0;r<n.length;r++){var o=n[r];e=o.key,i=o.ms;var a=o.value;if(o=o.origin,"string"!=typeof e||!U.isLong(i)||"string"!=typeof a||!Aa(o))break;t[e]={value:a,lastUpdateUserId:o,lastUpdateTs:i.toNumber()}}s.emit("AttributesUpdated",t)}})),m(n(s),"onChannelTextMessage",(function(e){var t=e.memberId,n=e.text,r=e.properties;e.channelId===s.channelId&&s.emit("ChannelMessage",{text:n,messageType:S.MessageType.TEXT},t,r)})),m(n(s),"onChannelMediaMessage",(function(e){var t=e.memberId,n=e.properties,r=e.details,i=e.messageType;e.channelId===s.channelId&&("FILE"===i?s.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(ra(r.media_size),10),description:ra(r.media_description),fileName:ra(r.media_filename),mediaId:ra(r.media_id),thumbnail:new Blob([r.media_thumbnail])},t,n):"IMAGE"===i&&s.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(ra(r.media_size),10),description:ra(r.media_description),fileName:ra(r.media_filename),mediaId:ra(r.media_id),thumbnail:new Blob([r.media_thumbnail]),height:parseInt(ra(r.media_height),10),width:parseInt(ra(r.media_width),10),thumbnailHeight:parseInt(ra(r.media_thumbnailheight),10),thumbnailWidth:parseInt(ra(r.media_thumbnailwidth),10)},t,n))})),m(n(s),"onChannelRawMessage",(function(e){var t=e.desc,n=e.raw,r=e.memberId,i=e.properties;e.channelId===s.channelId&&s.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:n,description:t},r,i)})),m(n(s),"onMemberNotice",(function(e){var t=e.memberId,n=e.type,r=e.size;if(e.channelId===s.channelId){var i=e.instance.toString();e=e.seq.toString();var o={MemberLeft:s.memberLeftLru,MemberJoined:s.memberJoinedLru,MemberCountUpdated:void 0}[n];if(o){if(o.has(i+e))return void s.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",n,e,pa(s.channelId),pa(t||""));if(o.set(i+e,void 0),"string"!=typeof t)return;if(t!==s.getSession().context.uid){if((i=s.memberJoinStateLru.get(t))===vf.JOINED&&"MemberJoined"===n)return void s.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,pa(s.channelId),pa(t||""));if(i===vf.LEFT&&"MemberLeft"===n)return void s.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,pa(s.channelId),pa(t||""))}s.memberJoinStateLru.set(t,"MemberJoined"===n?vf.JOINED:vf.LEFT)}s.info("Channel %s - %s, memberId: %s",n,pa(s.channelId),"MemberCountUpdated"===n?"[unknown]":pa(t||"")),i=t===s.getSession().context.uid,"MemberLeft"===n&&Aa(t)||"MemberJoined"===n&&Aa(t)?(i||s.emit(n,t),s.onMemberCountUpdated(r)):"MemberCountUpdated"===n&&"number"==typeof r&&s.onMemberCountUpdated(r)}})),s.getSession=ho(i),s.channelId=e,s.client=o,s.info("A channel created, id %s",pa(e)),s}ja(t,e);var r=ka(t);return Ia(t,[{key:"join",value:function(){var e=J(x.mark((function e(){var t,n,r,i,o,a,s,c=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=this.getSession(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new L("The client is not logged in. Cannot do the operation",Zr);case 7:if(e.prev=7,Aa(this.channelId)){e.next=10;break}throw new H(["The %s in the arguments is invalid","channelId"],dC);case 10:if("LEFT"===this.joinState){e.next=13;break}throw hb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:ib(t.startTime),errCode:Yr,sid:ab(t.instanceId)},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),new L("The channel has joined. Cannot rejoin",Yr);case 13:if(!t.usedChannelIds.includes(this.channelId)){e.next=16;break}throw hb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:ib(t.startTime),errCode:$r,sid:ab(t.instanceId)},null!==(o=this.client.context.config.enableCloudProxy)&&void 0!==o&&o),new L("A channel of the same channel ID has already joined. Cannot rejoin",$r);case 16:if(!(20<=t.usedChannelIds.length)){e.next=19;break}throw hb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:ib(t.startTime),errCode:Xr,sid:ab(t.instanceId)},null!==(a=this.client.context.config.enableCloudProxy)&&void 0!==a&&a),new lb("The joined channels has exceeded the limit of 20",Xr);case 19:return hb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:ib(t.startTime),errCode:0,sid:ab(t.instanceId)},null!==(n=this.client.context.config.enableCloudProxy)&&void 0!==n&&n),this.log("Joining the channel %s",pa(this.channelId)),this.joinState="JOINING",t.usedChannelIds.push(this.channelId),this.joinPromise=t.requestChannelJoin(this.channelId).then((function(){c.joinState="JOINED"})),e.next=26,this.joinPromise;case 26:hb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:ib(t.startTime),errCode:0,sid:ab(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),this.info("The channel %s joined successfully",pa(this.channelId)),t.on("channelTextMessage",this.onChannelTextMessage),t.on("channelRawMessage",this.onChannelRawMessage),t.on("channelMediaMessage",this.onChannelMediaMessage),t.on("memberNotice",this.onMemberNotice),t.on("channelAttributesUpdated",this.onAttributesUpdated),this.client.internalEmitter.on("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.once("LOGOUT",this.onLogout),e.next=47;break;case 37:if(e.prev=37,e.t1=e.catch(7),"JOINING"===this.joinState&&(this.joinState="LEFT"),this.logError(e.t1),!ta(e.t1)){e.next=43;break}throw e.t1;case 43:if(!Xa(e.t1)){e.next=46;break}throw hb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:ib(t.startTime),errCode:Wr,sid:ab(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(s=this.client.context.config.enableCloudProxy)&&void 0!==s&&s),new gb(["Join channel %s timed out",pa(this.channelId)],Wr);case 46:throw new bd(["The channel %s join failure",pa(this.channelId)],{code:Vr,originalError:e.t1});case 47:case"end":return e.stop()}}),e,this,[[0,4],[7,37]])})));return function(){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=J(x.mark((function e(){var t,n,r,i;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=this.getSession(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new L("The client is not logged in. Cannot do the operation",fC);case 7:if("LEFT"!==this.joinState){e.next=9;break}throw new L("The channel does not join. Cannot do the operation",eC);case 9:return e.prev=9,n.requestChannelLeave(this.channelId),e.next=13,this.clearChannel(n);case 13:e.next=24;break;case 15:if(e.prev=15,e.t1=e.catch(9),this.logError(e.t1),!ta(e.t1)){e.next=22;break}throw void 0===e.t1.code&&(e.t1.code=bs),hb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:ib(n.startTime),errCode:bs,sid:ab(n.instanceId),userId:n.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),e.t1;case 22:throw hb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:ib(n.startTime),errCode:as,sid:ab(n.instanceId),userId:n.context.uid},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),new bd("The channel leave failure",{code:as,originalError:e.t1});case 24:hb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:ib(n.startTime),errCode:0,sid:ab(n.instanceId),userId:n.context.uid},null!==(t=this.client.context.config.enableCloudProxy)&&void 0!==t&&t);case 25:case"end":return e.stop()}}),e,this,[[0,4],[9,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a=this,s=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=1<s.length&&void 0!==s[1]?s[1]:{},r=n.enableHistoricalMessaging,i=void 0!==r&&r,Wn(t,fi),"JOINED"===this.joinState){e.next=4;break}throw new L("The channel does not join. Cannot do the operation",UB);case 4:if(this.client.connectionState!==om.RECONNECTING){e.next=9;break}return o=Date.now(),e.next=8,new Promise((function(e,n){var r=function(){var r=J(x.mark((function r(){var c;return x.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c=Date.now()-o,r.prev=1,r.next=4,dh({message:t,peerId:a.channelId,toPeer:!1,session:a.getSession(),errorCodes:{NOT_LOGGED_IN:El,TOO_OFTEN:Qr},diff:c,logger:a.logger,options:{enableHistoricalMessaging:i,enableOfflineMessaging:!1}});case 4:e(),r.next=12;break;case 7:r.prev=7,r.t0=r.catch(1),Xa(r.t0)&&n(new gb(he(a.name,"sendMessageToPeer",1e4),Dl)),ta(r.t0)&&n(r.t0),n(new da("Channel message send failure",{code:Ag,originalError:r.t0}));case 12:return r.prev=12,clearTimeout(s),r.finish(12);case 15:case"end":return r.stop()}}),r,null,[[1,7,12,15]])})));return function(){return r.apply(this,arguments)}}();a.client.internalEmitter.once("RECONNECTED",r);var s=setTimeout((function(){a.client.internalEmitter.off("RECONNECTED",r),n(new gb(he(a.name,"sendMessageToPeer",1e4),Dl))}),9e3)}));case 8:return e.abrupt("return");case 9:if(this.client.connectionState===om.CONNECTED){e.next=11;break}throw new L("The client is not logged in. Cannot do the operation",El);case 11:return e.prev=11,e.next=14,dh({message:t,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:El,TOO_OFTEN:Qr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:i,enableOfflineMessaging:!1}});case 14:e.next=24;break;case 16:if(e.prev=16,e.t0=e.catch(11),!Xa(e.t0)){e.next=20;break}throw new gb(he(this.name,"sendMessage",1e4),Dl);case 20:if(!ta(e.t0)){e.next=23;break}throw this.logError(e.t0),e.t0;case 23:throw new bd("The channel message send failure",Ag);case 24:case"end":return e.stop()}}),e,this,[[11,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMembers",value:function(){var e=J(x.mark((function e(){var t,n;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.client.connectionState===om.CONNECTED){e.next=3;break}throw new L("The client is not logged in. Cannot do the operation",aC);case 3:if("JOINED"===this.joinState){e.next=5;break}throw new L("The channel does not join. Cannot do the operation",$B);case 5:return t=this.getSession().requestChannelMemberList(this.channelId),e.next=8,t.pipe(ea((function(e){return e.memberInfos.map((function(e){return e.account}))}))).toPromise();case 8:return n=e.sent,this.info("Channel %s - get members success, %o",pa(this.channelId),n.map(pa)),e.abrupt("return",n);case 13:if(e.prev=13,e.t0=e.catch(0),!ta(e.t0)){e.next=18;break}throw this.logError(e.t0),e.t0;case 18:throw new bd("The channel members get failure",YB);case 19:case"end":return e.stop()}}),e,this,[[0,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"clearChannel",value:function(){var e=J(x.mark((function e(t){var n=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.emit("channelLeft",this.channelId),"JOINING"!==this.joinState){e.next=4;break}return e.next=4,this.joinPromise;case 4:this.joinState="LEFT",this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,t.removeListener("channelTextMessage",this.onChannelTextMessage),t.removeListener("channelRawMessage",this.onChannelRawMessage),t.removeListener("channelMediaMessage",this.onChannelMediaMessage),t.removeListener("memberNotice",this.onMemberNotice),t.removeListener("channelAttributesUpdated",this.onAttributesUpdated),this.client.internalEmitter.removeListener("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.removeListener("LOGOUT",this.onLogout),t.usedChannelIds=t.usedChannelIds.filter((function(e){return e!==n.channelId}));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}(wb()),la(xb.prototype,"join",[Qb],Object.getOwnPropertyDescriptor(xb.prototype,"join"),xb.prototype),la(xb.prototype,"leave",[Qb],Object.getOwnPropertyDescriptor(xb.prototype,"leave"),xb.prototype),la(xb.prototype,"sendMessage",[Qb],Object.getOwnPropertyDescriptor(xb.prototype,"sendMessage"),xb.prototype),la(xb.prototype,"getMembers",[Ra],Object.getOwnPropertyDescriptor(xb.prototype,"getMembers"),xb.prototype),xb),E,Ib=S.ConnectionChangeReason,T=S.ConnectionState,eu={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},aG={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},bG=(E=function(e){function t(e,i,o,a){X(this,t);var s=r.call(this,i,"RtmClient",!0);return m(n(s),"connectionState",T.DISCONNECTED),m(n(s),"internalEmitter",new ia),m(n(s),"context",void 0),m(n(s),"attributes",{}),m(n(s),"loginPromise",void 0),m(n(s),"attributeDrafts",new Set),m(n(s),"session",void 0),m(n(s),"lastLoginTime",void 0),m(n(s),"reconnId",0),m(n(s),"channelAttributesCacheLru",new Ac(void 0,{maxlen:1e4})),m(n(s),"invitationManager",void 0),m(n(s),"subscribedPeerStatusCache",{}),m(n(s),"pendingPeerStatusSubCount",0),m(n(s),"peerStatusSeqLru",new Ac(void 0,{maxlen:1e4})),m(n(s),"peerUnreachableTimers",{}),m(n(s),"mediaTaskManager",void 0),m(n(s),"setParameters",void 0),m(n(s),"updateConfig",void 0),m(n(s),"blacklistedIP",{}),m(n(s),"userDropHandler",(function(e){if(s.connectionState!==T.ABORTED)switch(e){case 11:s.logError("Kicked off by remote session"),s.onConnectionStateChanged(T.ABORTED,Ib.REMOTE_LOGIN);break;case 14:case 15:case 16:s.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[e])),s.onConnectionStateChanged(T.ABORTED,Ib.BANNED_BY_SERVER);break;default:s.logError("User kicked off for unknown code: ".concat(e)),s.onConnectionStateChanged(T.ABORTED,Ib.INTERRUPTED)}})),s.context=new VE(e,o,i),s.mediaTaskManager=new kt(i),s.context.config=o,s.internalEmitter.setMaxListeners(512),s.setParameters=a.bind(n(s)),s.updateConfig=a.bind(n(s)),s.invitationManager=new YF((function(){return s.session}),i),s.invitationManager.on("remoteInvitationInstance",(function(e){s.emit("RemoteInvitationReceived",e)})),s.setMaxListeners(512),s.internalEmitter.setMaxListeners(512),s}ja(t,e);var r=ka(t);return Ia(t,[{key:"renewToken",value:function(){var e=J(x.mark((function e(t){var n,r,i,o=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&0!==t.length){e.next=2;break}throw new H("Invalid argument",nC);case 2:if(this.connectionState!==T.ABORTED){e.next=5;break}return e.next=5,new Promise((function(){}));case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){e.next=7;break}throw new L("The client is not logged in",qC);case 7:if(void 0!==this.session){e.next=9;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,n=this.context.token,this.context.token=t,e.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Md((function(){return Error("No available edge address to connect")})),Ce((function(e){return e.pipe(ba((function(e){if(ta(e))throw e})),jd(2500),Pa(4))})),Pa(1),kb(2e4),Ja((function(e){return Xa(e)&&o.warn("renewToken timed out"),Z(e)}))).toPromise();case 14:r=e.sent,i=r.ticket,e.next=27;break;case 18:if(e.prev=18,e.t0=e.catch(9),this.context.token=n,e.t0.code!==ds&&e.t0.code!==es){e.next=23;break}throw new of("Invalid token",pC);case 23:if(e.t0.code!==ii){e.next=25;break}throw new of("The token expired",oC);case 25:if(!Xa(e.t0)){e.next=27;break}throw new gb("Renew token timed out",mC);case 27:this.session.curLoginSockets.filter((function(e){return void 0!==e})).forEach((function(e){return e.ticket=i}));case 28:case"end":return e.stop()}}),e,this,[[9,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var e=J(x.mark((function e(t){var n,r,i=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new L("The client is not logged in",lC);case 2:if(void 0!==this.session){e.next=4;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(t)||0===t.length||t.some((function(e){return!Aa(e)}))||256<t.length)){e.next=6;break}throw new H("invalid arguments",is);case 6:return e.next=8,this.session.requestPeersOnlineStatus(t).toPromise();case 8:return n=e.sent,r=Bc(pl(n.userInfos,"account"),(function(e){return!!e.ts})),Object.keys(r).forEach((function(e){if(e in i.subscribedPeerStatusCache&&i.subscribedPeerStatusCache[e]!==S.PeerOnlineState.UNREACHABLE){var t=r[e]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;i.emit("PeersOnlineStatusChanged",m({},e,t)),i.subscribedPeerStatusCache[e]=t}})),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a,s,c,u,l;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new L("The client is not logged in",XB);case 2:if(void 0!==this.session){e.next=4;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&t.every((function(e){return"string"==typeof e}))&&0!==t.length){e.next=6;break}throw new H("Invalid arguments: channelIds",Sr);case 6:if(!(32<t.length)){e.next=8;break}throw new H("getChannelMemberCount exceed limit of 32 channelIds",WB);case 8:n=0;case 9:if(!(n<t.length)){e.next=16;break}if(Aa(r=t[n])){e.next=13;break}throw new H(["getChannelMemberCount channel id %s is invalid",r],Sr);case 13:n++,e.next=9;break;case 16:return e.next=18,this.session.requestGetChannelMemberCount(t).toPromise();case 18:for(i=e.sent,o=i.groupInfos,a={},s=0;s<o.length;s++)c=o[s],u=c.group,l=c.memberCount,Aa(u)&&"number"==typeof l&&(this.internalEmitter.emit("channelMemberCountUpdated",u,l),a[u]=l);return e.abrupt("return",a);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var e=J(x.mark((function e(t){var n,r;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Mf({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){e.next=3;break}throw new L("The client is not logged in",Zb);case 3:if(void 0!==this.session){e.next=5;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return n=this.session.requestSetLocalUserAttributes(t).toPromise(),r={attribute:t,promise:n},this.attributeDrafts.add(r),e.prev=8,e.next=11,n;case 11:this.attributes=t,e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(8),!ta(e.t0)){e.next=18;break}throw e.t0;case 18:throw new H("arguments is not valid",Oa);case 19:return e.prev=19,this.attributeDrafts.delete(r),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[8,14,19,22]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var e=J(x.mark((function e(t,n){var r,i,o,a,s,c=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<c.length&&void 0!==c[2]?c[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,Mf({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){e.next=4;break}throw new L("The client is not logged in",Zb);case 4:if(void 0!==this.session){e.next=6;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return a=this.session.requestSetChannelAttributes(t,n,o).toPromise(),e.prev=7,e.next=10,a;case 10:s=Bc(n,(function(e){return new Blob([e]).size})),this.channelAttributesCacheLru.set(t,s),e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(7),!ta(e.t0)){e.next=18;break}throw e.t0;case 18:throw new H("arguments is not valid",Oa);case 19:case"end":return e.stop()}}),e,this,[[7,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var e=J(x.mark((function e(t){var n,r,i;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=wa(wa({},this.attributes),t),Mf({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),Mf({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){e.next=5;break}throw new L("The client is not logged in",Zb);case 5:if(void 0!==this.session){e.next=7;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return r=this.session.requestAddOrUpdateLocalUserAttributes(t).toPromise(),i={attribute:n,promise:r},this.attributeDrafts.add(i),e.prev=10,e.next=13,r;case 13:this.attributes=n,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!ta(e.t0)){e.next=20;break}throw e.t0;case 20:throw new H("arguments is not valid",is);case 21:return e.prev=21,this.attributeDrafts.delete(i),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[10,16,21,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var e=J(x.mark((function e(t,n){var r,i,o,a,s,c,u,l=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<l.length&&void 0!==l[2]?l[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,a=this.channelAttributesCacheLru.get(t,{}),s=Bc(n,(function(e){return new Blob([e]).size})),c=wa(wa({},a),s),Mf({attributes:n,attrSizeMap:c,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){e.next=7;break}throw new L("The client is not logged in",Zb);case 7:if(void 0!==this.session){e.next=9;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return u=this.session.requestAddOrUpdateChannelAttributes(t,n,o).toPromise(),e.prev=10,e.next=13,u;case 13:this.channelAttributesCacheLru.set(t,c),e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!ta(e.t0)){e.next=20;break}throw e.t0;case 20:throw new H("arguments is not valid",Oa);case 21:case"end":return e.stop()}}),e,this,[[10,16]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var e=J(x.mark((function e(t){var n,r,i,o;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&0!==t.length&&!t.some((function(e){return 0===e.length}))){e.next=2;break}throw new L("arguments is not valid",Oa);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new L("The client is not logged in",Zb);case 4:if(void 0!==this.session){e.next=6;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return n=this.session.requestDeleteLocalUserAttributesByKeys(t).toPromise(),r={attribute:ml(this.attributes,t),promise:n},this.attributeDrafts.add(r),e.prev=9,e.next=12,n;case 12:for(i=0;i<t.length;i++)o=t[i],delete this.attributes[o];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(9),!ta(e.t0)){e.next=19;break}throw e.t0;case 19:throw new H("arguments is not valid",Oa);case 20:return e.prev=20,this.attributeDrafts.delete(r),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[9,15,20,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var e=J(x.mark((function e(t,n){var r,i,o,a,s,c,u,l=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<l.length&&void 0!==l[2]?l[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,Array.isArray(n)&&0!==n.length&&Aa(t)&&!n.some((function(e){return 0===e.length||512<e.length}))){e.next=3;break}throw new L("arguments is not valid",Oa);case 3:if(this.connectionState===T.CONNECTED){e.next=5;break}throw new L("The client is not logged in",Zb);case 5:if(void 0!==this.session){e.next=7;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return a=this.session.requestDeleteChannelAttributesByKeys(t,n,o).toPromise(),e.prev=8,e.next=11,a;case 11:if(s=this.channelAttributesCacheLru.get(t))for(c=0;c<n.length;c++)u=n[c],delete s[u];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(8),!ta(e.t0)){e.next=19;break}throw e.t0;case 19:throw new H("arguments is not valid",Oa);case 20:case"end":return e.stop()}}),e,this,[[8,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var e=J(x.mark((function e(){var t,n;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new L("The client is not logged in",Zb);case 2:if(void 0!==this.session){e.next=4;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return t=this.session.requestClearLocalUserAttributes().toPromise(),n={attribute:{},promise:t},this.attributeDrafts.add(n),e.prev=7,e.next=10,t;case 10:this.attributes={},e.next=18;break;case 13:if(e.prev=13,e.t0=e.catch(7),!ta(e.t0)){e.next=17;break}throw e.t0;case 17:throw new H("arguments is not valid",Oa);case 18:return e.prev=18,this.attributeDrafts.delete(n),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[7,13,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=1<a.length&&void 0!==a[1]?a[1]:{},r=n.enableNotificationToChannelMembers,i=void 0!==r&&r,this.connectionState===T.CONNECTED){e.next=3;break}throw new L("The client is not logged in",Zb);case 3:if(void 0!==this.session){e.next=5;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return o=this.session.requestClearChannelAttributes(t,i).toPromise(),e.prev=6,e.next=9,o;case 9:this.channelAttributesCacheLru.delete(t),e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(6),!ta(e.t0)){e.next=16;break}throw e.t0;case 16:throw new H("arguments is not valid",Oa);case 17:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var e=J(x.mark((function e(t){var n,r,i;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Aa(t)){e.next=2;break}throw new H("Not a valid user ID",Oa);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new L("The client is not logged in",Zb);case 4:if(void 0!==this.session){e.next=6;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetUserAttributeKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetUserAttributesByKeys(t,r.slice(0,512)).toPromise();case 13:i=e.sent,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(6),!ta(e.t0)){e.next=20;break}throw e.t0;case 20:throw new H("arguments is not valid",Oa);case 21:return e.abrupt("return",br(i.attributeInfos.map((function(e){return[e.key,e.value]}))));case 22:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a,s,c,u,l,d,h;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Aa(t)){e.next=2;break}throw new H("Not a valid channel ID",Oa);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new L("The client is not logged in",Zb);case 4:if(void 0!==this.session){e.next=6;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetChannelAttributesKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetChannelAttributesByKeys(t,r).toPromise();case 13:i=e.sent,o=i.attributeMaps,e.next=22;break;case 17:if(e.prev=17,e.t0=e.catch(6),!ta(e.t0)){e.next=21;break}throw e.t0;case 21:throw new H("arguments is not valid",Oa);case 22:a={},s=0;case 24:if(!(s<o.length)){e.next=32;break}if(c=o[s],u=c.key,l=c.ms,d=c.value,h=c.origin,"string"==typeof u&&U.isLong(l)&&"string"==typeof d&&Aa(h)){e.next=28;break}return e.abrupt("break",32);case 28:a[u]={value:d,lastUpdateUserId:h,lastUpdateTs:l.toNumber()};case 29:s++,e.next=24;break;case 32:return this.channelAttributesCacheLru.set(t,Bc(a,(function(e){return new Blob([e.value]).size}))),e.abrupt("return",a);case 34:case"end":return e.stop()}}),e,this,[[6,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var e=J(x.mark((function e(t,n){var r,i,o,a,s,c,u,l,d,h;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new L("The client is not logged in",Zb);case 2:if(void 0!==this.session){e.next=4;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Mn(t,n),e.prev=5,e.next=8,this.session.requestGetChannelAttributesByKeys(t,n).toPromise();case 8:r=e.sent,i=r.attributeMaps,e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(5),!ta(e.t0)){e.next=16;break}throw e.t0;case 16:throw new H("arguments is not valid",Oa);case 17:o={},a=this.channelAttributesCacheLru.get(t,{}),s=0;case 20:if(!(s<i.length)){e.next=29;break}if(c=i[s],u=c.key,l=c.ms,d=c.value,h=c.origin,"string"==typeof u&&U.isLong(l)&&"string"==typeof d&&Aa(h)){e.next=24;break}return e.abrupt("break",29);case 24:a[u]=new Blob([d]).size,o[u]={value:d,lastUpdateUserId:h,lastUpdateTs:l.toNumber()};case 26:s++,e.next=20;break;case 29:return this.channelAttributesCacheLru.set(t,a),e.abrupt("return",o);case 31:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var e=J(x.mark((function e(t,n){var r;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new L("The client is not logged in",Zb);case 2:if(void 0!==this.session){e.next=4;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Mn(t,n),e.prev=5,e.next=8,this.session.requestGetUserAttributesByKeys(t,n).toPromise();case 8:r=e.sent,e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(5),!ta(e.t0)){e.next=15;break}throw e.t0;case 15:throw new H("arguments is not valid",Oa);case 16:return e.abrupt("return",br(r.attributeInfos.map((function(e){return[e.key,e.value]}))));case 17:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(wn(!0),r=Yg(),i=t.token,t.token===this.context.appId&&(i=void 0),hb("Session",{appId:this.context.appId,did:navigator.userAgent,elapse:ib(this.session&&this.session.startTime),index:{index1:t.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.context.config.enableLogUpload)},installId:zg,lts:U.fromNumber(Date.now()),os:7,sid:ab(r),token:i||"",userId:t.uid,ver:"1.4.5",buildno:415,subVersion:15,version:4},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n,!0),Hd(t)&&Aa(t.uid)){e.next=7;break}throw new H("not a valid user id",hi);case 7:if("string"!=typeof i||!i){e.next=11;break}this.context.token=i,e.next=13;break;case 11:if("string"==typeof i||null==i){e.next=13;break}throw new H('The "token" is not a valid string.',hi);case 13:return o=Date.now(),this.context.sid=ab(r),this.loginPromise=this.loginImpl({uid:t.uid,instanceId:r}),this.info("RTM Client logging in as ".concat(pa(t.uid))),e.prev=17,e.next=20,this.loginPromise;case 20:e.next=28;break;case 22:throw e.prev=22,e.t0=e.catch(17),ta(e.t0)&&hb("Link",{ackedServerIp:"",destServerIp:"",ec:e.t0.code||1,sc:e.t0.serverCode,elapse:ib(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-o,sid:ab(r),userId:t.uid},null!==(a=this.context.config.enableCloudProxy)&&void 0!==a&&a),this.context.token=void 0,this.context.socketUseProxy=!1,e.t0;case 28:return e.prev=28,this.loginPromise=void 0,e.finish(28);case 31:this.context.socketUseProxy&&this.emit("FallbackProxyConnected"),wn(!1);case 33:case"end":return e.stop()}}),e,this,[[17,22,28,31]])})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=J(x.mark((function e(){var t;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loginPromise){e.next=3;break}return e.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){e.next=6;break}throw this.logError("Already in logout state"),new L("Logout failure. The client has already been logged out",fs);case 6:if(this.internalEmitter.emit("LOGOUT"),this.connectionState!==T.ABORTED){e.next=11;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Ib.LOGOUT),e.abrupt("return");case 11:if(void 0!==this.session){e.next=14;break}return this.onConnectionStateChanged(T.DISCONNECTED,Ib.LOGOUT),e.abrupt("return");case 14:return hb("Logout",{elapse:ib(this.session.startTime),lts:U.fromNumber(Date.now()),sid:ab(this.session.instanceId),userId:this.context.uid},null!==(t=this.context.config.enableCloudProxy)&&void 0!==t&&t),e.next=17,this.session.logoutHandler();case 17:this.onConnectionStateChanged(T.DISCONNECTED,Ib.LOGOUT),this.log("Log out success");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var e,t=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new L("Logout failure. The client has already been logged out",fs);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):void 0!==this.session&&(hb("Logout",{elapse:ib(this.session.startTime),lts:U.fromNumber(Date.now()),sid:ab(this.session.instanceId),userId:this.context.uid},null!==(e=this.context.config.enableCloudProxy)&&void 0!==e&&e),this.session.logoutHandler().then((function(){t.log("Log out success")}))),this.onConnectionStateChanged(T.DISCONNECTED,Ib.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var e=J(x.mark((function e(t,n){var r,i,o,a,s,c,u=this,l=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<l.length&&void 0!==l[2]?l[2]:{},i=r.enableOfflineMessaging,o=void 0!==i&&i,a=r.enableHistoricalMessaging,s=void 0!==a&&a,Wn(t,Ie),this.connectionState!==T.RECONNECTING){e.next=5;break}return c=Date.now(),e.abrupt("return",new Promise((function(e,r){var i=function(){var i=J(x.mark((function i(){var l;return x.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0!==u.session){i.next=2;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return l=Date.now()-c,i.prev=3,i.t0=e,i.next=7,dh({message:t,peerId:n,toPeer:!0,session:u.session,errorCodes:{NOT_LOGGED_IN:Hl,TOO_OFTEN:hs},diff:l,logger:u.logger,options:{enableHistoricalMessaging:s,enableOfflineMessaging:o}});case 7:i.t1=i.sent,(0,i.t0)(i.t1),i.next=16;break;case 11:i.prev=11,i.t2=i.catch(3),Xa(i.t2)&&r(new gb(he(u.name,"sendMessageToPeer",1e4),Fl)),ta(i.t2)&&r(i.t2),r(new da("Peer-to-peer message send failure",{code:gs,originalError:i.t2}));case 16:return i.prev=16,clearTimeout(a),i.finish(16);case 19:case"end":return i.stop()}}),i,null,[[3,11,16,19]])})));return function(){return i.apply(this,arguments)}}();u.internalEmitter.once("RECONNECTED",i);var a=setTimeout((function(){u.internalEmitter.off("RECONNECTED",i),r(new gb(he(u.name,"sendMessageToPeer",1e4),Fl))}),9e3)})));case 5:if(this.connectionState===T.CONNECTED){e.next=7;break}throw new L("Failed to send the peer-to-peer message. The client is not logged in",Hl);case 7:if(void 0!==this.session){e.next=9;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,e.next=12,dh({message:t,peerId:n,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:Hl,TOO_OFTEN:hs},diff:0,logger:this.logger,options:{enableHistoricalMessaging:s,enableOfflineMessaging:o}});case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(9),!Xa(e.t0)){e.next=19;break}throw new gb(he(this.name,"sendMessageToPeer",1e4),Fl);case 19:if(!ta(e.t0)){e.next=21;break}throw e.t0;case 21:throw new da("Peer-to-peer message send failure",{code:gs,originalError:e.t0});case 22:case"end":return e.stop()}}),e,this,[[9,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createChannel",value:function(e){var t=this;if(!Aa(e))throw new H(["The %s in the arguments is invalid",Object.keys({channelId:e})[0]],VB);return new $F(e,(function(){return t.session}),this,this.logger)}},{key:"createLocalInvitation",value:function(e){if(!Aa(e))throw new H(["The %s in the arguments is invalid",Object.keys({calleeId:e})[0]],Ec);return this.invitationManager.genLocalInvitation(e)}},{key:"subscribePeersOnlineStatus",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a,s,c,u,l,d,h,f,p,m=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new L("The client is not logged in",Il);case 2:if(void 0!==this.session){e.next=4;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new H("Invalid arguments: peerIds",Cg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(Aa(r=t[n])){e.next=11;break}throw new H(["subscribePeersOnlineStatus peer id %s is invalid",r],Cg);case 11:n++,e.next=7;break;case 14:if(!(512<(i=t&&t.length?bl(t):[]).length+Object.keys(this.subscribedPeerStatusCache).length+this.pendingPeerStatusSubCount)){e.next=17;break}throw new lb("Subscribed peers overflows",ks);case 17:return this.pendingPeerStatusSubCount+=i.length,e.next=20,this.session.requestSubscribePeersOnlineStatus(i).toPromise();case 20:o=e.sent,a=o.errors,this.pendingPeerStatusSubCount-=i.length,s=[],c=[],u=0;case 26:if(!(u<a.length)){e.next=34;break}if(l=a[u],d=l.code,"string"==typeof(h=l.account)){e.next=30;break}throw new da("Returned account is invalid",js);case 30:0!==d&&s.push(h);case 31:u++,e.next=26;break;case 34:for(f=0;f<i.length;f++)p=i[f],s.includes(p)||(c.push(p),this.subscribedPeerStatusCache[p]=void 0);if(this.session.requestPeersOnlineStatus(c).pipe(ea((function(e){return Bc(pl(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=Bc(e,(function(e,t){return e=e?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,m.subscribedPeerStatusCache[t]=e})),m.emit("PeersOnlineStatusChanged",e)})),0===s.length){e.next=38;break}throw new da("Subscription failed",js);case 38:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new L("The client is not logged in",Il);case 2:if(void 0!==this.session){e.next=4;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new H("Invalid arguments: peerIds",Cg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(Aa(r=t[n])){e.next=11;break}throw new H(["subscribePeersOnlineStatus peer id %s is invalid",r],Cg);case 11:n++,e.next=7;break;case 14:if(!(512<t.length)){e.next=16;break}throw new lb("Unsubscribed peers overflows",ks);case 16:for(i=t&&t.length?bl(t):[],this.session.requestUnsubscribePeersOnlineStatus(i),o=0;o<i.length;o++)a=i[o],delete this.subscribedPeerStatusCache[a];case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var e=J(x.mark((function e(t){return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new L("The client is not logged in",Il);case 2:if(t!==S.PeerSubscriptionOption.ONLINE_STATUS){e.next=4;break}return e.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new H("Subscription option not supported",Cg);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createMessage",value:function(e){return"IMAGE"===e.messageType?wa({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},e):"FILE"===e.messageType?wa({fileName:"",description:"",thumbnail:new Blob,size:0},e):e}},{key:"downloadMedia",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a,s,c,u,l,d,h,f,p,m,g=this,v=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=1<v.length&&void 0!==v[1]?v[1]:{},"string"==typeof t){e.next=3;break}throw new H("invalid mediaId format",Jl);case 3:if(e.prev=3,r=t.split("z"),i=ua(r,3),o=i[0],a=i[1],s=i[2],c=o.slice(1,65),u=YE(c),l=parseInt(o.slice(65),10),d=parseInt(a,10),h=parseInt(s,10),!(Number.isNaN(l)||Number.isNaN(d)||Number.isNaN(h))){e.next=12;break}throw new H("Invalid mediaId content",Jl);case 12:e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(3),!ta(e.t0)){e.next=18;break}throw e.t0;case 18:throw new H("parse mediaId failure",{code:Jl,originalError:e.t0});case 19:if(this.connectionState===T.CONNECTED){e.next=21;break}throw new L("The client is not logged in, cannot download",yC);case 21:if(void 0!==this.session){e.next=23;break}throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return f=this.mediaTaskManager.addDownloadTask({unit:d,zone:l,hashHexStr:c,size:h},(function(){if(void 0===g.session)throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});return g.session.requestFileDownloadIndexGet({hash:u,zone:l,unit:d,size:h}).toPromise()}),n),e.next=26,this.mediaTaskManager.waitMediaTask(f);case 26:return p=e.sent,m=p.payload,e.abrupt("return",m);case 29:case"end":return e.stop()}}),e,this,[[3,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a,s,c,u,l,d,h,f,p,m,g,v,y,b,_,E,S,w,A,R,I=this,O=arguments;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=1<O.length&&void 0!==O[1]?O[1]:{},r=2<O.length&&void 0!==O[2]?O[2]:{},Hd(n)){e.next=4;break}throw new H("Invalid params",Of);case 4:if(i="thumbnailWidth"in n||"thumbnailHeight"in n||"width"in n||"height"in n,o=n.messageType,a=void 0===o?i?"IMAGE":"FILE":o,s=n.description,c=void 0===s?"":s,u=n.fileName,l=void 0===u?"":u,d=n.thumbnail,"string"==typeof n.messageType&&"string"==typeof c&&"string"==typeof l&&(Tn(d)||void 0===d)&&Tn(t)){e.next=8;break}throw new H("Invalid message params type",Of);case 8:if(!i||"FILE"!==a){e.next=10;break}throw new H("Invalid message params, unexpected field in RtmFileMessage",Of);case 10:if(!(33554432<(h=t.size))){e.next=13;break}throw new lb("The payload size overflow 32 MB",sC);case 13:return e.next=15,pj(t);case 15:return f=e.sent,e.next=18,XE(f);case 18:if(p=e.sent,this.connectionState===T.CONNECTED){e.next=21;break}throw new L("The client is not logged in",uC);case 21:if("IMAGE"!==a){e.next=29;break}return e.next=24,Sv(n,f);case 24:m=e.sent,g=m.height,v=m.width,y=m.thumbnailWidth,b=m.thumbnailHeight;case 29:return _=this.mediaTaskManager.addUploadTask({file:new Uint8Array(f),hash:p},(function(){if(void 0===I.session)throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});return I.session.fetchFileUploadIndexGet({hash:p,size:h})}),(function(e,t){if(void 0===I.session)throw new Ha({SESSION_NOT_FOUND:"Failed to get session of the client"});return I.session.requestFileUploadIndexSet({hash:p,unit:e,servers:t}).toPromise()}),r),e.next=32,this.mediaTaskManager.waitMediaTask(_);case 32:if(E=e.sent,S=E.zone,w=E.retUnit,"IMAGE"!==a){e.next=38;break}return A={height:g,width:v,fileName:l,size:h,description:c,thumbnail:d,messageType:a,thumbnailWidth:y,thumbnailHeight:b,mediaId:"0".concat(et(p)).concat(S,"z").concat(w,"z").concat(h,"z").concat(g,"z").concat(v)},e.abrupt("return",A);case 38:return R={fileName:l,size:h,description:c,mediaId:"0".concat(et(p)).concat(S,"z").concat(w,"z").concat(h),thumbnail:d,messageType:a},e.abrupt("return",R);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var e=J(x.mark((function e(t){var n,r,i,o,a,s,c,u,l=this;return x.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.uid,r=t.instanceId,i=t.forceLoginTime,o=void 0===i?0:i,a=r,!(void 0!==this.lastLoginTime&&500>Date.now()-this.lastLoginTime)){e.next=4;break}throw new nE(["The frequency of login exceeded the limit of %d queries per second",2],iC);case 4:if(this.connectionState===T.DISCONNECTED||0!==o){e.next=6;break}throw new L("The SDK is either logging in or has logged in the Agora RTM system",gC);case 6:e.prev=6,this.context.uid=n,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(6),new H(["The %s in the arguments is invalid",Object.keys({uid:n})[0]],hi);case 13:return 0===o&&this.onConnectionStateChanged(T.CONNECTING,Ib.LOGIN),(s=new ct(this.context,this.logger,!1)).blacklistedIP=this.blacklistedIP,this.session=c=new cu(this.context,s,a,this.logger),u=function(){l.connectionState===T.CONNECTED&&(l.onConnectionStateChanged(T.RECONNECTING,Ib.INTERRUPTED),l.session)&&l.session.once("userJoined",(function(){l.onConnectionStateChanged(T.CONNECTED,Ib.LOGIN_SUCCESS)}))},c.on("connectionLost",u),c.on("tokenExpired",(function(){l.emit("TokenExpired")})),c.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",(function(e){l.emit("MessageFromPeer",{text:e.text,messageType:S.MessageType.TEXT},e.peerId,e.properties)})),this.session.on("peerMediaMessage",(function(e){var t=e.peerId,n=e.properties,r=e.messageType;e=e.details,"FILE"===r?l.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(ra(e.media_size),10),description:ra(e.media_description),fileName:ra(e.media_filename),mediaId:ra(e.media_id),thumbnail:new Blob([e.media_thumbnail])},t,n):"IMAGE"===r&&l.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(ra(e.media_size),10),description:ra(e.media_description),fileName:ra(e.media_filename),mediaId:ra(e.media_id),thumbnail:new Blob([e.media_thumbnail]),height:parseInt(ra(e.media_height),10),width:parseInt(ra(e.media_width),10),thumbnailHeight:parseInt(ra(e.media_thumbnailheight),10),thumbnailWidth:parseInt(ra(e.media_thumbnailwidth),10)},t,n)})),this.session.on("peerRawMessage",(function(e){l.emit("MessageFromPeer",{rawMessage:e.raw,description:e.desc,messageType:S.MessageType.RAW},e.peerId,e.properties)})),c.on("instanceChanged",(function(e){return a=e})),c.on("peerOnlineStatusChanged",(function(e){var t=e.instance.toString()+e.state,n=l.peerStatusSeqLru.get(t);!n||e.seq.greaterThan(n)?(l.peerStatusSeqLru.set(t,e.seq),e.state!==l.subscribedPeerStatusCache[e.peerId]&&l.emit("PeersOnlineStatusChanged",m({},e.peerId,e.state)),l.subscribedPeerStatusCache[e.peerId]=e.state,clearTimeout(l.peerUnreachableTimers[t]),e.state===S.PeerOnlineState.UNREACHABLE&&(l.peerUnreachableTimers[t]=setTimeout((function(){l.subscribedPeerStatusCache[e.peerId]===S.PeerOnlineState.UNREACHABLE&&(l.subscribedPeerStatusCache[e.peerId]=S.PeerOnlineState.ONLINE,l.emit("PeersOnlineStatusChanged",m({},e.peerId,S.PeerOnlineState.ONLINE)))}),3e4))):l.log("peerOnlineStatusChanged dedup for %s, %d",t,e.seq.toNumber())})),c.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),c.on("channelAttributesUpdated",(function(e){var t=e.channelId;e=e.attributeMaps;for(var n={},r=0;r<e.length;r++){var i=e[r],o=i.key,a=i.ms,s=i.value;if(i=i.origin,"string"!=typeof o||!U.isLong(a)||"string"!=typeof s||!Aa(i))break;n[o]=new Blob([s]).size}l.channelAttributesCacheLru.set(t,n)})),c.on("userJoined",(function(e){if(0!==Object.keys(l.attributes).length){if(void 0===l.session)return;l.session.requestSetLocalUserAttributes(l.attributes,e).toPromise()}if(0!==l.attributeDrafts.size)for(var t=function(t,n){var r=(t=n[t]).attribute;t.promise.then((function(){void 0!==l.session&&l.session.requestSetLocalUserAttributes(r,e).toPromise()}))},n=0,r=Array.from(l.attributeDrafts);n<r.length;n++)t(n,r);0!==Object.keys(l.subscribedPeerStatusCache).length&&c.requestSubscribePeersOnlineStatus(Object.keys(l.subscribedPeerStatusCache))})),c.on("banEdgeIP",(function(e){l.banIP(e)})),this.lastLoginTime=Date.now(),e.prev=32,e.next=35,c.loginHandler().toPromise();case 35:this.mediaTaskManager.setAuthInfo({ticket:c.connection.curOpenSockets.filter((function(e){return void 0!==e}))[0].ticket,instance:c.instanceId,useNewDomain:.5<=Math.random(),loginOpt:c.userJoinOptions.toLong()}),e.next=54;break;case 38:if(e.prev=38,e.t1=e.catch(32),!("loginRespTimeout"===e.t1.name&&2>o)){e.next=47;break}return c.removeAllListeners(),e.next=44,this.loginImpl({uid:n,instanceId:r,forceLoginTime:o+1});case 44:return e.abrupt("return");case 47:if(!Xa(e.t1)){e.next=50;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Ib.LOGIN_TIMEOUT),new gb(he(this.name,"login",12e3),hC);case 50:if(this.onConnectionStateChanged(T.DISCONNECTED,Ib.LOGIN_FAILURE),!ta(e.t1)){e.next=53;break}throw e.t1;case 53:throw new da("Login failure",{code:cs,originalError:e.t1});case 54:this.onConnectionStateChanged(T.CONNECTED,Ib.LOGIN_SUCCESS);case 55:case"end":return e.stop()}}),e,this,[[6,10],[32,38]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(e,t){var n,r=this;e===T.RECONNECTING&&(this.reconnId+=1),hb("ConnectionStateChange",{elapse:ib(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:eu[e],oldState:eu[this.connectionState],reason:aG[t],sid:ab(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),this.connectionState===T.RECONNECTING&&e===T.CONNECTED&&(0!==Object.keys(this.subscribedPeerStatusCache).length&&void 0!==this.session&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ea((function(e){return Bc(pl(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=Bc(e,(function(e,t){return e=e?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,r.subscribedPeerStatusCache[t]=e})),r.emit("PeersOnlineStatusChanged",e)})),this.internalEmitter.emit("RECONNECTED")),this.connectionState=e,e!==T.ABORTED&&e!==T.DISCONNECTED||(this.pendingPeerStatusSubCount=this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",e),this.emit("ConnectionStateChanged",e,t)}},{key:"banIP",value:function(e){var t;this.log("ip banned",e);var n=null!==(t=this.blacklistedIP[e])&&void 0!==t?t:0;this.blacklistedIP[e]=n+1}}]),t}(wb()),la(E.prototype,"renewToken",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),la(E.prototype,"queryPeersOnlineStatus",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),la(E.prototype,"getChannelMemberCount",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),la(E.prototype,"setLocalUserAttributes",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),la(E.prototype,"setChannelAttributes",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),la(E.prototype,"addOrUpdateLocalUserAttributes",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),la(E.prototype,"addOrUpdateChannelAttributes",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),la(E.prototype,"deleteLocalUserAttributesByKeys",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),la(E.prototype,"deleteChannelAttributesByKeys",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),la(E.prototype,"clearLocalUserAttributes",[Qb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),la(E.prototype,"clearChannelAttributes",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),la(E.prototype,"getUserAttributes",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),la(E.prototype,"getChannelAttributes",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),la(E.prototype,"getChannelAttributesByKeys",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),la(E.prototype,"getUserAttributesByKeys",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),la(E.prototype,"login",[Qb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),la(E.prototype,"logout",[Qb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),la(E.prototype,"logoutSync",[Qb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),la(E.prototype,"sendMessageToPeer",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),la(E.prototype,"createChannel",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),la(E.prototype,"createLocalInvitation",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),la(E.prototype,"subscribePeersOnlineStatus",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),la(E.prototype,"unsubscribePeersOnlineStatus",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),la(E.prototype,"queryPeersBySubscriptionOption",[Ra],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),la(E.prototype,"createMessage",[Qb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),la(E.prototype,"downloadMedia",[Qb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),la(E.prototype,"createMediaMessageByUploading",[Qb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),pm,qm,rm,sm,fu=null===(pm=/Chrome\/([0-9.]+)/.exec(null===(rm=window)||void 0===rm||null===(sm=rm.navigator)||void 0===sm?void 0:sm.userAgent))||void 0===pm||null===(qm=pm[1])||void 0===qm?void 0:qm.split(".")[0];if(fu&&88<=parseInt(fu,10)&&!pe()){var tm,me=document.createElement("video"),ne=document.createElement("canvas");me.setAttribute("style","display:none"),me.setAttribute("muted",""),me.muted=!0,me.setAttribute("autoplay",""),me.autoplay=!0,me.setAttribute("playsinline",""),ne.setAttribute("style","display:none"),ne.setAttribute("width","1"),ne.setAttribute("height","1"),null===(tm=ne.getContext("2d"))||void 0===tm||tm.fillRect(0,0,1,1),me.srcObject=null==ne?void 0:ne.captureStream()}var gu={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},hu={enableLogUpload:!1,logFilter:gu.LOG_FILTER_INFO,enableCloudProxy:!1},ie=wa(wa({createInstance:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e))throw new H(["The %s in the arguments is invalid",Object.keys({appId:e})[0]],Rr);var r=Object.keys(t).filter((function(e){return!(e in hu)}));if(0!==r.length)throw new H("Invalid RTM config: ".concat(r.join(", ")),Rr);var i=wa(wa({},hu),t);if(void 0!==n&&(!Array.isArray(n)||0===n.length))throw new H("Invalid area config");if(null!=n){if(!n.every((function(e){return e in S.LegacyAreaCode})))throw new H("Invalid area codes: ".concat(n.filter((function(e){return!(e in S)})).join(", ")));P=Ke(n.map((function(e){return vE[e]})))}n=Ql=Ka.__global_unique_id__=(Ka.__global_unique_id__||0)+1;var o=zE(i);r=AE(i);var a=BE(i),s=CE(n,i),c=Xs(n,i),u=c("RTM:DEBUG","<Entry> ");return Qs.rtmConfig=i,o("The Agora RTM Web SDK version is %s","1.4.5"),t.enableCloudProxy&&o("RTM cloud proxy enabled"),t.enableLogUpload&&o("Log upload enabled"),P&&u("Area is set to %s",Array.from(P.CODES).map((function(e){return Pf(D).find((function(t){return D[t]===e}))})).join(", ")),u("Creating an RtmClient instance"),u('The Git commit ID is "'.concat("v1.4.5-0-g9cf39592",'"')),u("The App ID is %s",Xn(e,4,10,"*".repeat(6))),o("The process ID is %s",zg),u("The build is %s","v1.4.5-0-g9cf39592"),u("NODE_ENV is %s","production"),new bG(e,{genLogger:c,genTracker:s,info:o,warn:r,logError:a,loggerId:n},i,(function(e){for(var t=0,n=Pf(e);t<n.length;t++){var r=n[t];try{var a=e[r];null!=a&&(e.enableCloudProxy&&o("RTM cloud proxy enabled"),e.enableLogUpload&&o("Log upload enabled"),i[r]=a)}catch(e){throw new H(["The %s in the arguments is invalid",r],void 0)}}}))},BUILD:"v1.4.5-0-g9cf39592",VERSION:"1.4.5",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:zg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},gu),{},{setParameter:function(e,t){Object.keys(lc).includes(e)&&(lc[e]=t)},getParameter:function(e){return lc[e]},setArea:function(e){var t=e.areaCodes;if(e=e.excludedArea,!Array.isArray(t)||0===t.length||!t.every((function(e){return e in S.AreaCode})))throw new H("Invalid area config");if(void 0!==e&&e===S.AreaCode.GLOBAL)throw new H("Excluded area cannot be global");if(void 0===e)P=Ke(t.map((function(e){return D[e]})));else{if(t.includes(e))throw new H("Excluded area cannot be in areaCodes");if(!(e in D))throw new H("Invalid excludedArea:",e);P=Xv({areas:t.map((function(e){return D[e]})),excludedArea:D[e]})}}});return ie})),
/**
  @license
                                 Apache License
                         Version 2.0, January 2004
                      http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

    "License" shall mean the terms and conditions for use, reproduction,
    and distribution as defined by Sections 1 through 9 of this document.

    "Licensor" shall mean the copyright owner or entity authorized by
    the copyright owner that is granting the License.

    "Legal Entity" shall mean the union of the acting entity and all
    other entities that control, are controlled by, or are under common
    control with that entity. For the purposes of this definition,
    "control" means (i) the power, direct or indirect, to cause the
    direction or management of such entity, whether by contract or
    otherwise, or (ii) ownership of fifty percent (50%) or more of the
    outstanding shares, or (iii) beneficial ownership of such entity.

    "You" (or "Your") shall mean an individual or Legal Entity
    exercising permissions granted by this License.

    "Source" form shall mean the preferred form for making modifications,
    including but not limited to software source code, documentation
    source, and configuration files.

    "Object" form shall mean any form resulting from mechanical
    transformation or translation of a Source form, including but
    not limited to compiled object code, generated documentation,
    and conversions to other media types.

    "Work" shall mean the work of authorship, whether in Source or
    Object form, made available under the License, as indicated by a
    copyright notice that is included in or attached to the work
    (an example is provided in the Appendix below).

    "Derivative Works" shall mean any work, whether in Source or Object
    form, that is based on (or derived from) the Work and for which the
    editorial revisions, annotations, elaborations, or other modifications
    represent, as a whole, an original work of authorship. For the purposes
    of this License, Derivative Works shall not include works that remain
    separable from, or merely link (or bind by name) to the interfaces of,
    the Work and Derivative Works thereof.

    "Contribution" shall mean any work of authorship, including
    the original version of the Work and any modifications or additions
    to that Work or Derivative Works thereof, that is intentionally
    submitted to Licensor for inclusion in the Work by the copyright owner
    or by an individual or Legal Entity authorized to submit on behalf of
    the copyright owner. For the purposes of this definition, "submitted"
    means any form of electronic, verbal, or written communication sent
    to the Licensor or its representatives, including but not limited to
    communication on electronic mailing lists, source code control systems,
    and issue tracking systems that are managed by, or on behalf of, the
    Licensor for the purpose of discussing and improving the Work, but
    excluding communication that is conspicuously marked or otherwise
    designated in writing by the copyright owner as "Not a Contribution."

    "Contributor" shall mean Licensor and any individual or Legal Entity
    on behalf of whom a Contribution has been received by Licensor and
    subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    copyright license to reproduce, prepare Derivative Works of,
    publicly display, publicly perform, sublicense, and distribute the
    Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    (except as stated in this section) patent license to make, have made,
    use, offer to sell, sell, import, and otherwise transfer the Work,
    where such license applies only to those patent claims licensable
    by such Contributor that are necessarily infringed by their
    Contribution(s) alone or by combination of their Contribution(s)
    with the Work to which such Contribution(s) was submitted. If You
    institute patent litigation against any entity (including a
    cross-claim or counterclaim in a lawsuit) alleging that the Work
    or a Contribution incorporated within the Work constitutes direct
    or contributory patent infringement, then any patent licenses
    granted to You under this License for that Work shall terminate
    as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
    Work or Derivative Works thereof in any medium, with or without
    modifications, and in Source or Object form, provided that You
    meet the following conditions:

    (a) You must give any other recipients of the Work or
        Derivative Works a copy of this License; and

    (b) You must cause any modified files to carry prominent notices
        stating that You changed the files; and

    (c) You must retain, in the Source form of any Derivative Works
        that You distribute, all copyright, patent, trademark, and
        attribution notices from the Source form of the Work,
        excluding those notices that do not pertain to any part of
        the Derivative Works; and

    (d) If the Work includes a "NOTICE" text file as part of its
        distribution, then any Derivative Works that You distribute must
        include a readable copy of the attribution notices contained
        within such NOTICE file, excluding those notices that do not
        pertain to any part of the Derivative Works, in at least one
        of the following places: within a NOTICE text file distributed
        as part of the Derivative Works; within the Source form or
        documentation, if provided along with the Derivative Works; or,
        within a display generated by the Derivative Works, if and
        wherever such third-party notices normally appear. The contents
        of the NOTICE file are for informational purposes only and
        do not modify the License. You may add Your own attribution
        notices within Derivative Works that You distribute, alongside
        or as an addendum to the NOTICE text from the Work, provided
        that such additional attribution notices cannot be construed
        as modifying the License.

    You may add Your own copyright statement to Your modifications and
    may provide additional or different license terms and conditions
    for use, reproduction, or distribution of Your modifications, or
    for any such Derivative Works as a whole, provided Your use,
    reproduction, and distribution of the Work otherwise complies with
    the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
    any Contribution intentionally submitted for inclusion in the Work
    by You to the Licensor shall be under the terms and conditions of
    this License, without any additional terms or conditions.
    Notwithstanding the above, nothing herein shall supersede or modify
    the terms of any separate license agreement you may have executed
    with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
    names, trademarks, service marks, or product names of the Licensor,
    except as required for reasonable and customary use in describing the
    origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
    agreed to in writing, Licensor provides the Work (and each
    Contributor provides its Contributions) on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
    implied, including, without limitation, any warranties or conditions
    of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
    PARTICULAR PURPOSE. You are solely responsible for determining the
    appropriateness of using or redistributing the Work and assume any
    risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
    whether in tort (including negligence), contract, or otherwise,
    unless required by applicable law (such as deliberate and grossly
    negligent acts) or agreed to in writing, shall any Contributor be
    liable to You for damages, including any direct, indirect, special,
    incidental, or consequential damages of any character arising as a
    result of this License or out of the use or inability to use the
    Work (including but not limited to damages for loss of goodwill,
    work stoppage, computer failure or malfunction, or any and all
    other commercial damages or losses), even if such Contributor
    has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
    the Work or Derivative Works thereof, You may choose to offer,
    and charge a fee for, acceptance of support, warranty, indemnity,
    or other liability obligations and/or rights consistent with this
    License. However, in accepting such obligations, You may act only
    on Your own behalf and on Your sole responsibility, not on behalf
    of any other Contributor, and only if You agree to indemnify,
    defend, and hold each Contributor harmless for any liability
    incurred by, or claims asserted against, such Contributor by reason
    of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

    To apply the Apache License to your work, attach the following
    boilerplate notice, with the fields enclosed by brackets "[]"
    replaced with your own identifying information. (Don't include
    the brackets!)  The text should be enclosed in the appropriate
    comment syntax for the file format. We also recommend that a
    file or class name and description of purpose be included on the
    same "printed page" as the copyright notice for easier
    identification within third-party archives.

 Copyright (c) 2015-2018 Google, Inc., Netflix, Inc., Microsoft Corp. and contributors

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 

 **/
/**
  @license
                                 Apache License
                         Version 2.0, January 2004
                      http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

    "License" shall mean the terms and conditions for use, reproduction,
    and distribution as defined by Sections 1 through 9 of this document.

    "Licensor" shall mean the copyright owner or entity authorized by
    the copyright owner that is granting the License.

    "Legal Entity" shall mean the union of the acting entity and all
    other entities that control, are controlled by, or are under common
    control with that entity. For the purposes of this definition,
    "control" means (i) the power, direct or indirect, to cause the
    direction or management of such entity, whether by contract or
    otherwise, or (ii) ownership of fifty percent (50%) or more of the
    outstanding shares, or (iii) beneficial ownership of such entity.

    "You" (or "Your") shall mean an individual or Legal Entity
    exercising permissions granted by this License.

    "Source" form shall mean the preferred form for making modifications,
    including but not limited to software source code, documentation
    source, and configuration files.

    "Object" form shall mean any form resulting from mechanical
    transformation or translation of a Source form, including but
    not limited to compiled object code, generated documentation,
    and conversions to other media types.

    "Work" shall mean the work of authorship, whether in Source or
    Object form, made available under the License, as indicated by a
    copyright notice that is included in or attached to the work
    (an example is provided in the Appendix below).

    "Derivative Works" shall mean any work, whether in Source or Object
    form, that is based on (or derived from) the Work and for which the
    editorial revisions, annotations, elaborations, or other modifications
    represent, as a whole, an original work of authorship. For the purposes
    of this License, Derivative Works shall not include works that remain
    separable from, or merely link (or bind by name) to the interfaces of,
    the Work and Derivative Works thereof.

    "Contribution" shall mean any work of authorship, including
    the original version of the Work and any modifications or additions
    to that Work or Derivative Works thereof, that is intentionally
    submitted to Licensor for inclusion in the Work by the copyright owner
    or by an individual or Legal Entity authorized to submit on behalf of
    the copyright owner. For the purposes of this definition, "submitted"
    means any form of electronic, verbal, or written communication sent
    to the Licensor or its representatives, including but not limited to
    communication on electronic mailing lists, source code control systems,
    and issue tracking systems that are managed by, or on behalf of, the
    Licensor for the purpose of discussing and improving the Work, but
    excluding communication that is conspicuously marked or otherwise
    designated in writing by the copyright owner as "Not a Contribution."

    "Contributor" shall mean Licensor and any individual or Legal Entity
    on behalf of whom a Contribution has been received by Licensor and
    subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    copyright license to reproduce, prepare Derivative Works of,
    publicly display, publicly perform, sublicense, and distribute the
    Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    (except as stated in this section) patent license to make, have made,
    use, offer to sell, sell, import, and otherwise transfer the Work,
    where such license applies only to those patent claims licensable
    by such Contributor that are necessarily infringed by their
    Contribution(s) alone or by combination of their Contribution(s)
    with the Work to which such Contribution(s) was submitted. If You
    institute patent litigation against any entity (including a
    cross-claim or counterclaim in a lawsuit) alleging that the Work
    or a Contribution incorporated within the Work constitutes direct
    or contributory patent infringement, then any patent licenses
    granted to You under this License for that Work shall terminate
    as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
    Work or Derivative Works thereof in any medium, with or without
    modifications, and in Source or Object form, provided that You
    meet the following conditions:

    (a) You must give any other recipients of the Work or
        Derivative Works a copy of this License; and

    (b) You must cause any modified files to carry prominent notices
        stating that You changed the files; and

    (c) You must retain, in the Source form of any Derivative Works
        that You distribute, all copyright, patent, trademark, and
        attribution notices from the Source form of the Work,
        excluding those notices that do not pertain to any part of
        the Derivative Works; and

    (d) If the Work includes a "NOTICE" text file as part of its
        distribution, then any Derivative Works that You distribute must
        include a readable copy of the attribution notices contained
        within such NOTICE file, excluding those notices that do not
        pertain to any part of the Derivative Works, in at least one
        of the following places: within a NOTICE text file distributed
        as part of the Derivative Works; within the Source form or
        documentation, if provided along with the Derivative Works; or,
        within a display generated by the Derivative Works, if and
        wherever such third-party notices normally appear. The contents
        of the NOTICE file are for informational purposes only and
        do not modify the License. You may add Your own attribution
        notices within Derivative Works that You distribute, alongside
        or as an addendum to the NOTICE text from the Work, provided
        that such additional attribution notices cannot be construed
        as modifying the License.

    You may add Your own copyright statement to Your modifications and
    may provide additional or different license terms and conditions
    for use, reproduction, or distribution of Your modifications, or
    for any such Derivative Works as a whole, provided Your use,
    reproduction, and distribution of the Work otherwise complies with
    the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
    any Contribution intentionally submitted for inclusion in the Work
    by You to the Licensor shall be under the terms and conditions of
    this License, without any additional terms or conditions.
    Notwithstanding the above, nothing herein shall supersede or modify
    the terms of any separate license agreement you may have executed
    with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
    names, trademarks, service marks, or product names of the Licensor,
    except as required for reasonable and customary use in describing the
    origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
    agreed to in writing, Licensor provides the Work (and each
    Contributor provides its Contributions) on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
    implied, including, without limitation, any warranties or conditions
    of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
    PARTICULAR PURPOSE. You are solely responsible for determining the
    appropriateness of using or redistributing the Work and assume any
    risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
    whether in tort (including negligence), contract, or otherwise,
    unless required by applicable law (such as deliberate and grossly
    negligent acts) or agreed to in writing, shall any Contributor be
    liable to You for damages, including any direct, indirect, special,
    incidental, or consequential damages of any character arising as a
    result of this License or out of the use or inability to use the
    Work (including but not limited to damages for loss of goodwill,
    work stoppage, computer failure or malfunction, or any and all
    other commercial damages or losses), even if such Contributor
    has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
    the Work or Derivative Works thereof, You may choose to offer,
    and charge a fee for, acceptance of support, warranty, indemnity,
    or other liability obligations and/or rights consistent with this
    License. However, in accepting such obligations, You may act only
    on Your own behalf and on Your sole responsibility, not on behalf
    of any other Contributor, and only if You agree to indemnify,
    defend, and hold each Contributor harmless for any liability
    incurred by, or claims asserted against, such Contributor by reason
    of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

    To apply the Apache License to your work, attach the following
    boilerplate notice, with the fields enclosed by brackets "[]"
    replaced with your own identifying information. (Don't include
    the brackets!)  The text should be enclosed in the appropriate
    comment syntax for the file format. We also recommend that a
    file or class name and description of purpose be included on the
    same "printed page" as the copyright notice for easier
    identification within third-party archives.

 Copyright (c) 2015-2018 Google, Inc., Netflix, Inc., Microsoft Corp. and contributors

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 

 **/
function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("rxjs",["exports"],t):t(e.rxjs={})}(this,(function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function n(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};function i(e){return"function"==typeof e}var o=!1,a={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else o&&console.log("RxJS: Back to a better error behavior. Thank you. <3");o=e},get useDeprecatedSynchronousErrorHandling(){return o}};function s(e){setTimeout((function(){throw e}),0)}var c={closed:!0,next:function(e){},error:function(e){if(a.useDeprecatedSynchronousErrorHandling)throw e;s(e)},complete:function(){}},u=Array.isArray||function(e){return e&&"number"==typeof e.length};function l(e){return null!==e&&"object"==typeof e}var d=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),h=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,r=n._parentOrParents,o=n._ctorUnsubscribe,a=n._unsubscribe,s=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof e)r.remove(this);else if(null!==r)for(var c=0;c<r.length;++c){r[c].remove(this)}if(i(a)){o&&(this._unsubscribe=void 0);try{a.call(this)}catch(e){t=e instanceof d?f(e.errors):[e]}}if(u(s)){c=-1;for(var h=s.length;++c<h;){var p=s[c];if(l(p))try{p.unsubscribe()}catch(e){t=t||[],e instanceof d?t=t.concat(f(e.errors)):t.push(e)}}}if(t)throw new d(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof e){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function f(e){return e.reduce((function(e,t){return e.concat(t instanceof d?t.errors:t)}),[])}var p="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),m=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=c;break;case 1:if(!n){o.destination=c;break}if("object"==typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new g(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new g(o,n,r,i)}return o}return n(t,e),t.prototype[p]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(h),g=function(e){function t(t,n,r,o){var a,s=e.call(this)||this;s._parentSubscriber=t;var u=s;return i(n)?a=n:n&&(a=n.next,r=n.error,o=n.complete,n!==c&&(i((u=Object.create(n)).unsubscribe)&&s.add(u.unsubscribe.bind(u)),u.unsubscribe=s.unsubscribe.bind(s))),s._context=u,s._next=a,s._error=r,s._complete=o,s}return n(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=a.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):s(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;s(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),a.useDeprecatedSynchronousErrorHandling)throw e;s(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return a.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(s(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(m);function v(e){for(;e;){var t=e,n=t.closed,r=t.destination,i=t.isStopped;if(n||i)return!1;e=r&&r instanceof m?r:null}return!0}var y="function"==typeof Symbol&&Symbol.observable||"@@observable";function b(e){return e}function _(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return E(e)}function E(e){return 0===e.length?b:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var S=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,i=function(e,t,n){if(e){if(e instanceof m)return e;if(e[p])return e[p]()}return e||t||n?new m(e,t,n):new m(c)}(e,t,n);if(r?i.add(r.call(i,this.source)):i.add(this.source||a.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),a.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){a.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),v(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=w(t))((function(t,r){var i;i=n.subscribe((function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[y]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:E(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=w(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function w(e){if(e||(e=a.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var T=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),A=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return n(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(h),R=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return n(t,e),t}(m),x=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return n(t,e),t.prototype[p]=function(){return new R(this)},t.prototype.lift=function(e){var t=new I(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new T;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new T;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new T;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new T;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new T;return this.hasError?(e.error(this.thrownError),h.EMPTY):this.isStopped?(e.complete(),h.EMPTY):(this.observers.push(e),new A(this,e))},t.prototype.asObservable=function(){var e=new S;return e.source=this,e},t.create=function(e,t){return new I(e,t)},t}(S),I=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return n(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):h.EMPTY},t}(x);function O(){return function(e){return e.lift(new M(e))}}var C,M=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new N(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i},e}(),N=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return n(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},t}(m),L=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return n(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new h).add(this.source.subscribe(new P(this.getSubject(),this))),e.closed&&(this._connection=null,e=h.EMPTY)),e},t.prototype.refCount=function(){return O()(this)},t}(S),k={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:(C=L.prototype)._subscribe},_isComplete:{value:C._isComplete,writable:!0},getSubject:{value:C.getSubject},connect:{value:C.connect},refCount:{value:C.refCount}},P=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return n(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(R);!function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}n(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null}}(m);var D=function(){function e(e,t,n,r){this.keySelector=e,this.elementSelector=t,this.durationSelector=n,this.subjectSelector=r}return e.prototype.call=function(e,t){return t.subscribe(new U(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},e}(),U=function(e){function t(t,n,r,i,o){var a=e.call(this,t)||this;return a.keySelector=n,a.elementSelector=r,a.durationSelector=i,a.subjectSelector=o,a.groups=null,a.attemptedToUnsubscribe=!1,a.count=0,a}return n(t,e),t.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(t);if(this.elementSelector)try{r=this.elementSelector(e)}catch(e){this.error(e)}else r=e;if(!i){i=this.subjectSelector?this.subjectSelector():new x,n.set(t,i);var o=new j(t,i,this);if(this.destination.next(o),this.durationSelector){var a=void 0;try{a=this.durationSelector(new j(t,i))}catch(e){return void this.error(e)}this.add(a.subscribe(new F(t,i,this)))}}i.closed||i.next(r)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach((function(t,n){t.error(e)})),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach((function(e,t){e.complete()})),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))},t}(m),F=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return n(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(m),j=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return n(t,e),t.prototype._subscribe=function(e){var t=new h,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new B(n)),t.add(r.subscribe(e)),t},t}(S),B=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return n(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(h),V=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return n(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new T;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(x),G=function(e){function t(t,n){return e.call(this)||this}return n(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(h),H=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return n(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(e){n=!0,r=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(G),z=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return n(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(H),W=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),q=function(e){function t(n,r){void 0===r&&(r=W.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return n(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(W),X=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(q),J=new X(z),Y=J,K=new S((function(e){return e.complete()}));function Q(e){return e?function(e){return new S((function(t){return e.schedule((function(){return t.complete()}))}))}(e):K}function Z(e){return e&&"function"==typeof e.schedule}var $,ee=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}};function te(e,t){return new S((function(n){var r=new h,i=0;return r.add(t.schedule((function(){i!==e.length?(n.next(e[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function ne(e,t){return t?te(e,t):new S(ee(e))}function re(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return Z(n)?(e.pop(),te(e,n)):ne(e)}function ie(e,t){return new S(t?function(n){return t.schedule(oe,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function oe(e){var t=e.error;e.subscriber.error(t)}($=e.NotificationKind||(e.NotificationKind={})).NEXT="N",$.ERROR="E",$.COMPLETE="C";var ae=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return re(this.value);case"E":return ie(this.error);case"C":return Q()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}();var se=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new ce(e,this.scheduler,this.delay))},e}(),ce=function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this,t)||this;return i.scheduler=n,i.delay=r,i}return n(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new ue(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(ae.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(ae.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(ae.createComplete()),this.unsubscribe()},t}(m),ue=function(e,t){this.notification=e,this.destination=t},le=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=t<1?1:t,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return n(t,e),t.prototype.nextInfiniteTimeWindow=function(t){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift(),e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this._events.push(new de(this._getNow(),t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new T;if(this.isStopped||this.hasError?t=h.EMPTY:(this.observers.push(e),t=new A(this,e)),i&&e.add(e=new ce(e,i)),n)for(var a=0;a<o&&!e.closed;a++)e.next(r[a]);else for(a=0;a<o&&!e.closed;a++)e.next(r[a].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||Y).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),o>0&&r.splice(0,o),r},t}(x),de=function(e,t){this.time=e,this.value=t},he=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return n(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),h.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),h.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(x),fe=1,pe=Promise.resolve(),me={};function ge(e){return e in me&&(delete me[e],!0)}var ve=function(e){var t=fe++;return me[t]=!0,pe.then((function(){return ge(t)&&e()})),t},ye=function(e){ge(e)},be=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return n(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=ve(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(ye(n),t.scheduled=void 0)},t}(H),_e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(q),Ee=new _e(be),Se=Ee,we=new q(H),Te=we,Ae=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return n(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(H),Re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(q),xe=new Re(Ae),Ie=xe,Oe=function(e){function t(t,n){void 0===t&&(t=Ce),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return n(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(q),Ce=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return n(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var i=e.actions;return i.push(this),i.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){void 0===n&&(n=0)},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(H);function Me(){}var Ne=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),Le=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),ke=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}();function Pe(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new De(e,t))}}var De=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new Ue(e,this.project,this.thisArg))},e}(),Ue=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return n(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(m);function Fe(e){var t=this,n=e.args,r=e.subscriber,i=e.params,o=i.callbackFunc,a=i.context,s=i.scheduler,c=i.subject;if(!c){c=i.subject=new he;try{o.apply(a,n.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.length<=1?e[0]:e;t.add(s.schedule(je,0,{value:r,subject:c}))}]))}catch(e){c.error(e)}}this.add(c.subscribe(r))}function je(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function Be(e){var t=this,n=e.params,r=e.subscriber,i=e.context,o=n.callbackFunc,a=n.args,s=n.scheduler,c=n.subject;if(!c){c=n.subject=new he;try{o.apply(i,a.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.shift();if(r)t.add(s.schedule(Ge,0,{err:r,subject:c}));else{var i=e.length<=1?e[0]:e;t.add(s.schedule(Ve,0,{value:i,subject:c}))}}]))}catch(e){this.add(s.schedule(Ge,0,{err:e,subject:c}))}}this.add(c.subscribe(r))}function Ve(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function Ge(e){var t=e.err;e.subject.error(t)}var He=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(m),ze=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return n(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(m);var We="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",qe=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Xe(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var Je=function(e){if(e&&"function"==typeof e[y])return r=e,function(e){var t=r[y]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(qe(e))return ee(e);if(Xe(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,s),e};if(e&&"function"==typeof e[We])return t=e,function(e){for(var n=t[We]();;){var r=void 0;try{r=n.next()}catch(t){return e.error(t),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,r,i=l(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function Ye(e,t,n,r,i){if(void 0===i&&(i=new ze(e,n,r)),!i.closed)return t instanceof S?t.subscribe(i):Je(t)(i)}var Ke={};var Qe=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ze(e,this.resultSelector))},e}(),Ze=function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return n(t,e),t.prototype._next=function(e){this.values.push(Ke),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(Ye(this,r,void 0,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=this.values,i=r[n],o=this.toRespond?i===Ke?--this.toRespond:this.toRespond:0;r[n]=t,0===o&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(He);function $e(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[y]}(e))return function(e,t){return new S((function(n){var r=new h;return r.add(t.schedule((function(){var i=e[y]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if(Xe(e))return function(e,t){return new S((function(n){var r=new h;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if(qe(e))return te(e,t);if(function(e){return e&&"function"==typeof e[We]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new S((function(n){var r,i=new h;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[We](),i.add(t.schedule((function(){if(!n.closed){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}})))}))),i}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}function et(e,t){return t?$e(e,t):e instanceof S?e:new S(Je(e))}var tt=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return n(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(m),nt=(function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i}n(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(m),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(m));!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e),t.prototype.notifyNext=function(e,t,n,r){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()}}(m);function rt(e,t){if(!t.closed)return e instanceof S?e.subscribe(t):Je(e)(t)}function it(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(it((function(n,r){return et(e(n,r)).pipe(Pe((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new ot(e,n))})}var ot=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new at(e,this.project,this.concurrent))},e}(),at=function(e){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=e.call(this,t)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return n(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new tt(this),n=this.destination;n.add(t);var r=rt(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(nt),st=it;function ct(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),it(b,e)}function ut(){return ct(1)}function lt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ut()(re.apply(void 0,e))}function dt(e){return new S((function(t){var n;try{n=e()}catch(e){return void t.error(e)}return(n?et(n):Q()).subscribe(t)}))}function ht(e,t){return new S((function(n){var r=e.length;if(0!==r)for(var i=new Array(r),o=0,a=0,s=function(s){var c=et(e[s]),u=!1;n.add(c.subscribe({next:function(e){u||(u=!0,a++),i[s]=e},error:function(e){return n.error(e)},complete:function(){++o!==r&&u||(a===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=i[n],e}),{}):i),n.complete())}}))},c=0;c<r;c++)s(c);else n.complete()}))}function ft(e,t,n,r,i){var o;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(e)){var a=e;e.addEventListener(t,n,i),o=function(){return a.removeEventListener(t,n,i)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(e)){var s=e;e.on(t,n),o=function(){return s.off(t,n)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(e)){var c=e;e.addListener(t,n),o=function(){return c.removeListener(t,n)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var u=0,l=e.length;u<l;u++)ft(e[u],t,n,r,i)}r.add(o)}function pt(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}var i;try{i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function mt(e){return!u(e)&&e-parseFloat(e)+1>=0}function gt(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}function vt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Number.POSITIVE_INFINITY,r=null,i=e[e.length-1];return Z(i)?(r=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof i&&(n=e.pop()),null===r&&1===e.length&&e[0]instanceof S?e[0]:ct(n)(ne(e,r))}var yt=new S(Me);function bt(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription,o=e.obj;if(!r.closed)if(n<t.length){var a=t[n];r.next([a,o[a]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:o}))}else r.complete()}function _t(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}function Et(e,t){return function(n){return n.lift(new St(e,t))}}var St=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new wt(e,this.predicate,this.thisArg))},e}(),wt=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return n(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(m);function Tt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!u(e[0]))return e[0];e=e[0]}return ne(e,void 0).lift(new At)}var At=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Rt(e))},e}(),Rt=function(e){function t(t){var n=e.call(this,t)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return n(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=Ye(this,e[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){this.hasFirst=!0;for(var r=0;r<this.subscriptions.length;r++)if(r!==n){var i=this.subscriptions[r];i.unsubscribe(),this.remove(i)}this.subscriptions=null}this.destination.next(t)},t}(He);function xt(e){var t=e.start,n=e.index,r=e.count,i=e.subscriber;n>=r?i.complete():(i.next(t),i.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}function It(e,t,n){void 0===e&&(e=0);var r=-1;return mt(t)?r=Number(t)<1?1:Number(t):Z(t)&&(n=t),Z(n)||(n=Te),new S((function(t){var i=mt(e)?e:+e-n.now();return n.schedule(Ot,i,{index:0,period:r,subscriber:t})}))}function Ot(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function Ct(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return"function"==typeof n&&e.pop(),ne(e,void 0).lift(new Mt(n))}var Mt=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Nt(e,this.resultSelector))},e}(),Nt=function(e){function t(t,n,r){void 0===r&&(r=Object.create(null));var i=e.call(this,t)||this;return i.resultSelector=n,i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:void 0,i}return n(t,e),t.prototype._next=function(e){var t=this.iterators;u(e)?t.push(new kt(e)):"function"==typeof e[We]?t.push(new Lt(e[We]())):t.push(new Pt(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0!==t){this.active=t;for(var n=0;n<t;n++){var r=e[n];if(r.stillUnsubscribed)this.destination.add(r.subscribe());else this.active--}}else this.destination.complete()},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){if("function"==typeof(a=e[r]).hasValue&&!a.hasValue())return}var i=!1,o=[];for(r=0;r<t;r++){var a,s=(a=e[r]).next();if(a.hasCompleted()&&(i=!0),s.done)return void n.complete();o.push(s.value)}this.resultSelector?this._tryresultSelector(o):n.next(o),i&&n.complete()},t.prototype._tryresultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(m),Lt=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return Boolean(e&&e.done)},e}(),kt=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[We]=function(){return this},e.prototype.next=function(e){var t=this.index++,n=this.array;return t<this.length?{value:n[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),Pt=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return n(t,e),t.prototype[We]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return this.buffer.length>0},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return rt(this.observable,new tt(this))},t}(nt);function Dt(e){return function(t){return t.lift(new Ut(e))}}var Ut=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ft(e,this.durationSelector))},e}(),Ft=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}return n(t,e),t.prototype._next=function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t=void 0;try{t=(0,this.durationSelector)(e)}catch(e){return this.destination.error(e)}var n=rt(t,new tt(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}},t.prototype.clearThrottle=function(){var e=this,t=e.value,n=e.hasValue,r=e.throttled;r&&(this.remove(r),this.throttled=void 0,r.unsubscribe()),n&&(this.value=void 0,this.hasValue=!1,this.destination.next(t))},t.prototype.notifyNext=function(){this.clearThrottle()},t.prototype.notifyComplete=function(){this.clearThrottle()},t}(nt);var jt=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new Bt(e,this.closingNotifier))},e}(),Bt=function(e){function t(t,n){var r=e.call(this,t)||this;return r.buffer=[],r.add(rt(n,new tt(r))),r}return n(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype.notifyNext=function(){var e=this.buffer;this.buffer=[],this.destination.next(e)},t}(nt);var Vt=function(){function e(e,t){this.bufferSize=e,this.startBufferEvery=t,this.subscriberClass=t&&e!==t?Ht:Gt}return e.prototype.call=function(e,t){return t.subscribe(new this.subscriberClass(e,this.bufferSize,this.startBufferEvery))},e}(),Gt=function(e){function t(t,n){var r=e.call(this,t)||this;return r.bufferSize=n,r.buffer=[],r}return n(t,e),t.prototype._next=function(e){var t=this.buffer;t.push(e),t.length==this.bufferSize&&(this.destination.next(t),this.buffer=[])},t.prototype._complete=function(){var t=this.buffer;t.length>0&&this.destination.next(t),e.prototype._complete.call(this)},t}(m),Ht=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}return n(t,e),t.prototype._next=function(e){var t=this,n=t.bufferSize,r=t.startBufferEvery,i=t.buffers,o=t.count;this.count++,o%r==0&&i.push([]);for(var a=i.length;a--;){var s=i[a];s.push(e),s.length===n&&(i.splice(a,1),this.destination.next(s))}},t.prototype._complete=function(){for(var t=this.buffers,n=this.destination;t.length>0;){var r=t.shift();r.length>0&&n.next(r)}e.prototype._complete.call(this)},t}(m);var zt=function(){function e(e,t,n,r){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new qt(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),Wt=function(){this.buffer=[]},qt=function(e){function t(t,n,r,i,o){var a=e.call(this,t)||this;a.bufferTimeSpan=n,a.bufferCreationInterval=r,a.maxBufferSize=i,a.scheduler=o,a.contexts=[];var s=a.openContext();if(a.timespanOnly=null==r||r<0,a.timespanOnly){var c={subscriber:a,context:s,bufferTimeSpan:n};a.add(s.closeAction=o.schedule(Xt,n,c))}else{var u={subscriber:a,context:s},l={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:a,scheduler:o};a.add(s.closeAction=o.schedule(Yt,n,u)),a.add(o.schedule(Jt,r,l))}return a}return n(t,e),t.prototype._next=function(e){for(var t,n=this.contexts,r=n.length,i=0;i<r;i++){var o=n[i],a=o.buffer;a.push(e),a.length==this.maxBufferSize&&(t=o)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts,n=this.destination;t.length>0;){var r=t.shift();n.next(r.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:e,bufferTimeSpan:n};this.add(e.closeAction=this.scheduler.schedule(Xt,n,r))}},t.prototype.openContext=function(){var e=new Wt;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;(t?t.indexOf(e):-1)>=0&&t.splice(t.indexOf(e),1)},t}(m);function Xt(e){var t=e.subscriber,n=e.context;n&&t.closeContext(n),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function Jt(e){var t=e.bufferCreationInterval,n=e.bufferTimeSpan,r=e.subscriber,i=e.scheduler,o=r.openContext();r.closed||(r.add(o.closeAction=i.schedule(Yt,n,{subscriber:r,context:o})),this.schedule(e,t))}function Yt(e){var t=e.subscriber,n=e.context;t.closeContext(n)}var Kt=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Qt(e,this.openings,this.closingSelector))},e}(),Qt=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.closingSelector=r,i.contexts=[],i.add(Ye(i,n)),i}return n(t,e),t.prototype._next=function(e){for(var t=this.contexts,n=t.length,r=0;r<n;r++)t[r].buffer.push(e)},t.prototype._error=function(t){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var n=t.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t){e?this.closeBuffer(e):this.openBuffer(t)},t.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},t.prototype.openBuffer=function(e){try{var t=this.closingSelector.call(this,e);t&&this.trySubscribe(t)}catch(e){this._error(e)}},t.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var n=e.buffer,r=e.subscription;this.destination.next(n),t.splice(t.indexOf(e),1),this.remove(r),r.unsubscribe()}},t.prototype.trySubscribe=function(e){var t=this.contexts,n=new h,r={buffer:[],subscription:n};t.push(r);var i=Ye(this,e,r);!i||i.closed?this.closeBuffer(r):(i.context=r,this.add(i),n.add(i))},t}(He);var Zt=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new $t(e,this.closingSelector))},e}(),$t=function(e){function t(t,n){var r=e.call(this,t)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}return n(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=!1},t.prototype.notifyNext=function(){this.openBuffer()},t.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},t.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var t,n=this.buffer;this.buffer&&this.destination.next(n),this.buffer=[];try{t=(0,this.closingSelector)()}catch(e){return this.error(e)}e=new h,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add(rt(t,new tt(this))),this.subscribing=!1},t}(nt);var en=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new tn(e,this.selector,this.caught))},e}(),tn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.selector=n,i.caught=r,i}return n(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle();var r=new tt(this);this.add(r);var i=rt(n,r);i!==r&&this.add(i)}},t}(nt);function nn(e,t){return it(e,t,1)}var rn=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new on(e,this.predicate,this.source))},e}(),on=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}return n(t,e),t.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},t.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t&&this.count++},t.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},t}(m);var an=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new sn(e,this.durationSelector))},e}(),sn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}return n(t,e),t.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.emitValue(),this.destination.complete()},t.prototype._tryNext=function(e,t){var n=this.durationSubscription;this.value=e,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=rt(t,new tt(this)))&&!n.closed&&this.add(this.durationSubscription=n)},t.prototype.notifyNext=function(){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){if(this.hasValue){var t=this.value,n=this.durationSubscription;n&&(this.durationSubscription=void 0,n.unsubscribe(),this.remove(n)),this.value=void 0,this.hasValue=!1,e.prototype._next.call(this,t)}},t}(nt);var cn=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new un(e,this.dueTime,this.scheduler))},e}(),un=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return n(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(ln,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},t}(m);function ln(e){e.debouncedNext()}function dn(e){return void 0===e&&(e=null),function(t){return t.lift(new hn(e))}}var hn=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new fn(e,this.defaultValue))},e}(),fn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.defaultValue=n,r.isEmpty=!0,r}return n(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(m);function pn(e){return e instanceof Date&&!isNaN(+e)}var mn=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new gn(e,this.delay,this.scheduler))},e}(),gn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return n(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(e,o)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,n=new vn(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(ae.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(ae.createComplete()),this.unsubscribe()},t}(m),vn=function(e,t){this.time=e,this.notification=t};var yn=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new bn(e,this.delayDurationSelector))},e}(),bn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}return n(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},t.prototype._next=function(e){var t=this.index++;try{var n=this.delayDurationSelector(e,t);n&&this.tryDelay(n,e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},t.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e);return-1!==t&&this.delayNotifierSubscriptions.splice(t,1),e.outerValue},t.prototype.tryDelay=function(e,t){var n=Ye(this,e,t);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},t.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},t}(He),_n=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subscriptionDelay=n,r}return n(t,e),t.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new En(e,this.source))},t}(S),En=function(e){function t(t,n){var r=e.call(this)||this;return r.parent=t,r.source=n,r.sourceSubscribed=!1,r}return n(t,e),t.prototype._next=function(e){this.subscribeToSource()},t.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},t.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},t.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},t}(m);var Sn=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new wn(e))},e}(),wn=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype._next=function(e){e.observe(this.destination)},t}(m);var Tn=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new An(e,this.keySelector,this.flushes))},e}(),An=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=n,i.values=new Set,r&&i.add(rt(r,new tt(i))),i}return n(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t,n=this.destination;try{t=this.keySelector(e)}catch(e){return void n.error(e)}this._finalizeNext(t,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(nt);function Rn(e,t){return function(n){return n.lift(new xn(e,t))}}var xn=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new In(e,this.compare,this.keySelector))},e}(),In=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return n(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(e){return this.destination.error(e)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(e){return this.destination.error(e)}else this.hasKey=!0;r||(this.key=t,this.destination.next(e))},t}(m);function On(e){return void 0===e&&(e=Nn),function(t){return t.lift(new Cn(e))}}var Cn=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new Mn(e,this.errorFactory))},e}(),Mn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.errorFactory=n,r.hasValue=!1,r}return n(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(m);function Nn(){return new Le}function Ln(e){return function(t){return 0===e?Q():t.lift(new kn(e))}}var kn=function(){function e(e){if(this.total=e,this.total<0)throw new Ne}return e.prototype.call=function(e,t){return t.subscribe(new Pn(e,this.total))},e}(),Pn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return n(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(m);var Dn=function(){function e(e,t,n){this.predicate=e,this.thisArg=t,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new Un(e,this.predicate,this.thisArg,this.source))},e}(),Un=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.predicate=n,o.thisArg=r,o.source=i,o.index=0,o.thisArg=r||o,o}return n(t,e),t.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},t.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t||this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(m);var Fn=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new jn(e))},e}(),jn=function(e){function t(t){var n=e.call(this,t)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}return n(t,e),t.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=!0,this.add(rt(e,new tt(this))))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(nt);var Bn=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Vn(e,this.project))},e}(),Vn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}return n(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.hasSubscription=!0,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new tt(this),n=this.destination;n.add(t);var r=rt(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(nt);var Gn=function(){function e(e,t,n){this.project=e,this.concurrent=t,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new Hn(e,this.project,this.concurrent,this.scheduler))},e}(),Hn=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.project=n,o.concurrent=r,o.scheduler=i,o.index=0,o.active=0,o.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(o.buffer=[]),o}return n(t,e),t.dispatch=function(e){var t=e.subscriber,n=e.result,r=e.value,i=e.index;t.subscribeToProjection(n,r,i)},t.prototype._next=function(e){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(e);try{var i=(0,this.project)(e,r);if(this.scheduler){var o={subscriber:this,result:i,value:e,index:r};this.destination.add(this.scheduler.schedule(t.dispatch,0,o))}else this.subscribeToProjection(i,e,r)}catch(e){n.error(e)}}else this.buffer.push(e)}},t.prototype.subscribeToProjection=function(e,t,n){this.active++,this.destination.add(rt(e,new tt(this)))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this._next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e&&e.length>0&&this._next(e.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},t}(nt);var zn=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new Wn(e,this.callback))},e}(),Wn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.add(new h(n)),r}return n(t,e),t}(m);var qn=function(){function e(e,t,n,r){this.predicate=e,this.source=t,this.yieldIndex=n,this.thisArg=r}return e.prototype.call=function(e,t){return t.subscribe(new Xn(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}(),Xn=function(e){function t(t,n,r,i,o){var a=e.call(this,t)||this;return a.predicate=n,a.source=r,a.yieldIndex=i,a.thisArg=o,a.index=0,a}return n(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete(),this.unsubscribe()},t.prototype._next=function(e){var t=this.predicate,n=this.thisArg,r=this.index++;try{t.call(n||this,e,r,this.source)&&this.notifyComplete(this.yieldIndex?r:e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},t}(m);var Jn=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Yn(e))},e}(),Yn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype._next=function(e){},t}(m);var Kn=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Qn(e))},e}(),Qn=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(m);function Zn(e){return function(t){return 0===e?Q():t.lift(new $n(e))}}var $n=function(){function e(e){if(this.total=e,this.total<0)throw new Ne}return e.prototype.call=function(e,t){return t.subscribe(new er(e,this.total))},e}(),er=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.ring=new Array,r.count=0,r}return n(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()},t}(m);var tr=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new nr(e,this.value))},e}(),nr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.value=n,r}return n(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(m);var rr=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new ir(e))},e}(),ir=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype._next=function(e){this.destination.next(ae.createNext(e))},t.prototype._error=function(e){var t=this.destination;t.next(ae.createError(e)),t.complete()},t.prototype._complete=function(){var e=this.destination;e.next(ae.createComplete()),e.complete()},t}(m);function or(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new ar(e,t,n))}}var ar=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new sr(e,this.accumulator,this.seed,this.hasSeed))},e}(),sr=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.accumulator=n,o._seed=r,o.hasSeed=i,o.index=0,o}return n(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(e){this.destination.error(e)}this.seed=t,this.destination.next(t)},t}(m);function cr(e,t){return arguments.length>=2?function(n){return _(or(e,t),Zn(1),dn(t))(n)}:function(t){return _(or((function(t,n,r){return e(t,n,r+1)})),Zn(1))(t)}}var ur=function(){function e(e,t,n){this.accumulator=e,this.seed=t,this.concurrent=n}return e.prototype.call=function(e,t){return t.subscribe(new lr(e,this.accumulator,this.seed,this.concurrent))},e}(),lr=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.accumulator=n,o.acc=r,o.concurrent=i,o.hasValue=!1,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return n(t,e),t.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,n=this.destination,r=void 0;try{r=(0,this.accumulator)(this.acc,e,t)}catch(e){return n.error(e)}this.active++,this._innerSub(r)}else this.buffer.push(e)},t.prototype._innerSub=function(e){var t=new tt(this),n=this.destination;n.add(t);var r=rt(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},t.prototype.notifyNext=function(e){var t=this.destination;this.acc=e,this.hasValue=!0,t.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},t}(nt);function dr(e,t){return function(n){var r;if(r="function"==typeof e?e:function(){return e},"function"==typeof t)return n.lift(new hr(r,t));var i=Object.create(n,k);return i.source=n,i.subjectFactory=r,i}}var hr=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(e);return i.add(t.subscribe(r)),i},e}();var fr=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,t){return t.subscribe(new pr(e,this.nextSources))},e}(),pr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.nextSources=n,r}return n(t,e),t.prototype.notifyError=function(){this.subscribeToNextSource()},t.prototype.notifyComplete=function(){this.subscribeToNextSource()},t.prototype._error=function(e){this.subscribeToNextSource(),this.unsubscribe()},t.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},t.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();if(e){var t=new tt(this),n=this.destination;n.add(t);var r=rt(e,t);r!==t&&n.add(r)}else this.destination.complete()},t}(nt);var mr=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new gr(e))},e}(),gr=function(e){function t(t){var n=e.call(this,t)||this;return n.hasPrev=!1,n}return n(t,e),t.prototype._next=function(e){var t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)},t}(m);function vr(e,t){return function(n){for(var r=n,i=0;i<t;i++){var o=null!=r?r[e[i]]:void 0;if(void 0===o)return;r=o}return r}}var yr=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new br(e,this.count,this.source))},e}(),br=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return n(t,e),t.prototype.complete=function(){if(!this.isStopped){var t=this.source,n=this.count;if(0===n)return e.prototype.complete.call(this);n>-1&&(this.count=n-1),t.subscribe(this._unsubscribeAndRecycle())}},t}(m);var _r=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new Er(e,this.notifier,t))},e}(),Er=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}return n(t,e),t.prototype.notifyNext=function(){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},t.prototype.notifyComplete=function(){if(!1===this.sourceIsBeingSubscribedTo)return e.prototype.complete.call(this)},t.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return e.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next(void 0)}},t.prototype._unsubscribe=function(){var e=this.notifications,t=this.retriesSubscription;e&&(e.unsubscribe(),this.notifications=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype._unsubscribeAndRecycle=function(){var t=this._unsubscribe;return this._unsubscribe=null,e.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=t,this},t.prototype.subscribeToRetries=function(){var t;this.notifications=new x;try{t=(0,this.notifier)(this.notifications)}catch(t){return e.prototype.complete.call(this)}this.retries=t,this.retriesSubscription=rt(t,new tt(this))},t}(nt);var Sr=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new wr(e,this.count,this.source))},e}(),wr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return n(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return e.prototype.error.call(this,t);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(m);var Tr=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Ar(e,this.notifier,this.source))},e}(),Ar=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i}return n(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.errors=void 0,this.retriesSubscription=void 0;else{n=new x;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}i=rt(r,new tt(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(nt);var Rr=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new xr(e),r=t.subscribe(n);return r.add(rt(this.notifier,new tt(n))),r},e}(),xr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasValue=!1,t}return n(t,e),t.prototype._next=function(e){this.value=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},t}(nt);var Ir=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Or(e,this.period,this.scheduler))},e}(),Or=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.period=n,i.scheduler=r,i.hasValue=!1,i.add(r.schedule(Cr,n,{subscriber:i,period:n})),i}return n(t,e),t.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},t}(m);function Cr(e){var t=e.subscriber,n=e.period;t.notifyNext(),this.schedule(e,n)}var Mr=function(){function e(e,t){this.compareTo=e,this.comparator=t}return e.prototype.call=function(e,t){return t.subscribe(new Nr(e,this.compareTo,this.comparator))},e}(),Nr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.compareTo=n,i.comparator=r,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(n.subscribe(new Lr(t,i))),i}return n(t,e),t.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())},t.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},t.prototype.checkValues=function(){for(var e=this,t=e._a,n=e._b,r=e.comparator;t.length>0&&n.length>0;){var i=t.shift(),o=n.shift(),a=!1;try{a=r?r(i,o):i===o}catch(e){this.destination.error(e)}a||this.emit(!1)}},t.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())},t.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},t}(m),Lr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.parent=n,r}return n(t,e),t.prototype._next=function(e){this.parent.nextB(e)},t.prototype._error=function(e){this.parent.error(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},t}(m);function kr(){return new x}var Pr=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Dr(e,this.predicate,this.source))},e}(),Dr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}return n(t,e),t.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},t.prototype._next=function(e){var t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)},t.prototype.tryNext=function(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new Le)},t}(m);var Ur=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new Fr(e,this.total))},e}(),Fr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return n(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},t}(m);var jr=function(){function e(e){if(this._skipCount=e,this._skipCount<0)throw new Ne}return e.prototype.call=function(e,t){return 0===this._skipCount?t.subscribe(new m(e)):t.subscribe(new Br(e,this._skipCount))},e}(),Br=function(e){function t(t,n){var r=e.call(this,t)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}return n(t,e),t.prototype._next=function(e){var t=this._skipCount,n=this._count++;if(n<t)this._ring[n]=e;else{var r=n%t,i=this._ring,o=i[r];i[r]=e,this.destination.next(o)}},t}(m);var Vr=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new Gr(e,this.notifier))},e}(),Gr=function(e){function t(t,n){var r=e.call(this,t)||this;r.hasValue=!1;var i=new tt(r);r.add(i),r.innerSubscription=i;var o=rt(n,i);return o!==i&&(r.add(o),r.innerSubscription=o),r}return n(t,e),t.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},t.prototype.notifyNext=function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},t.prototype.notifyComplete=function(){},t}(nt);var Hr=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new zr(e,this.predicate))},e}(),zr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}return n(t,e),t.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},t.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(e){this.destination.error(e)}},t}(m);var Wr=function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=Se);var i=e.call(this)||this;return i.source=t,i.delayTime=n,i.scheduler=r,(!mt(n)||n<0)&&(i.delayTime=0),r&&"function"==typeof r.schedule||(i.scheduler=Se),i}return n(t,e),t.create=function(e,n,r){return void 0===n&&(n=0),void 0===r&&(r=Se),new t(e,n,r)},t.dispatch=function(e){var t=e.source,n=e.subscriber;return this.add(t.subscribe(n))},t.prototype._subscribe=function(e){var n=this.delayTime,r=this.source;return this.scheduler.schedule(t.dispatch,n,{source:r,subscriber:e})},t}(S);var qr=function(){function e(e,t){this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return new Wr(t,this.delay,this.scheduler).subscribe(e)},e}();function Xr(e,t){return"function"==typeof t?function(n){return n.pipe(Xr((function(n,r){return et(e(n,r)).pipe(Pe((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new Jr(e))}}var Jr=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Yr(e,this.project))},e}(),Yr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}return n(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this._innerSub(t)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe();var n=new tt(this),r=this.destination;r.add(n),this.innerSubscription=rt(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(nt);var Kr=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new Qr(e),r=rt(this.notifier,new tt(n));return r&&!n.seenValue?(n.add(r),t.subscribe(n)):n},e}(),Qr=function(e){function t(t){var n=e.call(this,t)||this;return n.seenValue=!1,n}return n(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(nt);var Zr=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new $r(e,this.predicate,this.inclusive))},e}(),$r=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.inclusive=r,i.index=0,i}return n(t,e),t.prototype._next=function(e){var t,n=this.destination;try{t=this.predicate(e,this.index++)}catch(e){return void n.error(e)}this.nextOrComplete(e,t)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;Boolean(t)?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(m);var ei=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new ti(e,this.nextOrObserver,this.error,this.complete))},e}(),ti=function(e){function t(t,n,r,o){var a=e.call(this,t)||this;return a._tapNext=Me,a._tapError=Me,a._tapComplete=Me,a._tapError=r||Me,a._tapComplete=o||Me,i(n)?(a._context=a,a._tapNext=n):n&&(a._context=n,a._tapNext=n.next||Me,a._tapError=n.error||Me,a._tapComplete=n.complete||Me),a}return n(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(m),ni={leading:!0,trailing:!1};var ri=function(){function e(e,t,n){this.durationSelector=e,this.leading=t,this.trailing=n}return e.prototype.call=function(e,t){return t.subscribe(new ii(e,this.durationSelector,this.leading,this.trailing))},e}(),ii=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}return n(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._hasValue,t=this._sendValue;e&&(this.destination.next(t),this.throttle(t)),this._hasValue=!1,this._sendValue=void 0},t.prototype.throttle=function(e){var t=this.tryDurationSelector(e);t&&this.add(this._throttled=rt(t,new tt(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()},t}(nt);var oi=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new ai(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),ai=function(e){function t(t,n,r,i,o){var a=e.call(this,t)||this;return a.duration=n,a.scheduler=r,a.leading=i,a.trailing=o,a._hasTrailingValue=!1,a._trailingValue=null,a}return n(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(si,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(m);function si(e){e.subscriber.clearThrottle()}var ci=function(e,t){this.value=e,this.interval=t};function ui(e,t,n){return void 0===n&&(n=Te),function(r){var i=pn(e),o=i?+e-n.now():Math.abs(e);return r.lift(new li(o,i,t,n))}}var li=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new di(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),di=function(e){function t(t,n,r,i,o){var a=e.call(this,t)||this;return a.absoluteTimeout=n,a.waitFor=r,a.withObservable=i,a.scheduler=o,a.scheduleTimeout(),a}return n(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(rt(t,new tt(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(nt);var hi=function(e,t){this.value=e,this.timestamp=t};function fi(e,t,n){return 0===n?[t]:(e.push(t),e)}var pi=function(){function e(e){this.windowBoundaries=e}return e.prototype.call=function(e,t){var n=new mi(e),r=t.subscribe(n);return r.closed||n.add(rt(this.windowBoundaries,new tt(n))),r},e}(),mi=function(e){function t(t){var n=e.call(this,t)||this;return n.window=new x,t.next(n.window),n}return n(t,e),t.prototype.notifyNext=function(){this.openWindow()},t.prototype.notifyError=function(e){this._error(e)},t.prototype.notifyComplete=function(){this._complete()},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e)},t.prototype._complete=function(){this.window.complete(),this.destination.complete()},t.prototype._unsubscribe=function(){this.window=null},t.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,n=this.window=new x;t.next(n)},t}(nt);var gi=function(){function e(e,t){this.windowSize=e,this.startWindowEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new vi(e,this.windowSize,this.startWindowEvery))},e}(),vi=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.destination=t,i.windowSize=n,i.startWindowEvery=r,i.windows=[new x],i.count=0,t.next(i.windows[0]),i}return n(t,e),t.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,o=i.length,a=0;a<o&&!this.closed;a++)i[a].next(e);var s=this.count-r+1;if(s>=0&&s%t==0&&!this.closed&&i.shift().complete(),++this.count%t==0&&!this.closed){var c=new x;i.push(c),n.next(c)}},t.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},t.prototype._unsubscribe=function(){this.count=0,this.windows=null},t}(m);var yi=function(){function e(e,t,n,r){this.windowTimeSpan=e,this.windowCreationInterval=t,this.maxWindowSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new _i(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},e}(),bi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._numberOfNextedValues=0,t}return n(t,e),t.prototype.next=function(t){this._numberOfNextedValues++,e.prototype.next.call(this,t)},Object.defineProperty(t.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),t}(x),_i=function(e){function t(t,n,r,i,o){var a=e.call(this,t)||this;a.destination=t,a.windowTimeSpan=n,a.windowCreationInterval=r,a.maxWindowSize=i,a.scheduler=o,a.windows=[];var s=a.openWindow();if(null!==r&&r>=0){var c={subscriber:a,window:s,context:null},u={windowTimeSpan:n,windowCreationInterval:r,subscriber:a,scheduler:o};a.add(o.schedule(wi,n,c)),a.add(o.schedule(Si,r,u))}else{var l={subscriber:a,window:s,windowTimeSpan:n};a.add(o.schedule(Ei,n,l))}return a}return n(t,e),t.prototype._next=function(e){for(var t=this.windows,n=t.length,r=0;r<n;r++){var i=t[r];i.closed||(i.next(e),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},t.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},t.prototype.openWindow=function(){var e=new bi;return this.windows.push(e),this.destination.next(e),e},t.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)},t}(m);function Ei(e){var t=e.subscriber,n=e.windowTimeSpan,r=e.window;r&&t.closeWindow(r),e.window=t.openWindow(),this.schedule(e,n)}function Si(e){var t=e.windowTimeSpan,n=e.subscriber,r=e.scheduler,i=e.windowCreationInterval,o=n.openWindow(),a=this,s={action:a,subscription:null},c={subscriber:n,window:o,context:s};s.subscription=r.schedule(wi,t,c),a.add(s.subscription),a.schedule(e,i)}function wi(e){var t=e.subscriber,n=e.window,r=e.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),t.closeWindow(n)}var Ti=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Ai(e,this.openings,this.closingSelector))},e}(),Ai=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=Ye(i,n,n)),i}return n(t,e),t.prototype._next=function(e){var t=this.contexts;if(t)for(var n=t.length,r=0;r<n;r++)t[r].window.next(e)},t.prototype._error=function(t){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var o=n[i];o.window.error(t),o.subscription.unsubscribe()}e.prototype._error.call(this,t)},t.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var n=t.length,r=-1;++r<n;){var i=t[r];i.window.complete(),i.subscription.unsubscribe()}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,n=-1;++n<t;){var r=e[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},t.prototype.notifyNext=function(e,t,n,r,i){if(e===this.openings){var o=void 0;try{o=(0,this.closingSelector)(t)}catch(e){return this.error(e)}var a=new x,s=new h,c={window:a,subscription:s};this.contexts.push(c);var u=Ye(this,o,c);u.closed?this.closeWindow(this.contexts.length-1):(u.context=c,s.add(u)),this.destination.next(a)}else this.closeWindow(this.contexts.indexOf(e))},t.prototype.notifyError=function(e){this.error(e)},t.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},t.prototype.closeWindow=function(e){if(-1!==e){var t=this.contexts,n=t[e],r=n.window,i=n.subscription;t.splice(e,1),r.complete(),i.unsubscribe()}},t}(He);var Ri=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new xi(e,this.closingSelector))},e}(),xi=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.closingSelector=n,r.openWindow(),r}return n(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow(i)},t.prototype.notifyError=function(e){this._error(e)},t.prototype.notifyComplete=function(e){this.openWindow(e)},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},t.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},t.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},t.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var n,r=this.window=new x;this.destination.next(r);try{n=(0,this.closingSelector)()}catch(e){return this.destination.error(e),void this.window.error(e)}this.add(this.closingNotification=Ye(this,n))},t}(He);var Ii=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new Oi(e,this.observables,this.project))},e}(),Oi=function(e){function t(t,n,r){var i=e.call(this,t)||this;i.observables=n,i.project=r,i.toRespond=[];var o=n.length;i.values=new Array(o);for(var a=0;a<o;a++)i.toRespond.push(a);for(a=0;a<o;a++){var s=n[a];i.add(Ye(i,s,void 0,a))}return i}return n(t,e),t.prototype.notifyNext=function(e,t,n){this.values[n]=t;var r=this.toRespond;if(r.length>0){var i=r.indexOf(n);-1!==i&&r.splice(i,1)}},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(He);var Ci=Object.freeze({audit:Dt,auditTime:function(e,t){return void 0===t&&(t=Te),Dt((function(){return It(e,t)}))},buffer:function(e){return function(t){return t.lift(new jt(e))}},bufferCount:function(e,t){return void 0===t&&(t=null),function(n){return n.lift(new Vt(e,t))}},bufferTime:function(e){var t=arguments.length,n=Te;Z(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],t--);var r=null;t>=2&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return t>=3&&(i=arguments[2]),function(t){return t.lift(new zt(e,r,i,n))}},bufferToggle:function(e,t){return function(n){return n.lift(new Kt(e,t))}},bufferWhen:function(e){return function(t){return t.lift(new Zt(e))}},catchError:function(e){return function(t){var n=new en(e),r=t.lift(n);return n.caught=r}},combineAll:function(e){return function(t){return t.lift(new Qe(e))}},combineLatest:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&u(e[0])&&(e=e[0].slice()),function(t){return t.lift.call(et([t].concat(e)),new Qe(n))}},concat:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(lt.apply(void 0,[t].concat(e)))}},concatAll:ut,concatMap:nn,concatMapTo:function(e,t){return nn((function(){return e}),t)},count:function(e){return function(t){return t.lift(new rn(e,t))}},debounce:function(e){return function(t){return t.lift(new an(e))}},debounceTime:function(e,t){return void 0===t&&(t=Te),function(n){return n.lift(new cn(e,t))}},defaultIfEmpty:dn,delay:function(e,t){void 0===t&&(t=Te);var n=pn(e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new mn(n,t))}},delayWhen:function(e,t){return t?function(n){return new _n(n,t).lift(new yn(e))}:function(t){return t.lift(new yn(e))}},dematerialize:function(){return function(e){return e.lift(new Sn)}},distinct:function(e,t){return function(n){return n.lift(new Tn(e,t))}},distinctUntilChanged:Rn,distinctUntilKeyChanged:function(e,t){return Rn((function(n,r){return t?t(n[e],r[e]):n[e]===r[e]}))},elementAt:function(e,t){if(e<0)throw new Ne;var n=arguments.length>=2;return function(r){return r.pipe(Et((function(t,n){return n===e})),Ln(1),n?dn(t):On((function(){return new Ne})))}},endWith:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return lt(t,re.apply(void 0,e))}},every:function(e,t){return function(n){return n.lift(new Dn(e,t,n))}},exhaust:function(){return function(e){return e.lift(new Fn)}},exhaustMap:function e(t,n){return n?function(r){return r.pipe(e((function(e,r){return et(t(e,r)).pipe(Pe((function(t,i){return n(e,t,r,i)})))})))}:function(e){return e.lift(new Bn(t))}},expand:function(e,t,n){return void 0===t&&(t=Number.POSITIVE_INFINITY),t=(t||0)<1?Number.POSITIVE_INFINITY:t,function(r){return r.lift(new Gn(e,t,n))}},filter:Et,finalize:function(e){return function(t){return t.lift(new zn(e))}},find:function(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return function(n){return n.lift(new qn(e,n,!1,t))}},findIndex:function(e,t){return function(n){return n.lift(new qn(e,n,!0,t))}},first:function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Et((function(t,n){return e(t,n,r)})):b,Ln(1),n?dn(t):On((function(){return new Le})))}},groupBy:function(e,t,n,r){return function(i){return i.lift(new D(e,t,n,r))}},ignoreElements:function(){return function(e){return e.lift(new Jn)}},isEmpty:function(){return function(e){return e.lift(new Kn)}},last:function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Et((function(t,n){return e(t,n,r)})):b,Zn(1),n?dn(t):On((function(){return new Le})))}},map:Pe,mapTo:function(e){return function(t){return t.lift(new tr(e))}},materialize:function(){return function(e){return e.lift(new rr)}},max:function(e){return cr("function"==typeof e?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t})},merge:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(vt.apply(void 0,[t].concat(e)))}},mergeAll:ct,mergeMap:it,flatMap:st,mergeMapTo:function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?it((function(){return e}),t,n):("number"==typeof t&&(n=t),it((function(){return e}),n))},mergeScan:function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return r.lift(new ur(e,t,n))}},min:function(e){return cr("function"==typeof e?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t})},multicast:dr,observeOn:function(e,t){return void 0===t&&(t=0),function(n){return n.lift(new se(e,t))}},onErrorResumeNext:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length&&u(e[0])&&(e=e[0]),function(t){return t.lift(new fr(e))}},pairwise:function(){return function(e){return e.lift(new mr)}},partition:function(e,t){return function(n){return[Et(e,t)(n),Et(_t(e,t))(n)]}},pluck:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(t){return Pe(vr(e,n))(t)}},publish:function(e){return e?dr((function(){return new x}),e):dr(new x)},publishBehavior:function(e){return function(t){return dr(new V(e))(t)}},publishLast:function(){return function(e){return dr(new he)(e)}},publishReplay:function(e,t,n,r){n&&"function"!=typeof n&&(r=n);var i="function"==typeof n?n:void 0,o=new le(e,t,r);return function(e){return dr((function(){return o}),i)(e)}},race:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return 1===e.length&&u(e[0])&&(e=e[0]),t.lift.call(Tt.apply(void 0,[t].concat(e)))}},reduce:cr,repeat:function(e){return void 0===e&&(e=-1),function(t){return 0===e?Q():e<0?t.lift(new yr(-1,t)):t.lift(new yr(e-1,t))}},repeatWhen:function(e){return function(t){return t.lift(new _r(e))}},retry:function(e){return void 0===e&&(e=-1),function(t){return t.lift(new Sr(e,t))}},retryWhen:function(e){return function(t){return t.lift(new Tr(e,t))}},refCount:O,sample:function(e){return function(t){return t.lift(new Rr(e))}},sampleTime:function(e,t){return void 0===t&&(t=Te),function(n){return n.lift(new Ir(e,t))}},scan:or,sequenceEqual:function(e,t){return function(n){return n.lift(new Mr(e,t))}},share:function(){return function(e){return O()(dr(kr)(e))}},shareReplay:function(e,t,n){var r;return r=e&&"object"==typeof e?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n},function(e){return e.lift(function(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=e.windowTime,a=void 0===o?Number.POSITIVE_INFINITY:o,s=e.refCount,c=e.scheduler,u=0,l=!1,d=!1;return function(e){var r;u++,!t||l?(l=!1,t=new le(i,a,c),r=t.subscribe(this),n=e.subscribe({next:function(e){t.next(e)},error:function(e){l=!0,t.error(e)},complete:function(){d=!0,n=void 0,t.complete()}})):r=t.subscribe(this),this.add((function(){u--,r.unsubscribe(),n&&!d&&s&&0===u&&(n.unsubscribe(),n=void 0,t=void 0)}))}}(r))}},single:function(e){return function(t){return t.lift(new Pr(e,t))}},skip:function(e){return function(t){return t.lift(new Ur(e))}},skipLast:function(e){return function(t){return t.lift(new jr(e))}},skipUntil:function(e){return function(t){return t.lift(new Vr(e))}},skipWhile:function(e){return function(t){return t.lift(new Hr(e))}},startWith:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return Z(n)?(e.pop(),function(t){return lt(e,t,n)}):function(t){return lt(e,t)}},subscribeOn:function(e,t){return void 0===t&&(t=0),function(n){return n.lift(new qr(e,t))}},switchAll:function(){return Xr(b)},switchMap:Xr,switchMapTo:function(e,t){return t?Xr((function(){return e}),t):Xr((function(){return e}))},take:Ln,takeLast:Zn,takeUntil:function(e){return function(t){return t.lift(new Kr(e))}},takeWhile:function(e,t){return void 0===t&&(t=!1),function(n){return n.lift(new Zr(e,t))}},tap:function(e,t,n){return function(r){return r.lift(new ei(e,t,n))}},throttle:function(e,t){return void 0===t&&(t=ni),function(n){return n.lift(new ri(e,!!t.leading,!!t.trailing))}},throttleTime:function(e,t,n){return void 0===t&&(t=Te),void 0===n&&(n=ni),function(r){return r.lift(new oi(e,t,n.leading,n.trailing))}},throwIfEmpty:On,timeInterval:function(e){return void 0===e&&(e=Te),function(t){return dt((function(){return t.pipe(or((function(t,n){var r=t.current;return{value:n,current:e.now(),last:r}}),{current:e.now(),value:void 0,last:void 0}),Pe((function(e){var t=e.current,n=e.last,r=e.value;return new ci(r,t-n)})))}))}},timeout:function(e,t){return void 0===t&&(t=Te),ui(e,ie(new ke),t)},timeoutWith:ui,timestamp:function(e){return void 0===e&&(e=Te),Pe((function(t){return new hi(t,e.now())}))},toArray:function(){return cr(fi,[])},window:function(e){return function(t){return t.lift(new pi(e))}},windowCount:function(e,t){return void 0===t&&(t=0),function(n){return n.lift(new gi(e,t))}},windowTime:function(e){var t=Te,n=null,r=Number.POSITIVE_INFINITY;return Z(arguments[3])&&(t=arguments[3]),Z(arguments[2])?t=arguments[2]:mt(arguments[2])&&(r=Number(arguments[2])),Z(arguments[1])?t=arguments[1]:mt(arguments[1])&&(n=Number(arguments[1])),function(i){return i.lift(new yi(e,n,r,t))}},windowToggle:function(e,t){return function(n){return n.lift(new Ti(e,t))}},windowWhen:function(e){return function(t){return t.lift(new Ri(e))}},withLatestFrom:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;"function"==typeof e[e.length-1]&&(n=e.pop());var r=e;return t.lift(new Ii(r,n))}},zip:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(Ct.apply(void 0,[t].concat(e)))}},zipAll:function(e){return function(t){return t.lift(new Mt(e))}}}),Mi=function(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.subscribedFrame=e,this.unsubscribedFrame=t},Ni=function(){function e(){this.subscriptions=[]}return e.prototype.logSubscribedFrame=function(){return this.subscriptions.push(new Mi(this.scheduler.now())),this.subscriptions.length-1},e.prototype.logUnsubscribedFrame=function(e){var t=this.subscriptions,n=t[e];t[e]=new Mi(n.subscribedFrame,this.scheduler.now())},e}();function Li(e,t){for(var n=0,r=t.length;n<r;n++)for(var i=t[n],o=Object.getOwnPropertyNames(i.prototype),a=0,s=o.length;a<s;a++){var c=o[a];e.prototype[c]=i.prototype[c]}}var ki=function(e){function t(t,n){var r=e.call(this,(function(e){var t=this,n=t.logSubscribedFrame(),r=new h;return r.add(new h((function(){t.logUnsubscribedFrame(n)}))),t.scheduleMessages(e),r}))||this;return r.messages=t,r.subscriptions=[],r.scheduler=n,r}return n(t,e),t.prototype.scheduleMessages=function(e){for(var t=this.messages.length,n=0;n<t;n++){var r=this.messages[n];e.add(this.scheduler.schedule((function(e){var t=e.message,n=e.subscriber;t.notification.observe(n)}),r.frame,{message:r,subscriber:e}))}},t}(S);Li(ki,[Ni]);var Pi=function(e){function t(t,n){var r=e.call(this)||this;return r.messages=t,r.subscriptions=[],r.scheduler=n,r}return n(t,e),t.prototype._subscribe=function(t){var n=this,r=n.logSubscribedFrame(),i=new h;return i.add(new h((function(){n.logUnsubscribedFrame(r)}))),i.add(e.prototype._subscribe.call(this,t)),i},t.prototype.setup=function(){for(var e=this,t=e.messages.length,n=0;n<t;n++)!function(){var t=e.messages[n];e.scheduler.schedule((function(){t.notification.observe(e)}),t.frame)}()},t}(x);Li(Pi,[Ni]);var Di=function(e){function t(t){var n=e.call(this,Ce,750)||this;return n.assertDeepEqual=t,n.hotObservables=[],n.coldObservables=[],n.flushTests=[],n.runMode=!1,n}return n(t,e),t.prototype.createTime=function(e){var n=e.indexOf("|");if(-1===n)throw new Error('marble diagram for time should have a completion marker "|"');return n*t.frameTimeFactor},t.prototype.createColdObservable=function(e,n,r){if(-1!==e.indexOf("^"))throw new Error('cold observable cannot have subscription offset "^"');if(-1!==e.indexOf("!"))throw new Error('cold observable cannot have unsubscription marker "!"');var i=t.parseMarbles(e,n,r,void 0,this.runMode),o=new ki(i,this);return this.coldObservables.push(o),o},t.prototype.createHotObservable=function(e,n,r){if(-1!==e.indexOf("!"))throw new Error('hot observable cannot have unsubscription marker "!"');var i=t.parseMarbles(e,n,r,void 0,this.runMode),o=new Pi(i,this);return this.hotObservables.push(o),o},t.prototype.materializeInnerObservable=function(e,t){var n=this,r=[];return e.subscribe((function(e){r.push({frame:n.frame-t,notification:ae.createNext(e)})}),(function(e){r.push({frame:n.frame-t,notification:ae.createError(e)})}),(function(){r.push({frame:n.frame-t,notification:ae.createComplete()})})),r},t.prototype.expectObservable=function(e,n){var r=this;void 0===n&&(n=null);var i,o=[],a={actual:o,ready:!1},s=t.parseMarblesAsSubscriptions(n,this.runMode),c=s.subscribedFrame===Number.POSITIVE_INFINITY?0:s.subscribedFrame,u=s.unsubscribedFrame;this.schedule((function(){i=e.subscribe((function(e){var t=e;e instanceof S&&(t=r.materializeInnerObservable(t,r.frame)),o.push({frame:r.frame,notification:ae.createNext(t)})}),(function(e){o.push({frame:r.frame,notification:ae.createError(e)})}),(function(){o.push({frame:r.frame,notification:ae.createComplete()})}))}),c),u!==Number.POSITIVE_INFINITY&&this.schedule((function(){return i.unsubscribe()}),u),this.flushTests.push(a);var l=this.runMode;return{toBe:function(e,n,r){a.ready=!0,a.expected=t.parseMarbles(e,n,r,!0,l)}}},t.prototype.expectSubscriptions=function(e){var n={actual:e,ready:!1};this.flushTests.push(n);var r=this.runMode;return{toBe:function(e){var i="string"==typeof e?[e]:e;n.ready=!0,n.expected=i.map((function(e){return t.parseMarblesAsSubscriptions(e,r)}))}}},t.prototype.flush=function(){for(var t=this,n=this.hotObservables;n.length>0;)n.shift().setup();e.prototype.flush.call(this),this.flushTests=this.flushTests.filter((function(e){return!e.ready||(t.assertDeepEqual(e.actual,e.expected),!1)}))},t.parseMarblesAsSubscriptions=function(e,t){var n=this;if(void 0===t&&(t=!1),"string"!=typeof e)return new Mi(Number.POSITIVE_INFINITY);for(var r,i=e.length,o=-1,a=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,c=0,u=function(i){var u=c,d=function(e){u+=e*n.frameTimeFactor},h=e[i];switch(h){case" ":t||d(1);break;case"-":d(1);break;case"(":o=c,d(1);break;case")":o=-1,d(1);break;case"^":if(a!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");a=o>-1?o:c,d(1);break;case"!":if(s!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");s=o>-1?o:c;break;default:if(t&&h.match(/^[0-9]$/)&&(0===i||" "===e[i-1])){var f=e.slice(i).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(f){i+=f[0].length-1;var p=parseFloat(f[1]),m=void 0;switch(f[2]){case"ms":m=p;break;case"s":m=1e3*p;break;case"m":m=1e3*p*60}d(m/l.frameTimeFactor);break}}throw new Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+h+"'.")}c=u,r=i},l=this,d=0;d<i;d++)u(d),d=r;return s<0?new Mi(a):new Mi(a,s)},t.parseMarbles=function(e,t,n,r,i){var o=this;if(void 0===r&&(r=!1),void 0===i&&(i=!1),-1!==e.indexOf("!"))throw new Error('conventional marble diagrams cannot have the unsubscription marker "!"');for(var a,s=e.length,c=[],u=i?e.replace(/^[ ]+/,"").indexOf("^"):e.indexOf("^"),l=-1===u?0:u*-this.frameTimeFactor,d="object"!=typeof t?function(e){return e}:function(e){return r&&t[e]instanceof ki?t[e].messages:t[e]},h=-1,f=function(t){var r=l,s=function(e){r+=e*o.frameTimeFactor},u=void 0,f=e[t];switch(f){case" ":i||s(1);break;case"-":case"^":s(1);break;case"(":h=l,s(1);break;case")":h=-1,s(1);break;case"|":u=ae.createComplete(),s(1);break;case"#":u=ae.createError(n||"error"),s(1);break;default:if(i&&f.match(/^[0-9]$/)&&(0===t||" "===e[t-1])){var m=e.slice(t).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(m){t+=m[0].length-1;var g=parseFloat(m[1]),v=void 0;switch(m[2]){case"ms":v=g;break;case"s":v=1e3*g;break;case"m":v=1e3*g*60}s(v/p.frameTimeFactor);break}}u=ae.createNext(d(f)),s(1)}u&&c.push({frame:h>-1?h:l,notification:u}),l=r,a=t},p=this,m=0;m<s;m++)f(m),m=a;return c},t.prototype.run=function(e){var n=t.frameTimeFactor,r=this.maxFrames;t.frameTimeFactor=1,this.maxFrames=Number.POSITIVE_INFINITY,this.runMode=!0,q.delegate=this;var i={cold:this.createColdObservable.bind(this),hot:this.createHotObservable.bind(this),flush:this.flush.bind(this),expectObservable:this.expectObservable.bind(this),expectSubscriptions:this.expectSubscriptions.bind(this)};try{var o=e(i);return this.flush(),o}finally{t.frameTimeFactor=n,this.maxFrames=r,this.runMode=!1,q.delegate=void 0}},t}(Oe),Ui=Object.freeze({TestScheduler:Di}),Fi="undefined"!=typeof window&&window,ji="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Bi="undefined"!=typeof global&&global,Vi=Fi||Bi||ji;function Gi(e,t){return void 0===t&&(t=null),new Yi({method:"GET",url:e,headers:t})}function Hi(e,t,n){return new Yi({method:"POST",url:e,body:t,headers:n})}function zi(e,t){return new Yi({method:"DELETE",url:e,headers:t})}function Wi(e,t,n){return new Yi({method:"PUT",url:e,body:t,headers:n})}function qi(e,t,n){return new Yi({method:"PATCH",url:e,body:t,headers:n})}!function(){if(!Vi)throw new Error("RxJS could not find any global context (window, self, global)")}();var Xi=Pe((function(e,t){return e.response}));function Ji(e,t){return Xi(new Yi({method:"GET",url:e,responseType:"json",headers:t}))}var Yi=function(e){function t(t){var n=e.call(this)||this,r={async:!0,createXHR:function(){return this.crossDomain?function(){if(Vi.XMLHttpRequest)return new Vi.XMLHttpRequest;if(Vi.XDomainRequest)return new Vi.XDomainRequest;throw new Error("CORS is not supported by your browser")}():function(){if(Vi.XMLHttpRequest)return new Vi.XMLHttpRequest;var e=void 0;try{for(var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=0;n<3;n++)try{if(e=t[n],new Vi.ActiveXObject(e))break}catch(e){}return new Vi.ActiveXObject(e)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!0,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof t)r.url=t;else for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return n.request=r,n}var r;return n(t,e),t.prototype._subscribe=function(e){return new Ki(e,this.request)},t.create=((r=function(e){return new t(e)}).get=Gi,r.post=Hi,r.delete=zi,r.put=Wi,r.patch=qi,r.getJSON=Ji,r),t}(S),Ki=function(e){function t(t,n){var r=e.call(this,t)||this;r.request=n,r.done=!1;var i=n.headers=n.headers||{};return n.crossDomain||r.getHeader(i,"X-Requested-With")||(i["X-Requested-With"]="XMLHttpRequest"),r.getHeader(i,"Content-Type")||Vi.FormData&&n.body instanceof Vi.FormData||void 0===n.body||(i["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),n.body=r.serializeBody(n.body,r.getHeader(n.headers,"Content-Type")),r.send(),r}return n(t,e),t.prototype.next=function(e){this.done=!0;var t,n=this,r=n.xhr,i=n.request,o=n.destination;try{t=new Qi(e,r,i)}catch(e){return o.error(e)}o.next(t)},t.prototype.send=function(){var e=this.request,t=this.request,n=t.user,r=t.method,i=t.url,o=t.async,a=t.password,s=t.headers,c=t.body;try{var u=this.xhr=e.createXHR();this.setupEvents(u,e),n?u.open(r,i,o,n,a):u.open(r,i,o),o&&(u.timeout=e.timeout,u.responseType=e.responseType),"withCredentials"in u&&(u.withCredentials=!!e.withCredentials),this.setHeaders(u,s),c?u.send(c):u.send()}catch(e){this.error(e)}},t.prototype.serializeBody=function(e,t){if(!e||"string"==typeof e)return e;if(Vi.FormData&&e instanceof Vi.FormData)return e;if(t){var n=t.indexOf(";");-1!==n&&(t=t.substring(0,n))}switch(t){case"application/x-www-form-urlencoded":return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&");case"application/json":return JSON.stringify(e);default:return e}},t.prototype.setHeaders=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n])},t.prototype.getHeader=function(e,t){for(var n in e)if(n.toLowerCase()===t.toLowerCase())return e[n]},t.prototype.setupEvents=function(e,t){var n=t.progressSubscriber;function r(e){var t,n=r,i=n.subscriber,o=n.progressSubscriber,a=n.request;o&&o.error(e);try{t=new eo(this,a)}catch(e){t=e}i.error(t)}if(e.ontimeout=r,r.request=t,r.subscriber=this,r.progressSubscriber=n,e.upload&&"withCredentials"in e){var i,o;if(n)i=function(e){i.progressSubscriber.next(e)},Vi.XDomainRequest?e.onprogress=i:e.upload.onprogress=i,i.progressSubscriber=n;o=function(e){var t,n=o,r=n.progressSubscriber,i=n.subscriber,a=n.request;r&&r.error(e);try{t=new Zi("ajax error",this,a)}catch(e){t=e}i.error(t)},e.onerror=o,o.request=t,o.subscriber=this,o.progressSubscriber=n}function a(e){}function s(e){var t=s,n=t.subscriber,r=t.progressSubscriber,i=t.request;if(4===this.readyState){var o=1223===this.status?204:this.status,a="text"===this.responseType?this.response||this.responseText:this.response;if(0===o&&(o=a?200:0),o<400)r&&r.complete(),n.next(e),n.complete();else{r&&r.error(e);var c=void 0;try{c=new Zi("ajax error "+o,this,i)}catch(e){c=e}n.error(c)}}}e.onreadystatechange=a,a.subscriber=this,a.progressSubscriber=n,a.request=t,e.onload=s,s.subscriber=this,s.progressSubscriber=n,s.request=t},t.prototype.unsubscribe=function(){var t=this.done,n=this.xhr;!t&&n&&4!==n.readyState&&"function"==typeof n.abort&&n.abort(),e.prototype.unsubscribe.call(this)},t}(m),Qi=function(e,t,n){this.originalEvent=e,this.xhr=t,this.request=n,this.status=t.status,this.responseType=t.responseType||n.responseType,this.response=$i(this.responseType,t)},Zi=function(){function e(e,t,n){return Error.call(this),this.message=e,this.name="AjaxError",this.xhr=t,this.request=n,this.status=t.status,this.responseType=t.responseType||n.responseType,this.response=$i(this.responseType,t),this}return e.prototype=Object.create(Error.prototype),e}();function $i(e,t){switch(e){case"json":return function(e){return"response"in e?e.responseType?e.response:JSON.parse(e.response||e.responseText||"null"):JSON.parse(e.responseText||"null")}(t);case"xml":return t.responseXML;default:return"response"in t?t.response:t.responseText}}var eo=function(e,t){return Zi.call(this,"ajax timeout",e,t),this.name="AjaxTimeoutError",this},to=Yi.create,no=Object.freeze({ajax:to,AjaxResponse:Qi,AjaxError:Zi,AjaxTimeoutError:eo}),ro={url:"",deserializer:function(e){return JSON.parse(e.data)},serializer:function(e){return JSON.stringify(e)}},io=function(e){function t(t,n){var i=e.call(this)||this;if(t instanceof S)i.destination=n,i.source=t;else{var o=i._config=r({},ro);if(i._output=new x,"string"==typeof t)o.url=t;else for(var a in t)t.hasOwnProperty(a)&&(o[a]=t[a]);if(!o.WebSocketCtor&&WebSocket)o.WebSocketCtor=WebSocket;else if(!o.WebSocketCtor)throw new Error("no WebSocket constructor can be found");i.destination=new le}return i}return n(t,e),t.prototype.lift=function(e){var n=new t(this._config,this.destination);return n.operator=e,n.source=this,n},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new le),this._output=new x},t.prototype.multiplex=function(e,t,n){var r=this;return new S((function(i){try{r.next(e())}catch(e){i.error(e)}var o=r.subscribe((function(e){try{n(e)&&i.next(e)}catch(e){i.error(e)}}),(function(e){return i.error(e)}),(function(){return i.complete()}));return function(){try{r.next(t())}catch(e){i.error(e)}o.unsubscribe()}}))},t.prototype._connectSocket=function(){var e=this,t=this._config,n=t.WebSocketCtor,r=t.protocol,i=t.url,o=t.binaryType,a=this._output,s=null;try{s=r?new n(i,r):new n(i),this._socket=s,o&&(this._socket.binaryType=o)}catch(e){return void a.error(e)}var c=new h((function(){e._socket=null,s&&1===s.readyState&&s.close()}));s.onopen=function(t){if(!e._socket)return s.close(),void e._resetState();var n=e._config.openObserver;n&&n.next(t);var r=e.destination;e.destination=m.create((function(t){if(1===s.readyState)try{var n=e._config.serializer;s.send(n(t))}catch(t){e.destination.error(t)}}),(function(t){var n=e._config.closingObserver;n&&n.next(void 0),t&&t.code?s.close(t.code,t.reason):a.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),e._resetState()}),(function(){var t=e._config.closingObserver;t&&t.next(void 0),s.close(),e._resetState()})),r&&r instanceof le&&c.add(r.subscribe(e.destination))},s.onerror=function(t){e._resetState(),a.error(t)},s.onclose=function(t){e._resetState();var n=e._config.closeObserver;n&&n.next(t),t.wasClean?a.complete():a.error(t)},s.onmessage=function(t){try{var n=e._config.deserializer;a.next(n(t))}catch(e){a.error(e)}}},t.prototype._subscribe=function(e){var t=this,n=this.source;return n?n.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add((function(){var e=t._socket;0===t._output.observers.length&&(e&&1===e.readyState&&e.close(),t._resetState())})),e)},t.prototype.unsubscribe=function(){var t=this._socket;t&&1===t.readyState&&t.close(),this._resetState(),e.prototype.unsubscribe.call(this)},t}(I);var oo=Ci,ao=Ui,so=no,co=Object.freeze({webSocket:function(e){return new io(e)},WebSocketSubject:io}),uo=Object.freeze({fromFetch:function(e,t){void 0===t&&(t={});var n=t.selector,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n}(t,["selector"]);return new S((function(t){var o,a=new AbortController,s=a.signal,c=!0,u=!1,l=new h;if(l.add((function(){u=!0,c&&a.abort()})),i){if(i.signal)if(i.signal.aborted)a.abort();else{var d=i.signal,f=function(){s.aborted||a.abort()};d.addEventListener("abort",f),l.add((function(){return d.removeEventListener("abort",f)}))}o=r({},i,{signal:s})}else o={signal:s};return fetch(e,o).then((function(e){n?l.add(et(n(e)).subscribe((function(e){return t.next(e)}),(function(e){c=!1,u||t.error(e)}),(function(){c=!1,t.complete()}))):(c=!1,t.next(e),t.complete())})).catch((function(e){c=!1,u||t.error(e)})),l}))}});e.operators=oo,e.testing=ao,e.ajax=so,e.webSocket=co,e.fetch=uo,e.Observable=S,e.ConnectableObservable=L,e.GroupedObservable=j,e.observable=y,e.Subject=x,e.BehaviorSubject=V,e.ReplaySubject=le,e.AsyncSubject=he,e.asap=Se,e.asapScheduler=Ee,e.async=Te,e.asyncScheduler=we,e.queue=Y,e.queueScheduler=J,e.animationFrame=Ie,e.animationFrameScheduler=xe,e.VirtualTimeScheduler=Oe,e.VirtualAction=Ce,e.Scheduler=W,e.Subscription=h,e.Subscriber=m,e.Notification=ae,e.pipe=_,e.noop=Me,e.identity=b,e.isObservable=function(e){return!!e&&(e instanceof S||"function"==typeof e.lift&&"function"==typeof e.subscribe)},e.ArgumentOutOfRangeError=Ne,e.EmptyError=Le,e.ObjectUnsubscribedError=T,e.UnsubscriptionError=d,e.TimeoutError=ke,e.bindCallback=function e(t,n,r){if(n){if(!Z(n))return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return e(t,r).apply(void 0,i).pipe(Pe((function(e){return u(e)?n.apply(void 0,e):n(e)})))};r=n}return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i,o=this,a={context:o,subject:i,callbackFunc:t,scheduler:r};return new S((function(n){if(r){var s={args:e,subscriber:n,params:a};return r.schedule(Fe,0,s)}if(!i){i=new he;try{t.apply(o,e.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.next(e.length<=1?e[0]:e),i.complete()}]))}catch(e){v(i)?i.error(e):console.warn(e)}}return i.subscribe(n)}))}},e.bindNodeCallback=function e(t,n,r){if(n){if(!Z(n))return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return e(t,r).apply(void 0,i).pipe(Pe((function(e){return u(e)?n.apply(void 0,e):n(e)})))};r=n}return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i={subject:void 0,args:e,callbackFunc:t,scheduler:r,context:this};return new S((function(n){var o=i.context,a=i.subject;if(r)return r.schedule(Be,0,{params:i,subscriber:n,context:o});if(!a){a=i.subject=new he;try{t.apply(o,e.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.shift();n?a.error(n):(a.next(e.length<=1?e[0]:e),a.complete())}]))}catch(e){v(a)?a.error(e):console.warn(e)}}return a.subscribe(n)}))}},e.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=void 0,r=void 0;return Z(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&u(e[0])&&(e=e[0]),ne(e,r).lift(new Qe(n))},e.concat=lt,e.defer=dt,e.empty=Q,e.forkJoin=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(u(n))return ht(n,null);if(l(n)&&Object.getPrototypeOf(n)===Object.prototype){var r=Object.keys(n);return ht(r.map((function(e){return n[e]})),r)}}if("function"==typeof e[e.length-1]){var i=e.pop();return ht(e=1===e.length&&u(e[0])?e[0]:e,null).pipe(Pe((function(e){return i.apply(void 0,e)})))}return ht(e,null)},e.from=et,e.fromEvent=function e(t,n,r,o){return i(r)&&(o=r,r=void 0),o?e(t,n,r).pipe(Pe((function(e){return u(e)?o.apply(void 0,e):o(e)}))):new S((function(e){ft(t,n,(function(t){arguments.length>1?e.next(Array.prototype.slice.call(arguments)):e.next(t)}),e,r)}))},e.fromEventPattern=function e(t,n,r){return r?e(t,n).pipe(Pe((function(e){return u(e)?r.apply(void 0,e):r(e)}))):new S((function(e){var r,o=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1===t.length?t[0]:t)};try{r=t(o)}catch(t){return void e.error(t)}if(i(n))return function(){return n(o,r)}}))},e.generate=function(e,t,n,r,i){var o,a;if(1==arguments.length){var s=e;a=s.initialState,t=s.condition,n=s.iterate,o=s.resultSelector||b,i=s.scheduler}else void 0===r||Z(r)?(a=e,o=b,i=r):(a=e,o=r);return new S((function(e){var r=a;if(i)return i.schedule(pt,0,{subscriber:e,iterate:n,condition:t,resultSelector:o,state:r});for(;;){if(t){var s=void 0;try{s=t(r)}catch(t){return void e.error(t)}if(!s){e.complete();break}}var c=void 0;try{c=o(r)}catch(t){return void e.error(t)}if(e.next(c),e.closed)break;try{r=n(r)}catch(t){return void e.error(t)}}}))},e.iif=function(e,t,n){return void 0===t&&(t=K),void 0===n&&(n=K),dt((function(){return e()?t:n}))},e.interval=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=Te),(!mt(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=Te),new S((function(n){return n.add(t.schedule(gt,e,{subscriber:n,counter:0,period:e})),n}))},e.merge=vt,e.never=function(){return yt},e.of=re,e.onErrorResumeNext=function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(0===t.length)return K;var r=t[0],i=t.slice(1);return 1===t.length&&u(r)?e.apply(void 0,r):new S((function(t){var n=function(){return t.add(e.apply(void 0,i).subscribe(t))};return et(r).subscribe({next:function(e){t.next(e)},error:n,complete:n})}))},e.pairs=function(e,t){return new S(t?function(n){var r=Object.keys(e),i=new h;return i.add(t.schedule(bt,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i}:function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})},e.partition=function(e,t,n){return[Et(t,n)(new S(Je(e))),Et(_t(t,n))(new S(Je(e)))]},e.race=Tt,e.range=function(e,t,n){return void 0===e&&(e=0),new S((function(r){void 0===t&&(t=e,e=0);var i=0,o=e;if(n)return n.schedule(xt,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(o++),r.closed)break}}))},e.throwError=ie,e.timer=It,e.using=function(e,t){return new S((function(n){var r,i;try{r=e()}catch(e){return void n.error(e)}try{i=t(r)}catch(e){return void n.error(e)}var o=(i?et(i):K).subscribe(n);return function(){o.unsubscribe(),r&&r.unsubscribe()}}))},e.zip=Ct,e.scheduled=$e,e.EMPTY=K,e.NEVER=yt,e.config=a,Object.defineProperty(e,"__esModule",{value:!0})}));
/**
 * @license rxcomp v1.0.0-beta.21
 * (c) 2022 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
var rxcomp=function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t,n){return u=c()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&s(i,n.prototype),i},u.apply(null,arguments)}function l(e){var t="function"==typeof Map?new Map:void 0;return l=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,a(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)},l(e)}var d={},h={},f=function(){var e=n.prototype;function n(){this.rxcompId=-1,this.unsubscribe$=new t.Subject,this.changes$=new t.ReplaySubject(1)}return e.onInit=function(){},e.onChanges=function(e){},e.onView=function(){},e.onDestroy=function(){},e.pushChanges=function(){p(this).module.instances&&(this.changes$.next(this),this.onView())},e.onParentDidChange=function(e){p(this).module.resolveInputsOutputs(this,e),this.onChanges(e),this.pushChanges()},n.getInputsTokens=function(e,t,n){var r,i={};return null==(r=this.meta.inputs)||r.forEach((function(e){var r=n.resolveAttribute(e,t);r&&(i[e]=r)})),i},n}();function p(e){return d[e.rxcompId]}f.meta=void 0;var m=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t}(f),g=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).class="",t.keys=[],t}o(t,e);var n=t.prototype;return n.onInit=function(){var e=this,t=p(this).node;Array.prototype.slice.call(t.classList).forEach((function(t){e.keys.push(t)}))},n.onChanges=function(){var e=p(this).node,t=[],n=this.class;if("object"==typeof n)for(var r in n)n[r]&&t.push(r);else"string"==typeof n&&(t=n.split(/\s+/));t=t.concat(this.keys),e.setAttribute("class",t.join(" "))},t}(m);g.meta={selector:"[[class]]",inputs:["class"]};var v=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t}(l(Error)),y=function(e){function t(t,n,r,i,o){var a,s="ExpressionError in "+r.constructor.name+' "'+i+'"\n\t\t'+t.message;(a=e.call(this,s)||this).module=void 0,a.instance=void 0,a.expression=void 0,a.params=void 0,a.template=void 0,a.name=t.name,a.module=n,a.instance=r,a.expression=i,a.params=o;var c=p(r).node;return a.template=c.outerHTML,a}return o(t,e),t}(l(Error)),b=function(){function e(e,t){this.next=void 0,this.interceptor=void 0,this.next=e,this.interceptor=t}return e.prototype.handle=function(e){return this.interceptor.intercept(e,this.next)},e}(),_=function(){function e(){}return e.prototype.handle=function(e){return t.of(e)},e}(),E=[],S=new t.ReplaySubject(1),w=S.pipe(n.switchMap((function(e){return E.reduceRight((function(e,t){return new b(e,t)}),new _).handle(e)})),n.tap((function(e){e&&console.error(e)}))),T=function(e){function r(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).event="",t}return o(r,e),r.prototype.onInit=function(){var e=p(this),r=e.module,i=e.node,o=e.parentInstance,a=e.selector,s=this.event=a.replace(/\[|\]|\(|\)/g,""),c=t.fromEvent(i,s).pipe(n.shareReplay(1)),u=i.getAttribute("("+s+")");if(u){var l=r.makeFunction(u,["$event"]);c.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){r.resolve(l,o,e)}))}else o[s+"$"]=c},r}(m);T.meta={selector:"[("+["mousedown","mouseup","mousemove","click","dblclick","mouseover","mouseout","mouseenter","mouseleave","contextmenu","touchstart","touchmove","touchend","keydown","keyup","input","change","loaded"].join(")],[(")+")]"};var A=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t}(f),R=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.pushChanges=function(){var e=p(this),t=e.module,n=e.node;t.instances&&(this.changes$.next(this),t.parse(n,this),this.onView())},t}(f),x=["constructor","rxcompId","onInit","onChanges","onDestroy","pushChanges","changes$","unsubscribe$"],I=function(e){function t(n,r){var i;return void 0===r&&(r={}),i=e.call(this)||this,r=t.mergeDescriptors(n,n,r),r=t.mergeDescriptors(Object.getPrototypeOf(n),n,r),Object.defineProperties(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i),r),i}o(t,e);var n=t.prototype;return n.pushChanges=function(){var t=this,n=p(this);n.keys||(n.keys=Object.keys(n.parentInstance).filter((function(e){return-1===x.indexOf(e)}))),n.module.instances&&n.keys.forEach((function(e){t[e]=n.parentInstance[e]})),e.prototype.pushChanges.call(this)},n.onParentDidChange=function(e){this.onChanges(e),this.pushChanges()},t.mergeDescriptors=function(e,t,n){void 0===n&&(n={});for(var r=Object.getOwnPropertyNames(e),i=function(){var i=r.shift();if(-1===x.indexOf(i)&&!n.hasOwnProperty(i)){var o=Object.getOwnPropertyDescriptor(e,i);"function"==typeof o.value&&(o.value=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t[i].apply(t,n)}),n[i]=o}};r.length;)i();return n},t}(R),O=function(e){function t(t,n,r,i,o,a,s){var c;return(c=e.call(this,s)||this).index=void 0,c.count=void 0,c[t]=n,c[r]=i,c.index=o,c.count=a,c}return o(t,e),i(t,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),t}(I),C=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).instances=[],t.forbegin=void 0,t.forend=void 0,t.tokens=void 0,t}o(t,e);var n=t.prototype;return n.onInit=function(){var e=p(this).node,t=this.forbegin=document.createComment("*for begin");t.rxcompId=e.rxcompId,e.parentNode.replaceChild(t,e);var n=this.forend=document.createComment("*for end");t.parentNode.insertBefore(n,t.nextSibling),e.removeAttribute("*for")},n.onChanges=function(){for(var e=p(this),t=e.module,n=e.node,r=this.tokens,i=this.for||[],o=Array.isArray(i),a=o?i:Object.keys(i),s=a.length,c=this.instances.length,u=0;u<Math.max(c,s);u++)if(u<s){var l=o?u:a[u],d=o?a[l]:i[l];if(u<c){var h=this.instances[u];h[r.key]=l,h[r.value]=d}else{var f=n.cloneNode(!0);delete f.rxcompId,this.forend.parentNode.insertBefore(f,this.forend);var m=[r.key,l,r.value,d,u,s,e.parentInstance],g=t.makeInstance(f,O,e.selector,e.parentInstance,m,void 0,!0);g&&(t.compile(f,g),t.makeInstanceSubscription(g,e.parentInstance),this.instances.push(g))}}else{var v=p(this.instances[u]).node;v.parentNode.removeChild(v),t.remove(v)}this.instances.length=a.length},t.getInputsTokens=function(e,n,r){var i={},o=n.getAttribute("*for");if(o){var a=t.getForExpressionTokens(o);e.tokens=a,i.for=a.iterable}return i},t.getForExpressionTokens=function(e){if(null===e)throw new Error("invalid for");if(-1===e.trim().indexOf("let ")||-1===e.trim().indexOf(" of "))throw new Error("invalid for");var t=e.split(";").map((function(e){return e.trim()})).filter((function(e){return""!==e})),n=t[0].split(" of ").map((function(e){return e.trim()})),r=n[0].replace(/\s*let\s*/,""),i=n[1],o="index",a=r.match(/\[(.+)\s*,\s*(.+)\]/);if(a&&(o=a[1],r=a[2]),t.length>1){var s=t[1].split(/\s*let\s*|\s*=\s*index/).map((function(e){return e.trim()}));3===s.length&&(o=s[1])}return{key:o,value:r,iterable:i}},t}(A);C.meta={selector:"[*for]",inputs:["for"]};var M=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),i(t,[{key:"target",get:function(){return this.target_},set:function(e){if(this.target_!==e){this.target_=e;var t=p(this).node;e?t.setAttribute("target",e):t.removeAttribute("target")}}}]),t}(m);M.meta={selector:"[[target]]",inputs:["target"]};var N=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),i(t,[{key:"href",get:function(){return this.href_},set:function(e){if(this.href_!==e){this.href_=e;var t=p(this).node;e?t.setAttribute("href",e):t.removeAttribute("href")}}}]),t}(m);N.meta={selector:"[[href]]",inputs:["href"]};var L=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).ifbegin=void 0,t.ifend=void 0,t.clonedNode=void 0,t.element=void 0,t}o(t,e);var n=t.prototype;return n.onInit=function(){var e=p(this).node,t=this.ifbegin=document.createComment("*if begin");t.rxcompId=e.rxcompId,e.parentNode.replaceChild(t,e);var n=this.ifend=document.createComment("*if end");t.parentNode.insertBefore(n,t.nextSibling);var r=e.cloneNode(!0);r.removeAttribute("*if"),this.clonedNode=r,this.element=r.cloneNode(!0)},n.onChanges=function(){var e=p(this).module,t=this.element;if(Boolean(this.if)){if(!t.parentNode){var n=this.ifend;n.parentNode.insertBefore(t,n),e.compile(t)}}else t.parentNode&&(e.remove(t,this),t.parentNode.removeChild(t),this.element=this.clonedNode.cloneNode(!0))},t}(A);L.meta={selector:"[*if]",inputs:["if"]};var k=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),i(t,[{key:"innerHTML",get:function(){return this.innerHTML_},set:function(e){this.innerHTML_!==e&&(this.innerHTML_=e,p(this).node.innerHTML=null==e?"":e)}}]),t}(m);k.meta={selector:"[innerHTML]",inputs:["innerHTML"]};var P=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).active=!1,t}return o(t,e),t.prototype.onToggle=function(){this.active=!this.active,this.pushChanges()},t}(R);P.meta={selector:"json-component",inputs:["item"],template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ json </span>\n\t\t\t\t\t<span *if="active">- json </span>\n\t\t\t\t\t<span [innerHTML]="item"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item">\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item | json"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var D=function(){function e(){}return e.transform=function(e){return e},e}();D.meta=void 0;var U=[A,R,m],F=function(){function e(){}return e.bootstrap=function(e){if(!e)throw new v("missing moduleFactory");if(!e.meta)throw new v("missing moduleFactory meta");if(!e.meta.bootstrap)throw new v("missing bootstrap");if(!e.meta.bootstrap.meta)throw new v("missing bootstrap meta");if(!e.meta.bootstrap.meta.selector)throw new v("missing bootstrap meta selector");var t=this.resolveMeta(e),n=new e;return n.meta=t,t.imports.forEach((function(e){e.prototype.onInit.call(n)})),n},e.querySelector=function(e){return document.querySelector(e)},e.resolveMeta=function(e){var t=this.resolveImportedMeta(e),n=e.meta.bootstrap,r=this.querySelector(n.meta.selector);if(!r)throw new v("missing node "+n.meta.selector);var i=r.innerHTML,o=this.resolvePipes(t),a=this.resolveFactories(t);return this.sortFactories(a),a.unshift(n),{factories:a,pipes:o,selectors:this.unwrapSelectors(a),bootstrap:n,node:r,nodeInnerHTML:i,imports:e.meta.imports||[]}},e.resolveImportedMeta=function(e){var t=this,n=Object.assign({imports:[],declarations:[],pipes:[],exports:[]},e.meta);return n.imports=(e.meta.imports||[]).map((function(e){return t.resolveImportedMeta(e)})),n},e.resolvePipes=function(e,t){var n=this,r=e.imports.map((function(e){return n.resolvePipes(e,!0)})),i={};return(t?e.exports:e.declarations).filter((function(e){return e.prototype instanceof D})).forEach((function(e){return i[e.meta.name]=e})),Object.assign.apply(Object,[{}].concat(r,[i]))},e.resolveFactories=function(e,t){var n,r=this,i=e.imports.map((function(e){return r.resolveFactories(e,!0)})),o=(t?e.exports:e.declarations).filter((function(e){return e.prototype instanceof f}));return(n=Array.prototype.concat).call.apply(n,[o].concat(i))},e.sortFactories=function(e){e.sort((function(e,t){var n=U.reduce((function(t,n,r){return e.prototype instanceof n?r:t}),-1)-U.reduce((function(e,n,r){return t.prototype instanceof n?r:e}),-1);return 0===n?(e.meta.hosts?1:0)-(t.meta.hosts?1:0):n}))},e.getExpressions=function(e){var t=[];return e.replace(/\.([\w\-\_]+)|\[(.+?\]*)(\=)(.*?)\]|\[(.+?\]*)\]|([\w\-\_]+)/g,(function(e,n,r,i,o,a,s){return n&&t.push((function(e){return e.classList.contains(n)})),r&&t.push((function(e){return e.hasAttribute(r)&&e.getAttribute(r)===o||e.hasAttribute("["+r+"]")&&e.getAttribute("["+r+"]")===o})),a&&t.push((function(e){return e.hasAttribute(a)||e.hasAttribute("["+a+"]")})),s&&t.push((function(e){return e.nodeName.toLowerCase()===s.toLowerCase()})),""})),t},e.unwrapSelectors=function(e){var t=this,n=[];return e.forEach((function(e){e.meta&&e.meta.selector&&e.meta.selector.split(",").forEach((function(r){r=r.trim();var i=[],o=r.replace(/\:not\((.+?)\)/g,(function(e,n){return i=t.getExpressions(n),""})),a=t.getExpressions(o);n.push((function(t){var n=a.reduce((function(e,n){return e&&n(t)}),!0),o=i.reduce((function(e,n){return e||n(t)}),!1);return!(!n||o)&&{node:t,factory:e,selector:r}}))}))})),n},e}(),j="undefined"!=typeof window&&void 0!==window.document,B="undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("Node.js")||"undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("jsdom"),V="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,G="object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,H=V,z=!V&&j,W=G,q=function(){function e(){}return e.encode=function(e,t){return void 0===t&&(t=[X]),t.reduce((function(e,t){return t(e)}),e)},e.decode=function(e,t){return void 0===t&&(t=[Y]),t.reduce((function(e,t){return t(e)}),e)},e.encodeJson=function(e){return this.encode(e,[X])},e.decodeJson=function(e){return this.decode(e,[Y])},e.encodeBase64=function(e){return this.encode(e,[X,K])},e.decodeBase64=function(e){return this.decode(e,[Q,Y])},e}();function X(e,t,n){var r;try{var i=[],o=JSON.stringify(e,(function(e,n){if("object"==typeof n&&null!=n){if(-1!==i.indexOf(n))return t;i.push(n)}return n}),n);r=o}catch(e){}return r}function J(e,t){return function(n){return X(n,e,t)}}function Y(e){var t;if(e)try{t=JSON.parse(e)}catch(e){}return t}function K(e){var t;try{t=z?btoa(e):Buffer.from(e).toString("base64")}catch(n){t=e}return t}function Q(e){var t;try{t=z?atob(e):Buffer.from(e,"base64").toString()}catch(n){t=e}return t}var Z=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.transform=function(e){return q.encode(e,[J("#ref",2)])},t}(D);Z.meta={name:"json"};var $="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||void 0,ee=0,te=function(){function e(){this.meta=void 0,this.instances=void 0,this.unsubscribe$=new t.Subject}var r=e.prototype;return r.onInit=function(){},r.compile=function(t,n){var r,i=this;return e.querySelectorsAll(t,this.meta.selectors,[]).map((function(e){r&&r!==e.node&&(n=void 0);var t=i.makeInstance(e.node,e.factory,e.selector,n);return e.factory.prototype instanceof R&&(r=e.node),t})).filter((function(e){return void 0!==e}))},r.makeInstance=function(t,n,r,i,o,a,s){if(void 0===s&&(s=!1),i||t.parentNode){var c=n.meta;if(!(i=i||this.getParentInstance(t.parentNode)))return;var l=u(n,o||[]);a&&Object.keys(a).forEach((function(e){Object.defineProperty(l,e,{value:a[e],configurable:!1,enumerable:!1,writable:!0})}));var d=e.makeContext(this,l,i,t,n,r);return l instanceof I||(this.makeHosts(c,l,t),d.inputs=this.makeInputs(c,l,t,n),d.outputs=this.makeOutputs(c,l),this.resolveInputsOutputs(l,i)),l.onInit(),s||this.makeInstanceSubscription(l,i),l}},r.makeInstanceSubscription=function(e,t){t instanceof f&&t.changes$.pipe(n.takeUntil(e.unsubscribe$)).subscribe((function(t){e.onParentDidChange(t)}))},r.makeFunction=function(t,n){void 0===n&&(n=["$instance"]),t=e.parseExpression(t);var r="with(this) {\n\treturn (function ("+n.join(",")+", $$module) {\n\t\ttry {\n\t\t\tconst $$pipes = $$module.meta.pipes;\n\t\t\treturn "+t+";\n\t\t} catch(error) {\n\t\t\t$$module.nextError(error, this, "+JSON.stringify(t)+", arguments);\n\t\t}\n\t}.bind(this)).apply(this, arguments);\n}",i=new Function(r);return i.expression=t,i},r.resolveInputsOutputs=function(e,t){var n=p(e),r=n.parentInstance,i=n.inputs;for(var o in i){var a=i[o],s=this.resolve(a,r,e);e[o]=s}},r.resolveAttribute=function(e,t){var n=null;if(t.hasAttribute("["+e+"]"))n=t.getAttribute("["+e+"]");else if(t.hasAttribute("*"+e))n=t.getAttribute("*"+e);else if(t.hasAttribute(e)&&(n=t.getAttribute(e))){var r=n.replace(/({{)|(}})|(")/g,(function(e,t,n,r){return t?'"+':n?'+"':r?'"':""}));n='"'+r+'"'}return n},r.resolve=function(e,t,n){return e.apply(t,[n,this])},r.parse=function(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType){var i=r;ne(i)||this.parse(i,t)}else if(3===r.nodeType){var o=r;this.parseTextNode(o,t)}}},r.remove=function(t,n){var r=n?p(n):void 0;return e.traverseDown(t,(function(t){var n=t.rxcompId;n&&(0===e.deleteContext(n,r).length&&delete t.rxcompId)})),t},r.destroy=function(){this.unsubscribe$.next(),this.unsubscribe$.complete(),this.remove(this.meta.node),this.meta.node.innerHTML=this.meta.nodeInnerHTML},r.nextError=function(e,t,n,r){var i=new y(e,this,t,n,r);S.next(i)},r.makeContext=function(t,n,r,i){return e.makeContext(this,t,n,r,t.constructor,i)},r.makeHosts=function(e,t,n){e.hosts&&Object.keys(e.hosts).forEach((function(r){var i=e.hosts[r];t[r]=ie(t,i,n)}))},r.makeInputs=function(e,t,n,r){var i=this,o={},a=r.getInputsTokens(t,n,this);return Object.keys(a).forEach((function(e){o[e]=i.makeFunction(a[e])})),o},r.makeOutput=function(e,r){var i=this,o=p(e),a=o.node,s=o.parentInstance,c=a.getAttribute("("+r+")"),u=c?this.makeFunction(c,["$event"]):null,l=(new t.Subject).pipe(n.tap((function(e){u&&i.resolve(u,s,e)})));return l.pipe(n.takeUntil(e.unsubscribe$)).subscribe(),e[r]=l,l},r.makeOutputs=function(e,t){var n=this,r={};return e.outputs&&e.outputs.forEach((function(e){var i=n.makeOutput(t,e);i&&(r[e]=i)})),r},r.getInstance=function(e){if(e===document)return $;var t=re(e);return t?t.instance:void 0},r.getParentInstance=function(t){var n=this;return e.traverseUp(t,(function(e){return n.getInstance(e)}))},r.parseTextNode=function(e,t){var n=this,r=e.nodeExpressions;if(r||(r=this.parseTextNodeExpression(e.wholeText)),r.length){var i=r.reduce((function(e,r){var i;return"function"==typeof r?null==(i=n.resolve(r,t,t))&&(i=""):i=r,e+i}),"");if(e.nodeValue!==i){var o=document.createTextNode(i);o.nodeExpressions=r,e.parentNode.replaceChild(o,e)}}else e.nodeExpressions=r},r.pushFragment=function(e,t,n,r){var i=e.substring(t,n);r.push(i)},r.parseTextNodeExpression=function(e){for(var t,n=[],r=/\{{2}((([^{}])|(\{([^{}]|(\{.*?\}))+?\}))*?)\}{2}/g,i=0;null!==(t=r.exec(e));){var o=r.lastIndex-t[0].length;if(o>i&&this.pushFragment(e,o,i,n),i=r.lastIndex,t[1]){var a=this.makeFunction(t[1]);n.push(a)}}var s=e.length;return s>i&&this.pushFragment(e,i,s,n),n.find((function(e){return"function"==typeof e}))?n:[]},e.makeContext=function(e,t,n,r,i,o){t.rxcompId=++ee;var a={module:e,instance:t,parentInstance:n,node:r,factory:i,selector:o},s=r.rxcompId=r.rxcompId||t.rxcompId;return(h[s]||(h[s]=[])).push(a),d[t.rxcompId]=a,a},e.parseExpression=function(t){for(var n=/(\()([^\(\)]*)(\))/;t.match(n);)t=t.replace(n,(function(t){return""+e.parsePipes(arguments.length<=2?void 0:arguments[2])+""}));return t=(t=e.parsePipes(t)).replace(/()|()/g,(function(e){return(arguments.length<=1?void 0:arguments[1])?"(":")"})),e.parseOptionalChaining(t)},e.parsePipes=function(t){for(var n=/(.*?[^\|])\|([^\|]+)/;t.match(n);)t=t.replace(n,(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r[0].trim(),a=e.parsePipeParams(r[1]),s=a.shift().trim();return"$$pipes."+s+".transform"+[o].concat(a)+""}));return t},e.parsePipeParams=function(e){for(var t=[],n=0,r="",i=0,o=e.length;n<o;){var a=e.substr(n,1);"{"!==a&&"("!==a&&"["!==a||i++,"}"!==a&&")"!==a&&"]"!==a||i--,":"===a&&0===i?(r.length&&t.push(r.trim()),r=""):r+=a,n++}return r.length&&t.push(r.trim()),t},e.parseOptionalChaining=function(e){var t;return e=e.replace(/(\w+(\?\.))+([\.|\w]+)/g,(function(e){for(var n=e.split("?."),r=0;r<n.length-1;r++){var i=r>0?"("+n[r]+" = "+t+")":n[r],o=n[r+1];t=r>0?i+"."+o:"("+i+" ? "+i+"."+o+" : void 0)"}return t||""}))},e.deleteContext=function(e,t){var n=[],r=h[e];return r&&(r.forEach((function(e){if(e===t)n.push(t);else{var r=e.instance;r.unsubscribe$.next(),r.unsubscribe$.complete(),r.onDestroy(),delete d[r.rxcompId]}})),n.length?h[e]=n:delete h[e]),n},e.matchSelectors=function(e,t,n){for(var r=0;r<t.length;r++){var i=t[r](e);if(i){var o=i.factory;if(o.prototype instanceof R&&o.meta.template&&(e.innerHTML=o.meta.template),n.push(i),o.prototype instanceof A)break}}return n},e.querySelectorsAll=function(e,t,n){if(1===e.nodeType){var r=this.matchSelectors(e,t,[]);if(n=n.concat(r),r.find((function(e){return e.factory.prototype instanceof A})))return n;for(var i=e.childNodes,o=0;o<i.length;o++)n=this.querySelectorsAll(i[o],t,n)}return n},e.traverseUp=function(e,t,n){if(void 0===n&&(n=0),e){var r=t(e,n);return r||this.traverseUp(e.parentNode,t,n+1)}},e.traverseDown=function(e,t,n){if(void 0===n&&(n=0),e){var r=t(e,n);if(r)return r;if(1===e.nodeType)for(var i=0,o=e.childNodes.length;i<o&&!r;)r=this.traverseDown(e.childNodes[i],t,n+1),i++;return r}},e.traversePrevious=function(e,t,n){if(void 0===n&&(n=0),e){var r=t(e,n);return r||this.traversePrevious(e.previousSibling,t,n+1)}},e.traverseNext=function(e,t,n){if(void 0===n&&(n=0),e){var r=t(e,n);return r||this.traverseNext(e.nextSibling,t,n+1)}},e}();function ne(e){var t,n=e.rxcompId;if(n){var r=h[n];r&&(t=r.reduce((function(e,t){return t.instance instanceof I?e||t:t.instance instanceof R?t:e}),void 0))}return t}function re(e){var t=ne(e);if(!(t&&t.factory.prototype instanceof A))return t}function ie(e,t,n){if(n||(n=p(e).node),n.rxcompId){var r=h[n.rxcompId];if(r)for(var i=0;i<r.length;i++){var o=r[i];if(o.instance!==e&&o.instance instanceof t)return o.instance}}return n.parentNode?ie(e,t,n.parentNode):void 0}te.forRoot=void 0,te.meta=void 0;var oe=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),i(t,[{key:"src",get:function(){return this.src_},set:function(e){if(this.src_!==e){this.src_=e;var t=p(this).node;e?t.setAttribute("src",e):t.removeAttribute("src")}}}]),t}(m);oe.meta={selector:"[[src]]",inputs:["src"]};var ae=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).style=void 0,t.previousStyle=void 0,t}return o(t,e),t.prototype.onChanges=function(){var e=p(this).node,t=this.style,n=this.previousStyle;if(n)for(var r in n)if(!t||!t[r]){var i=r.split(".").shift();e.style.removeProperty(i)}if(t)for(var o in t)if(!n||n[o]!==t[o]){var a=o.split("."),s=a.shift(),c=t[o]+(a.length?a[0]:"");e.style.setProperty(s,c)}this.previousStyle=t},t}(m);ae.meta={selector:"[[style]]",inputs:["style"]};var se=[g,T,C,N,M,L,k,P,oe,ae],ce=[Z],ue=function(e){function t(){var t;return t=e.call(this)||this,w.pipe(n.takeUntil(t.unsubscribe$)).subscribe(),t}return o(t,e),t}(te);ue.meta={declarations:[].concat(se,ce),exports:[].concat(se,ce)};var le=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.bootstrap=function(e){if(!z)throw new v("missing platform browser, Window not found");if(!e)throw new v("missing moduleFactory");if(!e.meta)throw new v("missing moduleFactory meta");if(!e.meta.bootstrap)throw new v("missing bootstrap");if(!e.meta.bootstrap.meta)throw new v("missing bootstrap meta");if(!e.meta.bootstrap.meta.selector)throw new v("missing bootstrap meta selector");var t=this.resolveMeta(e),n=new e;if(n.meta=t,t.imports.forEach((function(e){e.prototype.onInit.call(n)})),$.rxcomp_hydrate_){var r,i=t.node.cloneNode();i.innerHTML=t.nodeInnerHTML=$.rxcomp_hydrate_.innerHTML;var o=n.compile(i,$);n.instances=o,o[0].pushChanges(),null==(r=t.node.parentNode)||r.replaceChild(i,t.node)}else{var a=n.compile(t.node,$);n.instances=a,a[0].pushChanges()}return n},t}(F);var de=function(){function e(){}return e.makeKey=function(e,t){var n="rxcomp-hydrate-"+e+"-"+(t?he(t):"");return n=n.replace(/(\s+)|(\W+)/g,(function(){return(arguments.length<=1?void 0:arguments[1])?"":"_"})),n},e.has=function(e){return null!==document.querySelector("#"+e)},e.get=function(e){var t=document.querySelector("#"+e);if(t&&t.firstChild){var n=t.firstChild.nodeValue;return n?q.decode(n,[Y]):void 0}},e.set=function(e,t){var n=q.encode(t,[X]);if(n){var r=document.createTextNode(n),i=document.querySelector("#"+e);i?i.replaceChild(r,i.firstChild):((i=document.createElement("script")).setAttribute("id",e),i.setAttribute("type","text/template"),i.append(r),document.head.append(i))}},e.remove=function(e){var t=document.querySelector("#"+e);t&&t.parentNode&&t.parentNode.removeChild(t)},e}();function he(e,t){return void 0===t&&(t=""),"number"==typeof e?t+="-"+e.toString():"string"==typeof e?t+="-"+e.substr(0,20):e&&Array.isArray(e)?t+="-"+e.map((function(e){return he(e)})).join(""):e&&"object"==typeof e&&(t+="-"+Object.keys(e).map((function(t){return t+he(e[t])})).join("-")),t}return e.Browser=le,e.ClassDirective=g,e.Component=R,e.Context=I,e.CoreModule=ue,e.DefaultErrorHandler=_,e.Directive=m,e.ErrorInterceptorHandler=b,e.ErrorInterceptors=E,e.EventDirective=T,e.ExpressionError=y,e.Factory=f,e.ForItem=O,e.ForStructure=C,e.HrefDirective=N,e.HrefTargetDirective=M,e.IfStructure=L,e.InnerHtmlDirective=k,e.JsonComponent=P,e.JsonPipe=Z,e.Module=te,e.ModuleError=v,e.PLATFORM_BROWSER=j,e.PLATFORM_JS_DOM=B,e.PLATFORM_NODE=V,e.PLATFORM_WEB_WORKER=G,e.Pipe=D,e.Platform=F,e.Serializer=q,e.SrcDirective=oe,e.Structure=A,e.StyleDirective=ae,e.TransferService=de,e.WINDOW=$,e.decodeBase64=Q,e.decodeJson=Y,e.encodeBase64=K,e.encodeJson=X,e.encodeJsonWithOptions=J,e.errors$=w,e.getContext=p,e.getContextByNode=re,e.getHost=ie,e.getLocationComponents=function(e){for(var t,n="",r="",i="",o="",a="",s="",c="",u=/^((http\:|https\:)?\/\/)?((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])|(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])|locahost)?(\:([^\/]+))?(\.?\/[^\?]+)?(\?[^\#]+)?(\#.+)?$/g,l=[];null!==(t=u.exec(e));)l.push(t);for(var d=0,h=l;d<h.length;d++){var f=h[d];n=f[2]||"",r=i=f[3]||"",o=f[11]||"",a=f[12]||"",s=f[13]||"",c=f[14]||""}return{href:e,protocol:n,host:r,hostname:i,port:o,pathname:a,search:s,hash:c}},e.getParsableContextByElement=ne,e.isPlatformBrowser=z,e.isPlatformServer=H,e.isPlatformWorker=W,e.nextError$=S,e.optionsToKey=he,Object.defineProperty(e,"__esModule",{value:!0}),e}({},rxjs,rxjs.operators);
/**
 * @license rxcomp-form v1.0.0-beta.18
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */this.rxcomp=this.rxcomp||{},this.rxcomp.form=function(e,t,n,r){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var s=function(e){function n(){return e.apply(this,arguments)||this}return a(n,e),n.prototype.onChanges=function(e){var n=t.getContext(this).node,r=this.control.flags;Object.keys(r).forEach((function(e){r[e]?n.classList.add(e):n.classList.remove(e)}))},o(n,[{key:"control",get:function(){return{}}}]),n}(t.Directive);s.meta={selector:"",hosts:{host:s}};var c=function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),o(t,[{key:"control",get:function(){if(this.formArray)return this.formArray;if(!this.host)throw"missing form collection";return this.host.control.get(this.formArrayName)}}]),t}(s);c.meta={selector:"[formArray],[formArrayName]",inputs:["formArray","formArrayName"],hosts:{host:s}};var u=function(e){function i(){return e.apply(this,arguments)||this}a(i,e);var s=i.prototype;return s.onInit=function(){var e=this,i=t.getContext(this).node;n.fromEvent(i,"input").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onChange(t)})),n.fromEvent(i,"change").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onChange(t)})),n.fromEvent(i,"blur").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onBlur(t)}))},s.onChanges=function(e){var n=t.getContext(this).node;this.formControlName&&(n.name=this.formControlName);var r=this.control,i=r.flags;Object.keys(i).forEach((function(e){i[e]?n.classList.add(e):n.classList.remove(e)})),this.writeValue(r.value)},s.writeValue=function(e){t.getContext(this).node.value=null==e?"":e},s.onChange=function(e){var n=t.getContext(this).node;this.control.value=""===n.value?null:n.value},s.onBlur=function(e){this.control.touched=!0},s.setDisabledState=function(e){t.getContext(this).node.disabled=e},o(i,[{key:"control",get:function(){if(this.formControl)return this.formControl;if(!this.host)throw"missing form collection";return this.host.control.get(this.formControlName)}}]),i}(t.Directive);u.meta={selector:"",inputs:["formControl","formControlName","value"],hosts:{host:s}};var l=function(e){function i(){return e.apply(this,arguments)||this}a(i,e);var o=i.prototype;return o.onInit=function(){var e=this,i=t.getContext(this).node;n.fromEvent(i,"change").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onChange(t)})),n.fromEvent(i,"blur").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onBlur(t)}))},o.writeValue=function(e){var n=t.getContext(this).node;e===this.value?n.setAttribute("checked",e):n.removeAttribute("checked")},o.setDisabledState=function(e){t.getContext(this).node.disabled=e},o.onChange=function(e){var n=t.getContext(this).node;this.control.value=n.checked?this.value:!0!==this.value&&null},o.onBlur=function(e){this.control.touched=!0},i}(u);l.meta={selector:"input[type=checkbox][formControl],input[type=checkbox][formControlName]",inputs:["formControl","formControlName","value"],hosts:{host:s}};var d=function(e){function n(){return e.apply(this,arguments)||this}return a(n,e),n.prototype.onChanges=function(e){var n=t.getContext(this).node,r=this.control.flags;Object.keys(r).forEach((function(e){r[e]?n.classList.add(e):n.classList.remove(e)}))},o(n,[{key:"control",get:function(){if(this.formField)return this.formField;if(!this.host)throw"missing form collection";return this.host.control.get(this.formFieldName)}}]),n}(t.Component);d.meta={selector:"[formField],[formFieldName]",inputs:["formField","formFieldName"],hosts:{host:s}};var h=function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),o(t,[{key:"control",get:function(){if(this.formGroup)return this.formGroup;if(!this.host)throw"missing form collection";return this.host.control.get(this.formGroupName)}}]),t}(s);h.meta={selector:"[formGroup],[formGroupName]",inputs:["formGroup","formGroupName"],hosts:{host:s}};var f=function(e){function n(){return e.apply(this,arguments)||this}a(n,e);var r=n.prototype;return r.writeValue=function(e){t.getContext(this).node.value=null==e?"":e},r.onChange=function(e){var n=t.getContext(this).node;this.control.value=""===n.value?null:n.value},r.onBlur=function(e){this.control.touched=!0},n}(u);f.meta={selector:"input[type=text][formControl],input[type=text][formControlName],input[type=email][formControl],input[type=email][formControlName],input[type=password][formControl],input[type=password][formControlName],textarea[formControl],textarea[formControlName]",inputs:["formControl","formControlName"],hosts:{host:s}};var p=function(e){function n(){return e.apply(this,arguments)||this}return a(n,e),n.prototype.onChanges=function(e){t.getContext(this).node.setAttribute("placeholder",this.placeholder||"")},n}(t.Directive);p.meta={selector:"input[placeholder],textarea[placeholder]",inputs:["placeholder"]};var m=function(e){function i(){return e.apply(this,arguments)||this}a(i,e);var o=i.prototype;return o.onInit=function(){var e=this,i=t.getContext(this).node;n.fromEvent(i,"change").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onChange(t)})),n.fromEvent(i,"blur").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onBlur(t)}))},o.writeValue=function(e){var n=t.getContext(this).node;n.checked=n.value===e},o.setDisabledState=function(e){t.getContext(this).node.disabled=e},o.onChange=function(e){var n=t.getContext(this).node;n.checked&&(this.control.value=n.value)},o.onBlur=function(e){this.control.touched=!0},i}(u);m.meta={selector:"input[type=radio][formControl],input[type=radio][formControlName]",inputs:["formControl","formControlName"],hosts:{host:s}};var g=function(e){function n(){return e.apply(this,arguments)||this}a(n,e);var r=n.prototype;return r.writeValue=function(e){t.getContext(this).node.value=null==e?"":e},r.setDisabledState=function(e){t.getContext(this).node.disabled=e},r.onChange=function(e){var n=t.getContext(this).node;this.control.value=""===n.value?null:n.value},r.onBlur=function(e){this.control.touched=!0},n}(u);g.meta={selector:"select[formControl],select[formControlName]",inputs:["formControl","formControlName"],hosts:{host:s}};var v=function(e){function i(){return e.apply(this,arguments)||this}return a(i,e),i.prototype.onInit=function(){var e=t.getContext(this),i=e.module,o=e.node,a=e.selector,s=e.parentInstance,c=this.event=a.replace(/\[|\]|\(|\)/g,""),u=o,l=this.event$=n.fromEvent(u,"submit").pipe(r.tap((function(e){e.preventDefault()})),r.shareReplay(1)),d=o.getAttribute("("+c+")");if(d){var h=i.makeFunction(d,["$event"]);l.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){i.resolve(h,s,e)}))}else s[c+"$"]=l},i}(t.Directive);v.meta={selector:"[(submit)]"};var y=function(){function e(e,t){this.validator=e,this.params$=new n.BehaviorSubject(t)}return e.prototype.validate=function(e){return this.validator(e,this.params)},o(e,[{key:"params",get:function(){return this.params$.getValue()},set:function(e){if(e){var t=this.params;Object.keys(e).reduce((function(n,r){return n||!t||t[r]!==e[r]}),!1)&&this.params$.next(e)}}}]),e}();function b(){return new y((function(e,t){return null}))}function _(){return new y((function(e,t){return null==e||0===e.length?{required:!0}:null}))}function E(){return new y((function(e,t){return!0===e?null:{required:!0}}))}function S(e){return new y((function(e,t){var n=t.min;return e&&n?(e=parseFloat(e),!isNaN(e)&&e<n?{min:{min:n,actual:e}}:null):null}),{min:e})}function w(e){return new y((function(e,t){var n=t.max;return e&&n?(e=parseFloat(e),!isNaN(e)&&e>n?{max:{max:n,actual:e}}:null):null}),{max:e})}function T(e){return new y((function(e,t){var n=t.minlength;if(!e||!n)return null;var r=e?e.length:0;return r<n?{minlength:{requiredLength:n,actualLength:r}}:null}),{minlength:e})}function A(e){return new y((function(e,t){var n=t.maxlength;if(!e||!n)return null;var r=e?e.length:0;return r>n?{minlength:{requiredLength:n,actualLength:r}}:null}),{maxlength:e})}function R(e){return new y((function(e,t){var n=t.pattern;if(!e||!n)return null;var r=function(e){var t;e instanceof RegExp?t=e:"string"==typeof e&&(e="$"===(e="^"===e.charAt(0)?e:"^"+e).charAt(e.length-1)?e:e+"$",t=new RegExp(e));return t||new RegExp("")}(n);return r.test(e)?null:{pattern:{requiredPattern:r.toString(),actualValue:e}}}),{pattern:e})}function x(){var e=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;return new y((function(t,n){return t?e.test(t)?null:{email:!0}:null}))}var I=Object.freeze({__proto__:null,NullValidator:b,RequiredValidator:_,RequiredTrueValidator:E,MinValidator:S,MaxValidator:w,MinLengthValidator:T,MaxLengthValidator:A,PatternValidator:R,EmailValidator:x}),O=function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.onInit=function(){var e=this.validator=x();this.host&&this.host.control.addValidators(e)},t}(t.Directive);O.meta={selector:"[email][formControl],[email][formControlName]",inputs:["email"],hosts:{host:u}};var C=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).maxlength=Number.POSITIVE_INFINITY,t}a(t,e);var n=t.prototype;return n.onInit=function(){this.validator=A(this.maxlength),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(e){this.validator&&(this.validator.params={maxlength:this.maxlength})},t}(t.Directive);C.meta={selector:"[maxlength][formControl],[maxlength][formControlName]",inputs:["maxlength"],hosts:{host:u}};var M=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).max=Number.POSITIVE_INFINITY,t}a(t,e);var n=t.prototype;return n.onInit=function(){this.validator=w(this.max),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(e){this.validator&&(this.validator.params={max:this.max})},t}(t.Directive);M.meta={selector:"[max][formControl],[max][formControlName]",inputs:["max"],hosts:{host:u}};var N=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).minlength=Number.NEGATIVE_INFINITY,t}a(t,e);var n=t.prototype;return n.onInit=function(){this.validator=T(this.minlength),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(e){this.validator&&(this.validator.params={minlength:this.minlength})},t}(t.Directive);N.meta={selector:"[minlength][formControl],[minlength][formControlName]",inputs:["minlength"],hosts:{host:u}};var L=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).min=Number.NEGATIVE_INFINITY,t}a(t,e);var n=t.prototype;return n.onInit=function(){this.validator=S(this.min),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(e){this.validator&&(this.validator.params={min:this.min})},t}(t.Directive);L.meta={selector:"[min][formControl],[min][formControlName]",inputs:["min"],hosts:{host:u}};var k=function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.onInit=function(){this.pattern&&(this.validator=R(this.pattern),this.host&&this.host.control.addValidators(this.validator))},n.onChanges=function(e){this.validator&&(this.validator.params={pattern:this.pattern})},t}(t.Directive);k.meta={selector:"[pattern][formControl],[pattern][formControlName]",inputs:["pattern"],hosts:{host:u}};var P=function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.onInit=function(){this.validator=E(),this.host&&this.host.control.addValidators(this.validator)},t}(t.Directive);P.meta={selector:"[requiredTrue][formControl],[requiredTrue][formControlName]",inputs:["requiredTrue"],hosts:{host:u}};var D=function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.onInit=function(){this.validator=_(),this.host&&this.host.control.addValidators(this.validator)},t}(t.Directive);D.meta={selector:"[required][formControl],[required][formControlName]",inputs:["required"],hosts:{host:u}};var U,F=[c,l,d,h,f,p,m,g,v,O,M,C,L,N,k,D,P],j=[],B=function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t}(t.Module);B.meta={declarations:[].concat(F,j),exports:[].concat(F,j)},function(e){e.Pending="pending",e.Valid="valid",e.Invalid="invalid",e.Disabled="disabled",e.Hidden="hidden"}(U||(U={}));var V=U,G=function(){function e(e){var t=this;this.value_=void 0,this.submitted_=!1,this.touched_=!1,this.dirty_=!1,this.valueSubject=new n.BehaviorSubject(null),this.statusSubject=new n.BehaviorSubject(null),this.validatorsSubject=(new n.ReplaySubject).pipe(r.switchAll()),this.value$=this.valueSubject.pipe(r.distinctUntilChanged(),r.skip(1),r.tap((function(){t.submitted_=!1,t.dirty_=!0,t.statusSubject.next(null)})),r.shareReplay(1)),this.status$=n.merge(this.statusSubject,this.validatorsSubject).pipe(r.switchMap((function(){return t.validate$(t.value)})),r.shareReplay(1)),this.changes$=n.merge(this.value$,this.status$).pipe(r.map((function(){return t.value})),r.auditTime(1),r.shareReplay(1)),this.validators=e?Array.isArray(e)?e:[e]:[]}var t=e.prototype;return t.initSubjects_=function(){this.switchValidators_()},t.switchValidators_=function(){var e=this.validators.map((function(e){return e.params$})),t=e.length?n.combineLatest(e):n.of(e);this.validatorsSubject.next(t)},t.initObservables_=function(){},t.validate$=function(e){var t=this;return this.status===V.Disabled||this.status===V.Hidden||this.submitted_||!this.validators.length?(this.errors_={},this.status===V.Invalid&&(this.status=V.Valid),n.of(this.errors_)):n.combineLatest(this.validators.map((function(t){var r=t.validate(e);return n.isObservable(r)?r:n.of(r)}))).pipe(r.map((function(e){return t.errors_=Object.assign.apply(Object,[{}].concat(e)),t.status=0===Object.keys(t.errors_).length?V.Valid:V.Invalid,t.errors_})))},t.reset=function(e){this.status=e||V.Pending,this.value_=null,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)},t.patch=function(e){this.value_=e,this.dirty_=!0,this.submitted_=!1,this.statusSubject.next(null)},t.addValidators=function(){var e;(e=this.validators).push.apply(e,arguments),this.switchValidators_()},t.replaceValidators=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.validators=t,this.switchValidators_()},t.clearValidators=function(){this.validators=[],this.switchValidators_()},o(e,[{key:"errors",get:function(){return this.errors_},set:function(e){this.errors_=e}},{key:"pending",get:function(){return this.status===V.Pending}},{key:"valid",get:function(){return this.status!==V.Invalid}},{key:"invalid",get:function(){return this.status===V.Invalid}},{key:"disabled",get:function(){return this.status===V.Disabled},set:function(e){e?this.status!==V.Disabled&&(this.status=V.Disabled,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)):this.status===V.Disabled&&(this.status=V.Pending,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null))}},{key:"enabled",get:function(){return this.status!==V.Disabled}},{key:"hidden",get:function(){return this.status===V.Hidden},set:function(e){e?this.status!==V.Hidden&&(this.status=V.Hidden,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)):this.status===V.Hidden&&(this.status=V.Pending,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null))}},{key:"visible",get:function(){return this.status!==V.Hidden}},{key:"submitted",get:function(){return this.submitted_},set:function(e){this.submitted_=e,this.statusSubject.next(null)}},{key:"dirty",get:function(){return this.dirty_}},{key:"pristine",get:function(){return!this.dirty_}},{key:"touched",get:function(){return this.touched_},set:function(e){this.touched_=e,this.statusSubject.next(null)}},{key:"untouched",get:function(){return!this.touched_}},{key:"flags",get:function(){return{untouched:this.untouched,touched:this.touched,pristine:this.pristine,dirty:this.dirty,pending:this.pending,enabled:this.enabled,disabled:this.disabled,hidden:this.hidden,visible:this.visible,valid:this.valid,invalid:this.invalid,submitted:this.submitted}}},{key:"value",get:function(){return this.value_},set:function(e){this.value_=e,this.valueSubject.next(e)}}]),e}(),H=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,n)||this).value_=t,r.status=V.Pending,r.errors={},r.initSubjects_(),r.initObservables_(),r.statusSubject.next(null),r}return a(t,e),t}(G),z=function(e){function t(t,r){var i;return(i=e.call(this,r)||this).changesChildren=new n.BehaviorSubject(void 0),i.controls=t,i.initControls_(),i.initSubjects_(),i.initObservables_(),i}a(t,e);var i=t.prototype;return i.initControl_=function(e,t){var n=e instanceof G?e:new H(e);return n.addValidators.apply(n,this.validators),n.name=t,n},i.initControls_=function(){var e=this;return this.forEach_((function(t,n){e.init(t,n)})),this.controls},i.initSubjects_=function(){this.changesChildren=this.changesChildren.pipe(r.switchAll()),this.switchSubjects_()},i.switchSubjects_=function(){var e=this.reduce_((function(e,t){return e.push(t.changes$),e}),[]),t=e.length?n.combineLatest(e):n.of(e);this.changesChildren.next(t)},i.initObservables_=function(){var e=this;this.changes$=this.changesChildren.pipe(r.map((function(){return e.value})),r.shareReplay(1))},i.validate=function(e){var t;if(this.status===V.Disabled||this.status===V.Hidden)t=[];else{var n=this.validators.map((function(t){return t.validate(e)})).filter((function(e){return null!==e}));t=this.reduce_((function(e,t){return e.concat(t.errors)}),n),this.status=0===t.length?V.Valid:V.Invalid}return t},i.forEach_=function(e){var t=this;Object.keys(this.controls).forEach((function(n){return e(t.controls[n],n)}))},i.reduce_=function(e,t){return this.forEach_((function(n,r){t=e(t,n,r)})),t},i.all_=function(e,t){return this.reduce_((function(n,r){return n&&r[e]===t}),!0)},i.any_=function(e,t){return this.reduce_((function(n,r){return n||r[e]===t}),!1)},i.reset=function(){this.forEach_((function(e){return e.reset()}))},i.patch=function(e){e&&this.forEach_((function(t,n){null!=e[n]&&t.patch(e[n])}))},i.init=function(e,t){this.controls[t]=this.initControl_(e,t)},i.get=function(e){return this.controls[e]},i.set=function(e,t){delete this.controls[t],this.controls[t]=this.initControl_(e,t),this.switchSubjects_()},i.add=function(e,t){this.controls[t]=this.initControl_(e,t),this.switchSubjects_()},i.remove=function(e){var t=this,n=Object.keys(this.controls).find((function(n){return t.controls[n]===e?n:null}));n&&this.removeKey(n)},i.removeKey=function(e){var t=void 0!==this.controls[e];delete this.controls[e],t&&this.switchSubjects_()},i.addValidators=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.forEach_((function(e){return e.addValidators.apply(e,t)}))},i.replaceValidators=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.forEach_((function(e){return e.replaceValidators.apply(e,t)}))},i.clearValidators=function(){this.forEach_((function(e){return e.clearValidators()}))},o(t,[{key:"valid",get:function(){return this.all_("valid",!0)}},{key:"invalid",get:function(){return this.any_("invalid",!0)}},{key:"pending",get:function(){return this.any_("pending",!0)}},{key:"disabled",get:function(){return this.all_("disabled",!0)},set:function(e){this.forEach_((function(t){t.disabled=e}))}},{key:"enabled",get:function(){return this.any_("enabled",!0)}},{key:"hidden",get:function(){return this.all_("hidden",!0)},set:function(e){this.forEach_((function(t){t.hidden=e}))}},{key:"visible",get:function(){return this.any_("visible",!0)}},{key:"submitted",get:function(){return this.all_("submitted",!0)},set:function(e){this.forEach_((function(t){t.submitted=e}))}},{key:"dirty",get:function(){return this.any_("dirty",!0)}},{key:"pristine",get:function(){return this.all_("pristine",!0)}},{key:"touched",get:function(){return this.all_("touched",!0)},set:function(e){this.forEach_((function(t){t.touched=e}))}},{key:"untouched",get:function(){return this.any_("untouched",!0)}},{key:"value",get:function(){return this.reduce_((function(e,t,n){return e[n]=t.value,e}),{})},set:function(e){this.forEach_((function(t,n){t.value=e[n]}))}},{key:"errors",get:function(){return this.reduce_((function(e,t){return Object.assign(e,t.errors)}),{})},set:function(e){}}]),t}(G),W=function(e){function t(t,n){return void 0===t&&(t=[]),e.call(this,t,n)||this}a(t,e);var n=t.prototype;return n.forEach_=function(e){this.controls.forEach((function(t,n){return e(t,n)}))},n.init=function(e,t){this.controls.length=Math.max(this.controls.length,t),this.controls[t]=this.initControl_(e,t)},n.set=function(e,t){this.controls.splice(t,1,this.initControl_(e,t)),this.switchSubjects_()},n.add=function(e,t){this.controls.length=Math.max(this.controls.length,t),this.controls[t]=this.initControl_(e,t),this.switchSubjects_()},n.push=function(e){this.controls.push(this.initControl_(e,this.controls.length)),this.switchSubjects_()},n.insert=function(e,t){this.controls.splice(t,0,this.initControl_(e,t)),this.switchSubjects_()},n.remove=function(e){var t=this.controls.indexOf(e);-1!==t&&this.removeKey(t)},n.removeKey=function(e){this.controls.length>e&&(this.controls.splice(e,1),this.switchSubjects_())},n.at=function(e){return this.controls[e]},o(t,[{key:"value",get:function(){return this.reduce_((function(e,t,n){return e[n]=t.value,e}),[])}},{key:"length",get:function(){return this.controls.length}}]),t}(z);var q=function(e){function t(t,n){return void 0===t&&(t={}),e.call(this,t,n)||this}return a(t,e),t}(z);return e.EmailValidator=x,e.FormAbstract=G,e.FormAbstractCollection=z,e.FormAbstractCollectionDirective=s,e.FormArray=W,e.FormArrayDirective=c,e.FormCheckboxDirective=l,e.FormControl=H,e.FormEmailDirective=O,e.FormFieldComponent=d,e.FormGroup=q,e.FormGroupDirective=h,e.FormInputDirective=f,e.FormMaxDirective=M,e.FormMaxLengthDirective=C,e.FormMinDirective=L,e.FormMinLengthDirective=N,e.FormModule=B,e.FormPatternDirective=k,e.FormPlaceholderDirective=p,e.FormRadioDirective=m,e.FormRequiredDirective=D,e.FormRequiredTrueDirective=P,e.FormSelectDirective=g,e.FormStatus=V,e.FormValidator=y,e.MaxLengthValidator=A,e.MaxValidator=w,e.MinLengthValidator=T,e.MinValidator=S,e.NullValidator=b,e.PatternValidator=R,e.RequiredTrueValidator=E,e.RequiredValidator=_,e.Validators=I,e.formArray=function(e,t){return void 0===e&&(e=[]),new W(e,t)},e.formGroup=function(e,t){return void 0===e&&(e={}),new q(e,t)},e}({},rxcomp,rxjs,rxjs.operators),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).window=e.window||{})}(this,(function(e){"use strict";
/*!
	 * EasePack 3.9.1
	 * https://greensock.com
	 *
	 * @license Copyright 2008-2021, GreenSock. All rights reserved.
	 * Subject to the terms at https://greensock.com/standard-license or for
	 * Club GreenSock members, the agreement issued with that membership.
	 * @author: Jack Doyle, jack@greensock.com
	*/var t,n,r=function(){return t||"undefined"!=typeof window&&(t=window.gsap)&&t.registerPlugin&&t},i=function(e,t){return!!(void 0===e?t:e&&!~(e+"").indexOf("false"))},o=function(e){if(t=e||r()){n=t.registerEase;var i,o=t.parseEase(),a=function(e){return function(t){var n=.5+t/2;e.config=function(t){return e(2*(1-t)*t*n+t*t)}}};for(i in o)o[i].config||a(o[i]);for(i in n("slow",l),n("expoScale",d),n("rough",h),f)"version"!==i&&t.core.globals(i,f[i])}},a=function(e,t,n){var r=(e=Math.min(1,e||.7))<1?t||0===t?t:.7:0,o=(1-e)/2,a=o+e,s=i(n);return function(e){var t=e+(.5-e)*r;return e<o?s?1-(e=1-e/o)*e:t-(e=1-e/o)*e*e*e*t:e>a?s?1===e?0:1-(e=(e-a)/o)*e:t+(e-t)*(e=(e-a)/o)*e*e*e:s?1:t}},s=function(e,n,r){var i=Math.log(n/e),o=n-e;return r&&(r=t.parseEase(r)),function(t){return(e*Math.exp(i*(r?r(t):t))-e)/o}},c=function(e,t,n){this.t=e,this.v=t,n&&(this.next=n,n.prev=this,this.c=n.v-t,this.gap=n.t-e)},u=function(e){"object"!=typeof e&&(e={points:+e||20});for(var n,r,o,a,s,u,l,d=e.taper||"none",h=[],f=0,p=0|(+e.points||20),m=p,g=i(e.randomize,!0),v=i(e.clamp),y=t?t.parseEase(e.template):0,b=.4*(+e.strength||1);--m>-1;)n=g?Math.random():1/p*m,r=y?y(n):n,o="none"===d?b:"out"===d?(a=1-n)*a*b:"in"===d?n*n*b:n<.5?(a=2*n)*a*.5*b:(a=2*(1-n))*a*.5*b,g?r+=Math.random()*o-.5*o:m%2?r+=.5*o:r-=.5*o,v&&(r>1?r=1:r<0&&(r=0)),h[f++]={x:n,y:r};for(h.sort((function(e,t){return e.x-t.x})),u=new c(1,1,null),m=p;m--;)s=h[m],u=new c(s.x,s.y,u);return l=new c(0,0,u.t?u:u.next),function(e){var t=l;if(e>t.t){for(;t.next&&e>=t.t;)t=t.next;t=t.prev}else for(;t.prev&&e<=t.t;)t=t.prev;return l=t,t.v+(e-t.t)/t.gap*t.c}},l=a(.7);l.ease=l,l.config=a;var d=s(1,2);d.config=s;var h=u();h.ease=h,h.config=u;var f={SlowMo:l,RoughEase:h,ExpoScaleEase:d};for(var p in f)f[p].register=o,f[p].version="3.9.1";r()&&t.registerPlugin(l),e.EasePack=f,e.ExpoScaleEase=d,e.RoughEase=h,e.SlowMo=l,e.default=f,Object.defineProperty(e,"__esModule",{value:!0})})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).window=e.window||{})}(this,(function(e){"use strict";function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}
/*!
   * GSAP 3.9.1
   * https://greensock.com
   *
   * @license Copyright 2008-2021, GreenSock. All rights reserved.
   * Subject to the terms at https://greensock.com/standard-license or for
   * Club GreenSock members, the agreement issued with that membership.
   * @author: Jack Doyle, jack@greensock.com
  */var r,i,o,a,s,c,u,l,d,h,f,p,m,g,v,y,b,_,E,S,w,T,A,R,x,I,O,C,M={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},N={duration:.5,overwrite:!1,delay:0},L=1e8,k=1e-8,P=2*Math.PI,D=P/4,U=0,F=Math.sqrt,j=Math.cos,B=Math.sin,V=function(e){return"string"==typeof e},G=function(e){return"function"==typeof e},H=function(e){return"number"==typeof e},z=function(e){return void 0===e},W=function(e){return"object"==typeof e},q=function(e){return!1!==e},X=function(){return"undefined"!=typeof window},J=function(e){return G(e)||V(e)},Y="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},K=Array.isArray,Q=/(?:-?\.?\d|\.)+/gi,Z=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,$=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,ee=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,te=/[+-]=-?[.\d]+/,ne=/[^,'"\[\]\s]+/gi,re=/[\d.+\-=]+(?:e[-+]\d*)*/i,ie={},oe={},ae=function(e){return(oe=Me(e,ie))&&_n},se=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},ce=function(e,t){return!t&&console.warn(e)},ue=function(e,t){return e&&(ie[e]=t)&&oe&&(oe[e]=t)||ie},le=function(){return 0},de={},he=[],fe={},pe={},me={},ge=30,ve=[],ye="",be=function(e){var t,n,r=e[0];if(W(r)||G(r)||(e=[e]),!(t=(r._gsap||{}).harness)){for(n=ve.length;n--&&!ve[n].targetTest(r););t=ve[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new Ht(e[n],t)))||e.splice(n,1);return e},_e=function(e){return e._gsap||be(ct(e))[0]._gsap},Ee=function(e,t,n){return(n=e[t])&&G(n)?e[t]():z(n)&&e.getAttribute&&e.getAttribute(t)||n},Se=function(e,t){return(e=e.split(",")).forEach(t)||e},we=function(e){return Math.round(1e5*e)/1e5||0},Te=function(e){return Math.round(1e7*e)/1e7||0},Ae=function(e,t){for(var n=t.length,r=0;e.indexOf(t[r])<0&&++r<n;);return r<n},Re=function(){var e,t,n=he.length,r=he.slice(0);for(fe={},he.length=0,e=0;e<n;e++)(t=r[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},xe=function(e,t,n,r){he.length&&Re(),e.render(t,n,r),he.length&&Re()},Ie=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(ne).length<2?t:V(e)?e.trim():e},Oe=function(e){return e},Ce=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},Me=function(e,t){for(var n in t)e[n]=t[n];return e},Ne=function e(t,n){for(var r in n)"__proto__"!==r&&"constructor"!==r&&"prototype"!==r&&(t[r]=W(n[r])?e(t[r]||(t[r]={}),n[r]):n[r]);return t},Le=function(e,t){var n,r={};for(n in e)n in t||(r[n]=e[n]);return r},ke=function(e){var t,n=e.parent||i,r=e.keyframes?(t=K(e.keyframes),function(e,n){for(var r in n)r in e||"duration"===r&&t||"ease"===r||(e[r]=n[r])}):Ce;if(q(e.inherit))for(;n;)r(e,n.vars.defaults),n=n.parent||n._dp;return e},Pe=function(e,t,n,r){void 0===n&&(n="_first"),void 0===r&&(r="_last");var i=t._prev,o=t._next;i?i._next=o:e[n]===t&&(e[n]=o),o?o._prev=i:e[r]===t&&(e[r]=i),t._next=t._prev=t.parent=null},De=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},Ue=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},Fe=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},je=function e(t){return!t||t._ts&&e(t.parent)},Be=function(e){return e._repeat?Ve(e._tTime,e=e.duration()+e._rDelay)*e:0},Ve=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},Ge=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},He=function(e){return e._end=Te(e._start+(e._tDur/Math.abs(e._ts||e._rts||k)||0))},ze=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=Te(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),He(e),n._dirty||Ue(n,e)),e},We=function(e,t){var n;if((t._time||t._initted&&!t._dur)&&(n=Ge(e.rawTime(),t),(!t._dur||rt(0,t.totalDuration(),n)-t._tTime>k)&&t.render(n,!0)),Ue(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-1e-8}},qe=function(e,t,n,r){return t.parent&&De(t),t._start=Te((H(n)?n:n||e!==i?et(e,n,t):e._time)+t._delay),t._end=Te(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),function(e,t,n,r,i){void 0===n&&(n="_first"),void 0===r&&(r="_last");var o,a=e[r];if(i)for(o=t[i];a&&a[i]>o;)a=a._prev;a?(t._next=a._next,a._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[r]=t,t._prev=a,t.parent=t._dp=e}(e,t,"_first","_last",e._sort?"_start":0),Ke(t)||(e._recent=t),r||We(e,t),e},Xe=function(e,t){return(ie.ScrollTrigger||se("scrollTrigger",t))&&ie.ScrollTrigger.create(t,e)},Je=function(e,t,n,r){return Kt(e,t),e._initted?!n&&e._pt&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&u!==Ct.frame?(he.push(e),e._lazy=[t,r],1):void 0:1},Ye=function e(t){var n=t.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||e(n))},Ke=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},Qe=function(e,t,n,r){var i=e._repeat,o=Te(t)||0,a=e._tTime/e._tDur;return a&&!r&&(e._time*=o/e._dur),e._dur=o,e._tDur=i?i<0?1e10:Te(o*(i+1)+e._rDelay*i):o,a>0&&!r?ze(e,e._tTime=e._tDur*a):e.parent&&He(e),n||Ue(e.parent,e),e},Ze=function(e){return e instanceof Wt?Ue(e):Qe(e,e._dur)},$e={_start:0,endTime:le,totalDuration:le},et=function e(t,n,r){var i,o,a,s=t.labels,c=t._recent||$e,u=t.duration()>=L?c.endTime(!1):t._dur;return V(n)&&(isNaN(n)||n in s)?(o=n.charAt(0),a="%"===n.substr(-1),i=n.indexOf("="),"<"===o||">"===o?(i>=0&&(n=n.replace(/=/,"")),("<"===o?c._start:c.endTime(c._repeat>=0))+(parseFloat(n.substr(1))||0)*(a?(i<0?c:r).totalDuration()/100:1)):i<0?(n in s||(s[n]=u),s[n]):(o=parseFloat(n.charAt(i-1)+n.substr(i+1)),a&&r&&(o=o/100*(K(r)?r[0]:r).totalDuration()),i>1?e(t,n.substr(0,i-1),r)+o:u+o)):null==n?u:+n},tt=function(e,t,n){var r,i,o=H(t[1]),a=(o?2:1)+(e<2?0:1),s=t[a];if(o&&(s.duration=t[1]),s.parent=n,e){for(r=s,i=n;i&&!("immediateRender"in r);)r=i.vars.defaults||{},i=q(i.vars.inherit)&&i.parent;s.immediateRender=q(r.immediateRender),e<2?s.runBackwards=1:s.startAt=t[a-1]}return new tn(t[0],s,t[a+1])},nt=function(e,t){return e||0===e?t(e):t},rt=function(e,t,n){return n<e?e:n>t?t:n},it=function(e,t){return V(e)&&(t=re.exec(e))?e.substr(t.index+t[0].length):""},ot=[].slice,at=function(e,t){return e&&W(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&W(e[0]))&&!e.nodeType&&e!==o},st=function(e,t,n){return void 0===n&&(n=[]),e.forEach((function(e){var r;return V(e)&&!t||at(e,1)?(r=n).push.apply(r,ct(e)):n.push(e)}))||n},ct=function(e,t,n){return!V(e)||n||!a&&Mt()?K(e)?st(e,n):at(e)?ot.call(e,0):e?[e]:[]:ot.call((t||s).querySelectorAll(e),0)},ut=function(e){return e.sort((function(){return.5-Math.random()}))},lt=function(e){if(G(e))return e;var t=W(e)?e:{each:e},n=Ft(t.ease),r=t.from||0,i=parseFloat(t.base)||0,o={},a=r>0&&r<1,s=isNaN(r)||a,c=t.axis,u=r,l=r;return V(r)?u=l={center:.5,edges:.5,end:1}[r]||0:!a&&s&&(u=r[0],l=r[1]),function(e,a,d){var h,f,p,m,g,v,y,b,_,E=(d||t).length,S=o[E];if(!S){if(!(_="auto"===t.grid?0:(t.grid||[1,L])[1])){for(y=-L;y<(y=d[_++].getBoundingClientRect().left)&&_<E;);_--}for(S=o[E]=[],h=s?Math.min(_,E)*u-.5:r%_,f=_===L?0:s?E*l/_-.5:r/_|0,y=0,b=L,v=0;v<E;v++)p=v%_-h,m=f-(v/_|0),S[v]=g=c?Math.abs("y"===c?m:p):F(p*p+m*m),g>y&&(y=g),g<b&&(b=g);"random"===r&&ut(S),S.max=y-b,S.min=b,S.v=E=(parseFloat(t.amount)||parseFloat(t.each)*(_>E?E-1:c?"y"===c?E/_:_:Math.max(_,E/_))||0)*("edges"===r?-1:1),S.b=E<0?i-E:i,S.u=it(t.amount||t.each)||0,n=n&&E<0?Dt(n):n}return E=(S[e]-S.min)/S.max||0,Te(S.b+(n?n(E):E)*S.v)+S.u}},dt=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var r=Math.round(parseFloat(n)/e)*e*t;return(r-r%1)/t+(H(n)?0:it(n))}},ht=function(e,t){var n,r,i=K(e);return!i&&W(e)&&(n=i=e.radius||L,e.values?(e=ct(e.values),(r=!H(e[0]))&&(n*=n)):e=dt(e.increment)),nt(t,i?G(e)?function(t){return r=e(t),Math.abs(r-t)<=n?r:t}:function(t){for(var i,o,a=parseFloat(r?t.x:t),s=parseFloat(r?t.y:0),c=L,u=0,l=e.length;l--;)(i=r?(i=e[l].x-a)*i+(o=e[l].y-s)*o:Math.abs(e[l]-a))<c&&(c=i,u=l);return u=!n||c<=n?e[u]:t,r||u===t||H(t)?u:u+it(t)}:dt(e))},ft=function(e,t,n,r){return nt(K(e)?!t:!0===n?!!(n=0):!r,(function(){return K(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(r=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+.99*n))/n)*n*r)/r}))},pt=function(e,t,n){return nt(n,(function(n){return e[~~t(n)]}))},mt=function(e){for(var t,n,r,i,o=0,a="";~(t=e.indexOf("random(",o));)r=e.indexOf(")",t),i="["===e.charAt(t+7),n=e.substr(t+7,r-t-7).match(i?ne:Q),a+=e.substr(o,t-o)+ft(i?n:+n[0],i?0:+n[1],+n[2]||1e-5),o=r+1;return a+e.substr(o,e.length-o)},gt=function(e,t,n,r,i){var o=t-e,a=r-n;return nt(i,(function(t){return n+((t-e)/o*a||0)}))},vt=function(e,t,n){var r,i,o,a=e.labels,s=L;for(r in a)(i=a[r]-t)<0==!!n&&i&&s>(i=Math.abs(i))&&(o=r,s=i);return o},yt=function(e,t,n){var r,i,o=e.vars,a=o[t];if(a)return r=o[t+"Params"],i=o.callbackScope||e,n&&he.length&&Re(),r?a.apply(i,r):a.call(i)},bt=function(e){return De(e),e.scrollTrigger&&e.scrollTrigger.kill(!1),e.progress()<1&&yt(e,"onInterrupt"),e},_t=function(e){var t=(e=!e.name&&e.default||e).name,n=G(e),r=t&&!n&&e.init?function(){this._props=[]}:e,i={init:le,render:dn,add:Jt,kill:fn,modifier:hn,rawVars:0},o={targetTest:0,get:0,getSetter:sn,aliases:{},register:0};if(Mt(),e!==r){if(pe[t])return;Ce(r,Ce(Le(e,i),o)),Me(r.prototype,Me(i,Le(e,o))),pe[r.prop=t]=r,e.targetTest&&(ve.push(r),de[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}ue(t,r),e.register&&e.register(_n,r,gn)},Et=255,St={aqua:[0,Et,Et],lime:[0,Et,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Et],navy:[0,0,128],white:[Et,Et,Et],olive:[128,128,0],yellow:[Et,Et,0],orange:[Et,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Et,0,0],pink:[Et,192,203],cyan:[0,Et,Et],transparent:[Et,Et,Et,0]},wt=function(e,t,n){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(n-t)*e*6:e<.5?n:3*e<2?t+(n-t)*(2/3-e)*6:t)*Et+.5|0},Tt=function(e,t,n){var r,i,o,a,s,c,u,l,d,h,f=e?H(e)?[e>>16,e>>8&Et,e&Et]:0:St.black;if(!f){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),St[e])f=St[e];else if("#"===e.charAt(0)){if(e.length<6&&(r=e.charAt(1),i=e.charAt(2),o=e.charAt(3),e="#"+r+r+i+i+o+o+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(f=parseInt(e.substr(1,6),16))>>16,f>>8&Et,f&Et,parseInt(e.substr(7),16)/255];f=[(e=parseInt(e.substr(1),16))>>16,e>>8&Et,e&Et]}else if("hsl"===e.substr(0,3))if(f=h=e.match(Q),t){if(~e.indexOf("="))return f=e.match(Z),n&&f.length<4&&(f[3]=1),f}else a=+f[0]%360/360,s=+f[1]/100,r=2*(c=+f[2]/100)-(i=c<=.5?c*(s+1):c+s-c*s),f.length>3&&(f[3]*=1),f[0]=wt(a+1/3,r,i),f[1]=wt(a,r,i),f[2]=wt(a-1/3,r,i);else f=e.match(Q)||St.transparent;f=f.map(Number)}return t&&!h&&(r=f[0]/Et,i=f[1]/Et,o=f[2]/Et,c=((u=Math.max(r,i,o))+(l=Math.min(r,i,o)))/2,u===l?a=s=0:(d=u-l,s=c>.5?d/(2-u-l):d/(u+l),a=u===r?(i-o)/d+(i<o?6:0):u===i?(o-r)/d+2:(r-i)/d+4,a*=60),f[0]=~~(a+.5),f[1]=~~(100*s+.5),f[2]=~~(100*c+.5)),n&&f.length<4&&(f[3]=1),f},At=function(e){var t=[],n=[],r=-1;return e.split(xt).forEach((function(e){var i=e.match($)||[];t.push.apply(t,i),n.push(r+=i.length+1)})),t.c=n,t},Rt=function(e,t,n){var r,i,o,a,s="",c=(e+s).match(xt),u=t?"hsla(":"rgba(",l=0;if(!c)return e;if(c=c.map((function(e){return(e=Tt(e,t,1))&&u+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"})),n&&(o=At(e),(r=n.c).join(s)!==o.c.join(s)))for(a=(i=e.replace(xt,"1").split($)).length-1;l<a;l++)s+=i[l]+(~r.indexOf(l)?c.shift()||u+"0,0,0,0)":(o.length?o:c.length?c:n).shift());if(!i)for(a=(i=e.split(xt)).length-1;l<a;l++)s+=i[l]+c[l];return s+i[a]},xt=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in St)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),It=/hsl[a]?\(/,Ot=function(e){var t,n=e.join(" ");if(xt.lastIndex=0,xt.test(n))return t=It.test(n),e[1]=Rt(e[1],t),e[0]=Rt(e[0],t,At(e[1])),!0},Ct=(y=Date.now,b=500,_=33,E=y(),S=E,T=w=1e3/240,R=function e(t){var n,r,i,o,a=y()-S,s=!0===t;if(a>b&&(E+=a-_),((n=(i=(S+=a)-E)-T)>0||s)&&(o=++m.frame,g=i-1e3*m.time,m.time=i/=1e3,T+=n+(n>=w?4:w-n),r=1),s||(h=f(e)),r)for(v=0;v<A.length;v++)A[v](i,g,o,t)},m={time:0,frame:0,tick:function(){R(!0)},deltaRatio:function(e){return g/(1e3/(e||60))},wake:function(){c&&(!a&&X()&&(o=a=window,s=o.document||{},ie.gsap=_n,(o.gsapVersions||(o.gsapVersions=[])).push(_n.version),ae(oe||o.GreenSockGlobals||!o.gsap&&o||{}),p=o.requestAnimationFrame),h&&m.sleep(),f=p||function(e){return setTimeout(e,T-1e3*m.time+1|0)},d=1,R(2))},sleep:function(){(p?o.cancelAnimationFrame:clearTimeout)(h),d=0,f=le},lagSmoothing:function(e,t){b=e||1e8,_=Math.min(t,b,0)},fps:function(e){w=1e3/(e||240),T=1e3*m.time+w},add:function(e){A.indexOf(e)<0&&A.push(e),Mt()},remove:function(e,t){~(t=A.indexOf(e))&&A.splice(t,1)&&v>=t&&v--},_listeners:A=[]}),Mt=function(){return!d&&Ct.wake()},Nt={},Lt=/^[\d.\-M][\d.\-,\s]/,kt=/["']/g,Pt=function(e){for(var t,n,r,i={},o=e.substr(1,e.length-3).split(":"),a=o[0],s=1,c=o.length;s<c;s++)n=o[s],t=s!==c-1?n.lastIndexOf(","):n.length,r=n.substr(0,t),i[a]=isNaN(r)?r.replace(kt,"").trim():+r,a=n.substr(t+1).trim();return i},Dt=function(e){return function(t){return 1-e(1-t)}},Ut=function e(t,n){for(var r,i=t._first;i;)i instanceof Wt?e(i,n):!i.vars.yoyoEase||i._yoyo&&i._repeat||i._yoyo===n||(i.timeline?e(i.timeline,n):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=n)),i=i._next},Ft=function(e,t){return e&&(G(e)?e:Nt[e]||function(e){var t,n,r,i,o=(e+"").split("("),a=Nt[o[0]];return a&&o.length>1&&a.config?a.config.apply(null,~e.indexOf("{")?[Pt(o[1])]:(t=e,n=t.indexOf("(")+1,r=t.indexOf(")"),i=t.indexOf("(",n),t.substring(n,~i&&i<r?t.indexOf(")",r+1):r)).split(",").map(Ie)):Nt._CE&&Lt.test(e)?Nt._CE("",e):a}(e))||t},jt=function(e,t,n,r){void 0===n&&(n=function(e){return 1-t(1-e)}),void 0===r&&(r=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var i,o={easeIn:t,easeOut:n,easeInOut:r};return Se(e,(function(e){for(var t in Nt[e]=ie[e]=o,Nt[i=e.toLowerCase()]=n,o)Nt[i+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=Nt[e+"."+t]=o[t]})),o},Bt=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},Vt=function e(t,n,r){var i=n>=1?n:1,o=(r||(t?.3:.45))/(n<1?n:1),a=o/P*(Math.asin(1/i)||0),s=function(e){return 1===e?1:i*Math.pow(2,-10*e)*B((e-a)*o)+1},c="out"===t?s:"in"===t?function(e){return 1-s(1-e)}:Bt(s);return o=P/o,c.config=function(n,r){return e(t,n,r)},c},Gt=function e(t,n){void 0===n&&(n=1.70158);var r=function(e){return e?--e*e*((n+1)*e+n)+1:0},i="out"===t?r:"in"===t?function(e){return 1-r(1-e)}:Bt(r);return i.config=function(n){return e(t,n)},i};Se("Linear,Quad,Cubic,Quart,Quint,Strong",(function(e,t){var n=t<5?t+1:t;jt(e+",Power"+(n-1),t?function(e){return Math.pow(e,n)}:function(e){return e},(function(e){return 1-Math.pow(1-e,n)}),(function(e){return e<.5?Math.pow(2*e,n)/2:1-Math.pow(2*(1-e),n)/2}))})),Nt.Linear.easeNone=Nt.none=Nt.Linear.easeIn,jt("Elastic",Vt("in"),Vt("out"),Vt()),x=7.5625,O=1/(I=2.75),jt("Bounce",(function(e){return 1-C(1-e)}),C=function(e){return e<O?x*e*e:e<.7272727272727273?x*Math.pow(e-1.5/I,2)+.75:e<.9090909090909092?x*(e-=2.25/I)*e+.9375:x*Math.pow(e-2.625/I,2)+.984375}),jt("Expo",(function(e){return e?Math.pow(2,10*(e-1)):0})),jt("Circ",(function(e){return-(F(1-e*e)-1)})),jt("Sine",(function(e){return 1===e?1:1-j(e*D)})),jt("Back",Gt("in"),Gt("out"),Gt()),Nt.SteppedEase=Nt.steps=ie.SteppedEase={config:function(e,t){void 0===e&&(e=1);var n=1/e,r=e+(t?0:1),i=t?1:0;return function(e){return((r*rt(0,.99999999,e)|0)+i)*n}}},N.ease=Nt["quad.out"],Se("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(e){return ye+=e+","+e+"Params,"}));var Ht=function(e,t){this.id=U++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Ee,this.set=t?t.getSetter:sn},zt=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,Qe(this,+e.duration,1,1),this.data=e.data,d||Ct.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,Qe(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(Mt(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(ze(this,e),!n._dp||n.parent||We(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&qe(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===k||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),xe(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+Be(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+Be(this),t):this.duration()?Math.min(1,this._time/this._dur):this.ratio},t.iteration=function(e,t){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*n,t):this._repeat?Ve(this._tTime,n)+1:1},t.timeScale=function(e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===e)return this;var t=this.parent&&this._ts?Ge(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||-1e-8===e?0:this._rts,Fe(this.totalTime(rt(-this._delay,this._tDur,t),!0)),He(this),this},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Mt(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==k&&(this._tTime-=k)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&qe(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(q(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Ge(t.rawTime(e),this):this._tTime:this._tTime},t.globalTime=function(e){for(var t=this,n=arguments.length?e:t.rawTime();t;)n=t._start+n/(t._ts||1),t=t._dp;return n},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,Ze(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,Ze(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(et(this,e),q(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,q(t))},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var e,t=this.parent||this._dp,n=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=n&&e<this.endTime(!0)-k))},t.eventCallback=function(e,t,n){var r=this.vars;return arguments.length>1?(t?(r[e]=t,n&&(r[e+"Params"]=n),"onUpdate"===e&&(this._onUpdate=t)):delete r[e],this):r[e]},t.then=function(e){var t=this;return new Promise((function(n){var r=G(e)?e:Oe,i=function(){var e=t.then;t.then=null,G(r)&&(r=r(t))&&(r.then||r===t)&&(t.then=e),n(r),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?i():t._prom=i}))},t.kill=function(){bt(this)},e}();Ce(zt.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Wt=function(e){function r(t,r){var o;return void 0===t&&(t={}),(o=e.call(this,t)||this).labels={},o.smoothChildTiming=!!t.smoothChildTiming,o.autoRemoveChildren=!!t.autoRemoveChildren,o._sort=q(t.sortChildren),i&&qe(t.parent||i,n(o),r),t.reversed&&o.reverse(),t.paused&&o.paused(!0),t.scrollTrigger&&Xe(n(o),t.scrollTrigger),o}t(r,e);var o=r.prototype;return o.to=function(e,t,n){return tt(0,arguments,this),this},o.from=function(e,t,n){return tt(1,arguments,this),this},o.fromTo=function(e,t,n,r){return tt(2,arguments,this),this},o.set=function(e,t,n){return t.duration=0,t.parent=this,ke(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new tn(e,t,et(this,n),1),this},o.call=function(e,t,n){return qe(this,tn.delayedCall(0,e,t),n)},o.staggerTo=function(e,t,n,r,i,o,a){return n.duration=t,n.stagger=n.stagger||r,n.onComplete=o,n.onCompleteParams=a,n.parent=this,new tn(e,n,et(this,i)),this},o.staggerFrom=function(e,t,n,r,i,o,a){return n.runBackwards=1,ke(n).immediateRender=q(n.immediateRender),this.staggerTo(e,t,n,r,i,o,a)},o.staggerFromTo=function(e,t,n,r,i,o,a,s){return r.startAt=n,ke(r).immediateRender=q(r.immediateRender),this.staggerTo(e,t,r,i,o,a,s)},o.render=function(e,t,n){var r,o,a,s,c,u,l,d,h,f,p,m,g=this._time,v=this._dirty?this.totalDuration():this._tDur,y=this._dur,b=e<=0?0:Te(e),_=this._zTime<0!=e<0&&(this._initted||!y);if(this!==i&&b>v&&e>=0&&(b=v),b!==this._tTime||n||_){if(g!==this._time&&y&&(b+=this._time-g,e+=this._time-g),r=b,h=this._start,u=!(d=this._ts),_&&(y||(g=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(p=this._yoyo,c=y+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*c+e,t,n);if(r=Te(b%c),b===v?(s=this._repeat,r=y):((s=~~(b/c))&&s===b/c&&(r=y,s--),r>y&&(r=y)),f=Ve(this._tTime,c),!g&&this._tTime&&f!==s&&(f=s),p&&1&s&&(r=y-r,m=1),s!==f&&!this._lock){var E=p&&1&f,S=E===(p&&1&s);if(s<f&&(E=!E),g=E?0:y,this._lock=1,this.render(g||(m?0:Te(s*c)),t,!y)._lock=0,this._tTime=b,!t&&this.parent&&yt(this,"onRepeat"),this.vars.repeatRefresh&&!m&&(this.invalidate()._lock=1),g&&g!==this._time||u!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(y=this._dur,v=this._tDur,S&&(this._lock=2,g=E?y:-1e-4,this.render(g,!0),this.vars.repeatRefresh&&!m&&this.invalidate()),this._lock=0,!this._ts&&!u)return this;Ut(this,m)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(l=function(e,t,n){var r;if(n>t)for(r=e._first;r&&r._start<=n;){if("isPause"===r.data&&r._start>t)return r;r=r._next}else for(r=e._last;r&&r._start>=n;){if("isPause"===r.data&&r._start<t)return r;r=r._prev}}(this,Te(g),Te(r)),l&&(b-=r-(r=l._start))),this._tTime=b,this._time=r,this._act=!d,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,g=0),!g&&r&&!t&&(yt(this,"onStart"),this._tTime!==b))return this;if(r>=g&&e>=0)for(o=this._first;o;){if(a=o._next,(o._act||r>=o._start)&&o._ts&&l!==o){if(o.parent!==this)return this.render(e,t,n);if(o.render(o._ts>0?(r-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(r-o._start)*o._ts,t,n),r!==this._time||!this._ts&&!u){l=0,a&&(b+=this._zTime=-1e-8);break}}o=a}else{o=this._last;for(var w=e<0?e:r;o;){if(a=o._prev,(o._act||w<=o._end)&&o._ts&&l!==o){if(o.parent!==this)return this.render(e,t,n);if(o.render(o._ts>0?(w-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(w-o._start)*o._ts,t,n),r!==this._time||!this._ts&&!u){l=0,a&&(b+=this._zTime=w?-1e-8:k);break}}o=a}}if(l&&!t&&(this.pause(),l.render(r>=g?0:-1e-8)._zTime=r>=g?1:-1,this._ts))return this._start=h,He(this),this.render(e,t,n);this._onUpdate&&!t&&yt(this,"onUpdate",!0),(b===v&&v>=this.totalDuration()||!b&&g)&&(h!==this._start&&Math.abs(d)===Math.abs(this._ts)||this._lock||((e||!y)&&(b===v&&this._ts>0||!b&&this._ts<0)&&De(this,1),t||e<0&&!g||!b&&!g&&v||(yt(this,b===v&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(b<v&&this.timeScale()>0)&&this._prom())))}return this},o.add=function(e,t){var n=this;if(H(t)||(t=et(this,t,e)),!(e instanceof zt)){if(K(e))return e.forEach((function(e){return n.add(e,t)})),this;if(V(e))return this.addLabel(e,t);if(!G(e))return this;e=tn.delayedCall(0,e)}return this!==e?qe(this,e,t):this},o.getChildren=function(e,t,n,r){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===r&&(r=-L);for(var i=[],o=this._first;o;)o._start>=r&&(o instanceof tn?t&&i.push(o):(n&&i.push(o),e&&i.push.apply(i,o.getChildren(!0,t,n)))),o=o._next;return i},o.getById=function(e){for(var t=this.getChildren(1,1,1),n=t.length;n--;)if(t[n].vars.id===e)return t[n]},o.remove=function(e){return V(e)?this.removeLabel(e):G(e)?this.killTweensOf(e):(Pe(this,e),e===this._recent&&(this._recent=this._last),Ue(this))},o.totalTime=function(t,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Te(Ct.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,n),this._forcing=0,this):this._tTime},o.addLabel=function(e,t){return this.labels[e]=et(this,t),this},o.removeLabel=function(e){return delete this.labels[e],this},o.addPause=function(e,t,n){var r=tn.delayedCall(0,t||le,n);return r.data="isPause",this._hasPause=1,qe(this,r,et(this,e))},o.removePause=function(e){var t=this._first;for(e=et(this,e);t;)t._start===e&&"isPause"===t.data&&De(t),t=t._next},o.killTweensOf=function(e,t,n){for(var r=this.getTweensOf(e,n),i=r.length;i--;)qt!==r[i]&&r[i].kill(e,t);return this},o.getTweensOf=function(e,t){for(var n,r=[],i=ct(e),o=this._first,a=H(t);o;)o instanceof tn?Ae(o._targets,i)&&(a?(!qt||o._initted&&o._ts)&&o.globalTime(0)<=t&&o.globalTime(o.totalDuration())>t:!t||o.isActive())&&r.push(o):(n=o.getTweensOf(i,t)).length&&r.push.apply(r,n),o=o._next;return r},o.tweenTo=function(e,t){t=t||{};var n,r=this,i=et(r,e),o=t,a=o.startAt,s=o.onStart,c=o.onStartParams,u=o.immediateRender,l=tn.to(r,Ce({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:i,overwrite:"auto",duration:t.duration||Math.abs((i-(a&&"time"in a?a.time:r._time))/r.timeScale())||k,onStart:function(){if(r.pause(),!n){var e=t.duration||Math.abs((i-(a&&"time"in a?a.time:r._time))/r.timeScale());l._dur!==e&&Qe(l,e,0,1).render(l._time,!0,!0),n=1}s&&s.apply(l,c||[])}},t));return u?l.render(0):l},o.tweenFromTo=function(e,t,n){return this.tweenTo(t,Ce({startAt:{time:et(this,e)}},n))},o.recent=function(){return this._recent},o.nextLabel=function(e){return void 0===e&&(e=this._time),vt(this,et(this,e))},o.previousLabel=function(e){return void 0===e&&(e=this._time),vt(this,et(this,e),1)},o.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+k)},o.shiftChildren=function(e,t,n){void 0===n&&(n=0);for(var r,i=this._first,o=this.labels;i;)i._start>=n&&(i._start+=e,i._end+=e),i=i._next;if(t)for(r in o)o[r]>=n&&(o[r]+=e);return Ue(this)},o.invalidate=function(){var t=this._first;for(this._lock=0;t;)t.invalidate(),t=t._next;return e.prototype.invalidate.call(this)},o.clear=function(e){void 0===e&&(e=!0);for(var t,n=this._first;n;)t=n._next,this.remove(n),n=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),Ue(this)},o.totalDuration=function(e){var t,n,r,o=0,a=this,s=a._last,c=L;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-e:e));if(a._dirty){for(r=a.parent;s;)t=s._prev,s._dirty&&s.totalDuration(),(n=s._start)>c&&a._sort&&s._ts&&!a._lock?(a._lock=1,qe(a,s,n-s._delay,1)._lock=0):c=n,n<0&&s._ts&&(o-=n,(!r&&!a._dp||r&&r.smoothChildTiming)&&(a._start+=n/a._ts,a._time-=n,a._tTime-=n),a.shiftChildren(-n,!1,-Infinity),c=0),s._end>o&&s._ts&&(o=s._end),s=t;Qe(a,a===i&&a._time>o?a._time:o,1,1),a._dirty=0}return a._tDur},r.updateRoot=function(e){if(i._ts&&(xe(i,Ge(e,i)),u=Ct.frame),Ct.frame>=ge){ge+=M.autoSleep||120;var t=i._first;if((!t||!t._ts)&&M.autoSleep&&Ct._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||Ct.sleep()}}},r}(zt);Ce(Wt.prototype,{_lock:0,_hasPause:0,_forcing:0});var qt,Xt=function(e,t,n,r,i,o,a){var s,c,u,l,d,h,f,p,m=new gn(this._pt,e,t,0,1,ln,null,i),g=0,v=0;for(m.b=n,m.e=r,n+="",(f=~(r+="").indexOf("random("))&&(r=mt(r)),o&&(o(p=[n,r],e,t),n=p[0],r=p[1]),c=n.match(ee)||[];s=ee.exec(r);)l=s[0],d=r.substring(g,s.index),u?u=(u+1)%5:"rgba("===d.substr(-5)&&(u=1),l!==c[v++]&&(h=parseFloat(c[v-1])||0,m._pt={_next:m._pt,p:d||1===v?d:",",s:h,c:"="===l.charAt(1)?parseFloat(l.substr(2))*("-"===l.charAt(0)?-1:1):parseFloat(l)-h,m:u&&u<4?Math.round:0},g=ee.lastIndex);return m.c=g<r.length?r.substring(g,r.length):"",m.fp=a,(te.test(r)||f)&&(m.e=0),this._pt=m,m},Jt=function(e,t,n,r,i,o,a,s,c){G(r)&&(r=r(i||0,e,o));var u,l=e[t],d="get"!==n?n:G(l)?c?e[t.indexOf("set")||!G(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():l,h=G(l)?c?on:rn:nn;if(V(r)&&(~r.indexOf("random(")&&(r=mt(r)),"="===r.charAt(1)&&((u=parseFloat(d)+parseFloat(r.substr(2))*("-"===r.charAt(0)?-1:1)+(it(d)||0))||0===u)&&(r=u)),d!==r)return isNaN(d*r)||""===r?(!l&&!(t in e)&&se(t,r),Xt.call(this,e,t,d,r,h,s||M.stringFilter,c)):(u=new gn(this._pt,e,t,+d||0,r-(d||0),"boolean"==typeof l?un:cn,0,h),c&&(u.fp=c),a&&u.modifier(a,this,e),this._pt=u)},Yt=function(e,t,n,r,i,o){var a,s,c,u;if(pe[e]&&!1!==(a=new pe[e]).init(i,a.rawVars?t[e]:function(e,t,n,r,i){if(G(e)&&(e=Zt(e,i,t,n,r)),!W(e)||e.style&&e.nodeType||K(e)||Y(e))return V(e)?Zt(e,i,t,n,r):e;var o,a={};for(o in e)a[o]=Zt(e[o],i,t,n,r);return a}(t[e],r,i,o,n),n,r,o)&&(n._pt=s=new gn(n._pt,i,e,0,1,a.render,a,0,a.priority),n!==l))for(c=n._ptLookup[n._targets.indexOf(i)],u=a._props.length;u--;)c[a._props[u]]=s;return a},Kt=function e(t,n){var o,a,s,c,u,l,d,h,f,p,m,g,v,y=t.vars,b=y.ease,_=y.startAt,E=y.immediateRender,S=y.lazy,w=y.onUpdate,T=y.onUpdateParams,A=y.callbackScope,R=y.runBackwards,x=y.yoyoEase,I=y.keyframes,O=y.autoRevert,C=t._dur,M=t._startAt,P=t._targets,D=t.parent,U=D&&"nested"===D.data?D.parent._targets:P,F="auto"===t._overwrite&&!r,j=t.timeline;if(j&&(!I||!b)&&(b="none"),t._ease=Ft(b,N.ease),t._yEase=x?Dt(Ft(!0===x?b:x,N.ease)):0,x&&t._yoyo&&!t._repeat&&(x=t._yEase,t._yEase=t._ease,t._ease=x),t._from=!j&&!!y.runBackwards,!j||I&&!y.stagger){if(g=(h=P[0]?_e(P[0]).harness:0)&&y[h.prop],o=Le(y,de),M&&De(M.render(-1,!0)),_)if(De(t._startAt=tn.set(P,Ce({data:"isStart",overwrite:!1,parent:D,immediateRender:!0,lazy:q(S),startAt:null,delay:0,onUpdate:w,onUpdateParams:T,callbackScope:A,stagger:0},_))),n<0&&!E&&!O&&t._startAt.render(-1,!0),E){if(n>0&&!O&&(t._startAt=0),C&&n<=0)return void(n&&(t._zTime=n))}else!1===O&&(t._startAt=0);else if(R&&C)if(M)!O&&(t._startAt=0);else if(n&&(E=!1),s=Ce({overwrite:!1,data:"isFromStart",lazy:E&&q(S),immediateRender:E,stagger:0,parent:D},o),g&&(s[h.prop]=g),De(t._startAt=tn.set(P,s)),n<0&&t._startAt.render(-1,!0),t._zTime=n,E){if(!n)return}else e(t._startAt,k);for(t._pt=0,S=C&&q(S)||S&&!C,a=0;a<P.length;a++){if(d=(u=P[a])._gsap||be(P)[a]._gsap,t._ptLookup[a]=p={},fe[d.id]&&he.length&&Re(),m=U===P?a:U.indexOf(u),h&&!1!==(f=new h).init(u,g||o,t,m,U)&&(t._pt=c=new gn(t._pt,u,f.name,0,1,f.render,f,0,f.priority),f._props.forEach((function(e){p[e]=c})),f.priority&&(l=1)),!h||g)for(s in o)pe[s]&&(f=Yt(s,o,t,m,u,U))?f.priority&&(l=1):p[s]=c=Jt.call(t,u,s,"get",o[s],m,U,0,y.stringFilter);t._op&&t._op[a]&&t.kill(u,t._op[a]),F&&t._pt&&(qt=t,i.killTweensOf(u,p,t.globalTime(n)),v=!t.parent,qt=0),t._pt&&S&&(fe[d.id]=1)}l&&mn(t),t._onInit&&t._onInit(t)}t._onUpdate=w,t._initted=(!t._op||t._pt)&&!v,I&&n<=0&&j.render(L,!0,!0)},Qt=function(e,t,n,r){var i,o,a=t.ease||r||"power1.inOut";if(K(t))o=n[e]||(n[e]=[]),t.forEach((function(e,n){return o.push({t:n/(t.length-1)*100,v:e,e:a})}));else for(i in t)o=n[i]||(n[i]=[]),"ease"===i||o.push({t:parseFloat(e),v:t[i],e:a})},Zt=function(e,t,n,r,i){return G(e)?e.call(t,n,r,i):V(e)&&~e.indexOf("random(")?mt(e):e},$t=ye+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase",en={};Se($t+",id,stagger,delay,duration,paused,scrollTrigger",(function(e){return en[e]=1}));var tn=function(e){function o(t,o,a,s){var c;"number"==typeof o&&(a.duration=o,o=a,a=null);var u,l,d,h,f,p,m,g,v=(c=e.call(this,s?o:ke(o))||this).vars,y=v.duration,b=v.delay,_=v.immediateRender,E=v.stagger,S=v.overwrite,w=v.keyframes,T=v.defaults,A=v.scrollTrigger,R=v.yoyoEase,x=o.parent||i,I=(K(t)||Y(t)?H(t[0]):"length"in o)?[t]:ct(t);if(c._targets=I.length?be(I):ce("GSAP target "+t+" not found. https://greensock.com",!M.nullTargetWarn)||[],c._ptLookup=[],c._overwrite=S,w||E||J(y)||J(b)){if(o=c.vars,(u=c.timeline=new Wt({data:"nested",defaults:T||{}})).kill(),u.parent=u._dp=n(c),u._start=0,E||J(y)||J(b)){if(h=I.length,m=E&&lt(E),W(E))for(f in E)~$t.indexOf(f)&&(g||(g={}),g[f]=E[f]);for(l=0;l<h;l++)(d=Le(o,en)).stagger=0,R&&(d.yoyoEase=R),g&&Me(d,g),p=I[l],d.duration=+Zt(y,n(c),l,p,I),d.delay=(+Zt(b,n(c),l,p,I)||0)-c._delay,!E&&1===h&&d.delay&&(c._delay=b=d.delay,c._start+=b,d.delay=0),u.to(p,d,m?m(l,p,I):0),u._ease=Nt.none;u.duration()?y=b=0:c.timeline=0}else if(w){ke(Ce(u.vars.defaults,{ease:"none"})),u._ease=Ft(w.ease||o.ease||"none");var O,C,N,L=0;if(K(w))w.forEach((function(e){return u.to(I,e,">")}));else{for(f in d={},w)"ease"===f||"easeEach"===f||Qt(f,w[f],d,w.easeEach);for(f in d)for(O=d[f].sort((function(e,t){return e.t-t.t})),L=0,l=0;l<O.length;l++)(N={ease:(C=O[l]).e,duration:(C.t-(l?O[l-1].t:0))/100*y})[f]=C.v,u.to(I,N,L),L+=N.duration;u.duration()<y&&u.to({},{duration:y-u.duration()})}}y||c.duration(y=u.duration())}else c.timeline=0;return!0!==S||r||(qt=n(c),i.killTweensOf(I),qt=0),qe(x,n(c),a),o.reversed&&c.reverse(),o.paused&&c.paused(!0),(_||!y&&!w&&c._start===Te(x._time)&&q(_)&&je(n(c))&&"nested"!==x.data)&&(c._tTime=-1e-8,c.render(Math.max(0,-b))),A&&Xe(n(c),A),c}t(o,e);var a=o.prototype;return a.render=function(e,t,n){var r,i,o,a,s,c,u,l,d,h=this._time,f=this._tDur,p=this._dur,m=e>f-k&&e>=0?f:e<k?0:e;if(p){if(m!==this._tTime||!e||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=e<0){if(r=m,l=this.timeline,this._repeat){if(a=p+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*a+e,t,n);if(r=Te(m%a),m===f?(o=this._repeat,r=p):((o=~~(m/a))&&o===m/a&&(r=p,o--),r>p&&(r=p)),(c=this._yoyo&&1&o)&&(d=this._yEase,r=p-r),s=Ve(this._tTime,a),r===h&&!n&&this._initted)return this;o!==s&&(l&&this._yEase&&Ut(l,c),!this.vars.repeatRefresh||c||this._lock||(this._lock=n=1,this.render(Te(a*o),!0).invalidate()._lock=0))}if(!this._initted){if(Je(this,e<0?e:r,n,t))return this._tTime=0,this;if(p!==this._dur)return this.render(e,t,n)}if(this._tTime=m,this._time=r,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=u=(d||this._ease)(r/p),this._from&&(this.ratio=u=1-u),r&&!h&&!t&&(yt(this,"onStart"),this._tTime!==m))return this;for(i=this._pt;i;)i.r(u,i.d),i=i._next;l&&l.render(e<0?e:!r&&c?-1e-8:l._dur*l._ease(r/this._dur),t,n)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(e<0&&this._startAt&&this._startAt.render(e,!0,n),yt(this,"onUpdate")),this._repeat&&o!==s&&this.vars.onRepeat&&!t&&this.parent&&yt(this,"onRepeat"),m!==this._tDur&&m||this._tTime!==m||(e<0&&this._startAt&&!this._onUpdate&&this._startAt.render(e,!0,!0),(e||!p)&&(m===this._tDur&&this._ts>0||!m&&this._ts<0)&&De(this,1),t||e<0&&!h||!m&&!h||(yt(this,m===f?"onComplete":"onReverseComplete",!0),this._prom&&!(m<f&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,n,r){var i,o,a,s=e.ratio,c=t<0||!t&&(!e._start&&Ye(e)&&(e._initted||!Ke(e))||(e._ts<0||e._dp._ts<0)&&!Ke(e))?0:1,u=e._rDelay,l=0;if(u&&e._repeat&&(l=rt(0,e._tDur,t),o=Ve(l,u),e._yoyo&&1&o&&(c=1-c),o!==Ve(e._tTime,u)&&(s=1-c,e.vars.repeatRefresh&&e._initted&&e.invalidate())),c!==s||r||e._zTime===k||!t&&e._zTime){if(!e._initted&&Je(e,t,r,n))return;for(a=e._zTime,e._zTime=t||(n?k:0),n||(n=t&&!a),e.ratio=c,e._from&&(c=1-c),e._time=0,e._tTime=l,i=e._pt;i;)i.r(c,i.d),i=i._next;e._startAt&&t<0&&e._startAt.render(t,!0,!0),e._onUpdate&&!n&&yt(e,"onUpdate"),l&&e._repeat&&!n&&e.parent&&yt(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===c&&(c&&De(e,1),n||(yt(e,c?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,n);return this},a.targets=function(){return this._targets},a.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),e.prototype.invalidate.call(this)},a.kill=function(e,t){if(void 0===t&&(t="all"),!(e||t&&"all"!==t))return this._lazy=this._pt=0,this.parent?bt(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,qt&&!0!==qt.vars.overwrite)._first||bt(this),this.parent&&n!==this.timeline.totalDuration()&&Qe(this,this._dur*this.timeline._tDur/n,0,1),this}var r,i,o,a,s,c,u,l=this._targets,d=e?ct(e):l,h=this._ptLookup,f=this._pt;if((!t||"all"===t)&&function(e,t){for(var n=e.length,r=n===t.length;r&&n--&&e[n]===t[n];);return n<0}(l,d))return"all"===t&&(this._pt=0),bt(this);for(r=this._op=this._op||[],"all"!==t&&(V(t)&&(s={},Se(t,(function(e){return s[e]=1})),t=s),t=function(e,t){var n,r,i,o,a=e[0]?_e(e[0]).harness:0,s=a&&a.aliases;if(!s)return t;for(r in n=Me({},t),s)if(r in n)for(i=(o=s[r].split(",")).length;i--;)n[o[i]]=n[r];return n}(l,t)),u=l.length;u--;)if(~d.indexOf(l[u]))for(s in i=h[u],"all"===t?(r[u]=t,a=i,o={}):(o=r[u]=r[u]||{},a=t),a)(c=i&&i[s])&&("kill"in c.d&&!0!==c.d.kill(s)||Pe(this,c,"_pt"),delete i[s]),"all"!==o&&(o[s]=1);return this._initted&&!this._pt&&f&&bt(this),this},o.to=function(e,t){return new o(e,t,arguments[2])},o.from=function(e,t){return tt(1,arguments)},o.delayedCall=function(e,t,n,r){return new o(t,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:t,onReverseComplete:t,onCompleteParams:n,onReverseCompleteParams:n,callbackScope:r})},o.fromTo=function(e,t,n){return tt(2,arguments)},o.set=function(e,t){return t.duration=0,t.repeatDelay||(t.repeat=0),new o(e,t)},o.killTweensOf=function(e,t,n){return i.killTweensOf(e,t,n)},o}(zt);Ce(tn.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Se("staggerTo,staggerFrom,staggerFromTo",(function(e){tn[e]=function(){var t=new Wt,n=ot.call(arguments,0);return n.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,n)}}));var nn=function(e,t,n){return e[t]=n},rn=function(e,t,n){return e[t](n)},on=function(e,t,n,r){return e[t](r.fp,n)},an=function(e,t,n){return e.setAttribute(t,n)},sn=function(e,t){return G(e[t])?rn:z(e[t])&&e.setAttribute?an:nn},cn=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},un=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},ln=function(e,t){var n=t._pt,r="";if(!e&&t.b)r=t.b;else if(1===e&&t.e)r=t.e;else{for(;n;)r=n.p+(n.m?n.m(n.s+n.c*e):Math.round(1e4*(n.s+n.c*e))/1e4)+r,n=n._next;r+=t.c}t.set(t.t,t.p,r,t)},dn=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},hn=function(e,t,n,r){for(var i,o=this._pt;o;)i=o._next,o.p===r&&o.modifier(e,t,n),o=i},fn=function(e){for(var t,n,r=this._pt;r;)n=r._next,r.p===e&&!r.op||r.op===e?Pe(this,r,"_pt"):r.dep||(t=1),r=n;return!t},pn=function(e,t,n,r){r.mSet(e,t,r.m.call(r.tween,n,r.mt),r)},mn=function(e){for(var t,n,r,i,o=e._pt;o;){for(t=o._next,n=r;n&&n.pr>o.pr;)n=n._next;(o._prev=n?n._prev:i)?o._prev._next=o:r=o,(o._next=n)?n._prev=o:i=o,o=t}e._pt=r},gn=function(){function e(e,t,n,r,i,o,a,s,c){this.t=t,this.s=r,this.c=i,this.p=n,this.r=o||cn,this.d=a||this,this.set=s||nn,this.pr=c||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,n){this.mSet=this.mSet||this.set,this.set=pn,this.m=e,this.mt=n,this.tween=t},e}();Se(ye+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(e){return de[e]=1})),ie.TweenMax=ie.TweenLite=tn,ie.TimelineLite=ie.TimelineMax=Wt,i=new Wt({sortChildren:!1,defaults:N,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),M.stringFilter=Ot;var vn={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){return _t(e)}))},timeline:function(e){return new Wt(e)},getTweensOf:function(e,t){return i.getTweensOf(e,t)},getProperty:function(e,t,n,r){V(e)&&(e=ct(e)[0]);var i=_e(e||{}).get,o=n?Oe:Ie;return"native"===n&&(n=""),e?t?o((pe[t]&&pe[t].get||i)(e,t,n,r)):function(t,n,r){return o((pe[t]&&pe[t].get||i)(e,t,n,r))}:e},quickSetter:function(e,t,n){if((e=ct(e)).length>1){var r=e.map((function(e){return _n.quickSetter(e,t,n)})),i=r.length;return function(e){for(var t=i;t--;)r[t](e)}}e=e[0]||{};var o=pe[t],a=_e(e),s=a.harness&&(a.harness.aliases||{})[t]||t,c=o?function(t){var r=new o;l._pt=0,r.init(e,n?t+n:t,l,0,[e]),r.render(1,r),l._pt&&dn(1,l)}:a.set(e,s);return o?c:function(t){return c(e,s,n?t+n:t,a,1)}},isTweening:function(e){return i.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Ft(e.ease,N.ease)),Ne(N,e||{})},config:function(e){return Ne(M,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,r=e.plugins,i=e.defaults,o=e.extendTimeline;(r||"").split(",").forEach((function(e){return e&&!pe[e]&&!ie[e]&&ce(t+" effect requires "+e+" plugin.")})),me[t]=function(e,t,r){return n(ct(e),Ce(t||{},i),r)},o&&(Wt.prototype[t]=function(e,n,r){return this.add(me[t](e,W(n)?n:(r=n)&&{},this),r)})},registerEase:function(e,t){Nt[e]=Ft(t)},parseEase:function(e,t){return arguments.length?Ft(e,t):Nt},getById:function(e){return i.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var n,r,o=new Wt(e);for(o.smoothChildTiming=q(e.smoothChildTiming),i.remove(o),o._dp=0,o._time=o._tTime=i._time,n=i._first;n;)r=n._next,!t&&!n._dur&&n instanceof tn&&n.vars.onComplete===n._targets[0]||qe(o,n,n._start-n._delay),n=r;return qe(i,o,0),o},utils:{wrap:function e(t,n,r){var i=n-t;return K(t)?pt(t,e(0,t.length),n):nt(r,(function(e){return(i+(e-t)%i)%i+t}))},wrapYoyo:function e(t,n,r){var i=n-t,o=2*i;return K(t)?pt(t,e(0,t.length-1),n):nt(r,(function(e){return t+((e=(o+(e-t)%o)%o||0)>i?o-e:e)}))},distribute:lt,random:ft,snap:ht,normalize:function(e,t,n){return gt(e,t,0,1,n)},getUnit:it,clamp:function(e,t,n){return nt(n,(function(n){return rt(e,t,n)}))},splitColor:Tt,toArray:ct,selector:function(e){return e=ct(e)[0]||ce("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return ct(t,n.querySelectorAll?n:n===e?ce("Invalid scope")||s.createElement("div"):e)}},mapRange:gt,pipe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(e,t){return t(e)}),e)}},unitize:function(e,t){return function(n){return e(parseFloat(n))+(t||it(n))}},interpolate:function e(t,n,r,i){var o=isNaN(t+n)?0:function(e){return(1-e)*t+e*n};if(!o){var a,s,c,u,l,d=V(t),h={};if(!0===r&&(i=1)&&(r=null),d)t={p:t},n={p:n};else if(K(t)&&!K(n)){for(c=[],u=t.length,l=u-2,s=1;s<u;s++)c.push(e(t[s-1],t[s]));u--,o=function(e){e*=u;var t=Math.min(l,~~e);return c[t](e-t)},r=n}else i||(t=Me(K(t)?[]:{},t));if(!c){for(a in n)Jt.call(h,t,a,"get",n[a]);o=function(e){return dn(e,h)||(d?t.p:t)}}}return nt(r,o)},shuffle:ut},install:ae,effects:me,ticker:Ct,updateRoot:Wt.updateRoot,plugins:pe,globalTimeline:i,core:{PropTween:gn,globals:ue,Tween:tn,Timeline:Wt,Animation:zt,getCache:_e,_removeLinkedListItem:Pe,suppressOverwrites:function(e){return r=e}}};Se("to,from,fromTo,delayedCall,set,killTweensOf",(function(e){return vn[e]=tn[e]})),Ct.add(Wt.updateRoot),l=vn.to({},{duration:0});var yn=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},bn=function(e,t){return{name:e,rawVars:1,init:function(e,n,r){r._onInit=function(e){var r,i;if(V(n)&&(r={},Se(n,(function(e){return r[e]=1})),n=r),t){for(i in r={},n)r[i]=t(n[i]);n=r}!function(e,t){var n,r,i,o=e._targets;for(n in t)for(r=o.length;r--;)(i=e._ptLookup[r][n])&&(i=i.d)&&(i._pt&&(i=yn(i,n)),i&&i.modifier&&i.modifier(t[n],e,o[r],n))}(e,n)}}}},_n=vn.registerPlugin({name:"attr",init:function(e,t,n,r,i){var o,a;for(o in t)(a=this.add(e,"setAttribute",(e.getAttribute(o)||0)+"",t[o],r,i,0,0,o))&&(a.op=o),this._props.push(o)}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n])}},bn("roundProps",dt),bn("modifiers"),bn("snap",ht))||vn;tn.version=Wt.version=_n.version="3.9.1",c=1,X()&&Mt();var En,Sn,wn,Tn,An,Rn,xn,In=Nt.Power0,On=Nt.Power1,Cn=Nt.Power2,Mn=Nt.Power3,Nn=Nt.Power4,Ln=Nt.Linear,kn=Nt.Quad,Pn=Nt.Cubic,Dn=Nt.Quart,Un=Nt.Quint,Fn=Nt.Strong,jn=Nt.Elastic,Bn=Nt.Back,Vn=Nt.SteppedEase,Gn=Nt.Bounce,Hn=Nt.Sine,zn=Nt.Expo,Wn=Nt.Circ,qn={},Xn=180/Math.PI,Jn=Math.PI/180,Yn=Math.atan2,Kn=/([A-Z])/g,Qn=/(?:left|right|width|margin|padding|x)/i,Zn=/[\s,\(]\S/,$n={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},er=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},tr=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},nr=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},rr=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},ir=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},or=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},ar=function(e,t,n){return e.style[t]=n},sr=function(e,t,n){return e.style.setProperty(t,n)},cr=function(e,t,n){return e._gsap[t]=n},ur=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},lr=function(e,t,n,r,i){var o=e._gsap;o.scaleX=o.scaleY=n,o.renderTransform(i,o)},dr=function(e,t,n,r,i){var o=e._gsap;o[t]=n,o.renderTransform(i,o)},hr="transform",fr=hr+"Origin",pr=function(e,t){var n=Sn.createElementNS?Sn.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Sn.createElement(e);return n.style?n:Sn.createElement(e)},mr=function e(t,n,r){var i=getComputedStyle(t);return i[n]||i.getPropertyValue(n.replace(Kn,"-$1").toLowerCase())||i.getPropertyValue(n)||!r&&e(t,vr(n)||n,1)||""},gr="O,Moz,ms,Ms,Webkit".split(","),vr=function(e,t,n){var r=(t||An).style,i=5;if(e in r&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);i--&&!(gr[i]+e in r););return i<0?null:(3===i?"ms":i>=0?gr[i]:"")+e},yr=function(){"undefined"!=typeof window&&window.document&&(En=window,Sn=En.document,wn=Sn.documentElement,An=pr("div")||{style:{}},pr("div"),hr=vr(hr),fr=hr+"Origin",An.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",xn=!!vr("perspective"),Tn=1)},br=function e(t){var n,r=pr("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,o=this.nextSibling,a=this.style.cssText;if(wn.appendChild(r),r.appendChild(this),this.style.display="block",t)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=e}catch(e){}else this._gsapBBox&&(n=this._gsapBBox());return i&&(o?i.insertBefore(this,o):i.appendChild(this)),wn.removeChild(r),this.style.cssText=a,n},_r=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Er=function(e){var t;try{t=e.getBBox()}catch(n){t=br.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===br||(t=br.call(e,!0)),!t||t.width||t.x||t.y?t:{x:+_r(e,["x","cx","x1"])||0,y:+_r(e,["y","cy","y1"])||0,width:0,height:0}},Sr=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!Er(e))},wr=function(e,t){if(t){var n=e.style;t in qn&&t!==fr&&(t=hr),n.removeProperty?("ms"!==t.substr(0,2)&&"webkit"!==t.substr(0,6)||(t="-"+t),n.removeProperty(t.replace(Kn,"-$1").toLowerCase())):n.removeAttribute(t)}},Tr=function(e,t,n,r,i,o){var a=new gn(e._pt,t,n,0,1,o?or:ir);return e._pt=a,a.b=r,a.e=i,e._props.push(n),a},Ar={deg:1,rad:1,turn:1},Rr=function e(t,n,r,i){var o,a,s,c,u=parseFloat(r)||0,l=(r+"").trim().substr((u+"").length)||"px",d=An.style,h=Qn.test(n),f="svg"===t.tagName.toLowerCase(),p=(f?"client":"offset")+(h?"Width":"Height"),m=100,g="px"===i,v="%"===i;return i===l||!u||Ar[i]||Ar[l]?u:("px"!==l&&!g&&(u=e(t,n,r,"px")),c=t.getCTM&&Sr(t),!v&&"%"!==l||!qn[n]&&!~n.indexOf("adius")?(d[h?"width":"height"]=m+(g?l:i),a=~n.indexOf("adius")||"em"===i&&t.appendChild&&!f?t:t.parentNode,c&&(a=(t.ownerSVGElement||{}).parentNode),a&&a!==Sn&&a.appendChild||(a=Sn.body),(s=a._gsap)&&v&&s.width&&h&&s.time===Ct.time?we(u/s.width*m):((v||"%"===l)&&(d.position=mr(t,"position")),a===t&&(d.position="static"),a.appendChild(An),o=An[p],a.removeChild(An),d.position="absolute",h&&v&&((s=_e(a)).time=Ct.time,s.width=a[p]),we(g?o*u/m:o&&u?m/o*u:0))):(o=c?t.getBBox()[h?"width":"height"]:t[p],we(v?u/o*m:u/100*o)))},xr=function(e,t,n,r){var i;return Tn||yr(),t in $n&&"transform"!==t&&~(t=$n[t]).indexOf(",")&&(t=t.split(",")[0]),qn[t]&&"transform"!==t?(i=Fr(e,r),i="transformOrigin"!==t?i[t]:i.svg?i.origin:jr(mr(e,fr))+" "+i.zOrigin+"px"):(!(i=e.style[t])||"auto"===i||r||~(i+"").indexOf("calc("))&&(i=Mr[t]&&Mr[t](e,t,n)||mr(e,t)||Ee(e,t)||("opacity"===t?1:0)),n&&!~(i+"").trim().indexOf(" ")?Rr(e,t,i,n)+n:i},Ir=function(e,t,n,r){if(!n||"none"===n){var i=vr(t,e,1),o=i&&mr(e,i,1);o&&o!==n?(t=i,n=o):"borderColor"===t&&(n=mr(e,"borderTopColor"))}var a,s,c,u,l,d,h,f,p,m,g,v,y=new gn(this._pt,e.style,t,0,1,ln),b=0,_=0;if(y.b=n,y.e=r,n+="","auto"===(r+="")&&(e.style[t]=r,r=mr(e,t)||r,e.style[t]=n),Ot(a=[n,r]),r=a[1],c=(n=a[0]).match($)||[],(r.match($)||[]).length){for(;s=$.exec(r);)h=s[0],p=r.substring(b,s.index),l?l=(l+1)%5:"rgba("!==p.substr(-5)&&"hsla("!==p.substr(-5)||(l=1),h!==(d=c[_++]||"")&&(u=parseFloat(d)||0,g=d.substr((u+"").length),(v="="===h.charAt(1)?+(h.charAt(0)+"1"):0)&&(h=h.substr(2)),f=parseFloat(h),m=h.substr((f+"").length),b=$.lastIndex-m.length,m||(m=m||M.units[t]||g,b===r.length&&(r+=m,y.e+=m)),g!==m&&(u=Rr(e,t,d,m)||0),y._pt={_next:y._pt,p:p||1===_?p:",",s:u,c:v?v*f:f-u,m:l&&l<4||"zIndex"===t?Math.round:0});y.c=b<r.length?r.substring(b,r.length):""}else y.r="display"===t&&"none"===r?or:ir;return te.test(r)&&(y.e=0),this._pt=y,y},Or={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Cr=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n,r,i,o=t.t,a=o.style,s=t.u,c=o._gsap;if("all"===s||!0===s)a.cssText="",r=1;else for(i=(s=s.split(",")).length;--i>-1;)n=s[i],qn[n]&&(r=1,n="transformOrigin"===n?fr:hr),wr(o,n);r&&(wr(o,hr),c&&(c.svg&&o.removeAttribute("transform"),Fr(o,1),c.uncache=1))}},Mr={clearProps:function(e,t,n,r,i){if("isFromStart"!==i.data){var o=e._pt=new gn(e._pt,t,n,0,0,Cr);return o.u=r,o.pr=-10,o.tween=i,e._props.push(n),1}}},Nr=[1,0,0,1,0,0],Lr={},kr=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},Pr=function(e){var t=mr(e,hr);return kr(t)?Nr:t.substr(7).match(Z).map(we)},Dr=function(e,t){var n,r,i,o,a=e._gsap||_e(e),s=e.style,c=Pr(e);return a.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(c=[(i=e.transform.baseVal.consolidate().matrix).a,i.b,i.c,i.d,i.e,i.f]).join(",")?Nr:c:(c!==Nr||e.offsetParent||e===wn||a.svg||(i=s.display,s.display="block",(n=e.parentNode)&&e.offsetParent||(o=1,r=e.nextSibling,wn.appendChild(e)),c=Pr(e),i?s.display=i:wr(e,"display"),o&&(r?n.insertBefore(e,r):n?n.appendChild(e):wn.removeChild(e))),t&&c.length>6?[c[0],c[1],c[4],c[5],c[12],c[13]]:c)},Ur=function(e,t,n,r,i,o){var a,s,c,u=e._gsap,l=i||Dr(e,!0),d=u.xOrigin||0,h=u.yOrigin||0,f=u.xOffset||0,p=u.yOffset||0,m=l[0],g=l[1],v=l[2],y=l[3],b=l[4],_=l[5],E=t.split(" "),S=parseFloat(E[0])||0,w=parseFloat(E[1])||0;n?l!==Nr&&(s=m*y-g*v)&&(c=S*(-g/s)+w*(m/s)-(m*_-g*b)/s,S=S*(y/s)+w*(-v/s)+(v*_-y*b)/s,w=c):(S=(a=Er(e)).x+(~E[0].indexOf("%")?S/100*a.width:S),w=a.y+(~(E[1]||E[0]).indexOf("%")?w/100*a.height:w)),r||!1!==r&&u.smooth?(b=S-d,_=w-h,u.xOffset=f+(b*m+_*v)-b,u.yOffset=p+(b*g+_*y)-_):u.xOffset=u.yOffset=0,u.xOrigin=S,u.yOrigin=w,u.smooth=!!r,u.origin=t,u.originIsAbsolute=!!n,e.style[fr]="0px 0px",o&&(Tr(o,u,"xOrigin",d,S),Tr(o,u,"yOrigin",h,w),Tr(o,u,"xOffset",f,u.xOffset),Tr(o,u,"yOffset",p,u.yOffset)),e.setAttribute("data-svg-origin",S+" "+w)},Fr=function(e,t){var n=e._gsap||new Ht(e);if("x"in n&&!t&&!n.uncache)return n;var r,i,o,a,s,c,u,l,d,h,f,p,m,g,v,y,b,_,E,S,w,T,A,R,x,I,O,C,N,L,k,P,D=e.style,U=n.scaleX<0,F="px",j="deg",B=mr(e,fr)||"0";return r=i=o=c=u=l=d=h=f=0,a=s=1,n.svg=!(!e.getCTM||!Sr(e)),g=Dr(e,n.svg),n.svg&&(R=(!n.uncache||"0px 0px"===B)&&!t&&e.getAttribute("data-svg-origin"),Ur(e,R||B,!!R||n.originIsAbsolute,!1!==n.smooth,g)),p=n.xOrigin||0,m=n.yOrigin||0,g!==Nr&&(_=g[0],E=g[1],S=g[2],w=g[3],r=T=g[4],i=A=g[5],6===g.length?(a=Math.sqrt(_*_+E*E),s=Math.sqrt(w*w+S*S),c=_||E?Yn(E,_)*Xn:0,(d=S||w?Yn(S,w)*Xn+c:0)&&(s*=Math.abs(Math.cos(d*Jn))),n.svg&&(r-=p-(p*_+m*S),i-=m-(p*E+m*w))):(P=g[6],L=g[7],O=g[8],C=g[9],N=g[10],k=g[11],r=g[12],i=g[13],o=g[14],u=(v=Yn(P,N))*Xn,v&&(R=T*(y=Math.cos(-v))+O*(b=Math.sin(-v)),x=A*y+C*b,I=P*y+N*b,O=T*-b+O*y,C=A*-b+C*y,N=P*-b+N*y,k=L*-b+k*y,T=R,A=x,P=I),l=(v=Yn(-S,N))*Xn,v&&(y=Math.cos(-v),k=w*(b=Math.sin(-v))+k*y,_=R=_*y-O*b,E=x=E*y-C*b,S=I=S*y-N*b),c=(v=Yn(E,_))*Xn,v&&(R=_*(y=Math.cos(v))+E*(b=Math.sin(v)),x=T*y+A*b,E=E*y-_*b,A=A*y-T*b,_=R,T=x),u&&Math.abs(u)+Math.abs(c)>359.9&&(u=c=0,l=180-l),a=we(Math.sqrt(_*_+E*E+S*S)),s=we(Math.sqrt(A*A+P*P)),v=Yn(T,A),d=Math.abs(v)>2e-4?v*Xn:0,f=k?1/(k<0?-k:k):0),n.svg&&(R=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!kr(mr(e,hr)),R&&e.setAttribute("transform",R))),Math.abs(d)>90&&Math.abs(d)<270&&(U?(a*=-1,d+=c<=0?180:-180,c+=c<=0?180:-180):(s*=-1,d+=d<=0?180:-180)),n.x=r-((n.xPercent=r&&(n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-r)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+F,n.y=i-((n.yPercent=i&&(n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-i)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+F,n.z=o+F,n.scaleX=we(a),n.scaleY=we(s),n.rotation=we(c)+j,n.rotationX=we(u)+j,n.rotationY=we(l)+j,n.skewX=d+j,n.skewY=h+j,n.transformPerspective=f+F,(n.zOrigin=parseFloat(B.split(" ")[2])||0)&&(D[fr]=jr(B)),n.xOffset=n.yOffset=0,n.force3D=M.force3D,n.renderTransform=n.svg?qr:xn?Wr:Vr,n.uncache=0,n},jr=function(e){return(e=e.split(" "))[0]+" "+e[1]},Br=function(e,t,n){var r=it(t);return we(parseFloat(t)+parseFloat(Rr(e,"x",n+"px",r)))+r},Vr=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Wr(e,t)},Gr="0deg",Hr="0px",zr=") ",Wr=function(e,t){var n=t||this,r=n.xPercent,i=n.yPercent,o=n.x,a=n.y,s=n.z,c=n.rotation,u=n.rotationY,l=n.rotationX,d=n.skewX,h=n.skewY,f=n.scaleX,p=n.scaleY,m=n.transformPerspective,g=n.force3D,v=n.target,y=n.zOrigin,b="",_="auto"===g&&e&&1!==e||!0===g;if(y&&(l!==Gr||u!==Gr)){var E,S=parseFloat(u)*Jn,w=Math.sin(S),T=Math.cos(S);S=parseFloat(l)*Jn,E=Math.cos(S),o=Br(v,o,w*E*-y),a=Br(v,a,-Math.sin(S)*-y),s=Br(v,s,T*E*-y+y)}m!==Hr&&(b+="perspective("+m+zr),(r||i)&&(b+="translate("+r+"%, "+i+"%) "),(_||o!==Hr||a!==Hr||s!==Hr)&&(b+=s!==Hr||_?"translate3d("+o+", "+a+", "+s+") ":"translate("+o+", "+a+zr),c!==Gr&&(b+="rotate("+c+zr),u!==Gr&&(b+="rotateY("+u+zr),l!==Gr&&(b+="rotateX("+l+zr),d===Gr&&h===Gr||(b+="skew("+d+", "+h+zr),1===f&&1===p||(b+="scale("+f+", "+p+zr),v.style[hr]=b||"translate(0, 0)"},qr=function(e,t){var n,r,i,o,a,s=t||this,c=s.xPercent,u=s.yPercent,l=s.x,d=s.y,h=s.rotation,f=s.skewX,p=s.skewY,m=s.scaleX,g=s.scaleY,v=s.target,y=s.xOrigin,b=s.yOrigin,_=s.xOffset,E=s.yOffset,S=s.forceCSS,w=parseFloat(l),T=parseFloat(d);h=parseFloat(h),f=parseFloat(f),(p=parseFloat(p))&&(f+=p=parseFloat(p),h+=p),h||f?(h*=Jn,f*=Jn,n=Math.cos(h)*m,r=Math.sin(h)*m,i=Math.sin(h-f)*-g,o=Math.cos(h-f)*g,f&&(p*=Jn,a=Math.tan(f-p),i*=a=Math.sqrt(1+a*a),o*=a,p&&(a=Math.tan(p),n*=a=Math.sqrt(1+a*a),r*=a)),n=we(n),r=we(r),i=we(i),o=we(o)):(n=m,o=g,r=i=0),(w&&!~(l+"").indexOf("px")||T&&!~(d+"").indexOf("px"))&&(w=Rr(v,"x",l,"px"),T=Rr(v,"y",d,"px")),(y||b||_||E)&&(w=we(w+y-(y*n+b*i)+_),T=we(T+b-(y*r+b*o)+E)),(c||u)&&(a=v.getBBox(),w=we(w+c/100*a.width),T=we(T+u/100*a.height)),a="matrix("+n+","+r+","+i+","+o+","+w+","+T+")",v.setAttribute("transform",a),S&&(v.style[hr]=a)},Xr=function(e,t,n,r,i,o){var a,s,c=360,u=V(i),l=parseFloat(i)*(u&&~i.indexOf("rad")?Xn:1),d=o?l*o:l-r,h=r+d+"deg";return u&&("short"===(a=i.split("_")[1])&&(d%=c)!==d%180&&(d+=d<0?c:-360),"cw"===a&&d<0?d=(d+36e9)%c-~~(d/c)*c:"ccw"===a&&d>0&&(d=(d-36e9)%c-~~(d/c)*c)),e._pt=s=new gn(e._pt,t,n,r,d,tr),s.e=h,s.u="deg",e._props.push(n),s},Jr=function(e,t){for(var n in t)e[n]=t[n];return e},Yr=function(e,t,n){var r,i,o,a,s,c,u,l=Jr({},n._gsap),d=n.style;for(i in l.svg?(o=n.getAttribute("transform"),n.setAttribute("transform",""),d[hr]=t,r=Fr(n,1),wr(n,hr),n.setAttribute("transform",o)):(o=getComputedStyle(n)[hr],d[hr]=t,r=Fr(n,1),d[hr]=o),qn)(o=l[i])!==(a=r[i])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(i)<0&&(s=it(o)!==(u=it(a))?Rr(n,i,o,u):parseFloat(o),c=parseFloat(a),e._pt=new gn(e._pt,r,i,s,c-s,er),e._pt.u=u||0,e._props.push(i));Jr(r,l)};Se("padding,margin,Width,Radius",(function(e,t){var n="Top",r="Right",i="Bottom",o="Left",a=(t<3?[n,r,i,o]:[n+o,n+r,i+r,i+o]).map((function(n){return t<2?e+n:"border"+n+e}));Mr[t>1?"border"+e:e]=function(e,t,n,r,i){var o,s;if(arguments.length<4)return o=a.map((function(t){return xr(e,t,n)})),5===(s=o.join(" ")).split(o[0]).length?o[0]:s;o=(r+"").split(" "),s={},a.forEach((function(e,t){return s[e]=o[t]=o[t]||o[(t-1)/2|0]})),e.init(t,s,i)}}));var Kr,Qr,Zr,$r={name:"css",register:yr,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,r,i){var o,a,s,c,u,l,d,h,f,p,m,g,v,y,b,_,E,S,w,T=this._props,A=e.style,R=n.vars.startAt;for(d in Tn||yr(),t)if("autoRound"!==d&&(a=t[d],!pe[d]||!Yt(d,t,n,r,e,i)))if(u=typeof a,l=Mr[d],"function"===u&&(u=typeof(a=a.call(n,r,e,i))),"string"===u&&~a.indexOf("random(")&&(a=mt(a)),l)l(this,e,d,a,n)&&(b=1);else if("--"===d.substr(0,2))o=(getComputedStyle(e).getPropertyValue(d)+"").trim(),a+="",xt.lastIndex=0,xt.test(o)||(h=it(o),f=it(a)),f?h!==f&&(o=Rr(e,d,o,f)+f):h&&(a+=h),this.add(A,"setProperty",o,a,r,i,0,0,d),T.push(d);else if("undefined"!==u){if(R&&d in R?(o="function"==typeof R[d]?R[d].call(n,r,e,i):R[d],V(o)&&~o.indexOf("random(")&&(o=mt(o)),it(o+"")||(o+=M.units[d]||it(xr(e,d))||""),"="===(o+"").charAt(1)&&(o=xr(e,d))):o=xr(e,d),c=parseFloat(o),(p="string"===u&&"="===a.charAt(1)?+(a.charAt(0)+"1"):0)&&(a=a.substr(2)),s=parseFloat(a),d in $n&&("autoAlpha"===d&&(1===c&&"hidden"===xr(e,"visibility")&&s&&(c=0),Tr(this,A,"visibility",c?"inherit":"hidden",s?"inherit":"hidden",!s)),"scale"!==d&&"transform"!==d&&~(d=$n[d]).indexOf(",")&&(d=d.split(",")[0])),m=d in qn)if(g||((v=e._gsap).renderTransform&&!t.parseTransform||Fr(e,t.parseTransform),y=!1!==t.smoothOrigin&&v.smooth,(g=this._pt=new gn(this._pt,A,hr,0,1,v.renderTransform,v,0,-1)).dep=1),"scale"===d)this._pt=new gn(this._pt,v,"scaleY",v.scaleY,(p?p*s:s-v.scaleY)||0),T.push("scaleY",d),d+="X";else{if("transformOrigin"===d){E=void 0,S=void 0,w=void 0,E=(_=a).split(" "),S=E[0],w=E[1]||"50%","top"!==S&&"bottom"!==S&&"left"!==w&&"right"!==w||(_=S,S=w,w=_),E[0]=Or[S]||S,E[1]=Or[w]||w,a=E.join(" "),v.svg?Ur(e,a,0,y,0,this):((f=parseFloat(a.split(" ")[2])||0)!==v.zOrigin&&Tr(this,v,"zOrigin",v.zOrigin,f),Tr(this,A,d,jr(o),jr(a)));continue}if("svgOrigin"===d){Ur(e,a,1,y,0,this);continue}if(d in Lr){Xr(this,v,d,c,a,p);continue}if("smoothOrigin"===d){Tr(this,v,"smooth",v.smooth,a);continue}if("force3D"===d){v[d]=a;continue}if("transform"===d){Yr(this,a,e);continue}}else d in A||(d=vr(d)||d);if(m||(s||0===s)&&(c||0===c)&&!Zn.test(a)&&d in A)s||(s=0),(h=(o+"").substr((c+"").length))!==(f=it(a)||(d in M.units?M.units[d]:h))&&(c=Rr(e,d,o,f)),this._pt=new gn(this._pt,m?v:A,d,c,p?p*s:s-c,m||"px"!==f&&"zIndex"!==d||!1===t.autoRound?er:rr),this._pt.u=f||0,h!==f&&"%"!==f&&(this._pt.b=o,this._pt.r=nr);else if(d in A)Ir.call(this,e,d,o,a);else{if(!(d in e)){se(d,a);continue}this.add(e,d,o||e[d],a,r,i)}T.push(d)}b&&mn(this)},get:xr,aliases:$n,getSetter:function(e,t,n){var r=$n[t];return r&&r.indexOf(",")<0&&(t=r),t in qn&&t!==fr&&(e._gsap.x||xr(e,"x"))?n&&Rn===n?"scale"===t?ur:cr:(Rn=n||{})&&("scale"===t?lr:dr):e.style&&!z(e.style[t])?ar:~t.indexOf("-")?sr:sn(e,t)},core:{_removeProperty:wr,_getMatrix:Dr}};_n.utils.checkPrefix=vr,Zr=Se((Kr="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(Qr="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(e){qn[e]=1})),Se(Qr,(function(e){M.units[e]="deg",Lr[e]=1})),$n[Zr[13]]=Kr+","+Qr,Se("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(e){var t=e.split(":");$n[t[1]]=Zr[t[0]]})),Se("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(e){M.units[e]="px"})),_n.registerPlugin($r);var ei=_n.registerPlugin($r)||_n,ti=ei.core.Tween;e.Back=Bn,e.Bounce=Gn,e.CSSPlugin=$r,e.Circ=Wn,e.Cubic=Pn,e.Elastic=jn,e.Expo=zn,e.Linear=Ln,e.Power0=In,e.Power1=On,e.Power2=Cn,e.Power3=Mn,e.Power4=Nn,e.Quad=kn,e.Quart=Dn,e.Quint=Un,e.Sine=Hn,e.SteppedEase=Vn,e.Strong=Fn,e.TimelineLite=Wt,e.TimelineMax=Wt,e.TweenLite=tn,e.TweenMax=ti,e.default=ei,e.gsap=ei,"undefined"==typeof window||window!==e?Object.defineProperty(e,"__esModule",{value:!0}):delete window.default})),
/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THREE={})}(this,(function(e){"use strict";const t="138",n=100,r=300,i=301,o=302,a=303,s=304,c=306,u=307,l=1e3,d=1001,h=1002,f=1003,p=1004,m=1005,g=1006,v=1007,y=1008,b=1009,_=1012,E=1014,S=1015,w=1016,T=1020,A=1023,R=1026,x=1027,I=33776,O=33777,C=33778,M=33779,N=35840,L=35841,k=35842,P=35843,D=37492,U=37496,F=37808,j=37809,B=37810,V=37811,G=37812,H=37813,z=37814,W=37815,q=37816,X=37817,J=37818,Y=37819,K=37820,Q=37821,Z=36492,$=2300,ee=2301,te=2302,ne=2400,re=2401,ie=2402,oe=2500,ae=2501,se=3e3,ce=3001,ue=7680,le=35044,de=35048,he="300 es",fe=1035;class pe{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const me=[];for(let e=0;e<256;e++)me[e]=(e<16?"0":"")+e.toString(16);let ge=1234567;const ve=Math.PI/180,ye=180/Math.PI;function be(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(me[255&e]+me[e>>8&255]+me[e>>16&255]+me[e>>24&255]+"-"+me[255&t]+me[t>>8&255]+"-"+me[t>>16&15|64]+me[t>>24&255]+"-"+me[63&n|128]+me[n>>8&255]+"-"+me[n>>16&255]+me[n>>24&255]+me[255&r]+me[r>>8&255]+me[r>>16&255]+me[r>>24&255]).toUpperCase()}function _e(e,t,n){return Math.max(t,Math.min(n,e))}function Ee(e,t){return(e%t+t)%t}function Se(e,t,n){return(1-n)*e+n*t}function we(e){return 0==(e&e-1)&&0!==e}function Te(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Ae(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Re=Object.freeze({__proto__:null,DEG2RAD:ve,RAD2DEG:ye,generateUUID:be,clamp:_e,euclideanModulo:Ee,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Se,damp:function(e,t,n,r){return Se(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(Ee(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(ge=e%2147483647),ge=16807*ge%2147483647,(ge-1)/2147483646},degToRad:function(e){return e*ve},radToDeg:function(e){return e*ye},isPowerOfTwo:we,ceilPowerOfTwo:Te,floorPowerOfTwo:Ae,setQuaternionFromProperEuler:function(e,t,n,r,i){const o=Math.cos,a=Math.sin,s=o(n/2),c=a(n/2),u=o((t+r)/2),l=a((t+r)/2),d=o((t-r)/2),h=a((t-r)/2),f=o((r-t)/2),p=a((r-t)/2);switch(i){case"XYX":e.set(s*l,c*d,c*h,s*u);break;case"YZY":e.set(c*h,s*l,c*d,s*u);break;case"ZXZ":e.set(c*d,c*h,s*l,s*u);break;case"XZX":e.set(s*l,c*p,c*f,s*u);break;case"YXY":e.set(c*f,s*l,c*p,s*u);break;case"ZYZ":e.set(c*p,c*f,s*l,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}});class xe{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}xe.prototype.isVector2=!0;class Ie{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,a,s,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=i,u[5]=s,u[6]=n,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[3],s=n[6],c=n[1],u=n[4],l=n[7],d=n[2],h=n[5],f=n[8],p=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],_=r[2],E=r[5],S=r[8];return i[0]=o*p+a*v+s*_,i[3]=o*m+a*y+s*E,i[6]=o*g+a*b+s*S,i[1]=c*p+u*v+l*_,i[4]=c*m+u*y+l*E,i[7]=c*g+u*b+l*S,i[2]=d*p+h*v+f*_,i[5]=d*m+h*y+f*E,i[8]=d*g+h*b+f*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-n*i*u+n*a*s+r*i*c-r*o*s}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],c=e[7],u=e[8],l=u*o-a*c,d=a*s-u*i,h=c*i-o*s,f=t*l+n*d+r*h;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return e[0]=l*p,e[1]=(r*c-u*n)*p,e[2]=(a*n-r*o)*p,e[3]=d*p,e[4]=(u*t-r*s)*p,e[5]=(r*i-a*t)*p,e[6]=h*p,e[7]=(n*s-c*t)*p,e[8]=(o*t-n*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,o,a){const s=Math.cos(i),c=Math.sin(i);return this.set(n*s,n*c,-n*(s*o+c*a)+o+e,-r*c,r*s,-r*(-c*o+s*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],c=r[4],u=r[7];return r[0]=t*i+n*s,r[3]=t*o+n*c,r[6]=t*a+n*u,r[1]=-n*i+t*s,r[4]=-n*o+t*c,r[7]=-n*a+t*u,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function Oe(e){for(let t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}Ie.prototype.isMatrix3=!0;const Ce={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Me(e,t){return new Ce[e](t)}function Ne(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}const Le={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ke={h:0,s:0,l:0},Pe={h:0,s:0,l:0};function De(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Ue(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Fe(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class je{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Ee(e,1),t=_e(t,0,1),n=_e(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=De(i,r,e+1/3),this.g=De(i,r,e),this.b=De(i,r,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,i=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Le[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ue(e.r),this.g=Ue(e.g),this.b=Ue(e.b),this}copyLinearToSRGB(e){return this.r=Fe(e.r),this.g=Fe(e.g),this.b=Fe(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),o=Math.min(t,n,r);let a,s;const c=(o+i)/2;if(o===i)a=0,s=0;else{const e=i-o;switch(s=c<=.5?e/(i+o):e/(2-i-o),i){case t:a=(n-r)/e+(n<r?6:0);break;case n:a=(r-t)/e+2;break;case r:a=(t-n)/e+4}a/=6}return e.h=a,e.s=s,e.l=c,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(ke),ke.h+=e,ke.s+=t,ke.l+=n,this.setHSL(ke.h,ke.s,ke.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(ke),e.getHSL(Pe);const n=Se(ke.h,Pe.h,t),r=Se(ke.s,Pe.s,t),i=Se(ke.l,Pe.l,t);return this.setHSL(n,r,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let Be;je.NAMES=Le,je.prototype.isColor=!0,je.prototype.r=1,je.prototype.g=1,je.prototype.b=1;class Ve{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Be&&(Be=Ne("canvas")),Be.width=e.width,Be.height=e.height;const n=Be.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Be}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Ne("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*Ue(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Ue(t[e]/255)):t[e]=Ue(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Ge{constructor(e=null){this.uuid=be(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(He(r[t].image)):e.push(He(r[t]))}else e=He(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function He(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Ve.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Ge.prototype.isSource=!0;let ze=0;class We extends pe{constructor(e=We.DEFAULT_IMAGE,t=We.DEFAULT_MAPPING,n=1001,r=1001,i=1006,o=1008,a=1023,s=1009,c=1,u=3e3){super(),Object.defineProperty(this,"id",{value:ze++}),this.uuid=be(),this.name="",this.source=new Ge(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=s,this.offset=new xe(0,0),this.repeat=new xe(1,1),this.center=new xe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ie,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==r)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case l:e.x=e.x-Math.floor(e.x);break;case d:e.x=e.x<0?0:1;break;case h:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case l:e.y=e.y-Math.floor(e.y);break;case d:e.y=e.y<0?0:1;break;case h:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}We.DEFAULT_IMAGE=null,We.DEFAULT_MAPPING=r,We.prototype.isTexture=!0;class qe{constructor(e=0,t=0,n=0,r=1){this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const o=.01,a=.1,s=e.elements,c=s[0],u=s[4],l=s[8],d=s[1],h=s[5],f=s[9],p=s[2],m=s[6],g=s[10];if(Math.abs(u-d)<o&&Math.abs(l-p)<o&&Math.abs(f-m)<o){if(Math.abs(u+d)<a&&Math.abs(l+p)<a&&Math.abs(f+m)<a&&Math.abs(c+h+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(c+1)/2,s=(h+1)/2,v=(g+1)/2,y=(u+d)/4,b=(l+p)/4,_=(f+m)/4;return e>s&&e>v?e<o?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=y/n,i=b/n):s>v?s<o?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=y/r,i=_/r):v<o?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=b/i,r=_/i),this.set(n,r,i,t),this}let v=Math.sqrt((m-f)*(m-f)+(l-p)*(l-p)+(d-u)*(d-u));return Math.abs(v)<.001&&(v=1),this.x=(m-f)/v,this.y=(l-p)/v,this.z=(d-u)/v,this.w=Math.acos((c+h+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}qe.prototype.isVector4=!0;class Xe extends pe{constructor(e,t,n={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new qe(0,0,e,t),this.scissorTest=!1,this.viewport=new qe(0,0,e,t);const r={width:e,height:t,depth:1};this.texture=new We(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:g,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}Xe.prototype.isWebGLRenderTarget=!0;class Je extends We{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=f,this.minFilter=f,this.wrapR=d,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Je.prototype.isDataArrayTexture=!0;class Ye extends Xe{constructor(e,t,n){super(e,t),this.depth=n,this.texture=new Je(null,e,t,n),this.texture.isRenderTargetTexture=!0}}Ye.prototype.isWebGLArrayRenderTarget=!0;class Ke extends We{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=f,this.minFilter=f,this.wrapR=d,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Ke.prototype.isData3DTexture=!0;class Qe extends Xe{constructor(e,t,n){super(e,t),this.depth=n,this.texture=new Ke(null,e,t,n),this.texture.isRenderTargetTexture=!0}}Qe.prototype.isWebGL3DRenderTarget=!0;class Ze extends Xe{constructor(e,t,n,r={}){super(e,t,r);const i=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=i.clone(),this.texture[e].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}Ze.prototype.isWebGLMultipleRenderTargets=!0;class $e{constructor(e=0,t=0,n=0,r=1){this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}static slerpFlat(e,t,n,r,i,o,a){let s=n[r+0],c=n[r+1],u=n[r+2],l=n[r+3];const d=i[o+0],h=i[o+1],f=i[o+2],p=i[o+3];if(0===a)return e[t+0]=s,e[t+1]=c,e[t+2]=u,void(e[t+3]=l);if(1===a)return e[t+0]=d,e[t+1]=h,e[t+2]=f,void(e[t+3]=p);if(l!==p||s!==d||c!==h||u!==f){let e=1-a;const t=s*d+c*h+u*f+l*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,t*n);e=Math.sin(e*o)/i,a=Math.sin(a*o)/i}const i=a*n;if(s=s*e+d*i,c=c*e+h*i,u=u*e+f*i,l=l*e+p*i,e===1-a){const e=1/Math.sqrt(s*s+c*c+u*u+l*l);s*=e,c*=e,u*=e,l*=e}}e[t]=s,e[t+1]=c,e[t+2]=u,e[t+3]=l}static multiplyQuaternionsFlat(e,t,n,r,i,o){const a=n[r],s=n[r+1],c=n[r+2],u=n[r+3],l=i[o],d=i[o+1],h=i[o+2],f=i[o+3];return e[t]=a*f+u*l+s*h-c*d,e[t+1]=s*f+u*d+c*l-a*h,e[t+2]=c*f+u*h+a*d-s*l,e[t+3]=u*f-a*l-s*d-c*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,r=e._y,i=e._z,o=e._order,a=Math.cos,s=Math.sin,c=a(n/2),u=a(r/2),l=a(i/2),d=s(n/2),h=s(r/2),f=s(i/2);switch(o){case"XYZ":this._x=d*u*l+c*h*f,this._y=c*h*l-d*u*f,this._z=c*u*f+d*h*l,this._w=c*u*l-d*h*f;break;case"YXZ":this._x=d*u*l+c*h*f,this._y=c*h*l-d*u*f,this._z=c*u*f-d*h*l,this._w=c*u*l+d*h*f;break;case"ZXY":this._x=d*u*l-c*h*f,this._y=c*h*l+d*u*f,this._z=c*u*f+d*h*l,this._w=c*u*l-d*h*f;break;case"ZYX":this._x=d*u*l-c*h*f,this._y=c*h*l+d*u*f,this._z=c*u*f-d*h*l,this._w=c*u*l+d*h*f;break;case"YZX":this._x=d*u*l+c*h*f,this._y=c*h*l+d*u*f,this._z=c*u*f-d*h*l,this._w=c*u*l-d*h*f;break;case"XZY":this._x=d*u*l-c*h*f,this._y=c*h*l-d*u*f,this._z=c*u*f+d*h*l,this._w=c*u*l+d*h*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],a=t[5],s=t[9],c=t[2],u=t[6],l=t[10],d=n+a+l;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(u-s)*e,this._y=(i-c)*e,this._z=(o-r)*e}else if(n>a&&n>l){const e=2*Math.sqrt(1+n-a-l);this._w=(u-s)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(i+c)/e}else if(a>l){const e=2*Math.sqrt(1+a-n-l);this._w=(i-c)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(s+u)/e}else{const e=2*Math.sqrt(1+l-n-a);this._w=(o-r)/e,this._x=(i+c)/e,this._y=(s+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(_e(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,o=e._w,a=t._x,s=t._y,c=t._z,u=t._w;return this._x=n*u+o*a+r*c-i*s,this._y=r*u+o*s+i*a-n*c,this._z=i*u+o*c+n*s-r*a,this._w=o*u-n*a-r*s-i*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(s),u=Math.atan2(c,a),l=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=o*l+this._w*d,this._x=n*l+this._x*d,this._y=r*l+this._y*d,this._z=i*l+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(i),n*Math.cos(i),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}$e.prototype.isQuaternion=!0;class et{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(nt.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(nt.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,a=e.z,s=e.w,c=s*t+o*r-a*n,u=s*n+a*t-i*r,l=s*r+i*n-o*t,d=-i*t-o*n-a*r;return this.x=c*s+d*-i+u*-a-l*-o,this.y=u*s+d*-o+l*-i-c*-a,this.z=l*s+d*-a+c*-o-u*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return tt.copy(this).projectOnVector(e),this.sub(tt)}reflect(e){return this.sub(tt.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(_e(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}et.prototype.isVector3=!0;const tt=new et,nt=new $e;class rt{constructor(e=new et(1/0,1/0,1/0),t=new et(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0;for(let s=0,c=e.length;s<c;s+=3){const c=e[s],u=e[s+1],l=e[s+2];c<t&&(t=c),u<n&&(n=u),l<r&&(r=l),c>i&&(i=c),u>o&&(o=u),l>a&&(a=l)}return this.min.set(t,n,r),this.max.set(i,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0;for(let s=0,c=e.count;s<c;s++){const c=e.getX(s),u=e.getY(s),l=e.getZ(s);c<t&&(t=c),u<n&&(n=u),l<r&&(r=l),c>i&&(i=c),u>o&&(o=u),l>a&&(a=l)}return this.min.set(t,n,r),this.max.set(i,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ot.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,r=t.count;n<r;n++)ot.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(ot)}else null===n.boundingBox&&n.computeBoundingBox(),at.copy(n.boundingBox),at.applyMatrix4(e.matrixWorld),this.union(at);const r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ot),ot.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ft),pt.subVectors(this.max,ft),st.subVectors(e.a,ft),ct.subVectors(e.b,ft),ut.subVectors(e.c,ft),lt.subVectors(ct,st),dt.subVectors(ut,ct),ht.subVectors(st,ut);let t=[0,-lt.z,lt.y,0,-dt.z,dt.y,0,-ht.z,ht.y,lt.z,0,-lt.x,dt.z,0,-dt.x,ht.z,0,-ht.x,-lt.y,lt.x,0,-dt.y,dt.x,0,-ht.y,ht.x,0];return!!vt(t,st,ct,ut,pt)&&(t=[1,0,0,0,1,0,0,0,1],!!vt(t,st,ct,ut,pt)&&(mt.crossVectors(lt,dt),t=[mt.x,mt.y,mt.z],vt(t,st,ct,ut,pt)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return ot.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(ot).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(it[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),it[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),it[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),it[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),it[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),it[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),it[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),it[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(it)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}rt.prototype.isBox3=!0;const it=[new et,new et,new et,new et,new et,new et,new et,new et],ot=new et,at=new rt,st=new et,ct=new et,ut=new et,lt=new et,dt=new et,ht=new et,ft=new et,pt=new et,mt=new et,gt=new et;function vt(e,t,n,r,i){for(let o=0,a=e.length-3;o<=a;o+=3){gt.fromArray(e,o);const a=i.x*Math.abs(gt.x)+i.y*Math.abs(gt.y)+i.z*Math.abs(gt.z),s=t.dot(gt),c=n.dot(gt),u=r.dot(gt);if(Math.max(-Math.max(s,c,u),Math.min(s,c,u))>a)return!1}return!0}const yt=new rt,bt=new et,_t=new et,Et=new et;class St{constructor(e=new et,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):yt.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Et.subVectors(e,this.center);const t=Et.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(Et.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return!0===this.center.equals(e.center)?_t.set(0,0,1).multiplyScalar(e.radius):_t.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(bt.copy(e.center).add(_t)),this.expandByPoint(bt.copy(e.center).sub(_t)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const wt=new et,Tt=new et,At=new et,Rt=new et,xt=new et,It=new et,Ot=new et;class Ct{constructor(e=new et,t=new et(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,wt)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=wt.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(wt.copy(this.direction).multiplyScalar(t).add(this.origin),wt.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Tt.copy(e).add(t).multiplyScalar(.5),At.copy(t).sub(e).normalize(),Rt.copy(this.origin).sub(Tt);const i=.5*e.distanceTo(t),o=-this.direction.dot(At),a=Rt.dot(this.direction),s=-Rt.dot(At),c=Rt.lengthSq(),u=Math.abs(1-o*o);let l,d,h,f;if(u>0)if(l=o*s-a,d=o*a-s,f=i*u,l>=0)if(d>=-f)if(d<=f){const e=1/u;l*=e,d*=e,h=l*(l+o*d+2*a)+d*(o*l+d+2*s)+c}else d=i,l=Math.max(0,-(o*d+a)),h=-l*l+d*(d+2*s)+c;else d=-i,l=Math.max(0,-(o*d+a)),h=-l*l+d*(d+2*s)+c;else d<=-f?(l=Math.max(0,-(-o*i+a)),d=l>0?-i:Math.min(Math.max(-i,-s),i),h=-l*l+d*(d+2*s)+c):d<=f?(l=0,d=Math.min(Math.max(-i,-s),i),h=d*(d+2*s)+c):(l=Math.max(0,-(o*i+a)),d=l>0?i:Math.min(Math.max(-i,-s),i),h=-l*l+d*(d+2*s)+c);else d=o>0?-i:i,l=Math.max(0,-(o*d+a)),h=-l*l+d*(d+2*s)+c;return n&&n.copy(this.direction).multiplyScalar(l).add(this.origin),r&&r.copy(At).multiplyScalar(d).add(Tt),h}intersectSphere(e,t){wt.subVectors(e.center,this.origin);const n=wt.dot(this.direction),r=wt.dot(wt)-n*n,i=e.radius*e.radius;if(r>i)return null;const o=Math.sqrt(i-r),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,o,a,s;const c=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,d=this.origin;return c>=0?(n=(e.min.x-d.x)*c,r=(e.max.x-d.x)*c):(n=(e.max.x-d.x)*c,r=(e.min.x-d.x)*c),u>=0?(i=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(i=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),l>=0?(a=(e.min.z-d.z)*l,s=(e.max.z-d.z)*l):(a=(e.max.z-d.z)*l,s=(e.min.z-d.z)*l),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,wt)}intersectTriangle(e,t,n,r,i){xt.subVectors(t,e),It.subVectors(n,e),Ot.crossVectors(xt,It);let o,a=this.direction.dot(Ot);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Rt.subVectors(this.origin,e);const s=o*this.direction.dot(It.crossVectors(Rt,It));if(s<0)return null;const c=o*this.direction.dot(xt.cross(Rt));if(c<0)return null;if(s+c>a)return null;const u=-o*Rt.dot(Ot);return u<0?null:this.at(u/a,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Mt{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,a,s,c,u,l,d,h,f,p,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=c,g[6]=u,g[10]=l,g[14]=d,g[3]=h,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Mt).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Nt.setFromMatrixColumn(e,0).length(),i=1/Nt.setFromMatrixColumn(e,1).length(),o=1/Nt.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),c=Math.sin(r),u=Math.cos(i),l=Math.sin(i);if("XYZ"===e.order){const e=o*u,n=o*l,r=a*u,i=a*l;t[0]=s*u,t[4]=-s*l,t[8]=c,t[1]=n+r*c,t[5]=e-i*c,t[9]=-a*s,t[2]=i-e*c,t[6]=r+n*c,t[10]=o*s}else if("YXZ"===e.order){const e=s*u,n=s*l,r=c*u,i=c*l;t[0]=e+i*a,t[4]=r*a-n,t[8]=o*c,t[1]=o*l,t[5]=o*u,t[9]=-a,t[2]=n*a-r,t[6]=i+e*a,t[10]=o*s}else if("ZXY"===e.order){const e=s*u,n=s*l,r=c*u,i=c*l;t[0]=e-i*a,t[4]=-o*l,t[8]=r+n*a,t[1]=n+r*a,t[5]=o*u,t[9]=i-e*a,t[2]=-o*c,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){const e=o*u,n=o*l,r=a*u,i=a*l;t[0]=s*u,t[4]=r*c-n,t[8]=e*c+i,t[1]=s*l,t[5]=i*c+e,t[9]=n*c-r,t[2]=-c,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){const e=o*s,n=o*c,r=a*s,i=a*c;t[0]=s*u,t[4]=i-e*l,t[8]=r*l+n,t[1]=l,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=n*l+r,t[10]=e-i*l}else if("XZY"===e.order){const e=o*s,n=o*c,r=a*s,i=a*c;t[0]=s*u,t[4]=-l,t[8]=c*u,t[1]=e*l+i,t[5]=o*u,t[9]=n*l-r,t[2]=r*l-n,t[6]=a*u,t[10]=i*l+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(kt,e,Pt)}lookAt(e,t,n){const r=this.elements;return Ft.subVectors(e,t),0===Ft.lengthSq()&&(Ft.z=1),Ft.normalize(),Dt.crossVectors(n,Ft),0===Dt.lengthSq()&&(1===Math.abs(n.z)?Ft.x+=1e-4:Ft.z+=1e-4,Ft.normalize(),Dt.crossVectors(n,Ft)),Dt.normalize(),Ut.crossVectors(Ft,Dt),r[0]=Dt.x,r[4]=Ut.x,r[8]=Ft.x,r[1]=Dt.y,r[5]=Ut.y,r[9]=Ft.y,r[2]=Dt.z,r[6]=Ut.z,r[10]=Ft.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[4],s=n[8],c=n[12],u=n[1],l=n[5],d=n[9],h=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],_=n[15],E=r[0],S=r[4],w=r[8],T=r[12],A=r[1],R=r[5],x=r[9],I=r[13],O=r[2],C=r[6],M=r[10],N=r[14],L=r[3],k=r[7],P=r[11],D=r[15];return i[0]=o*E+a*A+s*O+c*L,i[4]=o*S+a*R+s*C+c*k,i[8]=o*w+a*x+s*M+c*P,i[12]=o*T+a*I+s*N+c*D,i[1]=u*E+l*A+d*O+h*L,i[5]=u*S+l*R+d*C+h*k,i[9]=u*w+l*x+d*M+h*P,i[13]=u*T+l*I+d*N+h*D,i[2]=f*E+p*A+m*O+g*L,i[6]=f*S+p*R+m*C+g*k,i[10]=f*w+p*x+m*M+g*P,i[14]=f*T+p*I+m*N+g*D,i[3]=v*E+y*A+b*O+_*L,i[7]=v*S+y*R+b*C+_*k,i[11]=v*w+y*x+b*M+_*P,i[15]=v*T+y*I+b*N+_*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],a=e[5],s=e[9],c=e[13],u=e[2],l=e[6],d=e[10],h=e[14];return e[3]*(+i*s*l-r*c*l-i*a*d+n*c*d+r*a*h-n*s*h)+e[7]*(+t*s*h-t*c*d+i*o*d-r*o*h+r*c*u-i*s*u)+e[11]*(+t*c*l-t*a*h-i*o*l+n*o*h+i*a*u-n*c*u)+e[15]*(-r*a*u-t*s*l+t*a*d+r*o*l-n*o*d+n*s*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],c=e[7],u=e[8],l=e[9],d=e[10],h=e[11],f=e[12],p=e[13],m=e[14],g=e[15],v=l*m*c-p*d*c+p*s*h-a*m*h-l*s*g+a*d*g,y=f*d*c-u*m*c-f*s*h+o*m*h+u*s*g-o*d*g,b=u*p*c-f*l*c+f*a*h-o*p*h-u*a*g+o*l*g,_=f*l*s-u*p*s-f*a*d+o*p*d+u*a*m-o*l*m,E=t*v+n*y+r*b+i*_;if(0===E)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/E;return e[0]=v*S,e[1]=(p*d*i-l*m*i-p*r*h+n*m*h+l*r*g-n*d*g)*S,e[2]=(a*m*i-p*s*i+p*r*c-n*m*c-a*r*g+n*s*g)*S,e[3]=(l*s*i-a*d*i-l*r*c+n*d*c+a*r*h-n*s*h)*S,e[4]=y*S,e[5]=(u*m*i-f*d*i+f*r*h-t*m*h-u*r*g+t*d*g)*S,e[6]=(f*s*i-o*m*i-f*r*c+t*m*c+o*r*g-t*s*g)*S,e[7]=(o*d*i-u*s*i+u*r*c-t*d*c-o*r*h+t*s*h)*S,e[8]=b*S,e[9]=(f*l*i-u*p*i-f*n*h+t*p*h+u*n*g-t*l*g)*S,e[10]=(o*p*i-f*a*i+f*n*c-t*p*c-o*n*g+t*a*g)*S,e[11]=(u*a*i-o*l*i-u*n*c+t*l*c+o*n*h-t*a*h)*S,e[12]=_*S,e[13]=(u*p*r-f*l*r+f*n*d-t*p*d-u*n*m+t*l*m)*S,e[14]=(f*a*r-o*p*r-f*n*s+t*p*s+o*n*m-t*a*m)*S,e[15]=(o*l*r-u*a*r+u*n*s-t*l*s-o*n*d+t*a*d)*S,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,a=e.y,s=e.z,c=i*o,u=i*a;return this.set(c*o+n,c*a-r*s,c*s+r*a,0,c*a+r*s,u*a+n,u*s-r*o,0,c*s-r*a,u*s+r*o,i*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,o){return this.set(1,n,i,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,o=t._y,a=t._z,s=t._w,c=i+i,u=o+o,l=a+a,d=i*c,h=i*u,f=i*l,p=o*u,m=o*l,g=a*l,v=s*c,y=s*u,b=s*l,_=n.x,E=n.y,S=n.z;return r[0]=(1-(p+g))*_,r[1]=(h+b)*_,r[2]=(f-y)*_,r[3]=0,r[4]=(h-b)*E,r[5]=(1-(d+g))*E,r[6]=(m+v)*E,r[7]=0,r[8]=(f+y)*S,r[9]=(m-v)*S,r[10]=(1-(d+p))*S,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=Nt.set(r[0],r[1],r[2]).length();const o=Nt.set(r[4],r[5],r[6]).length(),a=Nt.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Lt.copy(this);const s=1/i,c=1/o,u=1/a;return Lt.elements[0]*=s,Lt.elements[1]*=s,Lt.elements[2]*=s,Lt.elements[4]*=c,Lt.elements[5]*=c,Lt.elements[6]*=c,Lt.elements[8]*=u,Lt.elements[9]*=u,Lt.elements[10]*=u,t.setFromRotationMatrix(Lt),n.x=i,n.y=o,n.z=a,this}makePerspective(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,s=2*i/(t-e),c=2*i/(n-r),u=(t+e)/(t-e),l=(n+r)/(n-r),d=-(o+i)/(o-i),h=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,r,i,o){const a=this.elements,s=1/(t-e),c=1/(n-r),u=1/(o-i),l=(t+e)*s,d=(n+r)*c,h=(o+i)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-h,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}Mt.prototype.isMatrix4=!0;const Nt=new et,Lt=new Mt,kt=new et(0,0,0),Pt=new et(1,1,1),Dt=new et,Ut=new et,Ft=new et,jt=new Mt,Bt=new $e;class Vt{constructor(e=0,t=0,n=0,r=Vt.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],o=r[4],a=r[8],s=r[1],c=r[5],u=r[9],l=r[2],d=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(_e(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,h),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-_e(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(s,c)):(this._y=Math.atan2(-l,i),this._z=0);break;case"ZXY":this._x=Math.asin(_e(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-l,h),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-_e(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(_e(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-_e(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-u,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return jt.makeRotationFromQuaternion(e),this.setFromRotationMatrix(jt,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Bt.setFromEuler(this),this.setFromQuaternion(Bt,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Vt.prototype.isEuler=!0,Vt.DefaultOrder="XYZ",Vt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Gt{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let Ht=0;const zt=new et,Wt=new $e,qt=new Mt,Xt=new et,Jt=new et,Yt=new et,Kt=new $e,Qt=new et(1,0,0),Zt=new et(0,1,0),$t=new et(0,0,1),en={type:"added"},tn={type:"removed"};class nn extends pe{constructor(){super(),Object.defineProperty(this,"id",{value:Ht++}),this.uuid=be(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=nn.DefaultUp.clone();const e=new et,t=new Vt,n=new $e,r=new et(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Mt},normalMatrix:{value:new Ie}}),this.matrix=new Mt,this.matrixWorld=new Mt,this.matrixAutoUpdate=nn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Gt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Wt.setFromAxisAngle(e,t),this.quaternion.multiply(Wt),this}rotateOnWorldAxis(e,t){return Wt.setFromAxisAngle(e,t),this.quaternion.premultiply(Wt),this}rotateX(e){return this.rotateOnAxis(Qt,e)}rotateY(e){return this.rotateOnAxis(Zt,e)}rotateZ(e){return this.rotateOnAxis($t,e)}translateOnAxis(e,t){return zt.copy(e).applyQuaternion(this.quaternion),this.position.add(zt.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Qt,e)}translateY(e){return this.translateOnAxis(Zt,e)}translateZ(e){return this.translateOnAxis($t,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(qt.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Xt.copy(e):Xt.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Jt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qt.lookAt(Jt,Xt,this.up):qt.lookAt(Xt,Jt,this.up),this.quaternion.setFromRotationMatrix(qt),r&&(qt.extractRotation(r.matrixWorld),Wt.setFromRotationMatrix(qt),this.quaternion.premultiply(Wt.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(en)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(tn)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(tn)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),qt.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),qt.multiply(e.parent.matrixWorld)),e.applyMatrix4(qt),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Jt,e,Yt),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Jt,Kt,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=o(e.geometries),r=o(e.materials),i=o(e.textures),a=o(e.images),s=o(e.shapes),c=o(e.skeletons),u=o(e.animations),l=o(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),c.length>0&&(n.skeletons=c),u.length>0&&(n.animations=u),l.length>0&&(n.nodes=l)}return n.object=r,n;function o(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}nn.DefaultUp=new et(0,1,0),nn.DefaultMatrixAutoUpdate=!0,nn.prototype.isObject3D=!0;const rn=new et,on=new et,an=new et,sn=new et,cn=new et,un=new et,ln=new et,dn=new et,hn=new et,fn=new et;class pn{constructor(e=new et,t=new et,n=new et){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),rn.subVectors(e,t),r.cross(rn);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){rn.subVectors(r,t),on.subVectors(n,t),an.subVectors(e,t);const o=rn.dot(rn),a=rn.dot(on),s=rn.dot(an),c=on.dot(on),u=on.dot(an),l=o*c-a*a;if(0===l)return i.set(-2,-1,-1);const d=1/l,h=(c*s-a*u)*d,f=(o*u-a*s)*d;return i.set(1-h-f,f,h)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,sn),sn.x>=0&&sn.y>=0&&sn.x+sn.y<=1}static getUV(e,t,n,r,i,o,a,s){return this.getBarycoord(e,t,n,r,sn),s.set(0,0),s.addScaledVector(i,sn.x),s.addScaledVector(o,sn.y),s.addScaledVector(a,sn.z),s}static isFrontFacing(e,t,n,r){return rn.subVectors(n,t),on.subVectors(e,t),rn.cross(on).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return rn.subVectors(this.c,this.b),on.subVectors(this.a,this.b),.5*rn.cross(on).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return pn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return pn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return pn.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return pn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return pn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let o,a;cn.subVectors(r,n),un.subVectors(i,n),dn.subVectors(e,n);const s=cn.dot(dn),c=un.dot(dn);if(s<=0&&c<=0)return t.copy(n);hn.subVectors(e,r);const u=cn.dot(hn),l=un.dot(hn);if(u>=0&&l<=u)return t.copy(r);const d=s*l-u*c;if(d<=0&&s>=0&&u<=0)return o=s/(s-u),t.copy(n).addScaledVector(cn,o);fn.subVectors(e,i);const h=cn.dot(fn),f=un.dot(fn);if(f>=0&&h<=f)return t.copy(i);const p=h*c-s*f;if(p<=0&&c>=0&&f<=0)return a=c/(c-f),t.copy(n).addScaledVector(un,a);const m=u*f-h*l;if(m<=0&&l-u>=0&&h-f>=0)return ln.subVectors(i,r),a=(l-u)/(l-u+(h-f)),t.copy(r).addScaledVector(ln,a);const g=1/(m+p+d);return o=p*g,a=d*g,t.copy(n).addScaledVector(cn,o).addScaledVector(un,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let mn=0;class gn extends pe{constructor(){super(),Object.defineProperty(this,"id",{value:mn++}),this.uuid=be(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=n,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ue,this.stencilZFail=ue,this.stencilZPass=ue,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}gn.prototype.isMaterial=!0,gn.fromType=function(){return null};class vn extends gn{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new je(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}vn.prototype.isMeshBasicMaterial=!0;const yn=new et,bn=new xe;class _n{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=le,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new je),t[n++]=i.r,t[n++]=i.g,t[n++]=i.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new xe),t[n++]=i.x,t[n++]=i.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new et),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new qe),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n++]=i.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)bn.fromBufferAttribute(this,t),bn.applyMatrix3(e),this.setXY(t,bn.x,bn.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)yn.fromBufferAttribute(this,t),yn.applyMatrix3(e),this.setXYZ(t,yn.x,yn.y,yn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)yn.x=this.getX(t),yn.y=this.getY(t),yn.z=this.getZ(t),yn.applyMatrix4(e),this.setXYZ(t,yn.x,yn.y,yn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)yn.x=this.getX(t),yn.y=this.getY(t),yn.z=this.getZ(t),yn.applyNormalMatrix(e),this.setXYZ(t,yn.x,yn.y,yn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)yn.x=this.getX(t),yn.y=this.getY(t),yn.z=this.getZ(t),yn.transformDirection(e),this.setXYZ(t,yn.x,yn.y,yn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==le&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}_n.prototype.isBufferAttribute=!0;class En extends _n{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Sn extends _n{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class wn extends _n{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Tn extends _n{constructor(e,t,n){super(new Int16Array(e),t,n)}}class An extends _n{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Rn extends _n{constructor(e,t,n){super(new Int32Array(e),t,n)}}class xn extends _n{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class In extends _n{constructor(e,t,n){super(new Uint16Array(e),t,n)}}In.prototype.isFloat16BufferAttribute=!0;class On extends _n{constructor(e,t,n){super(new Float32Array(e),t,n)}}class Cn extends _n{constructor(e,t,n){super(new Float64Array(e),t,n)}}let Mn=0;const Nn=new Mt,Ln=new nn,kn=new et,Pn=new rt,Dn=new rt,Un=new et;class Fn extends pe{constructor(){super(),Object.defineProperty(this,"id",{value:Mn++}),this.uuid=be(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Oe(e)?xn:An)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Ie).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Nn.makeRotationFromQuaternion(e),this.applyMatrix4(Nn),this}rotateX(e){return Nn.makeRotationX(e),this.applyMatrix4(Nn),this}rotateY(e){return Nn.makeRotationY(e),this.applyMatrix4(Nn),this}rotateZ(e){return Nn.makeRotationZ(e),this.applyMatrix4(Nn),this}translate(e,t,n){return Nn.makeTranslation(e,t,n),this.applyMatrix4(Nn),this}scale(e,t,n){return Nn.makeScale(e,t,n),this.applyMatrix4(Nn),this}lookAt(e){return Ln.lookAt(e),Ln.updateMatrix(),this.applyMatrix4(Ln.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(kn).negate(),this.translate(kn.x,kn.y,kn.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new On(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new rt);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new et(-1/0,-1/0,-1/0),new et(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Pn.setFromBufferAttribute(n),this.morphTargetsRelative?(Un.addVectors(this.boundingBox.min,Pn.min),this.boundingBox.expandByPoint(Un),Un.addVectors(this.boundingBox.max,Pn.max),this.boundingBox.expandByPoint(Un)):(this.boundingBox.expandByPoint(Pn.min),this.boundingBox.expandByPoint(Pn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new St);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new et,1/0);if(e){const n=this.boundingSphere.center;if(Pn.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Dn.setFromBufferAttribute(n),this.morphTargetsRelative?(Un.addVectors(Pn.min,Dn.min),Pn.expandByPoint(Un),Un.addVectors(Pn.max,Dn.max),Pn.expandByPoint(Un)):(Pn.expandByPoint(Dn.min),Pn.expandByPoint(Dn.max))}Pn.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)Un.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(Un));if(t)for(let i=0,o=t.length;i<o;i++){const o=t[i],a=this.morphTargetsRelative;for(let t=0,i=o.count;t<i;t++)Un.fromBufferAttribute(o,t),a&&(kn.fromBufferAttribute(e,t),Un.add(kn)),r=Math.max(r,n.distanceToSquared(Un))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,r=t.position.array,i=t.normal.array,o=t.uv.array,a=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new _n(new Float32Array(4*a),4));const s=this.getAttribute("tangent").array,c=[],u=[];for(let e=0;e<a;e++)c[e]=new et,u[e]=new et;const l=new et,d=new et,h=new et,f=new xe,p=new xe,m=new xe,g=new et,v=new et;function y(e,t,n){l.fromArray(r,3*e),d.fromArray(r,3*t),h.fromArray(r,3*n),f.fromArray(o,2*e),p.fromArray(o,2*t),m.fromArray(o,2*n),d.sub(l),h.sub(l),p.sub(f),m.sub(f);const i=1/(p.x*m.y-m.x*p.y);isFinite(i)&&(g.copy(d).multiplyScalar(m.y).addScaledVector(h,-p.y).multiplyScalar(i),v.copy(h).multiplyScalar(p.x).addScaledVector(d,-m.x).multiplyScalar(i),c[e].add(g),c[t].add(g),c[n].add(g),u[e].add(v),u[t].add(v),u[n].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(let e=0,t=b.length;e<t;++e){const t=b[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)y(n[e+0],n[e+1],n[e+2])}const _=new et,E=new et,S=new et,w=new et;function T(e){S.fromArray(i,3*e),w.copy(S);const t=c[e];_.copy(t),_.sub(S.multiplyScalar(S.dot(t))).normalize(),E.crossVectors(w,t);const n=E.dot(u[e])<0?-1:1;s[4*e]=_.x,s[4*e+1]=_.y,s[4*e+2]=_.z,s[4*e+3]=n}for(let e=0,t=b.length;e<t;++e){const t=b[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)T(n[e+0]),T(n[e+1]),T(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new _n(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new et,i=new et,o=new et,a=new et,s=new et,c=new et,u=new et,l=new et;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),f=e.getX(d+1),p=e.getX(d+2);r.fromBufferAttribute(t,h),i.fromBufferAttribute(t,f),o.fromBufferAttribute(t,p),u.subVectors(o,i),l.subVectors(r,i),u.cross(l),a.fromBufferAttribute(n,h),s.fromBufferAttribute(n,f),c.fromBufferAttribute(n,p),a.add(u),s.add(u),c.add(u),n.setXYZ(h,a.x,a.y,a.z),n.setXYZ(f,s.x,s.y,s.z),n.setXYZ(p,c.x,c.y,c.z)}else for(let e=0,a=t.count;e<a;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),u.subVectors(o,i),l.subVectors(r,i),u.cross(l),n.setXYZ(e+0,u.x,u.y,u.z),n.setXYZ(e+1,u.x,u.y,u.z),n.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===e.attributes[r])continue;const i=n[r].array,o=e.attributes[r],a=o.array,s=o.itemSize*t,c=Math.min(a.length,i.length-s);for(let e=0,t=s;e<c;e++,t++)i[t]=a[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Un.fromBufferAttribute(e,t),Un.normalize(),e.setXYZ(t,Un.x,Un.y,Un.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,o=new n.constructor(t.length*r);let a=0,s=0;for(let i=0,c=t.length;i<c;i++){a=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)o[s++]=n[a++]}return new _n(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Fn,n=this.index.array,r=this.attributes;for(const i in r){const o=e(r[i],n);t.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],a=i[r];for(let t=0,r=a.length;t<r;t++){const r=e(a[t],n);o.push(r)}t.morphAttributes[r]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];o.push(r.toJSON(e.data))}o.length>0&&(r[t]=o,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Fn.prototype.isBufferGeometry=!0;const jn=new Mt,Bn=new Ct,Vn=new St,Gn=new et,Hn=new et,zn=new et,Wn=new et,qn=new et,Xn=new et,Jn=new et,Yn=new et,Kn=new et,Qn=new xe,Zn=new xe,$n=new xe,er=new et,tr=new et;class nr extends nn{constructor(e=new Fn,t=new vn){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Vn.copy(n.boundingSphere),Vn.applyMatrix4(i),!1===e.ray.intersectsSphere(Vn))return;if(jn.copy(i).invert(),Bn.copy(e.ray).applyMatrix4(jn),null!==n.boundingBox&&!1===Bn.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,a=n.attributes.position,s=n.morphAttributes.position,c=n.morphTargetsRelative,u=n.attributes.uv,l=n.attributes.uv2,d=n.groups,h=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,f=d.length;n<f;n++){const f=d[n],p=r[f.materialIndex];for(let n=Math.max(f.start,h.start),r=Math.min(i.count,Math.min(f.start+f.count,h.start+h.count));n<r;n+=3){const r=i.getX(n),d=i.getX(n+1),h=i.getX(n+2);o=rr(this,p,e,Bn,a,s,c,u,l,r,d,h),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=f.materialIndex,t.push(o))}}else{for(let n=Math.max(0,h.start),d=Math.min(i.count,h.start+h.count);n<d;n+=3){const d=i.getX(n),h=i.getX(n+1),f=i.getX(n+2);o=rr(this,r,e,Bn,a,s,c,u,l,d,h,f),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}else if(void 0!==a)if(Array.isArray(r))for(let n=0,i=d.length;n<i;n++){const i=d[n],f=r[i.materialIndex];for(let n=Math.max(i.start,h.start),r=Math.min(a.count,Math.min(i.start+i.count,h.start+h.count));n<r;n+=3){o=rr(this,f,e,Bn,a,s,c,u,l,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,t.push(o))}}else{for(let n=Math.max(0,h.start),i=Math.min(a.count,h.start+h.count);n<i;n+=3){o=rr(this,r,e,Bn,a,s,c,u,l,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function rr(e,t,n,r,i,o,a,s,c,u,l,d){Gn.fromBufferAttribute(i,u),Hn.fromBufferAttribute(i,l),zn.fromBufferAttribute(i,d);const h=e.morphTargetInfluences;if(o&&h){Jn.set(0,0,0),Yn.set(0,0,0),Kn.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=h[e],n=o[e];0!==t&&(Wn.fromBufferAttribute(n,u),qn.fromBufferAttribute(n,l),Xn.fromBufferAttribute(n,d),a?(Jn.addScaledVector(Wn,t),Yn.addScaledVector(qn,t),Kn.addScaledVector(Xn,t)):(Jn.addScaledVector(Wn.sub(Gn),t),Yn.addScaledVector(qn.sub(Hn),t),Kn.addScaledVector(Xn.sub(zn),t)))}Gn.add(Jn),Hn.add(Yn),zn.add(Kn)}e.isSkinnedMesh&&(e.boneTransform(u,Gn),e.boneTransform(l,Hn),e.boneTransform(d,zn));const f=function(e,t,n,r,i,o,a,s){let c;if(c=1===t.side?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,2!==t.side,s),null===c)return null;tr.copy(s),tr.applyMatrix4(e.matrixWorld);const u=n.ray.origin.distanceTo(tr);return u<n.near||u>n.far?null:{distance:u,point:tr.clone(),object:e}}(e,t,n,r,Gn,Hn,zn,er);if(f){s&&(Qn.fromBufferAttribute(s,u),Zn.fromBufferAttribute(s,l),$n.fromBufferAttribute(s,d),f.uv=pn.getUV(er,Gn,Hn,zn,Qn,Zn,$n,new xe)),c&&(Qn.fromBufferAttribute(c,u),Zn.fromBufferAttribute(c,l),$n.fromBufferAttribute(c,d),f.uv2=pn.getUV(er,Gn,Hn,zn,Qn,Zn,$n,new xe));const e={a:u,b:l,c:d,normal:new et,materialIndex:0};pn.getNormal(Gn,Hn,zn,e.normal),f.face=e}return f}nr.prototype.isMesh=!0;class ir extends Fn{constructor(e=1,t=1,n=1,r=1,i=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const a=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const s=[],c=[],u=[],l=[];let d=0,h=0;function f(e,t,n,r,i,o,f,p,m,g,v){const y=o/m,b=f/g,_=o/2,E=f/2,S=p/2,w=m+1,T=g+1;let A=0,R=0;const x=new et;for(let o=0;o<T;o++){const a=o*b-E;for(let s=0;s<w;s++){const d=s*y-_;x[e]=d*r,x[t]=a*i,x[n]=S,c.push(x.x,x.y,x.z),x[e]=0,x[t]=0,x[n]=p>0?1:-1,u.push(x.x,x.y,x.z),l.push(s/m),l.push(1-o/g),A+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=d+t+w*e,r=d+t+w*(e+1),i=d+(t+1)+w*(e+1),o=d+(t+1)+w*e;s.push(n,r,o),s.push(r,i,o),R+=6}a.addGroup(h,R,v),h+=R,d+=A}f("z","y","x",-1,-1,n,t,e,o,i,0),f("z","y","x",1,-1,n,t,-e,o,i,1),f("x","z","y",1,1,e,n,t,r,o,2),f("x","z","y",1,-1,e,n,-t,r,o,3),f("x","y","z",1,-1,e,t,n,r,i,4),f("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new On(c,3)),this.setAttribute("normal",new On(u,3)),this.setAttribute("uv",new On(l,2))}static fromJSON(e){return new ir(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function or(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function ar(e){const t={};for(let n=0;n<e.length;n++){const r=or(e[n]);for(const e in r)t[e]=r[e]}return t}const sr={clone:or,merge:ar};class cr extends gn{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=or(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}cr.prototype.isShaderMaterial=!0;class ur extends nn{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Mt,this.projectionMatrix=new Mt,this.projectionMatrixInverse=new Mt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}ur.prototype.isCamera=!0;class lr extends ur{constructor(e=50,t=1,n=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*ye*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*ve*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*ye*Math.atan(Math.tan(.5*ve*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*ve*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,a=o.fullHeight;i+=o.offsetX*r/e,t-=o.offsetY*n/a,r*=o.width/e,n*=o.height/a}const a=this.filmOffset;0!==a&&(i+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}lr.prototype.isPerspectiveCamera=!0;const dr=90;class hr extends nn{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new lr(dr,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new et(1,0,0)),this.add(r);const i=new lr(dr,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new et(-1,0,0)),this.add(i);const o=new lr(dr,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new et(0,1,0)),this.add(o);const a=new lr(dr,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new et(0,-1,0)),this.add(a);const s=new lr(dr,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new et(0,0,1)),this.add(s);const c=new lr(dr,1,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new et(0,0,-1)),this.add(c)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[r,i,o,a,s,c]=this.children,u=e.xr.enabled,l=e.getRenderTarget();e.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=d,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(l),e.xr.enabled=u,n.texture.needsPMREMUpdate=!0}}class fr extends We{constructor(e,t,n,r,o,a,s,c,u,l){super(e=void 0!==e?e:[],t=void 0!==t?t:i,n,r,o,a,s,c,u,l),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}fr.prototype.isCubeTexture=!0;class pr extends Xe{constructor(e,t={}){super(e,e,t);const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new fr(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:g}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=A,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new ir(5,5,5),i=new cr({name:"CubemapFromEquirect",uniforms:or(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=t;const o=new nr(r,i),a=t.minFilter;t.minFilter===y&&(t.minFilter=g);return new hr(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}pr.prototype.isWebGLCubeRenderTarget=!0;const mr=new et,gr=new et,vr=new Ie;class yr{constructor(e=new et(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=mr.subVectors(n,t).cross(gr.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(mr),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(n).multiplyScalar(i).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||vr.getNormalMatrix(e),r=this.coplanarPoint(mr).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}yr.prototype.isPlane=!0;const br=new St,_r=new et;class Er{constructor(e=new yr,t=new yr,n=new yr,r=new yr,i=new yr,o=new yr){this.planes=[e,t,n,r,i,o]}set(e,t,n,r,i,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],c=n[5],u=n[6],l=n[7],d=n[8],h=n[9],f=n[10],p=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(a-r,l-s,p-d,y-m).normalize(),t[1].setComponents(a+r,l+s,p+d,y+m).normalize(),t[2].setComponents(a+i,l+c,p+h,y+g).normalize(),t[3].setComponents(a-i,l-c,p-h,y-g).normalize(),t[4].setComponents(a-o,l-u,p-f,y-v).normalize(),t[5].setComponents(a+o,l+u,p+f,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),br.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(br)}intersectsSprite(e){return br.center.set(0,0,0),br.radius=.7071067811865476,br.applyMatrix4(e.matrixWorld),this.intersectsSphere(br)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(_r.x=r.normal.x>0?e.max.x:e.min.x,_r.y=r.normal.y>0?e.max.y:e.min.y,_r.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(_r)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Sr(){let e=null,t=!1,n=null,r=null;function i(t,o){n(t,o),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function wr(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=r.get(t);void 0===o?r.set(t,function(t,r){const i=t.array,o=t.usage,a=e.createBuffer();let s;if(e.bindBuffer(r,a),e.bufferData(r,i,o),t.onUploadCallback(),i instanceof Float32Array)s=e.FLOAT;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");s=e.HALF_FLOAT}else s=e.UNSIGNED_SHORT;else if(i instanceof Int16Array)s=e.SHORT;else if(i instanceof Uint32Array)s=e.UNSIGNED_INT;else if(i instanceof Int32Array)s=e.INT;else if(i instanceof Int8Array)s=e.BYTE;else if(i instanceof Uint8Array)s=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);s=e.UNSIGNED_BYTE}return{buffer:a,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(!function(t,r,i){const o=r.array,a=r.updateRange;e.bindBuffer(i,t),-1===a.count?e.bufferSubData(i,0,o):(n?e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(o.buffer,t,i),o.version=t.version)}}}class Tr extends Fn{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,o=t/2,a=Math.floor(n),s=Math.floor(r),c=a+1,u=s+1,l=e/a,d=t/s,h=[],f=[],p=[],m=[];for(let e=0;e<u;e++){const t=e*d-o;for(let n=0;n<c;n++){const r=n*l-i;f.push(r,-t,0),p.push(0,0,1),m.push(n/a),m.push(1-e/s)}}for(let e=0;e<s;e++)for(let t=0;t<a;t++){const n=t+c*e,r=t+c*(e+1),i=t+1+c*(e+1),o=t+1+c*e;h.push(n,r,o),h.push(r,i,o)}this.setIndex(h),this.setAttribute("position",new On(f,3)),this.setAttribute("normal",new On(p,3)),this.setAttribute("uv",new On(m,2))}static fromJSON(e){return new Tr(e.width,e.height,e.widthSegments,e.heightSegments)}}const Ar={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ]\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tfloat texelIndex = float( vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Rr={common:{diffuse:{value:new je(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ie},uv2Transform:{value:new Ie},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new xe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new je(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new je(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ie}},sprite:{diffuse:{value:new je(16777215)},opacity:{value:1},center:{value:new xe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ie}}},xr={basic:{uniforms:ar([Rr.common,Rr.specularmap,Rr.envmap,Rr.aomap,Rr.lightmap,Rr.fog]),vertexShader:Ar.meshbasic_vert,fragmentShader:Ar.meshbasic_frag},lambert:{uniforms:ar([Rr.common,Rr.specularmap,Rr.envmap,Rr.aomap,Rr.lightmap,Rr.emissivemap,Rr.fog,Rr.lights,{emissive:{value:new je(0)}}]),vertexShader:Ar.meshlambert_vert,fragmentShader:Ar.meshlambert_frag},phong:{uniforms:ar([Rr.common,Rr.specularmap,Rr.envmap,Rr.aomap,Rr.lightmap,Rr.emissivemap,Rr.bumpmap,Rr.normalmap,Rr.displacementmap,Rr.fog,Rr.lights,{emissive:{value:new je(0)},specular:{value:new je(1118481)},shininess:{value:30}}]),vertexShader:Ar.meshphong_vert,fragmentShader:Ar.meshphong_frag},standard:{uniforms:ar([Rr.common,Rr.envmap,Rr.aomap,Rr.lightmap,Rr.emissivemap,Rr.bumpmap,Rr.normalmap,Rr.displacementmap,Rr.roughnessmap,Rr.metalnessmap,Rr.fog,Rr.lights,{emissive:{value:new je(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ar.meshphysical_vert,fragmentShader:Ar.meshphysical_frag},toon:{uniforms:ar([Rr.common,Rr.aomap,Rr.lightmap,Rr.emissivemap,Rr.bumpmap,Rr.normalmap,Rr.displacementmap,Rr.gradientmap,Rr.fog,Rr.lights,{emissive:{value:new je(0)}}]),vertexShader:Ar.meshtoon_vert,fragmentShader:Ar.meshtoon_frag},matcap:{uniforms:ar([Rr.common,Rr.bumpmap,Rr.normalmap,Rr.displacementmap,Rr.fog,{matcap:{value:null}}]),vertexShader:Ar.meshmatcap_vert,fragmentShader:Ar.meshmatcap_frag},points:{uniforms:ar([Rr.points,Rr.fog]),vertexShader:Ar.points_vert,fragmentShader:Ar.points_frag},dashed:{uniforms:ar([Rr.common,Rr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ar.linedashed_vert,fragmentShader:Ar.linedashed_frag},depth:{uniforms:ar([Rr.common,Rr.displacementmap]),vertexShader:Ar.depth_vert,fragmentShader:Ar.depth_frag},normal:{uniforms:ar([Rr.common,Rr.bumpmap,Rr.normalmap,Rr.displacementmap,{opacity:{value:1}}]),vertexShader:Ar.meshnormal_vert,fragmentShader:Ar.meshnormal_frag},sprite:{uniforms:ar([Rr.sprite,Rr.fog]),vertexShader:Ar.sprite_vert,fragmentShader:Ar.sprite_frag},background:{uniforms:{uvTransform:{value:new Ie},t2D:{value:null}},vertexShader:Ar.background_vert,fragmentShader:Ar.background_frag},cube:{uniforms:ar([Rr.envmap,{opacity:{value:1}}]),vertexShader:Ar.cube_vert,fragmentShader:Ar.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ar.equirect_vert,fragmentShader:Ar.equirect_frag},distanceRGBA:{uniforms:ar([Rr.common,Rr.displacementmap,{referencePosition:{value:new et},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ar.distanceRGBA_vert,fragmentShader:Ar.distanceRGBA_frag},shadow:{uniforms:ar([Rr.lights,Rr.fog,{color:{value:new je(0)},opacity:{value:1}}]),vertexShader:Ar.shadow_vert,fragmentShader:Ar.shadow_frag}};function Ir(e,t,n,r,i,o){const a=new je(0);let s,u,l=!0===i?0:1,d=null,h=0,f=null;function p(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,o)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),l=t,p(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,p(a,l)},render:function(n,i){let o=!1,m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=t.get(m));const g=e.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?p(a,l):m&&m.isColor&&(p(m,1),o=!0),(e.autoClear||o)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.mapping===c)?(void 0===u&&(u=new nr(new ir(1,1,1),new cr({name:"BackgroundCubeMaterial",uniforms:or(xr.cube.uniforms),vertexShader:xr.cube.vertexShader,fragmentShader:xr.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=m,u.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,d===m&&h===m.version&&f===e.toneMapping||(u.material.needsUpdate=!0,d=m,h=m.version,f=e.toneMapping),n.unshift(u,u.geometry,u.material,0,0,null)):m&&m.isTexture&&(void 0===s&&(s=new nr(new Tr(2,2),new cr({name:"BackgroundMaterial",uniforms:or(xr.background.uniforms),vertexShader:xr.background.vertexShader,fragmentShader:xr.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),s.material.uniforms.uvTransform.value.copy(m.matrix),d===m&&h===m.version&&f===e.toneMapping||(s.material.needsUpdate=!0,d=m,h=m.version,f=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}}}function Or(e,t,n,r){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||null!==o,s={},c=h(null);let u=c;function l(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function d(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function h(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function f(){const e=u.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function p(e){m(e,0)}function m(n,i){const o=u.newAttributes,a=u.enabledAttributes,s=u.attributeDivisors;if(o[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),s[n]!==i){(r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i}}function g(){const t=u.newAttributes,n=u.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function v(t,n,i,o,a,s){!0!==r.isWebGL2||i!==e.INT&&i!==e.UNSIGNED_INT?e.vertexAttribPointer(t,n,i,o,a,s):e.vertexAttribIPointer(t,n,i,a,s)}function y(){b(),u!==c&&(u=c,l(u.object))}function b(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(i,c,d,y,b){let _=!1;if(a){const t=function(t,n,i){const a=!0===i.wireframe;let c=s[t.id];void 0===c&&(c={},s[t.id]=c);let u=c[n.id];void 0===u&&(u={},c[n.id]=u);let l=u[a];void 0===l&&(l=h(r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),u[a]=l);return l}(y,d,c);u!==t&&(u=t,l(u.object)),_=function(e,t){const n=u.attributes,r=e.attributes;let i=0;for(const e in r){const t=n[e],o=r[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;i++}return u.attributesNum!==i||u.index!==t}(y,b),_&&function(e,t){const n={},r=e.attributes;let i=0;for(const e in r){const t=r[e],o={};o.attribute=t,t.data&&(o.data=t.data),n[e]=o,i++}u.attributes=n,u.attributesNum=i,u.index=t}(y,b)}else{const e=!0===c.wireframe;u.geometry===y.id&&u.program===d.id&&u.wireframe===e||(u.geometry=y.id,u.program=d.id,u.wireframe=e,_=!0)}!0===i.isInstancedMesh&&(_=!0),null!==b&&n.update(b,e.ELEMENT_ARRAY_BUFFER),_&&(!function(i,o,a,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const c=s.attributes,u=a.getAttributes(),l=o.defaultAttributeValues;for(const t in u){const r=u[t];if(r.location>=0){let o=c[t];if(void 0===o&&("instanceMatrix"===t&&i.instanceMatrix&&(o=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(o=i.instanceColor)),void 0!==o){const t=o.normalized,a=o.itemSize,c=n.get(o);if(void 0===c)continue;const u=c.buffer,l=c.type,d=c.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,c=n.stride,h=o.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)m(r.location+e,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<r.locationSize;e++)p(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<r.locationSize;e++)v(r.location+e,a/r.locationSize,l,t,c*d,(h+a/r.locationSize*e)*d)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)m(r.location+e,o.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<r.locationSize;e++)p(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<r.locationSize;e++)v(r.location+e,a/r.locationSize,l,t,a*d,a/r.locationSize*e*d)}}else if(void 0!==l){const n=l[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r.location,n);break;case 3:e.vertexAttrib3fv(r.location,n);break;case 4:e.vertexAttrib4fv(r.location,n);break;default:e.vertexAttrib1fv(r.location,n)}}}}g()}(i,c,d,y),null!==b&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)d(r[e].object),delete r[e];delete n[e.id]}},initAttributes:f,enableAttribute:p,disableUnusedAttributes:g}}function Cr(e,t,n,r){const i=r.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,r){e.drawArrays(o,t,r),n.update(r,o,1)},this.renderInstances=function(r,a,s){if(0===s)return;let c,u;if(i)c=e,u="drawArraysInstanced";else if(c=t.get("ANGLE_instanced_arrays"),u="drawArraysInstancedANGLE",null===c)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](o,r,a,s),n.update(a,o,s)}}function Mr(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);const c=o||t.has("WEBGL_draw_buffers"),u=!0===n.logarithmicDepthBuffer,l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),f=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=d>0,b=o||t.has("OES_texture_float");return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:u,maxTextures:l,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:o?e.getParameter(e.MAX_SAMPLES):0}}function Nr(e){const t=this;let n=null,r=0,i=!1,o=!1;const a=new yr,s=new Ie,c={value:null,needsUpdate:!1};function u(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function l(e,n,r,i){const o=null!==e?e.length:0;let u=null;if(0!==o){if(u=c.value,!0!==i||null===u){const t=r+4*o,i=n.matrixWorldInverse;s.getNormalMatrix(i),(null===u||u.length<t)&&(u=new Float32Array(t));for(let t=0,n=r;t!==o;++t,n+=4)a.copy(e[t]).applyMatrix4(i,s),a.normal.toArray(u,n),u[n+3]=a.constant}c.value=u,c.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,u}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const a=0!==e.length||t||0!==r||i;return i=t,n=l(e,o,0),r=e.length,a},this.beginShadows=function(){o=!0,l(null)},this.endShadows=function(){o=!1,u()},this.setState=function(t,a,s){const d=t.clippingPlanes,h=t.clipIntersection,f=t.clipShadows,p=e.get(t);if(!i||null===d||0===d.length||o&&!f)o?l(null):u();else{const e=o?0:r,t=4*e;let i=p.clippingState||null;c.value=i,i=l(d,a,t,s);for(let e=0;e!==t;++e)i[e]=n[e];p.clippingState=i,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function Lr(e){let t=new WeakMap;function n(e,t){return t===a?e.mapping=i:t===s&&(e.mapping=o),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const o=i.mapping;if(o===a||o===s){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const o=i.image;if(o&&o.height>0){const a=new pr(o.height/2);return a.fromEquirectangularTexture(e,i),t.set(i,a),i.addEventListener("dispose",r),n(a.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}xr.physical={uniforms:ar([xr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new xe(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new je(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new xe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new je(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new je(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ar.meshphysical_vert,fragmentShader:Ar.meshphysical_frag};class kr extends ur{constructor(e=-1,t=1,n=1,r=-1,i=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,o=n+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,o=i+e*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}kr.prototype.isOrthographicCamera=!0;const Pr=[.125,.215,.35,.446,.526,.582],Dr=20,Ur=new kr,Fr=new je;let jr=null;const Br=(1+Math.sqrt(5))/2,Vr=1/Br,Gr=[new et(1,1,1),new et(-1,1,1),new et(1,1,-1),new et(-1,1,-1),new et(0,Br,Vr),new et(0,Br,-Vr),new et(Vr,0,Br),new et(-Vr,0,Br),new et(Br,Vr,0),new et(-Br,Vr,0)];class Hr{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){jr=this._renderer.getRenderTarget(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Xr(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=qr(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(jr),e.scissorTest=!1,Wr(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===i||e.mapping===o?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),jr=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize-32,n={magFilter:g,minFilter:g,generateMipmaps:!1,type:w,format:A,encoding:se,depthBuffer:!1},r=zr(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=zr(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const o=e-4+1+Pr.length;for(let a=0;a<o;a++){const o=Math.pow(2,i);n.push(o);let s=1/o;a>e-4?s=Pr[a-e+4-1]:0===a&&(s=0),r.push(s);const c=1/(o-1),u=-c/2,l=1+c/2,d=[u,u,l,u,l,l,u,u,l,l,u,l],h=6,f=6,p=3,m=2,g=1,v=new Float32Array(p*f*h),y=new Float32Array(m*f*h),b=new Float32Array(g*f*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(r,p*f*e),y.set(d,m*f*e);const i=[e,e,e,e,e,e];b.set(i,g*f*e)}const _=new Fn;_.setAttribute("position",new _n(v,p)),_.setAttribute("uv",new _n(y,m)),_.setAttribute("faceIndex",new _n(b,g)),t.push(_),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(Dr),i=new et(0,1,0),o=new cr({name:"SphericalGaussianBlur",defines:{n:Dr,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Jr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return o}(r,e,t)}return r}_compileMaterial(e){const t=new nr(this._lodPlanes[0],e);this._renderer.compile(t,Ur)}_sceneToCubeUV(e,t,n,r){const i=new lr(90,1,t,n),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,c=s.autoClear,u=s.toneMapping;s.getClearColor(Fr),s.toneMapping=0,s.autoClear=!1;const l=new vn({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new nr(new ir,l);let h=!1;const f=e.background;f?f.isColor&&(l.color.copy(f),e.background=null,h=!0):(l.color.copy(Fr),h=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(i.up.set(0,o[t],0),i.lookAt(a[t],0,0)):1===n?(i.up.set(0,0,o[t]),i.lookAt(0,a[t],0)):(i.up.set(0,o[t],0),i.lookAt(0,0,a[t]));const c=this._cubeSize;Wr(r,n*c,t>2?c:0,c,c),s.setRenderTarget(r),h&&s.render(d,i),s.render(e,i)}d.geometry.dispose(),d.material.dispose(),s.toneMapping=u,s.autoClear=c,e.background=f}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===i||e.mapping===o;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Xr()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=qr());const a=r?this._cubemapMaterial:this._equirectMaterial,s=new nr(this._lodPlanes[0],a);a.uniforms.envMap.value=e;const c=this._cubeSize;Wr(t,0,0,3*c,2*c),n.setRenderTarget(t),n.render(s,Ur)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),r=Gr[(t-1)%Gr.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",i),this._halfBlur(o,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,o,a){const s=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new nr(this._lodPlanes[r],c),l=c.uniforms,d=this._sizeLods[n]-1,h=isFinite(i)?Math.PI/(2*d):2*Math.PI/39,f=i/h,p=isFinite(i)?1+Math.floor(3*f):Dr;p>Dr&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<Dr;++e){const t=e/f,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<p&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;l.envMap.value=e.texture,l.samples.value=p,l.weights.value=m,l.latitudinal.value="latitudinal"===o,a&&(l.poleAxis.value=a);const{_lodMax:v}=this;l.dTheta.value=h,l.mipInt.value=v-n;const y=this._sizeLods[r];Wr(t,3*y*(r>v-4?r-v+4:0),4*(this._cubeSize-y),3*y,2*y),s.setRenderTarget(t),s.render(u,Ur)}}function zr(e,t,n){const r=new Xe(e,t,n);return r.texture.mapping=c,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Wr(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function qr(){return new cr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Jr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Xr(){return new cr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Jr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Jr(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Yr(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(c){if(c&&c.isTexture){const u=c.mapping,l=u===a||u===s,d=u===i||u===o;if(l||d){if(c.isRenderTargetTexture&&!0===c.needsPMREMUpdate){c.needsPMREMUpdate=!1;let r=t.get(c);return null===n&&(n=new Hr(e)),r=l?n.fromEquirectangular(c,r):n.fromCubemap(c,r),t.set(c,r),r.texture}if(t.has(c))return t.get(c).texture;{const i=c.image;if(l&&i&&i.height>0||d&&i&&function(e){let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(i)){null===n&&(n=new Hr(e));const i=l?n.fromEquirectangular(c):n.fromCubemap(c);return t.set(c,i),c.addEventListener("dispose",r),i.texture}return null}}}return c},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Kr(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Qr(e,t,n,r){const i={},o=new WeakMap;function a(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const e in s.attributes)t.remove(s.attributes[e]);s.removeEventListener("dispose",a),delete i[s.id];const c=o.get(s);c&&(t.remove(c),o.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],r=e.index,i=e.attributes.position;let a=0;if(null!==r){const e=r.array;a=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],o=e[t+2];n.push(r,i,i,o,o,r)}}else{const e=i.array;a=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}const s=new(Oe(n)?xn:An)(n,1);s.version=a;const c=o.get(e);c&&t.remove(c),o.set(e,s)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",a),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const n in r)t.update(r[n],e.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)t.update(r[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return o.get(e)}}}function Zr(e,t,n,r){const i=r.isWebGL2;let o,a,s;this.setMode=function(e){o=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,r){e.drawElements(o,r,a,t*s),n.update(r,o,1)},this.renderInstances=function(r,c,u){if(0===u)return;let l,d;if(i)l=e,d="drawElementsInstanced";else if(l=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===l)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[d](o,c,a,r*s,u),n.update(c,o,u)}}function $r(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function ei(e,t){return e[0]-t[0]}function ti(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ni(e,t){let n=1;const r=t.isInterleavedBufferAttribute?t.data.array:t.array;r instanceof Int8Array?n=127:r instanceof Int16Array?n=32767:r instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),e.divideScalar(n)}function ri(e,t,n){const r={},i=new Float32Array(8),o=new WeakMap,a=new qe,s=[];for(let e=0;e<8;e++)s[e]=[e,0];return{update:function(c,u,l,d){const h=c.morphTargetInfluences;if(!0===t.isWebGL2){const f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,p=void 0!==f?f.length:0;let m=o.get(u);if(void 0===m||m.count!==p){void 0!==m&&m.texture.dispose();const y=void 0!==u.morphAttributes.position,b=void 0!==u.morphAttributes.normal,_=void 0!==u.morphAttributes.color,E=u.morphAttributes.position||[],w=u.morphAttributes.normal||[],T=u.morphAttributes.color||[];let R=0;!0===y&&(R=1),!0===b&&(R=2),!0===_&&(R=3);let x=u.attributes.position.count*R,I=1;x>t.maxTextureSize&&(I=Math.ceil(x/t.maxTextureSize),x=t.maxTextureSize);const O=new Float32Array(x*I*4*p),C=new Je(O,x,I,p);C.format=A,C.type=S,C.needsUpdate=!0;const M=4*R;for(let L=0;L<p;L++){const k=E[L],P=w[L],D=T[L],U=x*I*4*L;for(let F=0;F<k.count;F++){const j=F*M;!0===y&&(a.fromBufferAttribute(k,F),!0===k.normalized&&ni(a,k),O[U+j+0]=a.x,O[U+j+1]=a.y,O[U+j+2]=a.z,O[U+j+3]=0),!0===b&&(a.fromBufferAttribute(P,F),!0===P.normalized&&ni(a,P),O[U+j+4]=a.x,O[U+j+5]=a.y,O[U+j+6]=a.z,O[U+j+7]=0),!0===_&&(a.fromBufferAttribute(D,F),!0===D.normalized&&ni(a,P),O[U+j+8]=a.x,O[U+j+9]=a.y,O[U+j+10]=a.z,O[U+j+11]=4===D.itemSize?a.w:1)}}function N(){C.dispose(),o.delete(u),u.removeEventListener("dispose",N)}m={count:p,texture:C,size:new xe(x,I)},o.set(u,m),u.addEventListener("dispose",N)}let g=0;for(let B=0;B<h.length;B++)g+=h[B];const v=u.morphTargetsRelative?1:1-g;d.getUniforms().setValue(e,"morphTargetBaseInfluence",v),d.getUniforms().setValue(e,"morphTargetInfluences",h),d.getUniforms().setValue(e,"morphTargetsTexture",m.texture,n),d.getUniforms().setValue(e,"morphTargetsTextureSize",m.size)}else{const V=void 0===h?0:h.length;let G=r[u.id];if(void 0===G||G.length!==V){G=[];for(let X=0;X<V;X++)G[X]=[X,0];r[u.id]=G}for(let J=0;J<V;J++){const Y=G[J];Y[0]=J,Y[1]=h[J]}G.sort(ti);for(let K=0;K<8;K++)K<V&&G[K][1]?(s[K][0]=G[K][0],s[K][1]=G[K][1]):(s[K][0]=Number.MAX_SAFE_INTEGER,s[K][1]=0);s.sort(ei);const H=u.morphAttributes.position,z=u.morphAttributes.normal;let W=0;for(let Q=0;Q<8;Q++){const Z=s[Q],$=Z[0],ee=Z[1];$!==Number.MAX_SAFE_INTEGER&&ee?(H&&u.getAttribute("morphTarget"+Q)!==H[$]&&u.setAttribute("morphTarget"+Q,H[$]),z&&u.getAttribute("morphNormal"+Q)!==z[$]&&u.setAttribute("morphNormal"+Q,z[$]),i[Q]=ee,W+=ee):(H&&!0===u.hasAttribute("morphTarget"+Q)&&u.deleteAttribute("morphTarget"+Q),z&&!0===u.hasAttribute("morphNormal"+Q)&&u.deleteAttribute("morphNormal"+Q),i[Q]=0)}const q=u.morphTargetsRelative?1:1-W;d.getUniforms().setValue(e,"morphTargetBaseInfluence",q),d.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function ii(e,t,n,r){let i=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(a){const s=r.render.frame,c=a.geometry,u=t.get(a,c);return i.get(u)!==s&&(t.update(u),i.set(u,s)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",o)&&a.addEventListener("dispose",o),n.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,e.ARRAY_BUFFER)),u},dispose:function(){i=new WeakMap}}}const oi=new We,ai=new Je,si=new Ke,ci=new fr,ui=[],li=[],di=new Float32Array(16),hi=new Float32Array(9),fi=new Float32Array(4);function pi(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let o=ui[i];if(void 0===o&&(o=new Float32Array(i),ui[i]=o),0!==t){r.toArray(o,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(o,i)}return o}function mi(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function gi(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function vi(e,t){let n=li[t];void 0===n&&(n=new Int32Array(t),li[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function yi(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function bi(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(mi(n,t))return;e.uniform2fv(this.addr,t),gi(n,t)}}function _i(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(mi(n,t))return;e.uniform3fv(this.addr,t),gi(n,t)}}function Ei(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(mi(n,t))return;e.uniform4fv(this.addr,t),gi(n,t)}}function Si(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(mi(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),gi(n,t)}else{if(mi(n,r))return;fi.set(r),e.uniformMatrix2fv(this.addr,!1,fi),gi(n,r)}}function wi(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(mi(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),gi(n,t)}else{if(mi(n,r))return;hi.set(r),e.uniformMatrix3fv(this.addr,!1,hi),gi(n,r)}}function Ti(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(mi(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),gi(n,t)}else{if(mi(n,r))return;di.set(r),e.uniformMatrix4fv(this.addr,!1,di),gi(n,r)}}function Ai(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ri(e,t){const n=this.cache;mi(n,t)||(e.uniform2iv(this.addr,t),gi(n,t))}function xi(e,t){const n=this.cache;mi(n,t)||(e.uniform3iv(this.addr,t),gi(n,t))}function Ii(e,t){const n=this.cache;mi(n,t)||(e.uniform4iv(this.addr,t),gi(n,t))}function Oi(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Ci(e,t){const n=this.cache;mi(n,t)||(e.uniform2uiv(this.addr,t),gi(n,t))}function Mi(e,t){const n=this.cache;mi(n,t)||(e.uniform3uiv(this.addr,t),gi(n,t))}function Ni(e,t){const n=this.cache;mi(n,t)||(e.uniform4uiv(this.addr,t),gi(n,t))}function Li(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(t||oi,i)}function ki(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||si,i)}function Pi(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||ci,i)}function Di(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||ai,i)}function Ui(e,t){e.uniform1fv(this.addr,t)}function Fi(e,t){const n=pi(t,this.size,2);e.uniform2fv(this.addr,n)}function ji(e,t){const n=pi(t,this.size,3);e.uniform3fv(this.addr,n)}function Bi(e,t){const n=pi(t,this.size,4);e.uniform4fv(this.addr,n)}function Vi(e,t){const n=pi(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Gi(e,t){const n=pi(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Hi(e,t){const n=pi(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function zi(e,t){e.uniform1iv(this.addr,t)}function Wi(e,t){e.uniform2iv(this.addr,t)}function qi(e,t){e.uniform3iv(this.addr,t)}function Xi(e,t){e.uniform4iv(this.addr,t)}function Ji(e,t){e.uniform1uiv(this.addr,t)}function Yi(e,t){e.uniform2uiv(this.addr,t)}function Ki(e,t){e.uniform3uiv(this.addr,t)}function Qi(e,t){e.uniform4uiv(this.addr,t)}function Zi(e,t,n){const r=t.length,i=vi(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.setTexture2D(t[e]||oi,i[e])}function $i(e,t,n){const r=t.length,i=vi(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.setTexture3D(t[e]||si,i[e])}function eo(e,t,n){const r=t.length,i=vi(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.setTextureCube(t[e]||ci,i[e])}function to(e,t,n){const r=t.length,i=vi(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.setTexture2DArray(t[e]||ai,i[e])}function no(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return yi;case 35664:return bi;case 35665:return _i;case 35666:return Ei;case 35674:return Si;case 35675:return wi;case 35676:return Ti;case 5124:case 35670:return Ai;case 35667:case 35671:return Ri;case 35668:case 35672:return xi;case 35669:case 35673:return Ii;case 5125:return Oi;case 36294:return Ci;case 36295:return Mi;case 36296:return Ni;case 35678:case 36198:case 36298:case 36306:case 35682:return Li;case 35679:case 36299:case 36307:return ki;case 35680:case 36300:case 36308:case 36293:return Pi;case 36289:case 36303:case 36311:case 36292:return Di}}(t.type)}function ro(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ui;case 35664:return Fi;case 35665:return ji;case 35666:return Bi;case 35674:return Vi;case 35675:return Gi;case 35676:return Hi;case 5124:case 35670:return zi;case 35667:case 35671:return Wi;case 35668:case 35672:return qi;case 35669:case 35673:return Xi;case 5125:return Ji;case 36294:return Yi;case 36295:return Ki;case 36296:return Qi;case 35678:case 36198:case 36298:case 36306:case 35682:return Zi;case 35679:case 36299:case 36307:return $i;case 35680:case 36300:case 36308:case 36293:return eo;case 36289:case 36303:case 36311:case 36292:return to}}(t.type)}function io(e){this.id=e,this.seq=[],this.map={}}ro.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),gi(t,e)},io.prototype.setValue=function(e,t,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(e,t[o.id],n)}};const oo=/(\w+)(\])?(\[|\.)?/g;function ao(e,t){e.seq.push(t),e.map[t.id]=t}function so(e,t,n){const r=e.name,i=r.length;for(oo.lastIndex=0;;){const o=oo.exec(r),a=oo.lastIndex;let s=o[1];const c="]"===o[2],u=o[3];if(c&&(s|=0),void 0===u||"["===u&&a+2===i){ao(n,void 0===u?new no(s,e,t):new ro(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new io(s),ao(n,e)),n=e}}}function co(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);so(n,e.getUniformLocation(t,n.name),this)}}function uo(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}co.prototype.setValue=function(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)},co.prototype.setOptional=function(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)},co.upload=function(e,t,n,r){for(let i=0,o=t.length;i!==o;++i){const o=t[i],a=n[o.id];!1!==a.needsUpdate&&o.setValue(e,a.value,r)}},co.seqWithValue=function(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n};let lo=0;function ho(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":n.toUpperCase()+"\n\n"+i+"\n\n"+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function fo(e,t){const n=function(e){switch(e){case se:return["Linear","( value )"];case ce:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function po(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function mo(e){return""!==e}function go(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function vo(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const yo=/^[ \t]*#include +<([\w\d./]+)>/gm;function bo(e){return e.replace(yo,_o)}function _o(e,t){const n=Ar[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return bo(n)}const Eo=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,So=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function wo(e){return e.replace(So,Ao).replace(Eo,To)}function To(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Ao(e,t,n,r)}function Ao(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function Ro(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function xo(e,t,n,r){const a=e.getContext(),s=n.defines;let l=n.vertexShader,d=n.fragmentShader;const h=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),f=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case i:case o:t="ENVMAP_TYPE_CUBE";break;case c:case u:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),p=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case o:case u:t="ENVMAP_MODE_REFRACTION"}return t}(n),m=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),g=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t/32+1)+3,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),v=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(mo).join("\n")}(n),y=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),b=a.createProgram();let _,E,S=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(_=[y].filter(mo).join("\n"),_.length>0&&(_+="\n"),E=[v,y].filter(mo).join("\n"),E.length>0&&(E+="\n")):(_=[Ro(n),"#define SHADER_NAME "+n.shaderName,y,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(mo).join("\n"),E=[v,Ro(n),"#define SHADER_NAME "+n.shaderName,y,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.envMap?"#define "+p:"",n.envMap?"#define "+m:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Ar.tonemapping_pars_fragment:"",0!==n.toneMapping?po("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Ar.encodings_pars_fragment,fo("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(mo).join("\n")),l=bo(l),l=go(l,n),l=vo(l,n),d=bo(d),d=go(d,n),d=vo(d,n),l=wo(l),d=wo(d),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(S="#version 300 es\n",_=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,E=["#define varying in",n.glslVersion===he?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===he?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+E);const w=S+_+l,T=S+E+d,A=uo(a,a.VERTEX_SHADER,w),R=uo(a,a.FRAGMENT_SHADER,T);if(a.attachShader(b,A),a.attachShader(b,R),void 0!==n.index0AttributeName?a.bindAttribLocation(b,0,n.index0AttributeName):!0===n.morphTargets&&a.bindAttribLocation(b,0,"position"),a.linkProgram(b),e.debug.checkShaderErrors){const e=a.getProgramInfoLog(b).trim(),t=a.getShaderInfoLog(A).trim(),n=a.getShaderInfoLog(R).trim();let r=!0,i=!0;if(!1===a.getProgramParameter(b,a.LINK_STATUS)){r=!1;const t=ho(a,A,"vertex"),n=ho(a,R,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(b,a.VALIDATE_STATUS)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+n)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==n||(i=!1);i&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:_},fragmentShader:{log:n,prefix:E}})}let x,I;return a.deleteShader(A),a.deleteShader(R),this.getUniforms=function(){return void 0===x&&(x=new co(a,b)),x},this.getAttributes=function(){return void 0===I&&(I=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),o=r.name;let a=1;r.type===e.FLOAT_MAT2&&(a=2),r.type===e.FLOAT_MAT3&&(a=3),r.type===e.FLOAT_MAT4&&(a=4),n[o]={type:r.type,location:e.getAttribLocation(t,o),locationSize:a}}return n}(a,b)),I},this.destroy=function(){r.releaseStatesOfProgram(this),a.deleteProgram(b),this.program=void 0},this.name=n.shaderName,this.id=lo++,this.cacheKey=t,this.usedTimes=1,this.program=b,this.vertexShader=A,this.fragmentShader=R,this}let Io=0;class Oo{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(i)&&(o.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(!1===t.has(e)){const n=new Co;t.set(e,n)}return t.get(e)}}class Co{constructor(){this.id=Io++,this.usedTimes=0}}function Mo(e,t,n,r,i,o,a){const s=new Gt,l=new Oo,d=[],h=i.isWebGL2,f=i.logarithmicDepthBuffer,p=i.floatVertexTextures,m=i.maxVertexUniforms,g=i.vertexTextures;let v=i.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(o,s,d,b,_){const E=b.fog,S=_.geometry,w=o.isMeshStandardMaterial?b.environment:null,T=(o.isMeshStandardMaterial?n:t).get(o.envMap||w),A=!T||T.mapping!==c&&T.mapping!==u?null:T.image.height,R=y[o.type],x=_.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(p)return 1024;{const e=m,n=Math.floor((e-20)/4),r=Math.min(n,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}}(_):0;null!==o.precision&&(v=i.getMaxPrecision(o.precision),v!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",v,"instead."));const I=S.morphAttributes.position||S.morphAttributes.normal||S.morphAttributes.color,O=void 0!==I?I.length:0;let C,M,N,L,k=0;if(void 0!==S.morphAttributes.position&&(k=1),void 0!==S.morphAttributes.normal&&(k=2),void 0!==S.morphAttributes.color&&(k=3),R){const e=xr[R];C=e.vertexShader,M=e.fragmentShader}else C=o.vertexShader,M=o.fragmentShader,l.update(o),N=l.getVertexShaderID(o),L=l.getFragmentShaderID(o);const P=e.getRenderTarget(),D=o.alphaTest>0,U=o.clearcoat>0;return{isWebGL2:h,shaderID:R,shaderName:o.type,vertexShader:C,fragmentShader:M,defines:o.defines,customVertexShaderID:N,customFragmentShaderID:L,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:v,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:g,outputEncoding:null===P?e.outputEncoding:!0===P.isXRRenderTarget?P.texture.encoding:se,map:!!o.map,matcap:!!o.matcap,envMap:!!T,envMapMode:T&&T.mapping,envMapCubeUVHeight:A,lightMap:!!o.lightMap,aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:1===o.normalMapType,tangentSpaceNormalMap:0===o.normalMapType,decodeVideoTexture:!!o.map&&!0===o.map.isVideoTexture&&o.map.encoding===ce,clearcoat:U,clearcoatMap:U&&!!o.clearcoatMap,clearcoatRoughnessMap:U&&!!o.clearcoatRoughnessMap,clearcoatNormalMap:U&&!!o.clearcoatNormalMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,specularIntensityMap:!!o.specularIntensityMap,specularColorMap:!!o.specularColorMap,opaque:!1===o.transparent&&1===o.blending,alphaMap:!!o.alphaMap,alphaTest:D,gradientMap:!!o.gradientMap,sheen:o.sheen>0,sheenColorMap:!!o.sheenColorMap,sheenRoughnessMap:!!o.sheenRoughnessMap,transmission:o.transmission>0,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:!!o.normalMap&&!!S.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!S.attributes.color&&4===S.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.displacementMap||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheenColorMap||o.sheenRoughnessMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.transmission>0||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheen>0||o.sheenColorMap||o.sheenRoughnessMap||!o.displacementMap),fog:!!E,useFog:o.fog,fogExp2:E&&E.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:f,skinning:!0===_.isSkinnedMesh&&x>0,maxBones:x,useVertexTexture:p,morphTargets:void 0!==S.morphAttributes.position,morphNormals:void 0!==S.morphAttributes.normal,morphColors:void 0!==S.morphAttributes.color,morphTargetsCount:O,morphTextureStride:k,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&d.length>0,shadowMapType:e.shadowMap.type,toneMapping:o.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,doubleSided:2===o.side,flipSided:1===o.side,depthPacking:void 0!==o.depthPacking&&o.depthPacking,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.maxBones),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.map&&s.enable(4);t.matcap&&s.enable(5);t.envMap&&s.enable(6);t.lightMap&&s.enable(7);t.aoMap&&s.enable(8);t.emissiveMap&&s.enable(9);t.bumpMap&&s.enable(10);t.normalMap&&s.enable(11);t.objectSpaceNormalMap&&s.enable(12);t.tangentSpaceNormalMap&&s.enable(13);t.clearcoat&&s.enable(14);t.clearcoatMap&&s.enable(15);t.clearcoatRoughnessMap&&s.enable(16);t.clearcoatNormalMap&&s.enable(17);t.displacementMap&&s.enable(18);t.specularMap&&s.enable(19);t.roughnessMap&&s.enable(20);t.metalnessMap&&s.enable(21);t.gradientMap&&s.enable(22);t.alphaMap&&s.enable(23);t.alphaTest&&s.enable(24);t.vertexColors&&s.enable(25);t.vertexAlphas&&s.enable(26);t.vertexUvs&&s.enable(27);t.vertexTangents&&s.enable(28);t.uvsVertexOnly&&s.enable(29);t.fog&&s.enable(30);e.push(s.mask),s.disableAll(),t.useFog&&s.enable(0);t.flatShading&&s.enable(1);t.logarithmicDepthBuffer&&s.enable(2);t.skinning&&s.enable(3);t.useVertexTexture&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.physicallyCorrectLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.depthPacking&&s.enable(13);t.dithering&&s.enable(14);t.specularIntensityMap&&s.enable(15);t.specularColorMap&&s.enable(16);t.transmission&&s.enable(17);t.transmissionMap&&s.enable(18);t.thicknessMap&&s.enable(19);t.sheen&&s.enable(20);t.sheenColorMap&&s.enable(21);t.sheenRoughnessMap&&s.enable(22);t.decodeVideoTexture&&s.enable(23);t.opaque&&s.enable(24);e.push(s.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=y[e.type];let n;if(t){const e=xr[t];n=sr.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=d.length;e<t;e++){const t=d[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new xo(e,n,t,o),d.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=d.indexOf(e);d[t]=d[d.length-1],d.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:d,dispose:function(){l.dispose()}}}function No(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Lo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ko(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Po(){const e=[];let t=0;const n=[],r=[],i=[];function o(n,r,i,o,a,s){let c=e[t];return void 0===c?(c={id:n.id,object:n,geometry:r,material:i,groupOrder:o,renderOrder:n.renderOrder,z:a,group:s},e[t]=c):(c.id=n.id,c.object=n,c.geometry=r,c.material=i,c.groupOrder=o,c.renderOrder=n.renderOrder,c.z=a,c.group=s),t++,c}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,a,s,c,u){const l=o(e,t,a,s,c,u);a.transmission>0?r.push(l):!0===a.transparent?i.push(l):n.push(l)},unshift:function(e,t,a,s,c,u){const l=o(e,t,a,s,c,u);a.transmission>0?r.unshift(l):!0===a.transparent?i.unshift(l):n.unshift(l)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Lo),r.length>1&&r.sort(t||ko),i.length>1&&i.sort(t||ko)}}}function Do(){let e=new WeakMap;return{get:function(t,n){let r;return!1===e.has(t)?(r=new Po,e.set(t,[r])):n>=e.get(t).length?(r=new Po,e.get(t).push(r)):r=e.get(t)[n],r},dispose:function(){e=new WeakMap}}}function Uo(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new et,color:new je};break;case"SpotLight":n={position:new et,direction:new et,color:new je,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new et,color:new je,distance:0,decay:0};break;case"HemisphereLight":n={direction:new et,skyColor:new je,groundColor:new je};break;case"RectAreaLight":n={color:new je,position:new et,halfWidth:new et,halfHeight:new et}}return e[t.id]=n,n}}}let Fo=0;function jo(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Bo(e,t){const n=new Uo,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xe};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xe,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)i.probe.push(new et);const o=new et,a=new Mt,s=new Mt;return{setup:function(o,a){let s=0,c=0,u=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,d=0,h=0,f=0,p=0,m=0,g=0,v=0;o.sort(jo);const y=!0!==a?Math.PI:1;for(let e=0,t=o.length;e<t;e++){const t=o[e],a=t.color,b=t.intensity,_=t.distance,E=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=a.r*b*y,c+=a.g*b*y,u+=a.b*b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],b);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[l]=n,i.directionalShadowMap[l]=E,i.directionalShadowMatrix[l]=t.shadow.matrix,m++}i.directional[l]=e,l++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(b*y),e.distance=_,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=E,i.spotShadowMatrix[h]=t.shadow.matrix,v++}i.spot[h]=e,h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(a).multiplyScalar(b),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[f]=e,f++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[d]=n,i.pointShadowMap[d]=E,i.pointShadowMatrix[d]=t.shadow.matrix,g++}i.point[d]=e,d++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(b*y),e.groundColor.copy(t.groundColor).multiplyScalar(b*y),i.hemi[p]=e,p++}}f>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=Rr.LTC_FLOAT_1,i.rectAreaLTC2=Rr.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=Rr.LTC_HALF_1,i.rectAreaLTC2=Rr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=s,i.ambient[1]=c,i.ambient[2]=u;const b=i.hash;b.directionalLength===l&&b.pointLength===d&&b.spotLength===h&&b.rectAreaLength===f&&b.hemiLength===p&&b.numDirectionalShadows===m&&b.numPointShadows===g&&b.numSpotShadows===v||(i.directional.length=l,i.spot.length=h,i.rectArea.length=f,i.point.length=d,i.hemi.length=p,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=v,i.spotShadowMap.length=v,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotShadowMatrix.length=v,b.directionalLength=l,b.pointLength=d,b.spotLength=h,b.rectAreaLength=f,b.hemiLength=p,b.numDirectionalShadows=m,b.numPointShadows=g,b.numSpotShadows=v,i.version=Fo++)},setupView:function(e,t){let n=0,r=0,c=0,u=0,l=0;const d=t.matrixWorldInverse;for(let t=0,h=e.length;t<h;t++){const h=e[t];if(h.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(h.matrixWorld),o.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),n++}else if(h.isSpotLight){const e=i.spot[c];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(h.matrixWorld),o.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),c++}else if(h.isRectAreaLight){const e=i.rectArea[u];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),s.identity(),a.copy(h.matrixWorld),a.premultiply(d),s.extractRotation(a),e.halfWidth.set(.5*h.width,0,0),e.halfHeight.set(0,.5*h.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),u++}else if(h.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),r++}else if(h.isHemisphereLight){const e=i.hemi[l];e.direction.setFromMatrixPosition(h.matrixWorld),e.direction.transformDirection(d),e.direction.normalize(),l++}}},state:i}}function Vo(e,t){const n=new Bo(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Go(e,t){let n=new WeakMap;return{get:function(r,i=0){let o;return!1===n.has(r)?(o=new Vo(e,t),n.set(r,[o])):i>=n.get(r).length?(o=new Vo(e,t),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}class Ho extends gn{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Ho.prototype.isMeshDepthMaterial=!0;class zo extends gn{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new et,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}zo.prototype.isMeshDistanceMaterial=!0;function Wo(e,t,n){let r=new Er;const i=new xe,o=new xe,a=new qe,s=new Ho({depthPacking:3201}),c=new zo,u={},l=n.maxTextureSize,d={0:1,1:0,2:2},h=new cr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new xe},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.HORIZONTAL_PASS=1;const m=new Fn;m.setAttribute("position",new _n(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new nr(m,h),y=this;function b(n,r){const i=t.update(v);h.defines.VSM_SAMPLES!==n.blurSamples&&(h.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,h.needsUpdate=!0,p.needsUpdate=!0),h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,h,v,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,p,v,null)}function _(t,n,r,i,o,a){let l=null;const h=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(l=void 0!==h?h:!0===r.isPointLight?c:s,e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const e=l.uuid,t=n.uuid;let r=u[e];void 0===r&&(r={},u[e]=r);let i=r[t];void 0===i&&(i=l.clone(),r[t]=i),l=i}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=3===a?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],l.alphaMap=n.alphaMap,l.alphaTest=n.alphaTest,l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.displacementMap=n.displacementMap,l.displacementScale=n.displacementScale,l.displacementBias=n.displacementBias,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=i,l.farDistance=o),l}function E(n,i,o,a,s){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],l=i[u.materialIndex];if(l&&l.visible){const t=_(n,l,a,o.near,o.far,s);e.renderBufferDirect(o,null,r,t,n,u)}}}else if(i.visible){const t=_(n,i,a,o.near,o.far,s);e.renderBufferDirect(o,null,r,t,n,null)}}const c=n.children;for(let e=0,t=c.length;e<t;e++)E(c[e],i,o,a,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,s){if(!1===y.enabled)return;if(!1===y.autoUpdate&&!1===y.needsUpdate)return;if(0===t.length)return;const c=e.getRenderTarget(),u=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(let c=0,u=t.length;c<u;c++){const u=t[c],d=u.shadow;if(void 0===d){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;i.copy(d.mapSize);const p=d.getFrameExtents();if(i.multiply(p),o.copy(d.mapSize),(i.x>l||i.y>l)&&(i.x>l&&(o.x=Math.floor(l/p.x),i.x=o.x*p.x,d.mapSize.x=o.x),i.y>l&&(o.y=Math.floor(l/p.y),i.y=o.y*p.y,d.mapSize.y=o.y)),null===d.map&&!d.isPointLightShadow&&3===this.type){const e={minFilter:g,magFilter:g,format:A};d.map=new Xe(i.x,i.y,e),d.map.texture.name=u.name+".shadowMap",d.mapPass=new Xe(i.x,i.y,e),d.camera.updateProjectionMatrix()}if(null===d.map){const e={minFilter:f,magFilter:f,format:A};d.map=new Xe(i.x,i.y,e),d.map.texture.name=u.name+".shadowMap",d.camera.updateProjectionMatrix()}e.setRenderTarget(d.map),e.clear();const m=d.getViewportCount();for(let e=0;e<m;e++){const t=d.getViewport(e);a.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),h.viewport(a),d.updateMatrices(u,e),r=d.getFrustum(),E(n,s,d.camera,u,this.type)}d.isPointLightShadow||3!==this.type||b(d,s),d.needsUpdate=!1}y.needsUpdate=!1,e.setRenderTarget(c,u,d)}}function qo(e,t,r){const i=r.isWebGL2;const o=new function(){let t=!1;const n=new qe;let r=null;const i=new qe(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),n.set(t,r,o,a),!1===i.equals(n)&&(e.clearColor(t,r,o,a),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},a=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(t){t?j(e.DEPTH_TEST):B(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}else e.depthFunc(e.LEQUAL);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},s=new function(){let t=!1,n=null,r=null,i=null,o=null,a=null,s=null,c=null,u=null;return{setTest:function(n){t||(n?j(e.STENCIL_TEST):B(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,a){r===t&&i===n&&o===a||(e.stencilFunc(t,n,a),r=t,i=n,o=a)},setOp:function(t,n,r){a===t&&s===n&&c===r||(e.stencilOp(t,n,r),a=t,s=n,c=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,a=null,s=null,c=null,u=null}}};let c={},u={},l=new WeakMap,d=[],h=null,f=!1,p=null,m=null,g=null,v=null,y=null,b=null,_=null,E=!1,S=null,w=null,T=null,A=null,R=null;const x=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let I=!1,O=0;const C=e.getParameter(e.VERSION);-1!==C.indexOf("WebGL")?(O=parseFloat(/^WebGL (\d)/.exec(C)[1]),I=O>=1):-1!==C.indexOf("OpenGL ES")&&(O=parseFloat(/^OpenGL ES (\d)/.exec(C)[1]),I=O>=2);let M=null,N={};const L=e.getParameter(e.SCISSOR_BOX),k=e.getParameter(e.VIEWPORT),P=(new qe).fromArray(L),D=(new qe).fromArray(k);function U(t,n,r){const i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let t=0;t<r;t++)e.texImage2D(n+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i);return o}const F={};function j(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function B(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}F[e.TEXTURE_2D]=U(e.TEXTURE_2D,e.TEXTURE_2D,1),F[e.TEXTURE_CUBE_MAP]=U(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),o.setClear(0,0,0,1),a.setClear(1),s.setClear(0),j(e.DEPTH_TEST),a.setFunc(3),z(!1),W(1),j(e.CULL_FACE),H(0);const V={[n]:e.FUNC_ADD,101:e.FUNC_SUBTRACT,102:e.FUNC_REVERSE_SUBTRACT};if(i)V[103]=e.MIN,V[104]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(V[103]=e.MIN_EXT,V[104]=e.MAX_EXT)}const G={200:e.ZERO,201:e.ONE,202:e.SRC_COLOR,204:e.SRC_ALPHA,210:e.SRC_ALPHA_SATURATE,208:e.DST_COLOR,206:e.DST_ALPHA,203:e.ONE_MINUS_SRC_COLOR,205:e.ONE_MINUS_SRC_ALPHA,209:e.ONE_MINUS_DST_COLOR,207:e.ONE_MINUS_DST_ALPHA};function H(t,r,i,o,a,s,c,u){if(0!==t){if(!1===f&&(j(e.BLEND),f=!0),5===t)a=a||r,s=s||i,c=c||o,r===m&&a===y||(e.blendEquationSeparate(V[r],V[a]),m=r,y=a),i===g&&o===v&&s===b&&c===_||(e.blendFuncSeparate(G[i],G[o],G[s],G[c]),g=i,v=o,b=s,_=c),p=t,E=null;else if(t!==p||u!==E){if(m===n&&y===n||(e.blendEquation(e.FUNC_ADD),m=n,y=n),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}g=null,v=null,b=null,_=null,p=t,E=u}}else!0===f&&(B(e.BLEND),f=!1)}function z(t){S!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),S=t)}function W(t){0!==t?(j(e.CULL_FACE),t!==w&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):B(e.CULL_FACE),w=t}function q(t,n,r){t?(j(e.POLYGON_OFFSET_FILL),A===n&&R===r||(e.polygonOffset(n,r),A=n,R=r)):B(e.POLYGON_OFFSET_FILL)}function X(t){void 0===t&&(t=e.TEXTURE0+x-1),M!==t&&(e.activeTexture(t),M=t)}return{buffers:{color:o,depth:a,stencil:s},enable:j,disable:B,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,i&&(t===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(n,i){let o=d,a=!1;if(n)if(o=l.get(i),void 0===o&&(o=[],l.set(i,o)),n.isWebGLMultipleRenderTargets){const t=n.texture;if(o.length!==t.length||o[0]!==e.COLOR_ATTACHMENT0){for(let n=0,r=t.length;n<r;n++)o[n]=e.COLOR_ATTACHMENT0+n;o.length=t.length,a=!0}}else o[0]!==e.COLOR_ATTACHMENT0&&(o[0]=e.COLOR_ATTACHMENT0,a=!0);else o[0]!==e.BACK&&(o[0]=e.BACK,a=!0);a&&(r.isWebGL2?e.drawBuffers(o):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(o))},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:H,setMaterial:function(t,n){2===t.side?B(e.CULL_FACE):j(e.CULL_FACE);let r=1===t.side;n&&(r=!r),z(r),1===t.blending&&!1===t.transparent?H(0):H(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),o.setMask(t.colorWrite);const i=t.stencilWrite;s.setTest(i),i&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?j(e.SAMPLE_ALPHA_TO_COVERAGE):B(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:z,setCullFace:W,setLineWidth:function(t){t!==T&&(I&&e.lineWidth(t),T=t)},setPolygonOffset:q,setScissorTest:function(t){t?j(e.SCISSOR_TEST):B(e.SCISSOR_TEST)},activeTexture:X,bindTexture:function(t,n){null===M&&X();let r=N[M];void 0===r&&(r={type:void 0,texture:void 0},N[M]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||F[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=N[M];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===P.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),P.copy(t))},viewport:function(t){!1===D.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),D.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},M=null,N={},u={},l=new WeakMap,d=[],h=null,f=!1,p=null,m=null,g=null,v=null,y=null,b=null,_=null,E=!1,S=null,w=null,T=null,A=null,R=null,P.set(0,0,e.canvas.width,e.canvas.height),D.set(0,0,e.canvas.width,e.canvas.height),o.reset(),a.reset(),s.reset()}}}function Xo(e,t,n,r,i,o,a){const s=i.isWebGL2,c=i.maxTextures,u=i.maxCubemapSize,I=i.maxTextureSize,O=i.maxSamples,C=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,M=new WeakMap;let N;const L=new WeakMap;let k=!1;try{k="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function P(e,t){return k?new OffscreenCanvas(e,t):Ne("canvas")}function D(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?Ae:Math.floor,o=r(i*e.width),a=r(i*e.height);void 0===N&&(N=P(o,a));const s=n?P(o,a):N;s.width=o,s.height=a;return s.getContext("2d").drawImage(e,0,0,o,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+a+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function U(e){return we(e.width)&&we(e.height)}function F(e,t){return e.generateMipmaps&&t&&e.minFilter!==f&&e.minFilter!==g}function j(t){e.generateMipmap(t)}function B(n,r,i,o,a=!1){if(!1===s)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let c=r;return r===e.RED&&(i===e.FLOAT&&(c=e.R32F),i===e.HALF_FLOAT&&(c=e.R16F),i===e.UNSIGNED_BYTE&&(c=e.R8)),r===e.RG&&(i===e.FLOAT&&(c=e.RG32F),i===e.HALF_FLOAT&&(c=e.RG16F),i===e.UNSIGNED_BYTE&&(c=e.RG8)),r===e.RGBA&&(i===e.FLOAT&&(c=e.RGBA32F),i===e.HALF_FLOAT&&(c=e.RGBA16F),i===e.UNSIGNED_BYTE&&(c=o===ce&&!1===a?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(c=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(c=e.RGB5_A1)),c!==e.R16F&&c!==e.R32F&&c!==e.RG16F&&c!==e.RG32F&&c!==e.RGBA16F&&c!==e.RGBA32F||t.get("EXT_color_buffer_float"),c}function V(e,t,n){return!0===F(e,n)||e.isFramebufferTexture&&e.minFilter!==f&&e.minFilter!==g?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function G(t){return t===f||t===p||t===m?e.NEAREST:e.LINEAR}function H(e){const t=e.target;t.removeEventListener("dispose",H),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=L.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&W(e),0===Object.keys(i).length&&L.delete(n)}r.remove(e)}(t),t.isVideoTexture&&M.delete(t)}function z(t){const n=t.target;n.removeEventListener("dispose",z),function(t){const n=t.texture,i=r.get(t),o=r.get(n);void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),a.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);i.__webglTexture&&(e.deleteTexture(i.__webglTexture),a.memory.textures--),r.remove(n[t])}r.remove(n),r.remove(t)}(n)}function W(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete L.get(i)[n.__cacheKey],a.memory.textures--}let q=0;function X(t,i){const o=r.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;M.get(e)!==t&&(M.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&o.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void Z(o,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_2D,o.__webglTexture)}const J={[l]:e.REPEAT,[d]:e.CLAMP_TO_EDGE,[h]:e.MIRRORED_REPEAT},Y={[f]:e.NEAREST,[p]:e.NEAREST_MIPMAP_NEAREST,[m]:e.NEAREST_MIPMAP_LINEAR,[g]:e.LINEAR,[v]:e.LINEAR_MIPMAP_NEAREST,[y]:e.LINEAR_MIPMAP_LINEAR};function K(n,o,a){if(a?(e.texParameteri(n,e.TEXTURE_WRAP_S,J[o.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,J[o.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,J[o.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,Y[o.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,Y[o.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),o.wrapS===d&&o.wrapT===d||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,G(o.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,G(o.minFilter)),o.minFilter!==f&&o.minFilter!==g&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(o.type===S&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&o.type===w&&!1===t.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function Q(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",H));const i=n.source;let o=L.get(i);void 0===o&&(o={},L.set(i,o));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(s!==t.__cacheKey){void 0===o[s]&&(o[s]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,r=!0),o[s].usedTimes++;const i=o[t.__cacheKey];void 0!==i&&(o[t.__cacheKey].usedTimes--,0===i.usedTimes&&W(n)),t.__cacheKey=s,t.__webglTexture=o[s].texture}return r}function Z(t,r,i){let a=e.TEXTURE_2D;r.isDataArrayTexture&&(a=e.TEXTURE_2D_ARRAY),r.isData3DTexture&&(a=e.TEXTURE_3D);const c=Q(t,r),u=r.source;if(n.activeTexture(e.TEXTURE0+i),n.bindTexture(a,t.__webglTexture),u.version!==u.__currentVersion||!0===c){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const i=function(e){return!s&&(e.wrapS!==d||e.wrapT!==d||e.minFilter!==f&&e.minFilter!==g)}(r)&&!1===U(r.image);let c=D(r.image,i,!1,I);c=ie(r,c);const l=U(c)||s,h=o.convert(r.format,r.encoding);let p,m=o.convert(r.type),v=B(r.internalFormat,h,m,r.encoding,r.isVideoTexture);K(a,r,l);const y=r.mipmaps,b=s&&!0!==r.isVideoTexture,w=void 0===t.__version,O=V(r,c,l);if(r.isDepthTexture)v=e.DEPTH_COMPONENT,s?v=r.type===S?e.DEPTH_COMPONENT32F:r.type===E?e.DEPTH_COMPONENT24:r.type===T?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:r.type===S&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===R&&v===e.DEPTH_COMPONENT&&r.type!==_&&r.type!==E&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=_,m=o.convert(r.type)),r.format===x&&v===e.DEPTH_COMPONENT&&(v=e.DEPTH_STENCIL,r.type!==T&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=T,m=o.convert(r.type))),b&&w?n.texStorage2D(e.TEXTURE_2D,1,v,c.width,c.height):n.texImage2D(e.TEXTURE_2D,0,v,c.width,c.height,0,h,m,null);else if(r.isDataTexture)if(y.length>0&&l){b&&w&&n.texStorage2D(e.TEXTURE_2D,O,v,y[0].width,y[0].height);for(let t=0,r=y.length;t<r;t++)p=y[t],b?n.texSubImage2D(e.TEXTURE_2D,t,0,0,p.width,p.height,h,m,p.data):n.texImage2D(e.TEXTURE_2D,t,v,p.width,p.height,0,h,m,p.data);r.generateMipmaps=!1}else b?(w&&n.texStorage2D(e.TEXTURE_2D,O,v,c.width,c.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,c.width,c.height,h,m,c.data)):n.texImage2D(e.TEXTURE_2D,0,v,c.width,c.height,0,h,m,c.data);else if(r.isCompressedTexture){b&&w&&n.texStorage2D(e.TEXTURE_2D,O,v,y[0].width,y[0].height);for(let t=0,i=y.length;t<i;t++)p=y[t],r.format!==A?null!==h?b?n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,p.width,p.height,h,p.data):n.compressedTexImage2D(e.TEXTURE_2D,t,v,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):b?n.texSubImage2D(e.TEXTURE_2D,t,0,0,p.width,p.height,h,m,p.data):n.texImage2D(e.TEXTURE_2D,t,v,p.width,p.height,0,h,m,p.data)}else if(r.isDataArrayTexture)b?(w&&n.texStorage3D(e.TEXTURE_2D_ARRAY,O,v,c.width,c.height,c.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,c.width,c.height,c.depth,h,m,c.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,v,c.width,c.height,c.depth,0,h,m,c.data);else if(r.isData3DTexture)b?(w&&n.texStorage3D(e.TEXTURE_3D,O,v,c.width,c.height,c.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,c.width,c.height,c.depth,h,m,c.data)):n.texImage3D(e.TEXTURE_3D,0,v,c.width,c.height,c.depth,0,h,m,c.data);else if(r.isFramebufferTexture)b&&w?n.texStorage2D(e.TEXTURE_2D,O,v,c.width,c.height):n.texImage2D(e.TEXTURE_2D,0,v,c.width,c.height,0,h,m,null);else if(y.length>0&&l){b&&w&&n.texStorage2D(e.TEXTURE_2D,O,v,y[0].width,y[0].height);for(let t=0,r=y.length;t<r;t++)p=y[t],b?n.texSubImage2D(e.TEXTURE_2D,t,0,0,h,m,p):n.texImage2D(e.TEXTURE_2D,t,v,h,m,p);r.generateMipmaps=!1}else b?(w&&n.texStorage2D(e.TEXTURE_2D,O,v,c.width,c.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,h,m,c)):n.texImage2D(e.TEXTURE_2D,0,v,h,m,c);F(r,l)&&j(a),u.__currentVersion=u.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function $(t,i,a,s,c){const u=o.convert(a.format,a.encoding),l=o.convert(a.type),d=B(a.internalFormat,u,l,a.encoding);r.get(i).__hasExternalTextures||(c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,0,d,i.width,i.height,i.depth,0,u,l,null):n.texImage2D(c,0,d,i.width,i.height,0,u,l,null)),n.bindFramebuffer(e.FRAMEBUFFER,t),re(i)?C.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,s,c,r.get(a).__webglTexture,0,ne(i)):e.framebufferTexture2D(e.FRAMEBUFFER,s,c,r.get(a).__webglTexture,0),n.bindFramebuffer(e.FRAMEBUFFER,null)}function ee(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let i=e.DEPTH_COMPONENT16;if(r||re(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===S?i=e.DEPTH_COMPONENT32F:t.type===E&&(i=e.DEPTH_COMPONENT24));const r=ne(n);re(n)?C.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,i,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,r,i,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const i=ne(n);r&&!1===re(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):re(n)?C.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,i=o.convert(t.format,t.encoding),a=o.convert(t.type),s=B(t.internalFormat,i,a,t.encoding),c=ne(n);r&&!1===re(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,s,n.width,n.height):re(n)?C.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,s,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function te(t){const i=r.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),X(i.depthTexture,0);const o=r.get(i.depthTexture).__webglTexture,a=ne(i);if(i.depthTexture.format===R)re(i)?C.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(i.depthTexture.format!==x)throw new Error("Unknown depthTexture format");re(i)?C.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}(i.__webglFramebuffer,t)}else if(o){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),ee(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),ee(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function ne(e){return Math.min(O,e.samples)}function re(e){const n=r.get(e);return s&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function ie(e,n){const r=e.encoding,i=e.format,o=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===fe||r!==se&&(r===ce?!1===s?!0===t.has("EXT_sRGB")&&i===A?(e.format=fe,e.minFilter=g,e.generateMipmaps=!1):n=Ve.sRGBToLinear(n):i===A&&o===b||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)),n}this.allocateTextureUnit=function(){const e=q;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),q+=1,e},this.resetTextureUnits=function(){q=0},this.setTexture2D=X,this.setTexture2DArray=function(t,i){const o=r.get(t);t.version>0&&o.__version!==t.version?Z(o,t,i):(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_2D_ARRAY,o.__webglTexture))},this.setTexture3D=function(t,i){const o=r.get(t);t.version>0&&o.__version!==t.version?Z(o,t,i):(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_3D,o.__webglTexture))},this.setTextureCube=function(t,i){const a=r.get(t);t.version>0&&a.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;const a=Q(t,r),c=r.source;if(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture),c.version!==c.__currentVersion||!0===a){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const i=r.isCompressedTexture||r.image[0].isCompressedTexture,a=r.image[0]&&r.image[0].isDataTexture,l=[];for(let e=0;e<6;e++)l[e]=i||a?a?r.image[e].image:r.image[e]:D(r.image[e],!1,!0,u),l[e]=ie(r,l[e]);const d=l[0],h=U(d)||s,f=o.convert(r.format,r.encoding),p=o.convert(r.type),m=B(r.internalFormat,f,p,r.encoding),g=s&&!0!==r.isVideoTexture,v=void 0===t.__version;let y,b=V(r,d,h);if(K(e.TEXTURE_CUBE_MAP,r,h),i){g&&v&&n.texStorage2D(e.TEXTURE_CUBE_MAP,b,m,d.width,d.height);for(let t=0;t<6;t++){y=l[t].mipmaps;for(let i=0;i<y.length;i++){const o=y[i];r.format!==A?null!==f?g?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,o.width,o.height,f,o.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,m,o.width,o.height,0,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,o.width,o.height,f,p,o.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,m,o.width,o.height,0,f,p,o.data)}}}else{y=r.mipmaps,g&&v&&(y.length>0&&b++,n.texStorage2D(e.TEXTURE_CUBE_MAP,b,m,l[0].width,l[0].height));for(let t=0;t<6;t++)if(a){g?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,l[t].width,l[t].height,f,p,l[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,m,l[t].width,l[t].height,0,f,p,l[t].data);for(let r=0;r<y.length;r++){const i=y[r].image[t].image;g?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,f,p,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,m,i.width,i.height,0,f,p,i.data)}}else{g?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f,p,l[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,m,f,p,l[t]);for(let r=0;r<y.length;r++){const i=y[r];g?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,f,p,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,m,f,p,i.image[t])}}}F(r,h)&&j(e.TEXTURE_CUBE_MAP),c.__currentVersion=c.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(a,t,i):(n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture))},this.rebindTextures=function(t,n,i){const o=r.get(t);void 0!==n&&$(o.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),void 0!==i&&te(t)},this.setupRenderTarget=function(t){const c=t.texture,u=r.get(t),l=r.get(c);t.addEventListener("dispose",z),!0!==t.isWebGLMultipleRenderTargets&&(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=c.version,a.memory.textures++);const d=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultipleRenderTargets,f=U(t)||s;if(d){u.__webglFramebuffer=[];for(let t=0;t<6;t++)u.__webglFramebuffer[t]=e.createFramebuffer()}else if(u.__webglFramebuffer=e.createFramebuffer(),h)if(i.drawBuffers){const n=t.texture;for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(s&&t.samples>0&&!1===re(t)){u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,u.__webglColorRenderbuffer);const r=o.convert(c.format,c.encoding),i=o.convert(c.type),a=B(c.internalFormat,r,i,c.encoding),s=ne(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,s,a,t.width,t.height),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),ee(u.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}if(d){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),K(e.TEXTURE_CUBE_MAP,c,f);for(let n=0;n<6;n++)$(u.__webglFramebuffer[n],t,c,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n);F(c,f)&&j(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){const i=t.texture;for(let o=0,a=i.length;o<a;o++){const a=i[o],s=r.get(a);n.bindTexture(e.TEXTURE_2D,s.__webglTexture),K(e.TEXTURE_2D,a,f),$(u.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+o,e.TEXTURE_2D),F(a,f)&&j(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(s?r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(r,l.__webglTexture),K(r,c,f),$(u.__webglFramebuffer,t,c,e.COLOR_ATTACHMENT0,r),F(c,f)&&j(r),n.unbindTexture()}t.depthBuffer&&te(t)},this.updateRenderTargetMipmap=function(t){const i=U(t)||s,o=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let a=0,s=o.length;a<s;a++){const s=o[a];if(F(s,i)){const i=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=r.get(s).__webglTexture;n.bindTexture(i,o),j(i),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(s&&t.samples>0&&!1===re(t)){const i=t.width,o=t.height;let a=e.COLOR_BUFFER_BIT;const s=[e.COLOR_ATTACHMENT0],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;t.depthBuffer&&s.push(c);const u=r.get(t),l=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;!1===l&&(t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(a|=e.STENCIL_BUFFER_BIT)),n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer),!0===l&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),e.blitFramebuffer(0,0,i,o,0,0,i,o,a,e.NEAREST),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,s),n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=te,this.setupFrameBufferTexture=$,this.useMultisampledRTT=re}function Jo(e,t,n){const r=n.isWebGL2;return{convert:function(n,i=null){let o;if(n===b)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(n===_)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(n===E)return e.UNSIGNED_INT;if(n===S)return e.FLOAT;if(n===w)return r?e.HALF_FLOAT:(o=t.get("OES_texture_half_float"),null!==o?o.HALF_FLOAT_OES:null);if(1021===n)return e.ALPHA;if(n===A)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===R)return e.DEPTH_COMPONENT;if(n===x)return e.DEPTH_STENCIL;if(1028===n)return e.RED;if(1022===n)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),e.RGBA;if(n===fe)return o=t.get("EXT_sRGB"),null!==o?o.SRGB_ALPHA_EXT:null;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(n===I||n===O||n===C||n===M)if(i===ce){if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===o)return null;if(n===I)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===O)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===C)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===M)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(o=t.get("WEBGL_compressed_texture_s3tc"),null===o)return null;if(n===I)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===O)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===C)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===M)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===N||n===L||n===k||n===P){if(o=t.get("WEBGL_compressed_texture_pvrtc"),null===o)return null;if(n===N)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===L)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===k)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===P)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return o=t.get("WEBGL_compressed_texture_etc1"),null!==o?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===D||n===U){if(o=t.get("WEBGL_compressed_texture_etc"),null===o)return null;if(n===D)return i===ce?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(n===U)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}if(n===F||n===j||n===B||n===V||n===G||n===H||n===z||n===W||n===q||n===X||n===J||n===Y||n===K||n===Q){if(o=t.get("WEBGL_compressed_texture_astc"),null===o)return null;if(n===F)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===j)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===B)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===V)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===G)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===H)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===z)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===W)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===q)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===X)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===J)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Y)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===K)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Q)return i===ce?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Z){if(o=t.get("EXT_texture_compression_bptc"),null===o)return null;if(n===Z)return i===ce?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}return n===T?r?e.UNSIGNED_INT_24_8:(o=t.get("WEBGL_depth_texture"),null!==o?o.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Yo extends lr{constructor(e=[]){super(),this.cameras=e}}Yo.prototype.isArrayCamera=!0;class Ko extends nn{constructor(){super(),this.type="Group"}}Ko.prototype.isGroup=!0;const Qo={type:"move"};class Zo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ko,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ko,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new et,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new et),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ko,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new et,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new et),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,o=null;const a=this._targetRay,s=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==a&&(r=t.getPose(e.targetRaySpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Qo))),c&&e.hand){o=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n);if(void 0===c.joints[r.jointName]){const e=new Ko;e.matrixAutoUpdate=!1,e.visible=!1,c.joints[r.jointName]=e,c.add(e)}const i=c.joints[r.jointName];null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}const r=c.joints["index-finger-tip"],i=c.joints["thumb-tip"],a=r.position.distanceTo(i.position),s=.02,u=.005;c.inputState.pinching&&a>s+u?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&a<=s-u&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==r),null!==s&&(s.visible=null!==i),null!==c&&(c.visible=null!==o),this}}class $o extends We{constructor(e,t,n,r,i,o,a,s,c,u){if((u=void 0!==u?u:R)!==R&&u!==x)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===R&&(n=_),void 0===n&&u===x&&(n=T),super(null,r,i,o,a,s,u,n,c),this.image={width:e,height:t},this.magFilter=void 0!==a?a:f,this.minFilter=void 0!==s?s:f,this.flipY=!1,this.generateMipmaps=!1}}$o.prototype.isDepthTexture=!0;class ea extends pe{constructor(e,t){super();const n=this;let r=null,i=1,o=null,a="local-floor",s=null,c=null,u=null,l=null,d=null;const h=t.getContextAttributes();let f=null,p=null;const m=[],g=new Map,v=new lr;v.layers.enable(1),v.viewport=new qe;const y=new lr;y.layers.enable(2),y.viewport=new qe;const E=[v,y],S=new Yo;S.layers.enable(1),S.layers.enable(2);let w=null,I=null;function O(e){const t=g.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function C(){g.forEach((function(e,t){e.disconnect(t)})),g.clear(),w=null,I=null,e.setRenderTarget(f),l=null,u=null,c=null,r=null,p=null,D.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function M(e){const t=r.inputSources;for(let e=0;e<m.length;e++)g.set(t[e],m[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=g.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),g.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],r=g.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=m[e];return void 0===t&&(t=new Zo,m[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=m[e];return void 0===t&&(t=new Zo,m[e]=t),t.getGripSpace()},this.getHand=function(e){let t=m[e];return void 0===t&&(t=new Zo,m[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return null!==u?u:l},this.getBinding=function(){return c},this.getFrame=function(){return d},this.getSession=function(){return r},this.setSession=async function(s){if(r=s,null!==r){if(f=e.getRenderTarget(),r.addEventListener("select",O),r.addEventListener("selectstart",O),r.addEventListener("selectend",O),r.addEventListener("squeeze",O),r.addEventListener("squeezestart",O),r.addEventListener("squeezeend",O),r.addEventListener("end",C),r.addEventListener("inputsourceschange",M),!0!==h.xrCompatible&&await t.makeXRCompatible(),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==r.renderState.layers||h.antialias,alpha:h.alpha,depth:h.depth,stencil:h.stencil,framebufferScaleFactor:i};l=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:l}),p=new Xe(l.framebufferWidth,l.framebufferHeight,{format:A,type:b,encoding:e.outputEncoding})}else{let n=null,o=null,a=null;h.depth&&(a=h.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=h.stencil?x:R,o=h.stencil?T:_);const s={colorFormat:e.outputEncoding===ce?t.SRGB8_ALPHA8:t.RGBA8,depthFormat:a,scaleFactor:i};c=new XRWebGLBinding(r,t),u=c.createProjectionLayer(s),r.updateRenderState({layers:[u]}),p=new Xe(u.textureWidth,u.textureHeight,{format:A,type:b,depthTexture:new $o(u.textureWidth,u.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:h.stencil,encoding:e.outputEncoding,samples:h.antialias?4:0});e.properties.get(p).__ignoreDepthValues=u.ignoreDepthValues}p.isXRRenderTarget=!0,this.setFoveation(1),o=await r.requestReferenceSpace(a),D.setContext(r),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const N=new et,L=new et;function k(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;S.near=y.near=v.near=e.near,S.far=y.far=v.far=e.far,w===S.near&&I===S.far||(r.updateRenderState({depthNear:S.near,depthFar:S.far}),w=S.near,I=S.far);const t=e.parent,n=S.cameras;k(S,t);for(let e=0;e<n.length;e++)k(n[e],t);S.matrixWorld.decompose(S.position,S.quaternion,S.scale),e.position.copy(S.position),e.quaternion.copy(S.quaternion),e.scale.copy(S.scale),e.matrix.copy(S.matrix),e.matrixWorld.copy(S.matrixWorld);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){N.setFromMatrixPosition(t.matrixWorld),L.setFromMatrixPosition(n.matrixWorld);const r=N.distanceTo(L),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),c=(i[9]+1)/i[5],u=(i[9]-1)/i[5],l=(i[8]-1)/i[0],d=(o[8]+1)/o[0],h=a*l,f=a*d,p=r/(-l+d),m=p*-l;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=a+p,v=s+p,y=h-m,b=f+(r-m),_=c*s/v*g,E=u*s/v*g;e.projectionMatrix.makePerspective(y,b,_,E,g,v)}(S,v,y):S.projectionMatrix.copy(v.projectionMatrix)},this.getCamera=function(){return S},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==l?l.fixedFoveation:void 0},this.setFoveation=function(e){null!==u&&(u.fixedFoveation=e),null!==l&&void 0!==l.fixedFoveation&&(l.fixedFoveation=e)};let P=null;const D=new Sr;D.setAnimationLoop((function(t,n){if(s=n.getViewerPose(o),d=n,null!==s){const t=s.views;null!==l&&(e.setRenderTargetFramebuffer(p,l.framebuffer),e.setRenderTarget(p));let n=!1;t.length!==S.cameras.length&&(S.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let o=null;if(null!==l)o=l.getViewport(i);else{const t=c.getViewSubImage(u,i);o=t.viewport,0===r&&(e.setRenderTargetTextures(p,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(p))}const a=E[r];a.matrix.fromArray(i.transform.matrix),a.projectionMatrix.fromArray(i.projectionMatrix),a.viewport.set(o.x,o.y,o.width,o.height),0===r&&S.matrix.copy(a.matrix),!0===n&&S.cameras.push(a)}}const i=r.inputSources;for(let e=0;e<m.length;e++){const t=m[e],r=i[e];t.update(r,n,o)}P&&P(t,n),d=null})),this.setAnimationLoop=function(e){P=e},this.dispose=function(){}}}function ta(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap),n.alphaTest>0&&(t.alphaTest.value=n.alphaTest);const r=e.get(n).envMap;let i,o;r&&(t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,t.reflectivity.value=n.reflectivity,t.ior.value=n.ior,t.refractionRatio.value=n.refractionRatio),n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap?i=n.clearcoatRoughnessMap:n.specularIntensityMap?i=n.specularIntensityMap:n.specularColorMap?i=n.specularColorMap:n.transmissionMap?i=n.transmissionMap:n.thicknessMap?i=n.thicknessMap:n.sheenColorMap?i=n.sheenColorMap:n.sheenRoughnessMap&&(i=n.sheenRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias);e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,o,a){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t,r){n(e,t),e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,r,a):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,o):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function na(e={}){const n=void 0!==e.canvas?e.canvas:function(){const e=Ne("canvas");return e.style.display="block",e}(),r=void 0!==e.context?e.context:null,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",l=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let d;d=void 0!==e.context?r.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let h=null,f=null;const p=[],m=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=se,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const g=this;let v=!1,_=0,E=0,T=null,R=-1,x=null;const I=new qe,O=new qe;let C=null,M=n.width,N=n.height,L=1,k=null,P=null;const D=new qe(0,0,M,N),U=new qe(0,0,M,N);let F=!1;const j=new Er;let B=!1,V=!1,G=null;const H=new Mt,z=new xe,W=new et,q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function X(){return null===T?L:1}let J,Y,K,Q,Z,$,ee,te,ne,re,ie,oe,ae,ce,ue,le,de,he,fe,pe,me,ge,ve,ye=r;function be(e,t){for(let r=0;r<e.length;r++){const i=e[r],o=n.getContext(i,t);if(null!==o)return o}return null}try{const e={alpha:!0,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:l};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${t}`),n.addEventListener("webglcontextlost",Se,!1),n.addEventListener("webglcontextrestored",we,!1),null===ye){const t=["webgl2","webgl","experimental-webgl"];if(!0===g.isWebGL1Renderer&&t.shift(),ye=be(t,e),null===ye)throw be(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ye.getShaderPrecisionFormat&&(ye.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function _e(){J=new Kr(ye),Y=new Mr(ye,J,e),J.init(Y),ge=new Jo(ye,J,Y),K=new qo(ye,J,Y),Q=new $r(ye),Z=new No,$=new Xo(ye,J,K,Z,Y,ge,Q),ee=new Lr(g),te=new Yr(g),ne=new wr(ye,Y),ve=new Or(ye,J,ne,Y),re=new Qr(ye,ne,Q,ve),ie=new ii(ye,re,ne,Q),fe=new ri(ye,Y,$),le=new Nr(Z),oe=new Mo(g,ee,te,J,Y,ve,le),ae=new ta(Z),ce=new Do,ue=new Go(J,Y),he=new Ir(g,ee,K,ie,d,s),de=new Wo(g,ie,Y),pe=new Cr(ye,J,Q,Y),me=new Zr(ye,J,Q,Y),Q.programs=oe.programs,g.capabilities=Y,g.extensions=J,g.properties=Z,g.renderLists=ce,g.shadowMap=de,g.state=K,g.info=Q}_e();const Ee=new ea(g,ye);function Se(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function we(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const e=Q.autoReset,t=de.enabled,n=de.autoUpdate,r=de.needsUpdate,i=de.type;_e(),Q.autoReset=e,de.enabled=t,de.autoUpdate=n,de.needsUpdate=r,de.type=i}function Te(e){const t=e.target;t.removeEventListener("dispose",Te),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&(t.forEach((function(e){oe.releaseProgram(e)})),e.isShaderMaterial&&oe.releaseShaderCache(e))})(e),Z.remove(e)}(t)}this.xr=Ee,this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){const e=J.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=J.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e,this.setSize(M,N,!1))},this.getSize=function(e){return e.set(M,N)},this.setSize=function(e,t,r){Ee.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(M=e,N=t,n.width=Math.floor(e*L),n.height=Math.floor(t*L),!1!==r&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(M*L,N*L).floor()},this.setDrawingBufferSize=function(e,t,r){M=e,N=t,L=r,n.width=Math.floor(e*r),n.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(I)},this.getViewport=function(e){return e.copy(D)},this.setViewport=function(e,t,n,r){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,n,r),K.viewport(I.copy(D).multiplyScalar(L).floor())},this.getScissor=function(e){return e.copy(U)},this.setScissor=function(e,t,n,r){e.isVector4?U.set(e.x,e.y,e.z,e.w):U.set(e,t,n,r),K.scissor(O.copy(U).multiplyScalar(L).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){K.setScissorTest(F=e)},this.setOpaqueSort=function(e){k=e},this.setTransparentSort=function(e){P=e},this.getClearColor=function(e){return e.copy(he.getClearColor())},this.setClearColor=function(){he.setClearColor.apply(he,arguments)},this.getClearAlpha=function(){return he.getClearAlpha()},this.setClearAlpha=function(){he.setClearAlpha.apply(he,arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;e&&(r|=ye.COLOR_BUFFER_BIT),t&&(r|=ye.DEPTH_BUFFER_BIT),n&&(r|=ye.STENCIL_BUFFER_BIT),ye.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Se,!1),n.removeEventListener("webglcontextrestored",we,!1),ce.dispose(),ue.dispose(),Z.dispose(),ee.dispose(),te.dispose(),ie.dispose(),ve.dispose(),oe.dispose(),Ee.dispose(),Ee.removeEventListener("sessionstart",Ie),Ee.removeEventListener("sessionend",Oe),G&&(G.dispose(),G=null),Ce.stop()},this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=q);const a=i.isMesh&&i.matrixWorld.determinant()<0,s=function(e,t,n,r,i){!0!==t.isScene&&(t=q);$.resetTextureUnits();const o=t.fog,a=r.isMeshStandardMaterial?t.environment:null,s=null===T?g.outputEncoding:!0===T.isXRRenderTarget?T.texture.encoding:se,c=(r.isMeshStandardMaterial?te:ee).get(r.envMap||a),u=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,l=!!r.normalMap&&!!n.attributes.tangent,d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,m=r.toneMapped?g.toneMapping:0,v=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==v?v.length:0,b=Z.get(r),_=f.state.lights;if(!0===B&&(!0===V||e!==x)){const t=e===x&&r.id===R;le.setState(r,e,t)}let E=!1;r.version===b.__version?b.needsLights&&b.lightsStateVersion!==_.state.version||b.outputEncoding!==s||i.isInstancedMesh&&!1===b.instancing?E=!0:i.isInstancedMesh||!0!==b.instancing?i.isSkinnedMesh&&!1===b.skinning?E=!0:i.isSkinnedMesh||!0!==b.skinning?b.envMap!==c||r.fog&&b.fog!==o?E=!0:void 0===b.numClippingPlanes||b.numClippingPlanes===le.numPlanes&&b.numIntersection===le.numIntersection?(b.vertexAlphas!==u||b.vertexTangents!==l||b.morphTargets!==d||b.morphNormals!==h||b.morphColors!==p||b.toneMapping!==m||!0===Y.isWebGL2&&b.morphTargetsCount!==y)&&(E=!0):E=!0:E=!0:E=!0:(E=!0,b.__version=r.version);let S=b.currentProgram;!0===E&&(S=De(r,t,i));let w=!1,A=!1,I=!1;const O=S.getUniforms(),C=b.uniforms;K.useProgram(S.program)&&(w=!0,A=!0,I=!0);r.id!==R&&(R=r.id,A=!0);if(w||x!==e){if(O.setValue(ye,"projectionMatrix",e.projectionMatrix),Y.logarithmicDepthBuffer&&O.setValue(ye,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),x!==e&&(x=e,A=!0,I=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){const t=O.map.cameraPosition;void 0!==t&&t.setValue(ye,W.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&O.setValue(ye,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh)&&O.setValue(ye,"viewMatrix",e.matrixWorldInverse)}if(i.isSkinnedMesh){O.setOptional(ye,i,"bindMatrix"),O.setOptional(ye,i,"bindMatrixInverse");const e=i.skeleton;e&&(Y.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),O.setValue(ye,"boneTexture",e.boneTexture,$),O.setValue(ye,"boneTextureSize",e.boneTextureSize)):O.setOptional(ye,e,"boneMatrices"))}const M=n.morphAttributes;(void 0!==M.position||void 0!==M.normal||void 0!==M.color&&!0===Y.isWebGL2)&&fe.update(i,n,r,S);(A||b.receiveShadow!==i.receiveShadow)&&(b.receiveShadow=i.receiveShadow,O.setValue(ye,"receiveShadow",i.receiveShadow));A&&(O.setValue(ye,"toneMappingExposure",g.toneMappingExposure),b.needsLights&&(P=I,(k=C).ambientLightColor.needsUpdate=P,k.lightProbe.needsUpdate=P,k.directionalLights.needsUpdate=P,k.directionalLightShadows.needsUpdate=P,k.pointLights.needsUpdate=P,k.pointLightShadows.needsUpdate=P,k.spotLights.needsUpdate=P,k.spotLightShadows.needsUpdate=P,k.rectAreaLights.needsUpdate=P,k.hemisphereLights.needsUpdate=P),o&&r.fog&&ae.refreshFogUniforms(C,o),ae.refreshMaterialUniforms(C,r,L,N,G),co.upload(ye,b.uniformsList,C,$));var k,P;r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(co.upload(ye,b.uniformsList,C,$),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&O.setValue(ye,"center",i.center);return O.setValue(ye,"modelViewMatrix",i.modelViewMatrix),O.setValue(ye,"normalMatrix",i.normalMatrix),O.setValue(ye,"modelMatrix",i.matrixWorld),S}(e,t,n,r,i);K.setMaterial(r,a);let c=n.index;const u=n.attributes.position;if(null===c){if(void 0===u||0===u.count)return}else if(0===c.count)return;let l,d=1;!0===r.wireframe&&(c=re.getWireframeAttribute(n),d=2),ve.setup(i,r,s,n,c);let h=pe;null!==c&&(l=ne.get(c),h=me,h.setIndex(l));const p=null!==c?c.count:u.count,m=n.drawRange.start*d,v=n.drawRange.count*d,y=null!==o?o.start*d:0,b=null!==o?o.count*d:1/0,_=Math.max(m,y),E=Math.min(p,m+v,y+b)-1,S=Math.max(0,E-_+1);if(0!==S){if(i.isMesh)!0===r.wireframe?(K.setLineWidth(r.wireframeLinewidth*X()),h.setMode(ye.LINES)):h.setMode(ye.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),K.setLineWidth(e*X()),i.isLineSegments?h.setMode(ye.LINES):i.isLineLoop?h.setMode(ye.LINE_LOOP):h.setMode(ye.LINE_STRIP)}else i.isPoints?h.setMode(ye.POINTS):i.isSprite&&h.setMode(ye.TRIANGLES);if(i.isInstancedMesh)h.renderInstances(_,S,i.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);h.renderInstances(_,S,e)}else h.render(_,S)}},this.compile=function(e,t){f=ue.get(e),f.init(),m.push(f),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))})),f.setupLights(g.physicallyCorrectLights),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){De(n[r],e,t)}else De(n,e,t)})),m.pop(),f=null};let Re=null;function Ie(){Ce.stop()}function Oe(){Ce.start()}const Ce=new Sr;function Me(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)f.pushLight(e),e.castShadow&&f.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||j.intersectsSprite(e)){r&&W.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=ie.update(e),i=e.material;i.visible&&h.push(e,t,i,n,W.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Q.render.frame&&(e.skeleton.update(),e.skeleton.frame=Q.render.frame),!e.frustumCulled||j.intersectsObject(e))){r&&W.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=ie.update(e),i=e.material;if(Array.isArray(i)){const r=t.groups;for(let o=0,a=r.length;o<a;o++){const a=r[o],s=i[a.materialIndex];s&&s.visible&&h.push(e,t,s,n,W.z,a)}}else i.visible&&h.push(e,t,i,n,W.z,null)}const i=e.children;for(let e=0,o=i.length;e<o;e++)Me(i[e],t,n,r)}function Le(e,t,n,r){const i=e.opaque,o=e.transmissive,s=e.transparent;f.setupLightsView(n),o.length>0&&function(e,t,n){const r=Y.isWebGL2;null===G&&(G=new Xe(1,1,{generateMipmaps:!0,type:null!==ge.convert(w)?w:b,minFilter:y,samples:r&&!0===a?4:0}));g.getDrawingBufferSize(z),r?G.setSize(z.x,z.y):G.setSize(Ae(z.x),Ae(z.y));const i=g.getRenderTarget();g.setRenderTarget(G),g.clear();const o=g.toneMapping;g.toneMapping=0,ke(e,t,n),g.toneMapping=o,$.updateMultisampleRenderTarget(G),$.updateRenderTargetMipmap(G),g.setRenderTarget(i)}(i,t,n),r&&K.viewport(I.copy(r)),i.length>0&&ke(i,t,n),o.length>0&&ke(o,t,n),s.length>0&&ke(s,t,n),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function ke(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,o=e.length;i<o;i++){const o=e[i],a=o.object,s=o.geometry,c=null===r?o.material:r,u=o.group;a.layers.test(n.layers)&&Pe(a,t,n,s,c,u)}}function Pe(e,t,n,r,i,o){e.onBeforeRender(g,t,n,r,i,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(g,t,n,r,e,o),!0===i.transparent&&2===i.side?(i.side=1,i.needsUpdate=!0,g.renderBufferDirect(n,t,r,i,e,o),i.side=0,i.needsUpdate=!0,g.renderBufferDirect(n,t,r,i,e,o),i.side=2):g.renderBufferDirect(n,t,r,i,e,o),e.onAfterRender(g,t,n,r,i,o)}function De(e,t,n){!0!==t.isScene&&(t=q);const r=Z.get(e),i=f.state.lights,o=f.state.shadowsArray,a=i.state.version,s=oe.getParameters(e,i.state,o,t,n),c=oe.getProgramCacheKey(s);let u=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?te:ee).get(e.envMap||r.environment),void 0===u&&(e.addEventListener("dispose",Te),u=new Map,r.programs=u);let l=u.get(c);if(void 0!==l){if(r.currentProgram===l&&r.lightsStateVersion===a)return Ue(e,s),l}else s.uniforms=oe.getUniforms(e),e.onBuild(n,s,g),e.onBeforeCompile(s,g),l=oe.acquireProgram(s,c),u.set(c,l),r.uniforms=s.uniforms;const d=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=le.uniform),Ue(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(d.ambientLightColor.value=i.state.ambient,d.lightProbe.value=i.state.probe,d.directionalLights.value=i.state.directional,d.directionalLightShadows.value=i.state.directionalShadow,d.spotLights.value=i.state.spot,d.spotLightShadows.value=i.state.spotShadow,d.rectAreaLights.value=i.state.rectArea,d.ltc_1.value=i.state.rectAreaLTC1,d.ltc_2.value=i.state.rectAreaLTC2,d.pointLights.value=i.state.point,d.pointLightShadows.value=i.state.pointShadow,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotShadowMatrix.value=i.state.spotShadowMatrix,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix);const h=l.getUniforms(),p=co.seqWithValue(h.seq,d);return r.currentProgram=l,r.uniformsList=p,l}function Ue(e,t){const n=Z.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Ce.setAnimationLoop((function(e){Re&&Re(e)})),"undefined"!=typeof window&&Ce.setContext(window),this.setAnimationLoop=function(e){Re=e,Ee.setAnimationLoop(e),null===e?Ce.stop():Ce.start()},Ee.addEventListener("sessionstart",Ie),Ee.addEventListener("sessionend",Oe),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===v)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===Ee.enabled&&!0===Ee.isPresenting&&(!0===Ee.cameraAutoUpdate&&Ee.updateCamera(t),t=Ee.getCamera()),!0===e.isScene&&e.onBeforeRender(g,e,t,T),f=ue.get(e,m.length),f.init(),m.push(f),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),j.setFromProjectionMatrix(H),V=this.localClippingEnabled,B=le.init(this.clippingPlanes,V,t),h=ce.get(e,p.length),h.init(),p.push(h),Me(e,t,0,g.sortObjects),h.finish(),!0===g.sortObjects&&h.sort(k,P),!0===B&&le.beginShadows();const n=f.state.shadowsArray;if(de.render(n,e,t),!0===B&&le.endShadows(),!0===this.info.autoReset&&this.info.reset(),he.render(h,e),f.setupLights(g.physicallyCorrectLights),t.isArrayCamera){const n=t.cameras;for(let t=0,r=n.length;t<r;t++){const r=n[t];Le(h,e,r,r.viewport)}}else Le(h,e,t);null!==T&&($.updateMultisampleRenderTarget(T),$.updateRenderTargetMipmap(T)),!0===e.isScene&&e.onAfterRender(g,e,t),ve.resetDefaultState(),R=-1,x=null,m.pop(),f=m.length>0?m[m.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return T},this.setRenderTargetTextures=function(e,t,n){Z.get(e.texture).__webglTexture=t,Z.get(e.depthTexture).__webglTexture=n;const r=Z.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===J.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=Z.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){T=e,_=t,E=n;let r=!0;if(e){const t=Z.get(e);void 0!==t.__useDefaultFramebuffer?(K.bindFramebuffer(ye.FRAMEBUFFER,null),r=!1):void 0===t.__webglFramebuffer?$.setupRenderTarget(e):t.__hasExternalTextures&&$.rebindTextures(e,Z.get(e.texture).__webglTexture,Z.get(e.depthTexture).__webglTexture)}let i=null,o=!1,a=!1;if(e){const n=e.texture;(n.isData3DTexture||n.isDataArrayTexture)&&(a=!0);const r=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=r[t],o=!0):i=Y.isWebGL2&&e.samples>0&&!1===$.useMultisampledRTT(e)?Z.get(e).__webglMultisampledFramebuffer:r,I.copy(e.viewport),O.copy(e.scissor),C=e.scissorTest}else I.copy(D).multiplyScalar(L).floor(),O.copy(U).multiplyScalar(L).floor(),C=F;if(K.bindFramebuffer(ye.FRAMEBUFFER,i)&&Y.drawBuffers&&r&&K.drawBuffers(e,i),K.viewport(I),K.scissor(O),K.setScissorTest(C),o){const r=Z.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(a){const r=Z.get(e.texture),i=t||0;ye.framebufferTextureLayer(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}R=-1},this.readRenderTargetPixels=function(e,t,n,r,i,o,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){K.bindFramebuffer(ye.FRAMEBUFFER,s);try{const a=e.texture,s=a.format,c=a.type;if(s!==A&&ge.convert(s)!==ye.getParameter(ye.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const u=c===w&&(J.has("EXT_color_buffer_half_float")||Y.isWebGL2&&J.has("EXT_color_buffer_float"));if(!(c===b||ge.convert(c)===ye.getParameter(ye.IMPLEMENTATION_COLOR_READ_TYPE)||c===S&&(Y.isWebGL2||J.has("OES_texture_float")||J.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");ye.checkFramebufferStatus(ye.FRAMEBUFFER)===ye.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ye.readPixels(t,n,r,i,ge.convert(s),ge.convert(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==T?Z.get(T).__webglFramebuffer:null;K.bindFramebuffer(ye.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){if(!0!==t.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r);$.setTexture2D(t,0),ye.copyTexSubImage2D(ye.TEXTURE_2D,n,0,0,e.x,e.y,i,o),K.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,o=t.image.height,a=ge.convert(n.format),s=ge.convert(n.type);$.setTexture2D(n,0),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,n.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?ye.texSubImage2D(ye.TEXTURE_2D,r,e.x,e.y,i,o,a,s,t.image.data):t.isCompressedTexture?ye.compressedTexSubImage2D(ye.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):ye.texSubImage2D(ye.TEXTURE_2D,r,e.x,e.y,a,s,t.image),0===r&&n.generateMipmaps&&ye.generateMipmap(ye.TEXTURE_2D),K.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r,i=0){if(g.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const o=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,c=ge.convert(r.format),u=ge.convert(r.type);let l;if(r.isData3DTexture)$.setTexture3D(r,0),l=ye.TEXTURE_3D;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");$.setTexture2DArray(r,0),l=ye.TEXTURE_2D_ARRAY}ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,r.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,r.unpackAlignment);const d=ye.getParameter(ye.UNPACK_ROW_LENGTH),h=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),f=ye.getParameter(ye.UNPACK_SKIP_PIXELS),p=ye.getParameter(ye.UNPACK_SKIP_ROWS),m=ye.getParameter(ye.UNPACK_SKIP_IMAGES),v=n.isCompressedTexture?n.mipmaps[0]:n.image;ye.pixelStorei(ye.UNPACK_ROW_LENGTH,v.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,v.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,e.min.x),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,e.min.y),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?ye.texSubImage3D(l,i,t.x,t.y,t.z,o,a,s,c,u,v.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ye.compressedTexSubImage3D(l,i,t.x,t.y,t.z,o,a,s,c,v.data)):ye.texSubImage3D(l,i,t.x,t.y,t.z,o,a,s,c,u,v),ye.pixelStorei(ye.UNPACK_ROW_LENGTH,d),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,h),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,f),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,p),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,m),0===i&&r.generateMipmaps&&ye.generateMipmap(l),K.unbindTexture()},this.initTexture=function(e){$.setTexture2D(e,0),K.unbindTexture()},this.resetState=function(){_=0,E=0,T=null,K.reset(),ve.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}na.prototype.isWebGLRenderer=!0;class ra extends na{}ra.prototype.isWebGL1Renderer=!0;class ia{constructor(e,t=25e-5){this.name="",this.color=new je(e),this.density=t}clone(){return new ia(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}ia.prototype.isFogExp2=!0;class oa{constructor(e,t=1,n=1e3){this.name="",this.color=new je(e),this.near=t,this.far=n}clone(){return new oa(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}oa.prototype.isFog=!0;class aa extends nn{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}aa.prototype.isScene=!0;class sa{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=le,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=be()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=be()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=be()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}sa.prototype.isInterleavedBuffer=!0;const ca=new et;class ua{constructor(e,t,n,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)ca.x=this.getX(t),ca.y=this.getY(t),ca.z=this.getZ(t),ca.applyMatrix4(e),this.setXYZ(t,ca.x,ca.y,ca.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ca.x=this.getX(t),ca.y=this.getY(t),ca.z=this.getZ(t),ca.applyNormalMatrix(e),this.setXYZ(t,ca.x,ca.y,ca.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ca.x=this.getX(t),ca.y=this.getY(t),ca.z=this.getZ(t),ca.transformDirection(e),this.setXYZ(t,ca.x,ca.y,ca.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new _n(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ua(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}ua.prototype.isInterleavedBufferAttribute=!0;class la extends gn{constructor(e){super(),this.type="SpriteMaterial",this.color=new je(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let da;la.prototype.isSpriteMaterial=!0;const ha=new et,fa=new et,pa=new et,ma=new xe,ga=new xe,va=new Mt,ya=new et,ba=new et,_a=new et,Ea=new xe,Sa=new xe,wa=new xe;class Ta extends nn{constructor(e){if(super(),this.type="Sprite",void 0===da){da=new Fn;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new sa(e,5);da.setIndex([0,1,2,0,2,3]),da.setAttribute("position",new ua(t,3,0,!1)),da.setAttribute("uv",new ua(t,2,3,!1))}this.geometry=da,this.material=void 0!==e?e:new la,this.center=new xe(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),fa.setFromMatrixScale(this.matrixWorld),va.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),pa.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&fa.multiplyScalar(-pa.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;Aa(ya.set(-.5,-.5,0),pa,o,fa,r,i),Aa(ba.set(.5,-.5,0),pa,o,fa,r,i),Aa(_a.set(.5,.5,0),pa,o,fa,r,i),Ea.set(0,0),Sa.set(1,0),wa.set(1,1);let a=e.ray.intersectTriangle(ya,ba,_a,!1,ha);if(null===a&&(Aa(ba.set(-.5,.5,0),pa,o,fa,r,i),Sa.set(0,1),a=e.ray.intersectTriangle(ya,_a,ba,!1,ha),null===a))return;const s=e.ray.origin.distanceTo(ha);s<e.near||s>e.far||t.push({distance:s,point:ha.clone(),uv:pn.getUV(ha,ya,ba,_a,Ea,Sa,wa,new xe),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Aa(e,t,n,r,i,o){ma.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(ga.x=o*ma.x-i*ma.y,ga.y=i*ma.x+o*ma.y):ga.copy(ma),e.copy(t),e.x+=ga.x,e.y+=ga.y,e.applyMatrix4(va)}Ta.prototype.isSprite=!0;const Ra=new et,xa=new et;class Ia extends nn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Ra.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Ra);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Ra.setFromMatrixPosition(e.matrixWorld),xa.setFromMatrixPosition(this.matrixWorld);const n=Ra.distanceTo(xa)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}}const Oa=new et,Ca=new qe,Ma=new qe,Na=new et,La=new Mt;class ka extends nr{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Mt,this.bindMatrixInverse=new Mt}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new qe,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,r=this.geometry;Ca.fromBufferAttribute(r.attributes.skinIndex,e),Ma.fromBufferAttribute(r.attributes.skinWeight,e),Oa.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=Ma.getComponent(e);if(0!==r){const i=Ca.getComponent(e);La.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Na.copy(Oa).applyMatrix4(La),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}ka.prototype.isSkinnedMesh=!0;class Pa extends nn{constructor(){super(),this.type="Bone"}}Pa.prototype.isBone=!0;class Da extends We{constructor(e=null,t=1,n=1,r,i,o,a,s,c=1003,u=1003,l,d){super(null,o,a,s,c,u,r,i,l,d),this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Da.prototype.isDataTexture=!0;const Ua=new Mt,Fa=new Mt;class ja{constructor(e=[],t=[]){this.uuid=be(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Mt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Mt;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:Fa;Ua.multiplyMatrices(i,t[r]),Ua.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new ja(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Te(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Da(t,e,e,A,S);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new Pa),this.bones.push(i),this.boneInverses.push((new Mt).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const o=n[r];e.boneInverses.push(o.toArray())}return e}}class Ba extends _n{constructor(e,t,n,r=1){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Ba.prototype.isInstancedBufferAttribute=!0;const Va=new Mt,Ga=new Mt,Ha=[],za=new nr;class Wa extends nr{constructor(e,t,n){super(e,t),this.instanceMatrix=new Ba(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(za.geometry=this.geometry,za.material=this.material,void 0!==za.material)for(let i=0;i<r;i++){this.getMatrixAt(i,Va),Ga.multiplyMatrices(n,Va),za.matrixWorld=Ga,za.raycast(e,Ha);for(let e=0,n=Ha.length;e<n;e++){const n=Ha[e];n.instanceId=i,n.object=this,t.push(n)}Ha.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Ba(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Wa.prototype.isInstancedMesh=!0;class qa extends gn{constructor(e){super(),this.type="LineBasicMaterial",this.color=new je(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}qa.prototype.isLineBasicMaterial=!0;const Xa=new et,Ja=new et,Ya=new Mt,Ka=new Ct,Qa=new St;class Za extends nn{constructor(e=new Fn,t=new qa){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Xa.fromBufferAttribute(t,e-1),Ja.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Xa.distanceTo(Ja);e.setAttribute("lineDistance",new On(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Qa.copy(n.boundingSphere),Qa.applyMatrix4(r),Qa.radius+=i,!1===e.ray.intersectsSphere(Qa))return;Ya.copy(r).invert(),Ka.copy(e.ray).applyMatrix4(Ya);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,c=new et,u=new et,l=new et,d=new et,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r){for(let n=Math.max(0,o.start),a=Math.min(r.count,o.start+o.count)-1;n<a;n+=h){const o=r.getX(n),a=r.getX(n+1);c.fromBufferAttribute(i,o),u.fromBufferAttribute(i,a);if(Ka.distanceSqToSegment(c,u,d,l)>s)continue;d.applyMatrix4(this.matrixWorld);const h=e.ray.origin.distanceTo(d);h<e.near||h>e.far||t.push({distance:h,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,o.start),r=Math.min(i.count,o.start+o.count)-1;n<r;n+=h){c.fromBufferAttribute(i,n),u.fromBufferAttribute(i,n+1);if(Ka.distanceSqToSegment(c,u,d,l)>s)continue;d.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(d);r<e.near||r>e.far||t.push({distance:r,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Za.prototype.isLine=!0;const $a=new et,es=new et;class ts extends Za{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)$a.fromBufferAttribute(t,e),es.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+$a.distanceTo(es);e.setAttribute("lineDistance",new On(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}ts.prototype.isLineSegments=!0;class ns extends Za{constructor(e,t){super(e,t),this.type="LineLoop"}}ns.prototype.isLineLoop=!0;class rs extends gn{constructor(e){super(),this.type="PointsMaterial",this.color=new je(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}rs.prototype.isPointsMaterial=!0;const is=new Mt,os=new Ct,as=new St,ss=new et;class cs extends nn{constructor(e=new Fn,t=new rs){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),as.copy(n.boundingSphere),as.applyMatrix4(r),as.radius+=i,!1===e.ray.intersectsSphere(as))return;is.copy(r).invert(),os.copy(e.ray).applyMatrix4(is);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a;if(n.isBufferGeometry){const i=n.index,a=n.attributes.position;if(null!==i){for(let n=Math.max(0,o.start),c=Math.min(i.count,o.start+o.count);n<c;n++){const o=i.getX(n);ss.fromBufferAttribute(a,o),us(ss,o,s,r,e,t,this)}}else{for(let n=Math.max(0,o.start),i=Math.min(a.count,o.start+o.count);n<i;n++)ss.fromBufferAttribute(a,n),us(ss,n,s,r,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function us(e,t,n,r,i,o,a){const s=os.distanceSqToPoint(e);if(s<n){const n=new et;os.closestPointToPoint(e,n),n.applyMatrix4(r);const c=i.ray.origin.distanceTo(n);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a})}}cs.prototype.isPoints=!0;class ls extends We{constructor(e,t,n,r,i,o,a,s,c){super(e,t,n,r,i,o,a,s,c),this.minFilter=void 0!==o?o:g,this.magFilter=void 0!==i?i:g,this.generateMipmaps=!1;const u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){u.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}ls.prototype.isVideoTexture=!0;class ds extends We{constructor(e,t,n){super({width:e,height:t}),this.format=n,this.magFilter=f,this.minFilter=f,this.generateMipmaps=!1,this.needsUpdate=!0}}ds.prototype.isFramebufferTexture=!0;class hs extends We{constructor(e,t,n,r,i,o,a,s,c,u,l,d){super(null,o,a,s,c,u,r,i,l,d),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}hs.prototype.isCompressedTexture=!0;class fs extends We{constructor(e,t,n,r,i,o,a,s,c){super(e,t,n,r,i,o,a,s,c),this.needsUpdate=!0}}fs.prototype.isCanvasTexture=!0;class ps extends Fn{constructor(e=1,t=8,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],o=[],a=[],s=[],c=new et,u=new xe;o.push(0,0,0),a.push(0,0,1),s.push(.5,.5);for(let i=0,l=3;i<=t;i++,l+=3){const d=n+i/t*r;c.x=e*Math.cos(d),c.y=e*Math.sin(d),o.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(o[l]/e+1)/2,u.y=(o[l+1]/e+1)/2,s.push(u.x,u.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new On(o,3)),this.setAttribute("normal",new On(a,3)),this.setAttribute("uv",new On(s,2))}static fromJSON(e){return new ps(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class ms extends Fn{constructor(e=1,t=1,n=1,r=8,i=1,o=!1,a=0,s=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};const c=this;r=Math.floor(r),i=Math.floor(i);const u=[],l=[],d=[],h=[];let f=0;const p=[],m=n/2;let g=0;function v(n){const i=f,o=new xe,p=new et;let v=0;const y=!0===n?e:t,b=!0===n?1:-1;for(let e=1;e<=r;e++)l.push(0,m*b,0),d.push(0,b,0),h.push(.5,.5),f++;const _=f;for(let e=0;e<=r;e++){const t=e/r*s+a,n=Math.cos(t),i=Math.sin(t);p.x=y*i,p.y=m*b,p.z=y*n,l.push(p.x,p.y,p.z),d.push(0,b,0),o.x=.5*n+.5,o.y=.5*i*b+.5,h.push(o.x,o.y),f++}for(let e=0;e<r;e++){const t=i+e,r=_+e;!0===n?u.push(r,r+1,t):u.push(r+1,r,t),v+=3}c.addGroup(g,v,!0===n?1:2),g+=v}!function(){const o=new et,v=new et;let y=0;const b=(t-e)/n;for(let c=0;c<=i;c++){const u=[],g=c/i,y=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*s+a,c=Math.sin(i),p=Math.cos(i);v.x=y*c,v.y=-g*n+m,v.z=y*p,l.push(v.x,v.y,v.z),o.set(c,b,p).normalize(),d.push(o.x,o.y,o.z),h.push(t,1-g),u.push(f++)}p.push(u)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=p[t][e],r=p[t+1][e],i=p[t+1][e+1],o=p[t][e+1];u.push(n,r,o),u.push(r,i,o),y+=6}c.addGroup(g,y,0),g+=y}(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(u),this.setAttribute("position",new On(l,3)),this.setAttribute("normal",new On(d,3)),this.setAttribute("uv",new On(h,2))}static fromJSON(e){return new ms(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class gs extends ms{constructor(e=1,t=1,n=8,r=1,i=!1,o=0,a=2*Math.PI){super(0,e,t,n,r,i,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}static fromJSON(e){return new gs(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class vs extends Fn{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],o=[];function a(e,t,n,r){const i=r+1,o=[];for(let r=0;r<=i;r++){o[r]=[];const a=e.clone().lerp(n,r/i),s=t.clone().lerp(n,r/i),c=i-r;for(let e=0;e<=c;e++)o[r][e]=0===e&&r===i?a:a.clone().lerp(s,e/c)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(s(o[e][n+1]),s(o[e+1][n]),s(o[e][n])):(s(o[e][n+1]),s(o[e+1][n+1]),s(o[e+1][n]))}}function s(e){i.push(e.x,e.y,e.z)}function c(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function u(e,t,n,r){r<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=r/2/Math.PI+.5)}function l(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new et,r=new et,i=new et;for(let o=0;o<t.length;o+=3)c(t[o+0],n),c(t[o+1],r),c(t[o+2],i),a(n,r,i,e)}(r),function(e){const t=new et;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new et;for(let n=0;n<i.length;n+=3){e.x=i[n+0],e.y=i[n+1],e.z=i[n+2];const r=l(e)/2/Math.PI+.5,a=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(r,1-a)}var t;(function(){const e=new et,t=new et,n=new et,r=new et,a=new xe,s=new xe,c=new xe;for(let d=0,h=0;d<i.length;d+=9,h+=6){e.set(i[d+0],i[d+1],i[d+2]),t.set(i[d+3],i[d+4],i[d+5]),n.set(i[d+6],i[d+7],i[d+8]),a.set(o[h+0],o[h+1]),s.set(o[h+2],o[h+3]),c.set(o[h+4],o[h+5]),r.copy(e).add(t).add(n).divideScalar(3);const f=l(r);u(a,h+0,e,f),u(s,h+2,t,f),u(c,h+4,n,f)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],r=o[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);i>.9&&a<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new On(i,3)),this.setAttribute("normal",new On(i.slice(),3)),this.setAttribute("uv",new On(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new vs(e.vertices,e.indices,e.radius,e.details)}}class ys extends vs{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ys(e.radius,e.detail)}}const bs=new et,_s=new et,Es=new et,Ss=new pn;class ws extends Fn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,r=Math.pow(10,n),i=Math.cos(ve*t),o=e.getIndex(),a=e.getAttribute("position"),s=o?o.count:a.count,c=[0,0,0],u=["a","b","c"],l=new Array(3),d={},h=[];for(let e=0;e<s;e+=3){o?(c[0]=o.getX(e),c[1]=o.getX(e+1),c[2]=o.getX(e+2)):(c[0]=e,c[1]=e+1,c[2]=e+2);const{a:t,b:n,c:s}=Ss;if(t.fromBufferAttribute(a,c[0]),n.fromBufferAttribute(a,c[1]),s.fromBufferAttribute(a,c[2]),Ss.getNormal(Es),l[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,l[1]=`${Math.round(n.x*r)},${Math.round(n.y*r)},${Math.round(n.z*r)}`,l[2]=`${Math.round(s.x*r)},${Math.round(s.y*r)},${Math.round(s.z*r)}`,l[0]!==l[1]&&l[1]!==l[2]&&l[2]!==l[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=l[e],r=l[t],o=Ss[u[e]],a=Ss[u[t]],s=`${n}_${r}`,f=`${r}_${n}`;f in d&&d[f]?(Es.dot(d[f].normal)<=i&&(h.push(o.x,o.y,o.z),h.push(a.x,a.y,a.z)),d[f]=null):s in d||(d[s]={index0:c[e],index1:c[t],normal:Es.clone()})}}for(const e in d)if(d[e]){const{index0:t,index1:n}=d[e];bs.fromBufferAttribute(a,t),_s.fromBufferAttribute(a,n),h.push(bs.x,bs.y,bs.z),h.push(_s.x,_s.y,_s.z)}this.setAttribute("position",new On(h,3))}}}class Ts{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let o;o=t||e*n[i-1];let a,s=0,c=i-1;for(;s<=c;)if(r=Math.floor(s+(c-s)/2),a=n[r]-o,a<0)s=r+1;else{if(!(a>0)){c=r;break}c=r-1}if(r=c,n[r]===o)return r/(i-1);const u=n[r];return(r+(o-u)/(n[r+1]-u))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const o=this.getPoint(r),a=this.getPoint(i),s=t||(o.isVector2?new xe:new et);return s.copy(a).sub(o).normalize(),s}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new et,r=[],i=[],o=[],a=new et,s=new Mt;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new et)}i[0]=new et,o[0]=new et;let c=Number.MAX_VALUE;const u=Math.abs(r[0].x),l=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=c&&(c=u,n.set(1,0,0)),l<=c&&(c=l,n.set(0,1,0)),d<=c&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],a),o[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),o[t]=o[t-1].clone(),a.crossVectors(r[t-1],r[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(_e(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(s.makeRotationAxis(a,e))}o[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(_e(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(a.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(s.makeRotationAxis(r[n],t*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class As extends Ts{constructor(e=0,t=0,n=1,r=1,i=0,o=2*Math.PI,a=!1,s=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s}getPoint(e,t){const n=t||new xe,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const a=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,r=c-this.aY;s=n*e-r*t+this.aX,c=n*t+r*e+this.aY}return n.set(s,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}As.prototype.isEllipseCurve=!0;class Rs extends As{constructor(e,t,n,r,i,o){super(e,t,n,n,r,i,o),this.type="ArcCurve"}}function xs(){let e=0,t=0,n=0,r=0;function i(i,o,a,s){e=i,t=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,a,s){let c=(t-e)/o-(n-e)/(o+a)+(n-t)/a,u=(n-t)/a-(r-t)/(a+s)+(r-n)/s;c*=a,u*=a,i(t,n,c,u)},calc:function(i){const o=i*i;return e+t*i+n*o+r*(o*i)}}}Rs.prototype.isArcCurve=!0;const Is=new et,Os=new xs,Cs=new xs,Ms=new xs;class Ns extends Ts{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new et){const n=t,r=this.points,i=r.length,o=(i-(this.closed?0:1))*e;let a,s,c=Math.floor(o),u=o-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/i)+1)*i:0===u&&c===i-1&&(c=i-2,u=1),this.closed||c>0?a=r[(c-1)%i]:(Is.subVectors(r[0],r[1]).add(r[0]),a=Is);const l=r[c%i],d=r[(c+1)%i];if(this.closed||c+2<i?s=r[(c+2)%i]:(Is.subVectors(r[i-1],r[i-2]).add(r[i-1]),s=Is),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(l),e),n=Math.pow(l.distanceToSquared(d),e),r=Math.pow(d.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Os.initNonuniformCatmullRom(a.x,l.x,d.x,s.x,t,n,r),Cs.initNonuniformCatmullRom(a.y,l.y,d.y,s.y,t,n,r),Ms.initNonuniformCatmullRom(a.z,l.z,d.z,s.z,t,n,r)}else"catmullrom"===this.curveType&&(Os.initCatmullRom(a.x,l.x,d.x,s.x,this.tension),Cs.initCatmullRom(a.y,l.y,d.y,s.y,this.tension),Ms.initCatmullRom(a.z,l.z,d.z,s.z,this.tension));return n.set(Os.calc(u),Cs.calc(u),Ms.calc(u)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new et).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Ls(e,t,n,r,i){const o=.5*(r-t),a=.5*(i-n),s=e*e;return(2*n-2*r+o+a)*(e*s)+(-3*n+3*r-2*o-a)*s+o*e+n}function ks(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Ps(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}Ns.prototype.isCatmullRomCurve3=!0;class Ds extends Ts{constructor(e=new xe,t=new xe,n=new xe,r=new xe){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new xe){const n=t,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Ps(e,r.x,i.x,o.x,a.x),Ps(e,r.y,i.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Ds.prototype.isCubicBezierCurve=!0;class Us extends Ts{constructor(e=new et,t=new et,n=new et,r=new et){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new et){const n=t,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Ps(e,r.x,i.x,o.x,a.x),Ps(e,r.y,i.y,o.y,a.y),Ps(e,r.z,i.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Us.prototype.isCubicBezierCurve3=!0;class Fs extends Ts{constructor(e=new xe,t=new xe){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new xe){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new xe;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Fs.prototype.isLineCurve=!0;class js extends Ts{constructor(e=new et,t=new et){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new et){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Bs extends Ts{constructor(e=new xe,t=new xe,n=new xe){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new xe){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(ks(e,r.x,i.x,o.x),ks(e,r.y,i.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Bs.prototype.isQuadraticBezierCurve=!0;class Vs extends Ts{constructor(e=new et,t=new et,n=new et){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new et){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(ks(e,r.x,i.x,o.x),ks(e,r.y,i.y,o.y),ks(e,r.z,i.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Vs.prototype.isQuadraticBezierCurve3=!0;class Gs extends Ts{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new xe){const n=t,r=this.points,i=(r.length-1)*e,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],c=r[o],u=r[o>r.length-2?r.length-1:o+1],l=r[o>r.length-3?r.length-1:o+2];return n.set(Ls(a,s.x,c.x,u.x,l.x),Ls(a,s.y,c.y,u.y,l.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new xe).fromArray(n))}return this}}Gs.prototype.isSplineCurve=!0;var Hs=Object.freeze({__proto__:null,ArcCurve:Rs,CatmullRomCurve3:Ns,CubicBezierCurve:Ds,CubicBezierCurve3:Us,EllipseCurve:As,LineCurve:Fs,LineCurve3:js,QuadraticBezierCurve:Bs,QuadraticBezierCurve3:Vs,SplineCurve:Gs});class zs extends Ts{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Fs(t,e))}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const e=r[i]-n,o=this.curves[i],a=o.getLength(),s=0===a?0:1-e/a;return o.getPointAt(s,t)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],a=o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a);for(let e=0;e<s.length;e++){const r=s[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Hs[n.type]).fromJSON(n))}return this}}class Ws extends zs{constructor(e){super(),this.type="Path",this.currentPoint=new xe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Fs(this.currentPoint.clone(),new xe(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new Bs(this.currentPoint.clone(),new xe(e,t),new xe(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,o){const a=new Ds(this.currentPoint.clone(),new xe(e,t),new xe(n,r),new xe(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Gs(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,o){const a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,n,r,i,o),this}absarc(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this}ellipse(e,t,n,r,i,o,a,s){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,r,i,o,a,s),this}absellipse(e,t,n,r,i,o,a,s){const c=new As(e,t,n,r,i,o,a,s);if(this.curves.length>0){const e=c.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class qs extends Ws{constructor(e){super(e),this.uuid=be(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Ws).fromJSON(n))}return this}}const Xs=function(e,t,n=2){const r=t&&t.length,i=r?t[0]*n:e.length;let o=Js(e,0,i,n,!0);const a=[];if(!o||o.next===o.prev)return a;let s,c,u,l,d,h,f;if(r&&(o=function(e,t,n,r){const i=[];let o,a,s,c,u;for(o=0,a=t.length;o<a;o++)s=t[o]*r,c=o<a-1?t[o+1]*r:e.length,u=Js(e,s,c,r,!1),u===u.next&&(u.steiner=!0),i.push(oc(u));for(i.sort(tc),o=0;o<i.length;o++)nc(i[o],n),n=Ys(n,n.next);return n}(e,t,o,n)),e.length>80*n){s=u=e[0],c=l=e[1];for(let t=n;t<i;t+=n)d=e[t],h=e[t+1],d<s&&(s=d),h<c&&(c=h),d>u&&(u=d),h>l&&(l=h);f=Math.max(u-s,l-c),f=0!==f?1/f:0}return Ks(o,a,n,s,c,f),a};function Js(e,t,n,r,i){let o,a;if(i===function(e,t,n,r){let i=0;for(let o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)a=mc(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=mc(o,e[o],e[o+1],a);return a&&uc(a,a.next)&&(gc(a),a=a.next),a}function Ys(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!uc(r,r.next)&&0!==cc(r.prev,r,r.next))r=r.next;else{if(gc(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function Ks(e,t,n,r,i,o,a){if(!e)return;!a&&o&&function(e,t,n,r){let i=e;do{null===i.z&&(i.z=ic(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,o,a,s,c,u=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ,r);t++);for(c=u;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1)}(i)}(e,r,i,o);let s,c,u=e;for(;e.prev!==e.next;)if(s=e.prev,c=e.next,o?Zs(e,r,i,o):Qs(e))t.push(s.i/n),t.push(e.i/n),t.push(c.i/n),gc(e),e=c.next,u=c.next;else if((e=c)===u){a?1===a?Ks(e=$s(Ys(e),t,n),t,n,r,i,o,2):2===a&&ec(e,t,n,r,i,o):Ks(Ys(e),t,n,r,i,o,1);break}}function Qs(e){const t=e.prev,n=e,r=e.next;if(cc(t,n,r)>=0)return!1;let i=e.next.next;for(;i!==e.prev;){if(ac(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&cc(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Zs(e,t,n,r){const i=e.prev,o=e,a=e.next;if(cc(i,o,a)>=0)return!1;const s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,c=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,u=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,d=ic(s,c,t,n,r),h=ic(u,l,t,n,r);let f=e.prevZ,p=e.nextZ;for(;f&&f.z>=d&&p&&p.z<=h;){if(f!==e.prev&&f!==e.next&&ac(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&cc(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&ac(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&cc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=d;){if(f!==e.prev&&f!==e.next&&ac(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&cc(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=h;){if(p!==e.prev&&p!==e.next&&ac(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&cc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function $s(e,t,n){let r=e;do{const i=r.prev,o=r.next.next;!uc(i,o)&&lc(i,r,r.next,o)&&fc(i,o)&&fc(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),gc(r),gc(r.next),r=e=o),r=r.next}while(r!==e);return Ys(r)}function ec(e,t,n,r,i,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&sc(a,e)){let s=pc(a,e);return a=Ys(a,a.next),s=Ys(s,s.next),Ks(a,t,n,r,i,o),void Ks(s,t,n,r,i,o)}e=e.next}a=a.next}while(a!==e)}function tc(e,t){return e.x-t.x}function nc(e,t){if(t=function(e,t){let n=t;const r=e.x,i=e.y;let o,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>a){if(a=e,e===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!o)return null;if(r===a)return o;const s=o,c=o.x,u=o.y;let l,d=1/0;n=o;do{r>=n.x&&n.x>=c&&r!==n.x&&ac(i<u?r:a,i,c,u,i<u?a:r,i,n.x,n.y)&&(l=Math.abs(i-n.y)/(r-n.x),fc(n,e)&&(l<d||l===d&&(n.x>o.x||n.x===o.x&&rc(o,n)))&&(o=n,d=l)),n=n.next}while(n!==s);return o}(e,t),t){const n=pc(t,e);Ys(t,t.next),Ys(n,n.next)}}function rc(e,t){return cc(e.prev,e,t.prev)<0&&cc(t.next,e,e.next)<0}function ic(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function oc(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function ac(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function sc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&lc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(fc(e,t)&&fc(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(cc(e.prev,e,t.prev)||cc(e,t.prev,t))||uc(e,t)&&cc(e.prev,e,e.next)>0&&cc(t.prev,t,t.next)>0)}function cc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function uc(e,t){return e.x===t.x&&e.y===t.y}function lc(e,t,n,r){const i=hc(cc(e,t,n)),o=hc(cc(e,t,r)),a=hc(cc(n,r,e)),s=hc(cc(n,r,t));return i!==o&&a!==s||(!(0!==i||!dc(e,n,t))||(!(0!==o||!dc(e,r,t))||(!(0!==a||!dc(n,e,r))||!(0!==s||!dc(n,t,r)))))}function dc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function hc(e){return e>0?1:e<0?-1:0}function fc(e,t){return cc(e.prev,e,e.next)<0?cc(e,t,e.next)>=0&&cc(e,e.prev,t)>=0:cc(e,t,e.prev)<0||cc(e,e.next,t)<0}function pc(e,t){const n=new vc(e.i,e.x,e.y),r=new vc(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function mc(e,t,n,r){const i=new vc(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function gc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function vc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class yc{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return yc.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];bc(e),_c(n,e);let o=e.length;t.forEach(bc);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,_c(n,t[e]);const a=Xs(n,r);for(let e=0;e<a.length;e+=3)i.push(a.slice(e,e+3));return i}}function bc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function _c(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Ec extends Fn{constructor(e=new qs([new xe(.5,.5),new xe(-.5,.5),new xe(-.5,-.5),new xe(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++){o(e[t])}function o(e){const o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1;let c=void 0!==t.depth?t.depth:1,u=void 0===t.bevelEnabled||t.bevelEnabled,l=void 0!==t.bevelThickness?t.bevelThickness:.2,d=void 0!==t.bevelSize?t.bevelSize:l-.1,h=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Sc;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=t.amount);let g,v,y,b,_,E=!1;p&&(g=p.getSpacedPoints(s),E=!0,u=!1,v=p.computeFrenetFrames(s,!1),y=new et,b=new et,_=new et),u||(f=0,l=0,d=0,h=0);const S=e.extractPoints(a);let w=S.shape;const T=S.holes;if(!yc.isClockWise(w)){w=w.reverse();for(let e=0,t=T.length;e<t;e++){const t=T[e];yc.isClockWise(t)&&(T[e]=t.reverse())}}const A=yc.triangulateShape(w,T),R=w;for(let e=0,t=T.length;e<t;e++){const t=T[e];w=w.concat(t)}function x(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const I=w.length,O=A.length;function C(e,t,n){let r,i,o;const a=e.x-t.x,s=e.y-t.y,c=n.x-e.x,u=n.y-e.y,l=a*a+s*s,d=a*u-s*c;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(l),h=Math.sqrt(c*c+u*u),f=t.x-s/d,p=t.y+a/d,m=((n.x-u/h-f)*u-(n.y+c/h-p)*c)/(a*u-s*c);r=f+a*m-e.x,i=p+s*m-e.y;const g=r*r+i*i;if(g<=2)return new xe(r,i);o=Math.sqrt(g/2)}else{let e=!1;a>Number.EPSILON?c>Number.EPSILON&&(e=!0):a<-Number.EPSILON?c<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(u)&&(e=!0),e?(r=-s,i=a,o=Math.sqrt(l)):(r=a,i=s,o=Math.sqrt(l/2))}return new xe(r/o,i/o)}const M=[];for(let e=0,t=R.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),M[e]=C(R[e],R[n],R[r]);const N=[];let L,k=M.concat();for(let e=0,t=T.length;e<t;e++){const t=T[e];L=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),L[e]=C(t[e],t[r],t[i]);N.push(L),k=k.concat(L)}for(let e=0;e<f;e++){const t=e/f,n=l*Math.cos(t*Math.PI/2),r=d*Math.sin(t*Math.PI/2)+h;for(let e=0,t=R.length;e<t;e++){const t=x(R[e],M[e],r);U(t.x,t.y,-n)}for(let e=0,t=T.length;e<t;e++){const t=T[e];L=N[e];for(let e=0,i=t.length;e<i;e++){const i=x(t[e],L[e],r);U(i.x,i.y,-n)}}}const P=d+h;for(let e=0;e<I;e++){const t=u?x(w[e],k[e],P):w[e];E?(b.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),_.copy(g[0]).add(b).add(y),U(_.x,_.y,_.z)):U(t.x,t.y,0)}for(let e=1;e<=s;e++)for(let t=0;t<I;t++){const n=u?x(w[t],k[t],P):w[t];E?(b.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),_.copy(g[e]).add(b).add(y),U(_.x,_.y,_.z)):U(n.x,n.y,c/s*e)}for(let e=f-1;e>=0;e--){const t=e/f,n=l*Math.cos(t*Math.PI/2),r=d*Math.sin(t*Math.PI/2)+h;for(let e=0,t=R.length;e<t;e++){const t=x(R[e],M[e],r);U(t.x,t.y,c+n)}for(let e=0,t=T.length;e<t;e++){const t=T[e];L=N[e];for(let e=0,i=t.length;e<i;e++){const i=x(t[e],L[e],r);E?U(i.x,i.y+g[s-1].y,g[s-1].x+n):U(i.x,i.y,c+n)}}}function D(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=s+2*f;e<n;e++){const n=I*e,o=I*(e+1);j(t+r+n,t+i+n,t+i+o,t+r+o)}}}function U(e,t,n){o.push(e),o.push(t),o.push(n)}function F(e,t,i){B(e),B(t),B(i);const o=r.length/3,a=m.generateTopUV(n,r,o-3,o-2,o-1);V(a[0]),V(a[1]),V(a[2])}function j(e,t,i,o){B(e),B(t),B(o),B(t),B(i),B(o);const a=r.length/3,s=m.generateSideWallUV(n,r,a-6,a-3,a-2,a-1);V(s[0]),V(s[1]),V(s[3]),V(s[1]),V(s[2]),V(s[3])}function B(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function V(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(u){let e=0,t=I*e;for(let e=0;e<O;e++){const n=A[e];F(n[2]+t,n[1]+t,n[0]+t)}e=s+2*f,t=I*e;for(let e=0;e<O;e++){const n=A[e];F(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<O;e++){const t=A[e];F(t[2],t[1],t[0])}for(let e=0;e<O;e++){const t=A[e];F(t[0]+I*s,t[1]+I*s,t[2]+I*s)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;D(R,t),t+=R.length;for(let e=0,n=T.length;e<n;e++){const n=T[e];D(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new On(r,3)),this.setAttribute("uv",new On(i,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new Hs[r.type]).fromJSON(r)),new Ec(n,e.options)}}const Sc={generateTopUV:function(e,t,n,r,i){const o=t[3*n],a=t[3*n+1],s=t[3*r],c=t[3*r+1],u=t[3*i],l=t[3*i+1];return[new xe(o,a),new xe(s,c),new xe(u,l)]},generateSideWallUV:function(e,t,n,r,i,o){const a=t[3*n],s=t[3*n+1],c=t[3*n+2],u=t[3*r],l=t[3*r+1],d=t[3*r+2],h=t[3*i],f=t[3*i+1],p=t[3*i+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(s-l)<Math.abs(a-u)?[new xe(a,1-c),new xe(u,1-d),new xe(h,1-p),new xe(m,1-v)]:[new xe(s,1-c),new xe(l,1-d),new xe(f,1-p),new xe(g,1-v)]}};class wc extends vs{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new wc(e.radius,e.detail)}}class Tc extends Fn{constructor(e=[new xe(0,.5),new xe(.5,0),new xe(0,-.5)],t=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=_e(r,0,2*Math.PI);const i=[],o=[],a=[],s=[],c=[],u=1/t,l=new et,d=new xe,h=new et,f=new et,p=new et;let m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,h.x=1*g,h.y=-m,h.z=0*g,p.copy(h),h.normalize(),s.push(h.x,h.y,h.z);break;case e.length-1:s.push(p.x,p.y,p.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,h.x=1*g,h.y=-m,h.z=0*g,f.copy(h),h.x+=p.x,h.y+=p.y,h.z+=p.z,h.normalize(),s.push(h.x,h.y,h.z),p.copy(f)}for(let i=0;i<=t;i++){const h=n+i*u*r,f=Math.sin(h),p=Math.cos(h);for(let n=0;n<=e.length-1;n++){l.x=e[n].x*f,l.y=e[n].y,l.z=e[n].x*p,o.push(l.x,l.y,l.z),d.x=i/t,d.y=n/(e.length-1),a.push(d.x,d.y);const r=s[3*n+0]*f,u=s[3*n+1],h=s[3*n+0]*p;c.push(r,u,h)}}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const r=t+n*e.length,o=r,a=r+e.length,s=r+e.length+1,c=r+1;i.push(o,a,c),i.push(s,c,a)}this.setIndex(i),this.setAttribute("position",new On(o,3)),this.setAttribute("uv",new On(a,2)),this.setAttribute("normal",new On(c,3))}static fromJSON(e){return new Tc(e.points,e.segments,e.phiStart,e.phiLength)}}class Ac extends vs{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ac(e.radius,e.detail)}}class Rc extends Fn{constructor(e=.5,t=1,n=8,r=1,i=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},n=Math.max(3,n);const a=[],s=[],c=[],u=[];let l=e;const d=(t-e)/(r=Math.max(1,r)),h=new et,f=new xe;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){const r=i+e/n*o;h.x=l*Math.cos(r),h.y=l*Math.sin(r),s.push(h.x,h.y,h.z),c.push(0,0,1),f.x=(h.x/t+1)/2,f.y=(h.y/t+1)/2,u.push(f.x,f.y)}l+=d}for(let e=0;e<r;e++){const t=e*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,o=r+n+1,s=r+n+2,c=r+1;a.push(i,o,c),a.push(o,s,c)}}this.setIndex(a),this.setAttribute("position",new On(s,3)),this.setAttribute("normal",new On(c,3)),this.setAttribute("uv",new On(u,2))}static fromJSON(e){return new Rc(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class xc extends Fn{constructor(e=new qs([new xe(0,.5),new xe(-.5,-.5),new xe(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],o=[];let a=0,s=0;if(!1===Array.isArray(e))c(e);else for(let t=0;t<e.length;t++)c(e[t]),this.addGroup(a,s,t),a+=s,s=0;function c(e){const a=r.length/3,c=e.extractPoints(t);let u=c.shape;const l=c.holes;!1===yc.isClockWise(u)&&(u=u.reverse());for(let e=0,t=l.length;e<t;e++){const t=l[e];!0===yc.isClockWise(t)&&(l[e]=t.reverse())}const d=yc.triangulateShape(u,l);for(let e=0,t=l.length;e<t;e++){const t=l[e];u=u.concat(t)}for(let e=0,t=u.length;e<t;e++){const t=u[e];r.push(t.x,t.y,0),i.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=d.length;e<t;e++){const t=d[e],r=t[0]+a,i=t[1]+a,o=t[2]+a;n.push(r,i,o),s+=3}}this.setIndex(n),this.setAttribute("position",new On(r,3)),this.setAttribute("normal",new On(i,3)),this.setAttribute("uv",new On(o,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}return new xc(n,e.curveSegments)}}class Ic extends Fn{constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(o+a,Math.PI);let c=0;const u=[],l=new et,d=new et,h=[],f=[],p=[],m=[];for(let h=0;h<=n;h++){const g=[],v=h/n;let y=0;0==h&&0==o?y=.5/t:h==n&&s==Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const s=n/t;l.x=-e*Math.cos(r+s*i)*Math.sin(o+v*a),l.y=e*Math.cos(o+v*a),l.z=e*Math.sin(r+s*i)*Math.sin(o+v*a),f.push(l.x,l.y,l.z),d.copy(l).normalize(),p.push(d.x,d.y,d.z),m.push(s+y,1-v),g.push(c++)}u.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=u[e][r+1],i=u[e][r],a=u[e+1][r],c=u[e+1][r+1];(0!==e||o>0)&&h.push(t,i,c),(e!==n-1||s<Math.PI)&&h.push(i,a,c)}this.setIndex(h),this.setAttribute("position",new On(f,3)),this.setAttribute("normal",new On(p,3)),this.setAttribute("uv",new On(m,2))}static fromJSON(e){return new Ic(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Oc extends vs{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Oc(e.radius,e.detail)}}class Cc extends Fn{constructor(e=1,t=.4,n=8,r=6,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],s=[],c=[],u=new et,l=new et,d=new et;for(let o=0;o<=n;o++)for(let h=0;h<=r;h++){const f=h/r*i,p=o/n*Math.PI*2;l.x=(e+t*Math.cos(p))*Math.cos(f),l.y=(e+t*Math.cos(p))*Math.sin(f),l.z=t*Math.sin(p),a.push(l.x,l.y,l.z),u.x=e*Math.cos(f),u.y=e*Math.sin(f),d.subVectors(l,u).normalize(),s.push(d.x,d.y,d.z),c.push(h/r),c.push(o/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,a=(r+1)*(e-1)+t,s=(r+1)*e+t;o.push(n,i,s),o.push(i,a,s)}this.setIndex(o),this.setAttribute("position",new On(a,3)),this.setAttribute("normal",new On(s,3)),this.setAttribute("uv",new On(c,2))}static fromJSON(e){return new Cc(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Mc extends Fn{constructor(e=1,t=.4,n=64,r=8,i=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},n=Math.floor(n),r=Math.floor(r);const a=[],s=[],c=[],u=[],l=new et,d=new et,h=new et,f=new et,p=new et,m=new et,g=new et;for(let a=0;a<=n;++a){const y=a/n*i*Math.PI*2;v(y,i,o,e,h),v(y+.01,i,o,e,f),m.subVectors(f,h),g.addVectors(f,h),p.crossVectors(m,g),g.crossVectors(p,m),p.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,o=-t*Math.cos(i),f=t*Math.sin(i);l.x=h.x+(o*g.x+f*p.x),l.y=h.y+(o*g.y+f*p.y),l.z=h.z+(o*g.z+f*p.z),s.push(l.x,l.y,l.z),d.subVectors(l,h).normalize(),c.push(d.x,d.y,d.z),u.push(a/n),u.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,s=(r+1)*(e-1)+t;a.push(n,i,s),a.push(i,o,s)}function v(e,t,n,r,i){const o=Math.cos(e),a=Math.sin(e),s=n/t*e,c=Math.cos(s);i.x=r*(2+c)*.5*o,i.y=r*(2+c)*a*.5,i.z=r*Math.sin(s)*.5}this.setIndex(a),this.setAttribute("position",new On(s,3)),this.setAttribute("normal",new On(c,3)),this.setAttribute("uv",new On(u,2))}static fromJSON(e){return new Mc(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Nc extends Fn{constructor(e=new Vs(new et(-1,-1,0),new et(-1,1,0),new et(1,1,0)),t=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new et,s=new et,c=new xe;let u=new et;const l=[],d=[],h=[],f=[];function p(i){u=e.getPointAt(i/t,u);const c=o.normals[i],h=o.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),o=-Math.cos(t);s.x=o*c.x+i*h.x,s.y=o*c.y+i*h.y,s.z=o*c.z+i*h.z,s.normalize(),d.push(s.x,s.y,s.z),a.x=u.x+n*s.x,a.y=u.y+n*s.y,a.z=u.z+n*s.z,l.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)c.x=e/t,c.y=n/r,h.push(c.x,c.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,a=(r+1)*(e-1)+t;f.push(n,i,a),f.push(i,o,a)}}()}(),this.setIndex(f),this.setAttribute("position",new On(l,3)),this.setAttribute("normal",new On(d,3)),this.setAttribute("uv",new On(h,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Nc((new Hs[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Lc extends Fn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,r=new et,i=new et;if(null!==e.index){const o=e.attributes.position,a=e.index;let s=e.groups;0===s.length&&(s=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,c=s.length;e<c;++e){const c=s[e],u=c.start;for(let e=u,s=u+c.count;e<s;e+=3)for(let s=0;s<3;s++){const c=a.getX(e+s),u=a.getX(e+(s+1)%3);r.fromBufferAttribute(o,c),i.fromBufferAttribute(o,u),!0===kc(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}}else{const o=e.attributes.position;for(let e=0,a=o.count/3;e<a;e++)for(let a=0;a<3;a++){const s=3*e+a,c=3*e+(a+1)%3;r.fromBufferAttribute(o,s),i.fromBufferAttribute(o,c),!0===kc(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new On(t,3))}}}function kc(e,t,n){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}var Pc=Object.freeze({__proto__:null,BoxGeometry:ir,BoxBufferGeometry:ir,CircleGeometry:ps,CircleBufferGeometry:ps,ConeGeometry:gs,ConeBufferGeometry:gs,CylinderGeometry:ms,CylinderBufferGeometry:ms,DodecahedronGeometry:ys,DodecahedronBufferGeometry:ys,EdgesGeometry:ws,ExtrudeGeometry:Ec,ExtrudeBufferGeometry:Ec,IcosahedronGeometry:wc,IcosahedronBufferGeometry:wc,LatheGeometry:Tc,LatheBufferGeometry:Tc,OctahedronGeometry:Ac,OctahedronBufferGeometry:Ac,PlaneGeometry:Tr,PlaneBufferGeometry:Tr,PolyhedronGeometry:vs,PolyhedronBufferGeometry:vs,RingGeometry:Rc,RingBufferGeometry:Rc,ShapeGeometry:xc,ShapeBufferGeometry:xc,SphereGeometry:Ic,SphereBufferGeometry:Ic,TetrahedronGeometry:Oc,TetrahedronBufferGeometry:Oc,TorusGeometry:Cc,TorusBufferGeometry:Cc,TorusKnotGeometry:Mc,TorusKnotBufferGeometry:Mc,TubeGeometry:Nc,TubeBufferGeometry:Nc,WireframeGeometry:Lc});class Dc extends gn{constructor(e){super(),this.type="ShadowMaterial",this.color=new je(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}Dc.prototype.isShadowMaterial=!0;class Uc extends cr{constructor(e){super(e),this.type="RawShaderMaterial"}}Uc.prototype.isRawShaderMaterial=!0;class Fc extends gn{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new je(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Fc.prototype.isMeshStandardMaterial=!0;class jc extends Fc{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new xe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return _e(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new je(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new je(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new je(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}jc.prototype.isMeshPhysicalMaterial=!0;class Bc extends gn{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new je(16777215),this.specular=new je(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Bc.prototype.isMeshPhongMaterial=!0;class Vc extends gn{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new je(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Vc.prototype.isMeshToonMaterial=!0;class Gc extends gn{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}Gc.prototype.isMeshNormalMaterial=!0;class Hc extends gn{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new je(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Hc.prototype.isMeshLambertMaterial=!0;class zc extends gn{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new je(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}zc.prototype.isMeshMatcapMaterial=!0;class Wc extends qa{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}Wc.prototype.isLineDashedMaterial=!0;const qc={ShadowMaterial:Dc,SpriteMaterial:la,RawShaderMaterial:Uc,ShaderMaterial:cr,PointsMaterial:rs,MeshPhysicalMaterial:jc,MeshStandardMaterial:Fc,MeshPhongMaterial:Bc,MeshToonMaterial:Vc,MeshNormalMaterial:Gc,MeshLambertMaterial:Hc,MeshDepthMaterial:Ho,MeshDistanceMaterial:zo,MeshBasicMaterial:vn,MeshMatcapMaterial:zc,LineDashedMaterial:Wc,LineBasicMaterial:qa,Material:gn};gn.fromType=function(e){return new qc[e]};const Xc={arraySlice:function(e,t,n){return Xc.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const r=e.length,i=new e.constructor(r);for(let o=0,a=0;a!==r;++o){const r=n[o]*t;for(let n=0;n!==t;++n)i[a++]=e[r+n]}return i},flattenJSON:function(e,t,n,r){let i=1,o=e[0];for(;void 0!==o&&void 0===o[r];)o=e[i++];if(void 0===o)return;let a=o[r];if(void 0!==a)if(Array.isArray(a))do{a=o[r],void 0!==a&&(t.push(o.time),n.push.apply(n,a)),o=e[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[r],void 0!==a&&(t.push(o.time),a.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{a=o[r],void 0!==a&&(t.push(o.time),n.push(a)),o=e[i++]}while(void 0!==o)},subclip:function(e,t,n,r,i=30){const o=e.clone();o.name=t;const a=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],s=t.getValueSize(),c=[],u=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*i;if(!(o<n||o>=r)){c.push(t.times[e]);for(let n=0;n<s;++n)u.push(t.values[e*s+n])}}0!==c.length&&(t.times=Xc.convertArray(c,t.times.constructor),t.values=Xc.convertArray(u,t.values.constructor),a.push(t))}o.tracks=a;let s=1/0;for(let e=0;e<o.tracks.length;++e)s>o.tracks[e].times[0]&&(s=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*s);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,o=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const a=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===a)continue;let s=0;const c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=c/3);let u=0;const l=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=l/3);const d=r.times.length-1;let h;if(o<=r.times[0]){const e=s,t=c-s;h=Xc.arraySlice(r.values,e,t)}else if(o>=r.times[d]){const e=d*c+s,t=e+c-s;h=Xc.arraySlice(r.values,e,t)}else{const e=r.createInterpolant(),t=s,n=c-s;e.evaluate(o),h=Xc.arraySlice(e.resultBuffer,t,n)}if("quaternion"===i){(new $e).fromArray(h).normalize().conjugate().toArray(h)}const f=a.times.length;for(let e=0;e<f;++e){const t=e*l+u;if("quaternion"===i)$e.multiplyQuaternionsFlat(a.values,t,h,0,a.values,t);else{const e=l-2*u;for(let n=0;n<e;++n)a.values[t+n]-=h[n]}}}return e.blendMode=ae,e}};class Jc{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let o;n:{r:if(!(e<r)){for(let o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,r=t[++n],e<r)break t}o=t.length;break n}if(e>=i)break e;{const a=t[1];e<a&&(n=2,i=a);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===o)break;if(r=i,i=t[--n-1],e>=i)break t}o=n,n=0}}for(;n<o;){const r=n+o>>>1;e<t[r]?o=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Jc.prototype.beforeStart_=Jc.prototype.copySampleValue_,Jc.prototype.afterEnd_=Jc.prototype.copySampleValue_;class Yc extends Jc{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ne,endingEnd:ne}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,o=e+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case re:i=e,a=2*t-n;break;case ie:i=r.length-2,a=t+r[i]-r[i+1];break;default:i=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case re:o=e,s=2*n-t;break;case ie:o=1,s=n+r[1]-r[0];break;default:o=e-1,s=t}const c=.5*(n-t),u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(s-n),this._offsetPrev=i*u,this._offsetNext=o*u}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,c=s-a,u=this._offsetPrev,l=this._offsetNext,d=this._weightPrev,h=this._weightNext,f=(n-t)/(r-t),p=f*f,m=p*f,g=-d*m+2*d*p-d*f,v=(1+d)*m+(-1.5-2*d)*p+(-.5+d)*f+1,y=(-1-h)*m+(1.5+h)*p+.5*f,b=h*m-h*p;for(let e=0;e!==a;++e)i[e]=g*o[u+e]+v*o[c+e]+y*o[s+e]+b*o[l+e];return i}}class Kc extends Jc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,c=s-a,u=(n-t)/(r-t),l=1-u;for(let e=0;e!==a;++e)i[e]=o[c+e]*l+o[s+e]*u;return i}}class Qc extends Jc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Zc{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Xc.convertArray(t,this.TimeBufferType),this.values=Xc.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Xc.convertArray(e.times,Array),values:Xc.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Qc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Kc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Yc(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case $:t=this.InterpolantFactoryMethodDiscrete;break;case ee:t=this.InterpolantFactoryMethodLinear;break;case te:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return $;case this.InterpolantFactoryMethodLinear:return ee;case this.InterpolantFactoryMethodSmooth:return te}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const e=this.getValueSize();this.times=Xc.arraySlice(n,i,o),this.values=Xc.arraySlice(this.values,i*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,o),e=!1;break}o=r}if(void 0!==r&&Xc.isTypedArray(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=Xc.arraySlice(this.times),t=Xc.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===te,i=e.length-1;let o=1;for(let a=1;a<i;++a){let i=!1;const s=e[a];if(s!==e[a+1]&&(1!==a||s!==e[0]))if(r)i=!0;else{const e=a*n,r=e-n,o=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[r+a]||n!==t[o+a]){i=!0;break}}}if(i){if(a!==o){e[o]=e[a];const r=a*n,i=o*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++o}}if(i>0){e[o]=e[i];for(let e=i*n,r=o*n,a=0;a!==n;++a)t[r+a]=t[e+a];++o}return o!==e.length?(this.times=Xc.arraySlice(e,0,o),this.values=Xc.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=Xc.arraySlice(this.times,0),t=Xc.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Zc.prototype.TimeBufferType=Float32Array,Zc.prototype.ValueBufferType=Float32Array,Zc.prototype.DefaultInterpolation=ee;class $c extends Zc{}$c.prototype.ValueTypeName="bool",$c.prototype.ValueBufferType=Array,$c.prototype.DefaultInterpolation=$,$c.prototype.InterpolantFactoryMethodLinear=void 0,$c.prototype.InterpolantFactoryMethodSmooth=void 0;class eu extends Zc{}eu.prototype.ValueTypeName="color";class tu extends Zc{}tu.prototype.ValueTypeName="number";class nu extends Jc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-t)/(r-t);let c=e*a;for(let e=c+a;c!==e;c+=4)$e.slerpFlat(i,0,o,c-a,o,c,s);return i}}class ru extends Zc{InterpolantFactoryMethodLinear(e){return new nu(this.times,this.values,this.getValueSize(),e)}}ru.prototype.ValueTypeName="quaternion",ru.prototype.DefaultInterpolation=ee,ru.prototype.InterpolantFactoryMethodSmooth=void 0;class iu extends Zc{}iu.prototype.ValueTypeName="string",iu.prototype.ValueBufferType=Array,iu.prototype.DefaultInterpolation=$,iu.prototype.InterpolantFactoryMethodLinear=void 0,iu.prototype.InterpolantFactoryMethodSmooth=void 0;class ou extends Zc{}ou.prototype.ValueTypeName="vector";class au{constructor(e,t=-1,n,r=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=be(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(su(n[e]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(Zc.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,o=[];for(let e=0;e<i;e++){let a=[],s=[];a.push((e+i-1)%i,e,(e+1)%i),s.push(0,1,0);const c=Xc.getKeyframeOrder(a);a=Xc.sortedArray(a,1,c),s=Xc.sortedArray(s,1,c),r||0!==a[0]||(a.push(i),s.push(s[0])),o.push(new tu(".morphTargetInfluences["+t[e].name+"]",a,s).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(i);if(o&&o.length>1){const e=o[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const o=[];for(const e in r)o.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const o=[],a=[];Xc.flattenJSON(n,o,a,r),0!==o.length&&i.push(new e(t,o,a))}},r=[],i=e.name||"default",o=e.fps||30,a=e.blendMode;let s=e.length||-1;const c=e.hierarchy||[];for(let e=0;e<c.length;e++){const i=c[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new tu(".morphTargetInfluence["+n+"]",e,o))}s=e.length*o}else{const o=".bones["+t[e].name+"]";n(ou,o+".position",i,"pos",r),n(ru,o+".quaternion",i,"rot",r),n(ou,o+".scale",i,"scl",r)}}if(0===r.length)return null;return new this(i,s,r,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function su(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return tu;case"vector":case"vector2":case"vector3":case"vector4":return ou;case"color":return eu;case"quaternion":return ru;case"bool":case"boolean":return $c;case"string":return iu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Xc.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const cu={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class uu{constructor(e,t,n){const r=this;let i,o=!1,a=0,s=0;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===o&&void 0!==r.onStart&&r.onStart(e,a,s),o=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,s),a===s&&(o=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){const t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=c.length;t<n;t+=2){const n=c[t],r=c[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const lu=new uu;class du{constructor(e){this.manager=void 0!==e?e:lu,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const hu={};class fu extends du{constructor(e){super(e)}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=cu.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout((()=>{t&&t(i),this.manager.itemEnd(e)}),0),i;if(void 0!==hu[e])return void hu[e].push({onLoad:t,onProgress:n,onError:r});hu[e]=[],hu[e].push({onLoad:t,onProgress:n,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,s=this.responseType;fetch(o).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=hu[e],r=t.body.getReader(),i=t.headers.get("Content-Length"),o=i?parseInt(i):0,a=0!==o;let s=0;const c=new ReadableStream({start(e){!function t(){r.read().then((({done:r,value:i})=>{if(r)e.close();else{s+=i.byteLength;const r=new ProgressEvent("progress",{lengthComputable:a,loaded:s,total:o});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(r)}e.enqueue(i),t()}}))}()}});return new Response(c)}throw Error(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`)})).then((e=>{switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(void 0===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((e=>r.decode(e)))}}})).then((t=>{cu.add(e,t);const n=hu[e];delete hu[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onLoad&&r.onLoad(t)}})).catch((t=>{const n=hu[e];if(void 0===n)throw this.manager.itemError(e),t;delete hu[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class pu extends du{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=cu.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const a=Ne("img");function s(){u(),cu.add(e,this),t&&t(this),i.manager.itemEnd(e)}function c(t){u(),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}function u(){a.removeEventListener("load",s,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",s,!1),a.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}class mu extends du{constructor(e){super(e)}load(e,t,n,r){const i=new fr,o=new pu(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function s(n){o.load(e[n],(function(e){i.images[n]=e,a++,6===a&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)s(t);return i}}class gu extends du{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Da,a=new fu(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(i.withCredentials),a.load(e,(function(e){const n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:d,o.wrapT=void 0!==n.wrapT?n.wrapT:d,o.magFilter=void 0!==n.magFilter?n.magFilter:g,o.minFilter=void 0!==n.minFilter?n.minFilter:g,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=y),1===n.mipmapCount&&(o.minFilter=g),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}class vu extends du{constructor(e){super(e)}load(e,t,n,r){const i=new We,o=new pu(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}class yu extends nn{constructor(e,t=1){super(),this.type="Light",this.color=new je(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}yu.prototype.isLight=!0;class bu extends yu{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(nn.DefaultUp),this.updateMatrix(),this.groundColor=new je(t)}copy(e){return yu.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}bu.prototype.isHemisphereLight=!0;const _u=new Mt,Eu=new et,Su=new et;class wu{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new xe(512,512),this.map=null,this.mapPass=null,this.matrix=new Mt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Er,this._frameExtents=new xe(1,1),this._viewportCount=1,this._viewports=[new qe(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Eu.setFromMatrixPosition(e.matrixWorld),t.position.copy(Eu),Su.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Su),t.updateMatrixWorld(),_u.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_u),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Tu extends wu{constructor(){super(new lr(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*ye*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Tu.prototype.isSpotLightShadow=!0;class Au extends yu{constructor(e,t,n=0,r=Math.PI/3,i=0,o=1){super(e,t),this.type="SpotLight",this.position.copy(nn.DefaultUp),this.updateMatrix(),this.target=new nn,this.distance=n,this.angle=r,this.penumbra=i,this.decay=o,this.shadow=new Tu}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Au.prototype.isSpotLight=!0;const Ru=new Mt,xu=new et,Iu=new et;class Ou extends wu{constructor(){super(new lr(90,1,.5,500)),this._frameExtents=new xe(4,2),this._viewportCount=6,this._viewports=[new qe(2,1,1,1),new qe(0,1,1,1),new qe(3,1,1,1),new qe(1,1,1,1),new qe(3,0,1,1),new qe(1,0,1,1)],this._cubeDirections=[new et(1,0,0),new et(-1,0,0),new et(0,0,1),new et(0,0,-1),new et(0,1,0),new et(0,-1,0)],this._cubeUps=[new et(0,1,0),new et(0,1,0),new et(0,1,0),new et(0,1,0),new et(0,0,1),new et(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),xu.setFromMatrixPosition(e.matrixWorld),n.position.copy(xu),Iu.copy(n.position),Iu.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Iu),n.updateMatrixWorld(),r.makeTranslation(-xu.x,-xu.y,-xu.z),Ru.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ru)}}Ou.prototype.isPointLightShadow=!0;class Cu extends yu{constructor(e,t,n=0,r=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Ou}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Cu.prototype.isPointLight=!0;class Mu extends wu{constructor(){super(new kr(-5,5,5,-5,.5,500))}}Mu.prototype.isDirectionalLightShadow=!0;class Nu extends yu{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(nn.DefaultUp),this.updateMatrix(),this.target=new nn,this.shadow=new Mu}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Nu.prototype.isDirectionalLight=!0;class Lu extends yu{constructor(e,t){super(e,t),this.type="AmbientLight"}}Lu.prototype.isAmbientLight=!0;class ku extends yu{constructor(e,t,n=10,r=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}ku.prototype.isRectAreaLight=!0;class Pu{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new et)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*r*1.092548),t.addScaledVector(o[5],r*i*1.092548),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],n*i*1.092548),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*i),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*r),t.addScaledVector(o[5],.858086*r*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],.858086*n*i),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}Pu.prototype.isSphericalHarmonics3=!0;class Du extends yu{constructor(e=new Pu,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Du.prototype.isLightProbe=!0;class Uu extends du{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,o=new fu(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=gn.fromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new je).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];switch(r.uniforms[t]={},i.type){case"t":r.uniforms[t].value=n(i.value);break;case"c":r.uniforms[t].value=(new je).setHex(i.value);break;case"v2":r.uniforms[t].value=(new xe).fromArray(i.value);break;case"v3":r.uniforms[t].value=(new et).fromArray(i.value);break;case"v4":r.uniforms[t].value=(new qe).fromArray(i.value);break;case"m3":r.uniforms[t].value=(new Ie).fromArray(i.value);break;case"m4":r.uniforms[t].value=(new Mt).fromArray(i.value);break;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new xe).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new xe).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}}class Fu{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class ju extends Fn{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}ju.prototype.isInstancedBufferGeometry=!0;class Bu extends du{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new fu(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],o=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers,i=r[t],o=new Uint32Array(i).buffer;return n[t]=o,o}(e,i.buffer),a=Me(i.type,o),s=new sa(a,i.stride);return s.uuid=i.uuid,t[r]=s,s}const i=e.isInstancedBufferGeometry?new ju:new Fn,o=e.data.index;if(void 0!==o){const e=Me(o.type,o.array);i.setIndex(new _n(e,1))}const a=e.data.attributes;for(const t in a){const n=a[t];let o;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);o=new ua(t,n.itemSize,n.offset,n.normalized)}else{const e=Me(n.type,n.array);o=new(n.isInstancedBufferAttribute?Ba:_n)(e,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),void 0!==n.usage&&o.setUsage(n.usage),void 0!==n.updateRange&&(o.updateRange.offset=n.updateRange.offset,o.updateRange.count=n.updateRange.count),i.setAttribute(t,o)}const s=e.data.morphAttributes;if(s)for(const t in s){const n=s[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let a;if(i.isInterleavedBufferAttribute){const t=r(e.data,i.data);a=new ua(t,i.itemSize,i.offset,i.normalized)}else{const e=Me(i.type,i.array);a=new _n(e,i.itemSize,i.normalized)}void 0!==i.name&&(a.name=i.name),o.push(a)}i.morphAttributes[t]=o}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const c=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==c)for(let e=0,t=c.length;e!==t;++e){const t=c[e];i.addGroup(t.start,t.count,t.materialIndex)}const u=e.data.boundingSphere;if(void 0!==u){const e=new et;void 0!==u.center&&e.fromArray(u.center),i.boundingSphere=new St(e,u.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}const Vu={UVMapping:r,CubeReflectionMapping:i,CubeRefractionMapping:o,EquirectangularReflectionMapping:a,EquirectangularRefractionMapping:s,CubeUVReflectionMapping:c,CubeUVRefractionMapping:u},Gu={RepeatWrapping:l,ClampToEdgeWrapping:d,MirroredRepeatWrapping:h},Hu={NearestFilter:f,NearestMipmapNearestFilter:p,NearestMipmapLinearFilter:m,LinearFilter:g,LinearMipmapNearestFilter:v,LinearMipmapLinearFilter:y};class zu extends du{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=cu.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){cu.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}let Wu;zu.prototype.isImageBitmapLoader=!0;const qu={getContext:function(){return void 0===Wu&&(Wu=new(window.AudioContext||window.webkitAudioContext)),Wu},setContext:function(e){Wu=e}};class Xu extends du{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new fu(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);qu.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}}class Ju extends Du{constructor(e,t,n=1){super(void 0,n);const r=(new je).set(e),i=(new je).set(t),o=new et(r.r,r.g,r.b),a=new et(i.r,i.g,i.b),s=Math.sqrt(Math.PI),c=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(c)}}Ju.prototype.isHemisphereLightProbe=!0;class Yu extends Du{constructor(e,t=1){super(void 0,t);const n=(new je).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Yu.prototype.isAmbientLightProbe=!0;const Ku=new Mt,Qu=new Mt,Zu=new Mt;class $u{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=el(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=el();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function el(){return("undefined"==typeof performance?Date:performance).now()}const tl=new et,nl=new $e,rl=new et,il=new et;class ol extends nn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const al=new et,sl=new $e,cl=new et,ul=new et;class ll{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class dl{constructor(e,t,n){let r,i,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==r;++e)n[i+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]}_slerp(e,t,n,r){$e.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const o=this._workIndex*i;$e.multiplyQuaternionsFlat(e,o,e,t,e,n),$e.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,i){const o=1-r;for(let a=0;a!==i;++a){const i=t+a;e[i]=e[i]*o+e[n+a]*r}}_lerpAdditive(e,t,n,r,i){for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]+e[n+o]*r}}}const hl="\\[\\]\\.:\\/",fl=new RegExp("["+hl+"]","g"),pl="[^"+hl+"]",ml="[^"+hl.replace("\\.","")+"]",gl=/((?:WC+[\/:])*)/.source.replace("WC",pl),vl=/(WCOD+)?/.source.replace("WCOD",ml),yl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",pl),bl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",pl),_l=new RegExp("^"+gl+vl+yl+bl+"$"),El=["material","materials","bones"];class Sl{constructor(e,t,n){this.path=t,this.parsedPath=n||Sl.parseTrackName(t),this.node=Sl.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Sl.Composite(e,t,n):new Sl(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(fl,"")}static parseTrackName(e){const t=_l.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==El.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const o=n(i.children);if(o)return o}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=Sl.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const o=e[r];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Sl.Composite=class{constructor(e,t,n){const r=n||Sl.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Sl.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Sl.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Sl.prototype.GetterByBindingType=[Sl.prototype._getValue_direct,Sl.prototype._getValue_array,Sl.prototype._getValue_arrayElement,Sl.prototype._getValue_toArray],Sl.prototype.SetterByBindingTypeAndVersioning=[[Sl.prototype._setValue_direct,Sl.prototype._setValue_direct_setNeedsUpdate,Sl.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Sl.prototype._setValue_array,Sl.prototype._setValue_array_setNeedsUpdate,Sl.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Sl.prototype._setValue_arrayElement,Sl.prototype._setValue_arrayElement_setNeedsUpdate,Sl.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Sl.prototype._setValue_fromArray,Sl.prototype._setValue_fromArray_setNeedsUpdate,Sl.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class wl{constructor(){this.uuid=be(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let a,s=e.length,c=this.nCachedObjects_;for(let u=0,l=arguments.length;u!==l;++u){const l=arguments[u],d=l.uuid;let h=t[d];if(void 0===h){h=s++,t[d]=h,e.push(l);for(let e=0,t=o;e!==t;++e)i[e].push(new Sl(l,n[e],r[e]))}else if(h<c){a=e[h];const s=--c,u=e[s];t[u.uuid]=h,e[h]=u,t[d]=s,e[s]=l;for(let e=0,t=o;e!==t;++e){const t=i[e],o=t[s];let a=t[h];t[h]=o,void 0===a&&(a=new Sl(l,n[e],r[e])),t[s]=a}}else e[h]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o],s=a.uuid,c=t[s];if(void 0!==c&&c>=i){const o=i++,u=e[o];t[u.uuid]=c,e[c]=u,t[s]=o,e[o]=a;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[o],i=t[c];t[c]=r,t[o]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=e.length;for(let a=0,s=arguments.length;a!==s;++a){const s=arguments[a].uuid,c=t[s];if(void 0!==c)if(delete t[s],c<i){const a=--i,s=e[a],u=--o,l=e[u];t[s.uuid]=c,e[c]=s,t[l.uuid]=a,e[a]=l,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[a],i=t[u];t[c]=r,t[a]=i,t.pop()}}else{const i=--o,a=e[i];i>0&&(t[a.uuid]=c),e[c]=a,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[c]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,a=this._parsedPaths,s=this._objects,c=s.length,u=this.nCachedObjects_,l=new Array(c);r=i.length,n[e]=r,o.push(e),a.push(t),i.push(l);for(let n=u,r=s.length;n!==r;++n){const r=s[n];l[n]=new Sl(r,e,t)}return l}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}}wl.prototype.isAnimationObjectGroup=!0;class Tl{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,o=i.length,a=new Array(o),s={endingStart:ne,endingEnd:ne};for(let e=0;e!==o;++e){const t=i[e].createInterpolant(null);a[e]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,o=n/r;e.warp(1,i,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const s=a.parameterPositions,c=a.sampleValues;return s[0]=i,s[1]=i+n,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;if(r<0||0===n)return;this._startTime=null,t=n*r}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===ae)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulateAdditive(a);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulate(r,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const o=2202===n;if(0===e)return-1===i?r:o&&1==(1&i)?t-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&1==(1&i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=re,r.endingEnd=re):(r.endingStart=e?this.zeroSlopeAtStart?re:ne:ie,r.endingEnd=t?this.zeroSlopeAtEnd?re:ne:ie)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=t,a[1]=i+e,s[1]=n,this}}class Al extends pe{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,a=e._interpolants,s=n.uuid,c=this._bindingsByRootAndName;let u=c[s];void 0===u&&(u={},c[s]=u);for(let e=0;e!==i;++e){const i=r[e],c=i.name;let l=u[c];if(void 0!==l)++l.referenceCount,o[e]=l;else{if(l=o[e],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,s,c));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;l=new dl(Sl.create(n,c,r),i.ValueTypeName,i.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,s,c),o[e]=l}a[e].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,c=s[s.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,s[u]=c,s.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[t];void 0===o&&(o={},r[t]=o),o[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],c=e._cacheIndex;s._cacheIndex=c,t[c]=s,t.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Kc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let o="string"==typeof e?au.findByName(r,e):e;const a=null!==o?o.uuid:e,s=this._actionsByClip[a];let c=null;if(void 0===n&&(n=null!==o?o.blendMode:oe),void 0!==s){const e=s.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;c=s.knownActions[0],null===o&&(o=c._clip)}if(null===o)return null;const u=new Tl(this,o,t,n);return this._bindAction(u,c),this._addInactiveAction(u,a,i),u}existingAction(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?au.findByName(n,e):e,o=i?i.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1;for(let a=0;a!==n;++a){t[a]._update(r,e,i,o)}const a=this._bindings,s=this._nActiveBindings;for(let e=0;e!==s;++e)a[e].apply(o);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,o=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,t[i]=o,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}Al.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Rl{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Rl(void 0===this.value.clone?this.value:this.value.clone())}}class xl extends sa{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}xl.prototype.isInstancedInterleavedBuffer=!0;class Il{constructor(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}Il.prototype.isGLBufferAttribute=!0;function Ol(e,t){return e.distance-t.distance}function Cl(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)Cl(r[e],t,n,!0)}}const Ml=new xe;class Nl{constructor(e=new xe(1/0,1/0),t=new xe(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Ml.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ml.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Nl.prototype.isBox2=!0;const Ll=new et,kl=new et;class Pl{constructor(e=new et,t=new et){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Ll.subVectors(e,this.start),kl.subVectors(this.end,this.start);const n=kl.dot(kl);let r=kl.dot(Ll)/n;return t&&(r=_e(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Dl=new et;const Ul=new et,Fl=new Mt,jl=new Mt;class Bl extends ts{constructor(e){const t=Vl(e),n=new Fn,r=[],i=[],o=new je(0,0,1),a=new je(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new On(r,3)),n.setAttribute("color",new On(i,3));super(n,new qa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");jl.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(Fl.multiplyMatrices(jl,i.matrixWorld),Ul.setFromMatrixPosition(Fl),r.setXYZ(n,Ul.x,Ul.y,Ul.z),Fl.multiplyMatrices(jl,i.parent.matrixWorld),Ul.setFromMatrixPosition(Fl),r.setXYZ(n+1,Ul.x,Ul.y,Ul.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function Vl(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Vl(e.children[n]));return t}const Gl=new et,Hl=new je,zl=new je;class Wl extends ts{constructor(e=10,t=10,n=4473924,r=8947848){n=new je(n),r=new je(r);const i=t/2,o=e/t,a=e/2,s=[],c=[];for(let e=0,u=0,l=-a;e<=t;e++,l+=o){s.push(-a,0,l,a,0,l),s.push(l,0,-a,l,0,a);const t=e===i?n:r;t.toArray(c,u),u+=3,t.toArray(c,u),u+=3,t.toArray(c,u),u+=3,t.toArray(c,u),u+=3}const u=new Fn;u.setAttribute("position",new On(s,3)),u.setAttribute("color",new On(c,3));super(u,new qa({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const ql=new et,Xl=new et,Jl=new et;const Yl=new et,Kl=new ur;function Ql(e,t,n,r,i,o,a){Yl.set(i,o,a).unproject(r);const s=t[e];if(void 0!==s){const e=n.getAttribute("position");for(let t=0,n=s.length;t<n;t++)e.setXYZ(s[t],Yl.x,Yl.y,Yl.z)}}const Zl=new rt;class $l extends ts{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Fn;i.setIndex(new _n(n,1)),i.setAttribute("position",new _n(r,3)),super(i,new qa({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Zl.setFromObject(this.object),Zl.isEmpty())return;const t=Zl.min,n=Zl.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return ts.prototype.copy.call(this,e),this.object=e.object,this}}const ed=new et;let td,nd;class rd extends ts{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Fn;n.setAttribute("position",new On(t,3)),n.setAttribute("color",new On([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new qa({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new je,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const id=new Float32Array(1),od=new Int32Array(id.buffer);Ts.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Ts.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Ws.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},Wl.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Bl.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},du.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Fu.extractUrlBase(e)},du.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Nl.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Nl.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Nl.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Nl.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},rt.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},rt.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},rt.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},rt.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},rt.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Vt.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},St.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Er.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Pl.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Ie.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Ie.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Ie.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Ie.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Ie.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Ie.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Mt.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Mt.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Mt.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new et).setFromMatrixColumn(this,3)},Mt.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Mt.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Mt.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Mt.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Mt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Mt.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Mt.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Mt.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Mt.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Mt.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Mt.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Mt.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Mt.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Mt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Mt.prototype.makeFrustum=function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)},Mt.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},yr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},$e.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},$e.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Ct.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Ct.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},Ct.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},pn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},pn.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},pn.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},pn.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},pn.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},pn.barycoordFromPoint=function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),pn.getBarycoord(e,t,n,r,i)},pn.normal=function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),pn.getNormal(e,t,n,r)},qs.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},qs.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ec(this,e)},qs.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new xc(this,e)},xe.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},xe.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},xe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},et.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},et.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},et.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},et.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},et.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},et.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},et.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},et.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},et.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},qe.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},qe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},nn.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},nn.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},nn.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},nn.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},nn.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(nn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),nr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(nr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),ka.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},lr.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(yu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(_n.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===de},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(de)}}}),_n.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?de:le),this},_n.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},_n.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Fn.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},Fn.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new _n(arguments[1],arguments[2])))},Fn.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},Fn.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Fn.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Fn.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},Fn.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Fn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),sa.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?de:le),this},sa.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Ec.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Ec.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Ec.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},aa.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Rl.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(gn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new je}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(cr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),na.prototype.clearTarget=function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},na.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},na.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},na.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},na.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},na.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},na.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},na.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},na.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},na.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},na.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},na.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},na.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},na.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},na.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},na.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},na.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},na.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},na.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},na.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},na.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},na.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},na.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},na.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},na.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(na.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?ce:se}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(Wo.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Xe.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),ol.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new Xu).load(e,(function(e){t.setBuffer(e)})),this},ll.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},hr.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},hr.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)},Ve.crossOrigin=void 0,Ve.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new vu;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Ve.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new mu;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Ve.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ve.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const ad={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t),e.ACESFilmicToneMapping=4,e.AddEquation=n,e.AddOperation=2,e.AdditiveAnimationBlendMode=ae,e.AdditiveBlending=2,e.AlphaFormat=1021,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=Lu,e.AmbientLightProbe=Yu,e.AnimationClip=au,e.AnimationLoader=class extends du{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new fu(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=au.parse(e[n]);t.push(r)}return t}},e.AnimationMixer=Al,e.AnimationObjectGroup=wl,e.AnimationUtils=Xc,e.ArcCurve=Rs,e.ArrayCamera=Yo,e.ArrowHelper=class extends nn{constructor(e=new et(0,0,1),t=new et(0,0,0),n=1,r=16776960,i=.2*n,o=.2*i){super(),this.type="ArrowHelper",void 0===td&&(td=new Fn,td.setAttribute("position",new On([0,0,0,0,1,0],3)),nd=new ms(0,.5,1,5,1),nd.translate(0,-.5,0)),this.position.copy(t),this.line=new Za(td,new qa({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new nr(nd,new vn({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{ed.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(ed,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}},e.Audio=ol,e.AudioAnalyser=ll,e.AudioContext=qu,e.AudioListener=class extends nn{constructor(){super(),this.type="AudioListener",this.context=qu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new $u}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(tl,nl,rl),il.set(0,0,-1).applyQuaternion(nl),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(tl.x,e),t.positionY.linearRampToValueAtTime(tl.y,e),t.positionZ.linearRampToValueAtTime(tl.z,e),t.forwardX.linearRampToValueAtTime(il.x,e),t.forwardY.linearRampToValueAtTime(il.y,e),t.forwardZ.linearRampToValueAtTime(il.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(tl.x,tl.y,tl.z),t.setOrientation(il.x,il.y,il.z,n.x,n.y,n.z)}},e.AudioLoader=Xu,e.AxesHelper=rd,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new rd(e)},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new gu(e)},e.Bone=Pa,e.BooleanKeyframeTrack=$c,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new $l(e,t)},e.Box2=Nl,e.Box3=rt,e.Box3Helper=class extends ts{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Fn;r.setIndex(new _n(n,1)),r.setAttribute("position",new On([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new qa({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}},e.BoxBufferGeometry=ir,e.BoxGeometry=ir,e.BoxHelper=$l,e.BufferAttribute=_n,e.BufferGeometry=Fn,e.BufferGeometryLoader=Bu,e.ByteType=1010,e.Cache=cu,e.Camera=ur,e.CameraHelper=class extends ts{constructor(e){const t=new Fn,n=new qa({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],o={},a=new je(16755200),s=new je(16711680),c=new je(43775),u=new je(16777215),l=new je(3355443);function d(e,t,n){h(e,n),h(t,n)}function h(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}d("n1","n2",a),d("n2","n4",a),d("n4","n3",a),d("n3","n1",a),d("f1","f2",a),d("f2","f4",a),d("f4","f3",a),d("f3","f1",a),d("n1","f1",a),d("n2","f2",a),d("n3","f3",a),d("n4","f4",a),d("p","n1",s),d("p","n2",s),d("p","n3",s),d("p","n4",s),d("u1","u2",c),d("u2","u3",c),d("u3","u1",c),d("c","t",u),d("p","c",l),d("cn1","cn2",l),d("cn3","cn4",l),d("cf1","cf2",l),d("cf3","cf4",l),t.setAttribute("position",new On(r,3)),t.setAttribute("color",new On(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap;Kl.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ql("c",t,e,Kl,0,0,-1),Ql("t",t,e,Kl,0,0,1),Ql("n1",t,e,Kl,-1,-1,-1),Ql("n2",t,e,Kl,1,-1,-1),Ql("n3",t,e,Kl,-1,1,-1),Ql("n4",t,e,Kl,1,1,-1),Ql("f1",t,e,Kl,-1,-1,1),Ql("f2",t,e,Kl,1,-1,1),Ql("f3",t,e,Kl,-1,1,1),Ql("f4",t,e,Kl,1,1,1),Ql("u1",t,e,Kl,.7,1.1,-1),Ql("u2",t,e,Kl,-.7,1.1,-1),Ql("u3",t,e,Kl,0,2,-1),Ql("cf1",t,e,Kl,-1,0,1),Ql("cf2",t,e,Kl,1,0,1),Ql("cf3",t,e,Kl,0,-1,1),Ql("cf4",t,e,Kl,0,1,1),Ql("cn1",t,e,Kl,-1,0,-1),Ql("cn2",t,e,Kl,1,0,-1),Ql("cn3",t,e,Kl,0,-1,-1),Ql("cn4",t,e,Kl,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=fs,e.CatmullRomCurve3=Ns,e.CineonToneMapping=3,e.CircleBufferGeometry=ps,e.CircleGeometry=ps,e.ClampToEdgeWrapping=d,e.Clock=$u,e.Color=je,e.ColorKeyframeTrack=eu,e.CompressedTexture=hs,e.CompressedTextureLoader=class extends du{constructor(e){super(e)}load(e,t,n,r){const i=this,o=[],a=new hs,s=new fu(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);let c=0;function u(u){s.load(e[u],(function(e){const n=i.parse(e,!0);o[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},c+=1,6===c&&(1===n.mipmapCount&&(a.minFilter=g),a.image=o,a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)u(t);else s.load(e,(function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}a.image=o}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=g),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,r);return a}},e.ConeBufferGeometry=gs,e.ConeGeometry=gs,e.CubeCamera=hr,e.CubeReflectionMapping=i,e.CubeRefractionMapping=o,e.CubeTexture=fr,e.CubeTextureLoader=mu,e.CubeUVReflectionMapping=c,e.CubeUVRefractionMapping=u,e.CubicBezierCurve=Ds,e.CubicBezierCurve3=Us,e.CubicInterpolant=Yc,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=Ts,e.CurvePath=zs,e.CustomBlending=5,e.CustomToneMapping=5,e.CylinderBufferGeometry=ms,e.CylinderGeometry=ms,e.Cylindrical=class{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}},e.Data3DTexture=Ke,e.DataArrayTexture=Je,e.DataTexture=Da,e.DataTexture2DArray=function(e,t,n,r){return console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),new Je(e,t,n,r)},e.DataTexture3D=function(e,t,n,r){return console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),new Ke(e,t,n,r)},e.DataTextureLoader=gu,e.DataUtils=class{static toHalfFloat(e){e>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),id[0]=e;const t=od[0];let n=t>>16&32768,r=t>>12&2047;const i=t>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&t,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}},e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=lu,e.DepthFormat=R,e.DepthStencilFormat=x,e.DepthTexture=$o,e.DirectionalLight=Nu,e.DirectionalLightHelper=class extends nn{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let r=new Fn;r.setAttribute("position",new On([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new qa({fog:!1,toneMapped:!1});this.lightPlane=new Za(r,i),this.add(this.lightPlane),r=new Fn,r.setAttribute("position",new On([0,0,0,0,0,1],3)),this.targetLine=new Za(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){ql.setFromMatrixPosition(this.light.matrixWorld),Xl.setFromMatrixPosition(this.light.target.matrixWorld),Jl.subVectors(Xl,ql),this.lightPlane.lookAt(Xl),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Xl),this.targetLine.scale.z=Jl.length()}},e.DiscreteInterpolant=Qc,e.DodecahedronBufferGeometry=ys,e.DodecahedronGeometry=ys,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new _n(e,t).setUsage(de)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=de,e.DynamicReadUsage=35049,e.EdgesGeometry=ws,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new ts(new ws(e.geometry),new qa({color:void 0!==t?t:16777215}))},e.EllipseCurve=As,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=a,e.EquirectangularRefractionMapping=s,e.Euler=Vt,e.EventDispatcher=pe,e.ExtrudeBufferGeometry=Ec,e.ExtrudeGeometry=Ec,e.FaceColors=1,e.FileLoader=fu,e.FlatShading=1,e.Float16BufferAttribute=In,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new On(e,t)},e.Float32BufferAttribute=On,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Cn(e,t)},e.Float64BufferAttribute=Cn,e.FloatType=S,e.Fog=oa,e.FogExp2=ia,e.Font=function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},e.FontLoader=function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},e.FramebufferTexture=ds,e.FrontSide=0,e.Frustum=Er,e.GLBufferAttribute=Il,e.GLSL1="100",e.GLSL3=he,e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=Wl,e.Group=Ko,e.HalfFloatType=w,e.HemisphereLight=bu,e.HemisphereLightHelper=class extends nn{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new Ac(t);r.rotateY(.5*Math.PI),this.material=new vn({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.setAttribute("color",new _n(o,3)),this.add(new nr(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Hl.copy(this.light.color),zl.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?Hl:zl;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(Gl.setFromMatrixPosition(this.light.matrixWorld).negate())}},e.HemisphereLightProbe=Ju,e.IcosahedronBufferGeometry=wc,e.IcosahedronGeometry=wc,e.ImageBitmapLoader=zu,e.ImageLoader=pu,e.ImageUtils=Ve,e.ImmediateRenderObject=function(){console.error("THREE.ImmediateRenderObject has been removed.")},e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=Ba,e.InstancedBufferGeometry=ju,e.InstancedInterleavedBuffer=xl,e.InstancedMesh=Wa,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Tn(e,t)},e.Int16BufferAttribute=Tn,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Rn(e,t)},e.Int32BufferAttribute=Rn,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new En(e,t)},e.Int8BufferAttribute=En,e.IntType=1013,e.InterleavedBuffer=sa,e.InterleavedBufferAttribute=ua,e.Interpolant=Jc,e.InterpolateDiscrete=$,e.InterpolateLinear=ee,e.InterpolateSmooth=te,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=ue,e.KeyframeTrack=Zc,e.LOD=Ia,e.LatheBufferGeometry=Tc,e.LatheGeometry=Tc,e.Layers=Gt,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=yu,e.LightProbe=Du,e.Line=Za,e.Line3=Pl,e.LineBasicMaterial=qa,e.LineCurve=Fs,e.LineCurve3=js,e.LineDashedMaterial=Wc,e.LineLoop=ns,e.LinePieces=1,e.LineSegments=ts,e.LineStrip=0,e.LinearEncoding=se,e.LinearFilter=g,e.LinearInterpolant=Kc,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=y,e.LinearMipmapNearestFilter=v,e.LinearToneMapping=1,e.Loader=du,e.LoaderUtils=Fu,e.LoadingManager=uu,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=gn,e.MaterialLoader=Uu,e.Math=Re,e.MathUtils=Re,e.Matrix3=Ie,e.Matrix4=Mt,e.MaxEquation=104,e.Mesh=nr,e.MeshBasicMaterial=vn,e.MeshDepthMaterial=Ho,e.MeshDistanceMaterial=zo,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=Hc,e.MeshMatcapMaterial=zc,e.MeshNormalMaterial=Gc,e.MeshPhongMaterial=Bc,e.MeshPhysicalMaterial=jc,e.MeshStandardMaterial=Fc,e.MeshToonMaterial=Vc,e.MinEquation=103,e.MirroredRepeatWrapping=h,e.MixOperation=1,e.MultiMaterial=function(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=f,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=m,e.NearestMipmapNearestFilter=p,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColors=0,e.NoToneMapping=0,e.NormalAnimationBlendMode=oe,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=tu,e.Object3D=nn,e.ObjectLoader=class extends du{constructor(e){super(e)}load(e,t,n,r){const i=this,o=""===this.path?Fu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new fu(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){let o=null;try{o=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)}async loadAsync(e,t){const n=""===this.path?Fu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new fu(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(e,t),o=JSON.parse(i),a=o.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,(function(){void 0!==t&&t(c)})),a=this.parseTextures(e.textures,o),s=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,i,s,a,n),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),void 0!==t){let e=!1;for(const t in o)if(o[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,r,a,o,t),c=this.parseSkeletons(e.skeletons,s);return this.bindSkeletons(s,c),s}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new qs).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new ja).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(e,t){const n={};if(void 0!==e){const r=new Bu;for(let i=0,o=e.length;i<o;i++){let o;const a=e[i];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(a);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:a.type in Pc?o=Pc[a.type].fromJSON(a,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),!0===o.isBufferGeometry&&void 0!==a.userData&&(o.userData=a.userData),n[a.uuid]=o}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new Uu;i.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];if("MultiMaterial"===o.type){const e=[];for(let t=0;t<o.materials.length;t++){const r=o.materials[t];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),e.push(n[r.uuid])}r[o.uuid]=e}else void 0===n[o.uuid]&&(n[o.uuid]=i.parse(o)),r[o.uuid]=n[o.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=au.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function o(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),i.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:Me(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new uu(t);i=new pu(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n.url;if(Array.isArray(i)){const e=[];for(let t=0,n=i.length;t<n;t++){const n=o(i[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new Da(n.data,n.width,n.height)))}r[n.uuid]=new Ge(e)}else{const e=o(n.url);r[n.uuid]=new Ge(e)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function i(e){if("string"==typeof e){const n=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await r.loadAsync(i)}return e.data?{data:Me(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){r=new pu(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],o=r.url;if(Array.isArray(o)){const e=[];for(let t=0,n=o.length;t<n;t++){const n=o[t],r=await i(n);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new Da(r.data,r.width,r.height)))}n[r.uuid]=new Ge(e)}else{const e=await i(r.url);n[r.uuid]=new Ge(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let i=0,o=e.length;i<o;i++){const o=e[i];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const a=t[o.image],s=a.data;let c;Array.isArray(s)?(c=new fr,6===s.length&&(c.needsUpdate=!0)):(c=s&&s.data?new Da:new We,s&&(c.needsUpdate=!0)),c.source=a,c.uuid=o.uuid,void 0!==o.name&&(c.name=o.name),void 0!==o.mapping&&(c.mapping=n(o.mapping,Vu)),void 0!==o.offset&&c.offset.fromArray(o.offset),void 0!==o.repeat&&c.repeat.fromArray(o.repeat),void 0!==o.center&&c.center.fromArray(o.center),void 0!==o.rotation&&(c.rotation=o.rotation),void 0!==o.wrap&&(c.wrapS=n(o.wrap[0],Gu),c.wrapT=n(o.wrap[1],Gu)),void 0!==o.format&&(c.format=o.format),void 0!==o.type&&(c.type=o.type),void 0!==o.encoding&&(c.encoding=o.encoding),void 0!==o.minFilter&&(c.minFilter=n(o.minFilter,Hu)),void 0!==o.magFilter&&(c.magFilter=n(o.magFilter,Hu)),void 0!==o.anisotropy&&(c.anisotropy=o.anisotropy),void 0!==o.flipY&&(c.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(c.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(c.unpackAlignment=o.unpackAlignment),void 0!==o.userData&&(c.userData=o.userData),r[o.uuid]=c}return r}parseObject(e,t,n,r,i){let o,a,s;function c(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function u(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function l(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":o=new aa,void 0!==e.background&&(Number.isInteger(e.background)?o.background=new je(e.background):o.background=l(e.background)),void 0!==e.environment&&(o.environment=l(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new oa(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new ia(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new lr(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new kr(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new Lu(e.color,e.intensity);break;case"DirectionalLight":o=new Nu(e.color,e.intensity);break;case"PointLight":o=new Cu(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new ku(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Au(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new bu(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new Du).fromJSON(e);break;case"SkinnedMesh":a=c(e.geometry),s=u(e.material),o=new ka(a,s),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":a=c(e.geometry),s=u(e.material),o=new nr(a,s);break;case"InstancedMesh":a=c(e.geometry),s=u(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;o=new Wa(a,s,t),o.instanceMatrix=new Ba(new Float32Array(n.array),16),void 0!==r&&(o.instanceColor=new Ba(new Float32Array(r.array),r.itemSize));break;case"LOD":o=new Ia;break;case"Line":o=new Za(c(e.geometry),u(e.material));break;case"LineLoop":o=new ns(c(e.geometry),u(e.material));break;case"LineSegments":o=new ts(c(e.geometry),u(e.material));break;case"PointCloud":case"Points":o=new cs(c(e.geometry),u(e.material));break;case"Sprite":o=new Ta(u(e.material));break;case"Group":o=new Ko;break;case"Bone":o=new Pa;break;default:o=new nn}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)o.add(this.parseObject(a[e],t,n,r,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];o.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=o.getObjectByProperty("uuid",n.object);void 0!==r&&o.addLevel(r,n.distance)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}},e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=Ac,e.OctahedronGeometry=Ac,e.OneFactor=201,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=205,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=kr,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.PMREMGenerator=Hr,e.ParametricGeometry=function(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new Fn},e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Ta(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new rs(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new cs(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new rs(e)},e.Path=Ws,e.PerspectiveCamera=lr,e.Plane=yr,e.PlaneBufferGeometry=Tr,e.PlaneGeometry=Tr,e.PlaneHelper=class extends Za{constructor(e,t=1,n=16776960){const r=n,i=new Fn;i.setAttribute("position",new On([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new qa({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=new Fn;o.setAttribute("position",new On([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new nr(o,new vn({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}},e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new cs(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new rs(e)},e.PointLight=Cu,e.PointLightHelper=class extends nr{constructor(e,t,n){super(new Ic(t,4,2),new vn({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},e.Points=cs,e.PointsMaterial=rs,e.PolarGridHelper=class extends ts{constructor(e=10,t=16,n=8,r=64,i=4473924,o=8947848){i=new je(i),o=new je(o);const a=[],s=[];for(let n=0;n<=t;n++){const r=n/t*(2*Math.PI),c=Math.sin(r)*e,u=Math.cos(r)*e;a.push(0,0,0),a.push(c,0,u);const l=1&n?i:o;s.push(l.r,l.g,l.b),s.push(l.r,l.g,l.b)}for(let t=0;t<=n;t++){const c=1&t?i:o,u=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*u,i=Math.cos(t)*u;a.push(n,0,i),s.push(c.r,c.g,c.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*u,i=Math.cos(t)*u,a.push(n,0,i),s.push(c.r,c.g,c.b)}}const c=new Fn;c.setAttribute("position",new On(a,3)),c.setAttribute("color",new On(s,3));super(c,new qa({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},e.PolyhedronBufferGeometry=vs,e.PolyhedronGeometry=vs,e.PositionalAudio=class extends ol{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(al,sl,cl),ul.set(0,0,1).applyQuaternion(sl);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(al.x,e),t.positionY.linearRampToValueAtTime(al.y,e),t.positionZ.linearRampToValueAtTime(al.z,e),t.orientationX.linearRampToValueAtTime(ul.x,e),t.orientationY.linearRampToValueAtTime(ul.y,e),t.orientationZ.linearRampToValueAtTime(ul.z,e)}else t.setPosition(al.x,al.y,al.z),t.setOrientation(ul.x,ul.y,ul.z)}},e.PropertyBinding=Sl,e.PropertyMixer=dl,e.QuadraticBezierCurve=Bs,e.QuadraticBezierCurve3=Vs,e.Quaternion=$e,e.QuaternionKeyframeTrack=ru,e.QuaternionLinearInterpolant=nu,e.REVISION=t,e.RGBADepthPacking=3201,e.RGBAFormat=A,e.RGBAIntegerFormat=1033,e.RGBA_ASTC_10x10_Format=Y,e.RGBA_ASTC_10x5_Format=q,e.RGBA_ASTC_10x6_Format=X,e.RGBA_ASTC_10x8_Format=J,e.RGBA_ASTC_12x10_Format=K,e.RGBA_ASTC_12x12_Format=Q,e.RGBA_ASTC_4x4_Format=F,e.RGBA_ASTC_5x4_Format=j,e.RGBA_ASTC_5x5_Format=B,e.RGBA_ASTC_6x5_Format=V,e.RGBA_ASTC_6x6_Format=G,e.RGBA_ASTC_8x5_Format=H,e.RGBA_ASTC_8x6_Format=z,e.RGBA_ASTC_8x8_Format=W,e.RGBA_BPTC_Format=Z,e.RGBA_ETC2_EAC_Format=U,e.RGBA_PVRTC_2BPPV1_Format=P,e.RGBA_PVRTC_4BPPV1_Format=k,e.RGBA_S3TC_DXT1_Format=O,e.RGBA_S3TC_DXT3_Format=C,e.RGBA_S3TC_DXT5_Format=M,e.RGBFormat=1022,e.RGB_ETC1_Format=36196,e.RGB_ETC2_Format=D,e.RGB_PVRTC_2BPPV1_Format=L,e.RGB_PVRTC_4BPPV1_Format=N,e.RGB_S3TC_DXT1_Format=I,e.RGFormat=1030,e.RGIntegerFormat=1031,e.RawShaderMaterial=Uc,e.Ray=Ct,e.Raycaster=class{constructor(e,t,n=0,r=1/0){this.ray=new Ct(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Gt,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return Cl(e,this,n,t),n.sort(Ol),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)Cl(e[r],this,n,t);return n.sort(Ol),n}},e.RectAreaLight=ku,e.RedFormat=1028,e.RedIntegerFormat=1029,e.ReinhardToneMapping=2,e.RepeatWrapping=l,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=Rc,e.RingGeometry=Rc,e.Scene=aa,e.SceneUtils=ad,e.ShaderChunk=Ar,e.ShaderLib=xr,e.ShaderMaterial=cr,e.ShadowMaterial=Dc,e.Shape=qs,e.ShapeBufferGeometry=xc,e.ShapeGeometry=xc,e.ShapePath=class{constructor(){this.type="ShapePath",this.color=new je,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Ws,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new qs;i.curves=r.curves,t.push(i)}return t}function r(e,t){const n=t.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=t[i],a=t[o],s=a.x-n.x,c=a.y-n.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(n=t[o],s=-s,a=t[i],c=-c),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=c*(e.x-n.x)-s*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return r}const i=yc.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);let a,s,c;const u=[];if(1===o.length)return s=o[0],c=new qs,c.curves=s.curves,u.push(c),u;let l=!i(o[0].getPoints());l=e?!l:l;const d=[],h=[];let f,p,m=[],g=0;h[g]=void 0,m[g]=[];for(let t=0,n=o.length;t<n;t++)s=o[t],f=s.getPoints(),a=i(f),a=e?!a:a,a?(!l&&h[g]&&g++,h[g]={s:new qs,p:f},h[g].s.curves=s.curves,l&&g++,m[g]=[]):m[g].push({h:s,p:f[0]});if(!h[0])return n(o);if(h.length>1){let e=!1,t=0;for(let e=0,t=h.length;e<t;e++)d[e]=[];for(let n=0,i=h.length;n<i;n++){const i=m[n];for(let o=0;o<i.length;o++){const a=i[o];let s=!0;for(let i=0;i<h.length;i++)r(a.p,h[i].p)&&(n!==i&&t++,s?(s=!1,d[i].push(a)):e=!0);s&&d[n].push(a)}}t>0&&!1===e&&(m=d)}for(let e=0,t=h.length;e<t;e++){c=h[e].s,u.push(c),p=m[e];for(let e=0,t=p.length;e<t;e++)c.holes.push(p[e].h)}return u}},e.ShapeUtils=yc,e.ShortType=1011,e.Skeleton=ja,e.SkeletonHelper=Bl,e.SkinnedMesh=ka,e.SmoothShading=2,e.Sphere=St,e.SphereBufferGeometry=Ic,e.SphereGeometry=Ic,e.Spherical=class{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(_e(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},e.SphericalHarmonics3=Pu,e.SplineCurve=Gs,e.SpotLight=Au,e.SpotLightHelper=class extends nn{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new Fn,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const i=e/n*Math.PI*2,o=t/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}n.setAttribute("position",new On(r,3));const i=new qa({fog:!1,toneMapped:!1});this.cone=new ts(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Dl.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Dl),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},e.Sprite=Ta,e.SpriteMaterial=la,e.SrcAlphaFactor=204,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StaticCopyUsage=35046,e.StaticDrawUsage=le,e.StaticReadUsage=35045,e.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new lr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new lr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Zu.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,i=t.near*Math.tan(ve*t.fov*.5)/t.zoom;let o,a;Qu.elements[12]=-n,Ku.elements[12]=n,o=-i*t.aspect+r,a=i*t.aspect+r,Zu.elements[0]=2*t.near/(a-o),Zu.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(Zu),o=-i*t.aspect-r,a=i*t.aspect-r,Zu.elements[0]=2*t.near/(a-o),Zu.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(Zu)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Qu),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Ku)}},e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=iu,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=Oc,e.TetrahedronGeometry=Oc,e.TextGeometry=function(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new Fn},e.Texture=We,e.TextureLoader=vu,e.TorusBufferGeometry=Cc,e.TorusGeometry=Cc,e.TorusKnotBufferGeometry=Mc,e.TorusKnotGeometry=Mc,e.Triangle=pn,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=Nc,e.TubeGeometry=Nc,e.UVMapping=r,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new An(e,t)},e.Uint16BufferAttribute=An,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new xn(e,t)},e.Uint32BufferAttribute=xn,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Sn(e,t)},e.Uint8BufferAttribute=Sn,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new wn(e,t)},e.Uint8ClampedBufferAttribute=wn,e.Uniform=Rl,e.UniformsLib=Rr,e.UniformsUtils=sr,e.UnsignedByteType=b,e.UnsignedInt248Type=T,e.UnsignedIntType=E,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShortType=_,e.VSMShadowMap=3,e.Vector2=xe,e.Vector3=et,e.Vector4=qe,e.VectorKeyframeTrack=ou,e.Vertex=function(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new et(e,t,n)},e.VertexColors=2,e.VideoTexture=ls,e.WebGL1Renderer=ra,e.WebGL3DRenderTarget=Qe,e.WebGLArrayRenderTarget=Ye,e.WebGLCubeRenderTarget=pr,e.WebGLMultipleRenderTargets=Ze,e.WebGLMultisampleRenderTarget=function(e,t,n){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.');const r=new Xe(e,t,n);return r.samples=4,r},e.WebGLRenderTarget=Xe,e.WebGLRenderTargetCube=function(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new pr(e,n)},e.WebGLRenderer=na,e.WebGLUtils=Jo,e.WireframeGeometry=Lc,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new ts(new Lc(e.geometry),new qa({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=ie,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new fu(e)},e.ZeroCurvatureEnding=ne,e.ZeroFactor=200,e.ZeroSlopeEnding=re,e.ZeroStencilOp=0,e._SRGBAFormat=fe,e.sRGBEncoding=ce,Object.defineProperty(e,"__esModule",{value:!0})})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.QRious=t()}(this,(function(){"use strict";var e=function(){},t=Object.prototype.hasOwnProperty,n=Array.prototype.slice;function r(e,r,i){for(var o,a,s=0,c=(i=n.call(arguments,2)).length;s<c;s++)for(o in a=i[s])e&&!t.call(a,o)||(r[o]=a[o])}var i=function(t,n,i,o){var a=this;return"string"!=typeof t&&(o=i,i=n,n=t,t=null),"function"!=typeof n&&(o=i,i=n,n=function(){return a.apply(this,arguments)}),r(!1,n,a,o),n.prototype=function(t,n){var i;return"function"==typeof Object.create?i=Object.create(t):(e.prototype=t,i=new e,e.prototype=null),n&&r(!0,i,n),i}(a.prototype,i),n.prototype.constructor=n,n.class_=t||a.class_,n.super_=a,n};function o(){}o.class_="Nevis",o.super_=Object,o.extend=i;var a=o,s=a.extend((function(e,t,n){this.qrious=e,this.element=t,this.element.qrious=e,this.enabled=Boolean(n)}),{draw:function(e){},getElement:function(){return this.enabled||(this.enabled=!0,this.render()),this.element},getModuleSize:function(e){var t=this.qrious,n=t.padding||0,r=Math.floor((t.size-2*n)/e.width);return Math.max(1,r)},getOffset:function(e){var t=this.qrious,n=t.padding;if(null!=n)return n;var r=this.getModuleSize(e),i=Math.floor((t.size-r*e.width)/2);return Math.max(0,i)},render:function(e){this.enabled&&(this.resize(),this.reset(),this.draw(e))},reset:function(){},resize:function(){}}),c=s.extend({draw:function(e){var t,n,r=this.qrious,i=this.getModuleSize(e),o=this.getOffset(e),a=this.element.getContext("2d");for(a.fillStyle=r.foreground,a.globalAlpha=r.foregroundAlpha,t=0;t<e.width;t++)for(n=0;n<e.width;n++)e.buffer[n*e.width+t]&&a.fillRect(i*t+o,i*n+o,i,i)},reset:function(){var e=this.qrious,t=this.element.getContext("2d"),n=e.size;t.lineWidth=1,t.clearRect(0,0,n,n),t.fillStyle=e.background,t.globalAlpha=e.backgroundAlpha,t.fillRect(0,0,n,n)},resize:function(){var e=this.element;e.width=e.height=this.qrious.size}}),u=a.extend(null,{BLOCK:[0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24,26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28]}),l=a.extend(null,{BLOCKS:[1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0,44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30,11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4,122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24,46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30],FINAL_FORMAT:[30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107],LEVELS:{L:1,M:2,Q:3,H:4}}),d=a.extend(null,{EXPONENT:[1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0],LOG:[255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175]}),h=a.extend(null,{BLOCK:[3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177]}),f=a.extend((function(e){var t,n,r,i,o,a=e.value.length;for(this._badness=[],this._level=l.LEVELS[e.level],this._polynomial=[],this._value=e.value,this._version=0,this._stringBuffer=[];this._version<40&&(this._version++,r=4*(this._level-1)+16*(this._version-1),i=l.BLOCKS[r++],o=l.BLOCKS[r++],t=l.BLOCKS[r++],n=l.BLOCKS[r],!(a<=(r=t*(i+o)+o-3+(this._version<=9)))););this._dataBlock=t,this._eccBlock=n,this._neccBlock1=i,this._neccBlock2=o;var s=this.width=17+4*this._version;this.buffer=f._createArray(s*s),this._ecc=f._createArray(t+(t+n)*(i+o)+o),this._mask=f._createArray((s*(s+1)+1)/2),this._insertFinders(),this._insertAlignments(),this.buffer[8+s*(s-8)]=1,this._insertTimingGap(),this._reverseMask(),this._insertTimingRowAndColumn(),this._insertVersion(),this._syncMask(),this._convertBitStream(a),this._calculatePolynomial(),this._appendEccToData(),this._interleaveBlocks(),this._pack(),this._finish()}),{_addAlignment:function(e,t){var n,r=this.buffer,i=this.width;for(r[e+i*t]=1,n=-2;n<2;n++)r[e+n+i*(t-2)]=1,r[e-2+i*(t+n+1)]=1,r[e+2+i*(t+n)]=1,r[e+n+1+i*(t+2)]=1;for(n=0;n<2;n++)this._setMask(e-1,t+n),this._setMask(e+1,t-n),this._setMask(e-n,t-1),this._setMask(e+n,t+1)},_appendData:function(e,t,n,r){var i,o,a,s=this._polynomial,c=this._stringBuffer;for(o=0;o<r;o++)c[n+o]=0;for(o=0;o<t;o++){if(255!==(i=d.LOG[c[e+o]^c[n]]))for(a=1;a<r;a++)c[n+a-1]=c[n+a]^d.EXPONENT[f._modN(i+s[r-a])];else for(a=n;a<n+r;a++)c[a]=c[a+1];c[n+r-1]=255===i?0:d.EXPONENT[f._modN(i+s[0])]}},_appendEccToData:function(){var e,t=0,n=this._dataBlock,r=this._calculateMaxLength(),i=this._eccBlock;for(e=0;e<this._neccBlock1;e++)this._appendData(t,n,r,i),t+=n,r+=i;for(e=0;e<this._neccBlock2;e++)this._appendData(t,n+1,r,i),t+=n+1,r+=i},_applyMask:function(e){var t,n,r,i,o=this.buffer,a=this.width;switch(e){case 0:for(i=0;i<a;i++)for(r=0;r<a;r++)r+i&1||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 1:for(i=0;i<a;i++)for(r=0;r<a;r++)1&i||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 2:for(i=0;i<a;i++)for(t=0,r=0;r<a;r++,t++)3===t&&(t=0),t||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 3:for(n=0,i=0;i<a;i++,n++)for(3===n&&(n=0),t=n,r=0;r<a;r++,t++)3===t&&(t=0),t||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 4:for(i=0;i<a;i++)for(t=0,n=i>>1&1,r=0;r<a;r++,t++)3===t&&(t=0,n=!n),n||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 5:for(n=0,i=0;i<a;i++,n++)for(3===n&&(n=0),t=0,r=0;r<a;r++,t++)3===t&&(t=0),(r&i&1)+!(!t|!n)||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 6:for(n=0,i=0;i<a;i++,n++)for(3===n&&(n=0),t=0,r=0;r<a;r++,t++)3===t&&(t=0),(r&i&1)+(t&&t===n)&1||this._isMasked(r,i)||(o[r+i*a]^=1);break;case 7:for(n=0,i=0;i<a;i++,n++)for(3===n&&(n=0),t=0,r=0;r<a;r++,t++)3===t&&(t=0),(t&&t===n)+(r+i&1)&1||this._isMasked(r,i)||(o[r+i*a]^=1)}},_calculateMaxLength:function(){return this._dataBlock*(this._neccBlock1+this._neccBlock2)+this._neccBlock2},_calculatePolynomial:function(){var e,t,n=this._eccBlock,r=this._polynomial;for(r[0]=1,e=0;e<n;e++){for(r[e+1]=1,t=e;t>0;t--)r[t]=r[t]?r[t-1]^d.EXPONENT[f._modN(d.LOG[r[t]]+e)]:r[t-1];r[0]=d.EXPONENT[f._modN(d.LOG[r[0]]+e)]}for(e=0;e<=n;e++)r[e]=d.LOG[r[e]]},_checkBadness:function(){var e,t,n,r,i,o=0,a=this._badness,s=this.buffer,c=this.width;for(i=0;i<c-1;i++)for(r=0;r<c-1;r++)(s[r+c*i]&&s[r+1+c*i]&&s[r+c*(i+1)]&&s[r+1+c*(i+1)]||!(s[r+c*i]||s[r+1+c*i]||s[r+c*(i+1)]||s[r+1+c*(i+1)]))&&(o+=f.N2);var u=0;for(i=0;i<c;i++){for(n=0,a[0]=0,e=0,r=0;r<c;r++)e===(t=s[r+c*i])?a[n]++:a[++n]=1,u+=(e=t)?1:-1;o+=this._getBadness(n)}u<0&&(u=-u);var l=0,d=u;for(d+=d<<2,d<<=1;d>c*c;)d-=c*c,l++;for(o+=l*f.N4,r=0;r<c;r++){for(n=0,a[0]=0,e=0,i=0;i<c;i++)e===(t=s[r+c*i])?a[n]++:a[++n]=1,e=t;o+=this._getBadness(n)}return o},_convertBitStream:function(e){var t,n,r=this._ecc,i=this._version;for(n=0;n<e;n++)r[n]=this._value.charCodeAt(n);var o=this._stringBuffer=r.slice(),a=this._calculateMaxLength();e>=a-2&&(e=a-2,i>9&&e--);var s=e;if(i>9){for(o[s+2]=0,o[s+3]=0;s--;)t=o[s],o[s+3]|=255&t<<4,o[s+2]=t>>4;o[2]|=255&e<<4,o[1]=e>>4,o[0]=64|e>>12}else{for(o[s+1]=0,o[s+2]=0;s--;)t=o[s],o[s+2]|=255&t<<4,o[s+1]=t>>4;o[1]|=255&e<<4,o[0]=64|e>>4}for(s=e+3-(i<10);s<a;)o[s++]=236,o[s++]=17},_getBadness:function(e){var t,n=0,r=this._badness;for(t=0;t<=e;t++)r[t]>=5&&(n+=f.N1+r[t]-5);for(t=3;t<e-1;t+=2)r[t-2]===r[t+2]&&r[t+2]===r[t-1]&&r[t-1]===r[t+1]&&3*r[t-1]===r[t]&&(0===r[t-3]||t+3>e||3*r[t-3]>=4*r[t]||3*r[t+3]>=4*r[t])&&(n+=f.N3);return n},_finish:function(){var e,t;this._stringBuffer=this.buffer.slice();var n=0,r=3e4;for(t=0;t<8&&(this._applyMask(t),(e=this._checkBadness())<r&&(r=e,n=t),7!==n);t++)this.buffer=this._stringBuffer.slice();n!==t&&this._applyMask(n),r=l.FINAL_FORMAT[n+(this._level-1<<3)];var i=this.buffer,o=this.width;for(t=0;t<8;t++,r>>=1)1&r&&(i[o-1-t+8*o]=1,t<6?i[8+o*t]=1:i[8+o*(t+1)]=1);for(t=0;t<7;t++,r>>=1)1&r&&(i[8+o*(o-7+t)]=1,t?i[6-t+8*o]=1:i[7+8*o]=1)},_interleaveBlocks:function(){var e,t,n=this._dataBlock,r=this._ecc,i=this._eccBlock,o=0,a=this._calculateMaxLength(),s=this._neccBlock1,c=this._neccBlock2,u=this._stringBuffer;for(e=0;e<n;e++){for(t=0;t<s;t++)r[o++]=u[e+t*n];for(t=0;t<c;t++)r[o++]=u[s*n+e+t*(n+1)]}for(t=0;t<c;t++)r[o++]=u[s*n+e+t*(n+1)];for(e=0;e<i;e++)for(t=0;t<s+c;t++)r[o++]=u[a+e+t*i];this._stringBuffer=r},_insertAlignments:function(){var e,t,n,r=this._version,i=this.width;if(r>1)for(e=u.BLOCK[r],n=i-7;;){for(t=i-7;t>e-3&&(this._addAlignment(t,n),!(t<e));)t-=e;if(n<=e+9)break;n-=e,this._addAlignment(6,n),this._addAlignment(n,6)}},_insertFinders:function(){var e,t,n,r,i=this.buffer,o=this.width;for(e=0;e<3;e++){for(t=0,r=0,1===e&&(t=o-7),2===e&&(r=o-7),i[r+3+o*(t+3)]=1,n=0;n<6;n++)i[r+n+o*t]=1,i[r+o*(t+n+1)]=1,i[r+6+o*(t+n)]=1,i[r+n+1+o*(t+6)]=1;for(n=1;n<5;n++)this._setMask(r+n,t+1),this._setMask(r+1,t+n+1),this._setMask(r+5,t+n),this._setMask(r+n+1,t+5);for(n=2;n<4;n++)i[r+n+o*(t+2)]=1,i[r+2+o*(t+n+1)]=1,i[r+4+o*(t+n)]=1,i[r+n+1+o*(t+4)]=1}},_insertTimingGap:function(){var e,t,n=this.width;for(t=0;t<7;t++)this._setMask(7,t),this._setMask(n-8,t),this._setMask(7,t+n-7);for(e=0;e<8;e++)this._setMask(e,7),this._setMask(e+n-8,7),this._setMask(e,n-8)},_insertTimingRowAndColumn:function(){var e,t=this.buffer,n=this.width;for(e=0;e<n-14;e++)1&e?(this._setMask(8+e,6),this._setMask(6,8+e)):(t[8+e+6*n]=1,t[6+n*(8+e)]=1)},_insertVersion:function(){var e,t,n,r,i=this.buffer,o=this._version,a=this.width;if(o>6)for(e=h.BLOCK[o-7],t=17,n=0;n<6;n++)for(r=0;r<3;r++,t--)1&(t>11?o>>t-12:e>>t)?(i[5-n+a*(2-r+a-11)]=1,i[2-r+a-11+a*(5-n)]=1):(this._setMask(5-n,2-r+a-11),this._setMask(2-r+a-11,5-n))},_isMasked:function(e,t){var n=f._getMaskBit(e,t);return 1===this._mask[n]},_pack:function(){var e,t,n,r=1,i=1,o=this.width,a=o-1,s=o-1,c=(this._dataBlock+this._eccBlock)*(this._neccBlock1+this._neccBlock2)+this._neccBlock2;for(t=0;t<c;t++)for(e=this._stringBuffer[t],n=0;n<8;n++,e<<=1){128&e&&(this.buffer[a+o*s]=1);do{i?a--:(a++,r?0!==s?s--:(r=!r,6===(a-=2)&&(a--,s=9)):s!==o-1?s++:(r=!r,6===(a-=2)&&(a--,s-=8))),i=!i}while(this._isMasked(a,s))}},_reverseMask:function(){var e,t,n=this.width;for(e=0;e<9;e++)this._setMask(e,8);for(e=0;e<8;e++)this._setMask(e+n-8,8),this._setMask(8,e);for(t=0;t<7;t++)this._setMask(8,t+n-7)},_setMask:function(e,t){var n=f._getMaskBit(e,t);this._mask[n]=1},_syncMask:function(){var e,t,n=this.width;for(t=0;t<n;t++)for(e=0;e<=t;e++)this.buffer[e+n*t]&&this._setMask(e,t)}},{_createArray:function(e){var t,n=[];for(t=0;t<e;t++)n[t]=0;return n},_getMaskBit:function(e,t){var n;return e>t&&(n=e,e=t,t=n),n=t,n+=t*t,n>>=1,n+=e},_modN:function(e){for(;e>=255;)e=((e-=255)>>8)+(255&e);return e},N1:3,N2:3,N3:40,N4:10}),p=f,m=s.extend({draw:function(){this.element.src=this.qrious.toDataURL()},reset:function(){this.element.src=""},resize:function(){var e=this.element;e.width=e.height=this.qrious.size}}),g=a.extend((function(e,t,n,r){this.name=e,this.modifiable=Boolean(t),this.defaultValue=n,this._valueTransformer=r}),{transform:function(e){var t=this._valueTransformer;return"function"==typeof t?t(e,this):e}}),v=a.extend(null,{abs:function(e){return null!=e?Math.abs(e):null},hasOwn:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},noop:function(){},toUpperCase:function(e){return null!=e?e.toUpperCase():null}}),y=a.extend((function(e){this.options={},e.forEach((function(e){this.options[e.name]=e}),this)}),{exists:function(e){return null!=this.options[e]},get:function(e,t){return y._get(this.options[e],t)},getAll:function(e){var t,n=this.options,r={};for(t in n)v.hasOwn(n,t)&&(r[t]=y._get(n[t],e));return r},init:function(e,t,n){var r,i;for(r in"function"!=typeof n&&(n=v.noop),this.options)v.hasOwn(this.options,r)&&(i=this.options[r],y._set(i,i.defaultValue,t),y._createAccessor(i,t,n));this._setAll(e,t,!0)},set:function(e,t,n){return this._set(e,t,n)},setAll:function(e,t){return this._setAll(e,t)},_set:function(e,t,n,r){var i=this.options[e];if(!i)throw new Error("Invalid option: "+e);if(!i.modifiable&&!r)throw new Error("Option cannot be modified: "+e);return y._set(i,t,n)},_setAll:function(e,t,n){if(!e)return!1;var r,i=!1;for(r in e)v.hasOwn(e,r)&&this._set(r,e[r],t,n)&&(i=!0);return i}},{_createAccessor:function(e,t,n){var r={get:function(){return y._get(e,t)}};e.modifiable&&(r.set=function(r){y._set(e,r,t)&&n(r,e)}),Object.defineProperty(t,e.name,r)},_get:function(e,t){return t["_"+e.name]},_set:function(e,t,n){var r="_"+e.name,i=n[r],o=e.transform(null!=t?t:e.defaultValue);return n[r]=o,o!==i}}),b=y,_=a.extend((function(){this._services={}}),{getService:function(e){var t=this._services[e];if(!t)throw new Error("Service is not being managed with name: "+e);return t},setService:function(e,t){if(this._services[e])throw new Error("Service is already managed with name: "+e);t&&(this._services[e]=t)}}),E=new b([new g("background",!0,"white"),new g("backgroundAlpha",!0,1,v.abs),new g("element"),new g("foreground",!0,"black"),new g("foregroundAlpha",!0,1,v.abs),new g("level",!0,"L",v.toUpperCase),new g("mime",!0,"image/png"),new g("padding",!0,null,v.abs),new g("size",!0,100,v.abs),new g("value",!0,"")]),S=new _,w=a.extend((function(e){E.init(e,this,this.update.bind(this));var t=E.get("element",this),n=S.getService("element"),r=t&&n.isCanvas(t)?t:n.createCanvas(),i=t&&n.isImage(t)?t:n.createImage();this._canvasRenderer=new c(this,r,!0),this._imageRenderer=new m(this,i,i===t),this.update()}),{get:function(){return E.getAll(this)},set:function(e){E.setAll(e,this)&&this.update()},toDataURL:function(e){return this.canvas.toDataURL(e||this.mime)},update:function(){var e=new p({level:this.level,value:this.value});this._canvasRenderer.render(e),this._imageRenderer.render(e)}},{use:function(e){S.setService(e.getName(),e)}});Object.defineProperties(w.prototype,{canvas:{get:function(){return this._canvasRenderer.getElement()}},image:{get:function(){return this._imageRenderer.getElement()}}});var T=w,A=a.extend({getName:function(){}}).extend({createCanvas:function(){},createImage:function(){},getName:function(){return"element"},isCanvas:function(e){},isImage:function(e){}}).extend({createCanvas:function(){return document.createElement("canvas")},createImage:function(){return document.createElement("img")},isCanvas:function(e){return e instanceof HTMLCanvasElement},isImage:function(e){return e instanceof HTMLImageElement}});return T.use(new A),T}));
//# sourceMappingURL=vendors.min.js.map